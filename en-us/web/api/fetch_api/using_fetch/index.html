<p>{{DefaultAPISidebar(“Fetch API”)}}</p>
<p>The <a href="/en-US/docs/Web/API/Fetch_API">Fetch API</a> provides a JavaScript interface for accessing and manipulating parts of the HTTP pipeline, such as requests and responses. It also provides a global {{domxref(“fetch()”)}} method that provides an easy, logical way to fetch resources asynchronously across the network.</p>
<p>This kind of functionality was previously achieved using {{domxref(“XMLHttpRequest”)}}. Fetch provides a better alternative that can be easily used by other technologies such as {{domxref(“Service_Worker_API”, “Service Workers”)}}. Fetch also provides a single logical place to define other HTTP-related concepts such as <a href="/en-US/docs/Web/HTTP/CORS">CORS</a> and extensions to HTTP.</p>
<p>The <code>fetch</code> specification differs from <code>jQuery.ajax()</code> in the following significant ways:</p>
<ul>
<li>The Promise returned from <code>fetch()</code> <strong>won’t reject on HTTP error status</strong> even if the response is an HTTP 404 or 500. Instead, as soon as the server responds with headers, the Promise will resolve normally (with the {{domxref(“Response/ok”, “ok”)}} property of the response set to false if the response isn’t in the range 200–299), and it will only reject on network failure or if anything prevented the request from completing.</li>
<li><code>fetch()</code> <strong>won’t send cross-origin cookies</strong> unless you set the <em>credentials</em> <a href="/en-US/docs/Web/API/fetch#parameters">init option</a>. (Since <a href="https://github.com/whatwg/fetch/pull/585">April 2018</a>. The spec changed the default credentials policy to <code>same-origin</code>. Firefox changed since 61.0b13.)</li>
</ul>
<p>A basic fetch request is really simple to set up. Have a look at the following code:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb1-1" title="1"><span class="at">fetch</span>(<span class="st">&#39;http://example.com/movies.json&#39;</span>)</a>
<a class="sourceLine" id="cb1-2" title="2">  .<span class="at">then</span>(response <span class="kw">=&gt;</span> <span class="va">response</span>.<span class="at">json</span>())</a>
<a class="sourceLine" id="cb1-3" title="3">  .<span class="at">then</span>(data <span class="kw">=&gt;</span> <span class="va">console</span>.<span class="at">log</span>(data))<span class="op">;</span></a></code></pre></div>
<p>Here we are fetching a JSON file across the network and printing it to the console. The simplest use of <code>fetch()</code> takes one argument — the path to the resource you want to fetch — and does not directly return the JSON response body but instead returns a promise that resolves with a {{domxref(“Response”)}} object.</p>
<p>The {{domxref(“Response”)}} object, in turn, does not directly contain the actual JSON response body but is instead a representation of the entire HTTP response. So, to extract the JSON body content from the {{domxref(“Response”)}} object, we use the {{domxref(“Response.json()”, “json()”)}} method, which returns a second promise that resolves with the result of parsing the response body text as JSON.</p>
<blockquote>
<p><strong>Note:</strong> See the {{anch(“Body”)}} section for similar methods to extract other types of body content.</p>
</blockquote>
<p>Fetch requests are controlled by the <code>connect-src</code> directive of <a href="/en-US/docs/Web/HTTP/Headers/Content-Security-Policy">Content Security Policy</a> rather than the directive of the resources it’s retrieving.</p>
<h3 id="supplying-request-options">Supplying request options</h3>
<p>The <code>fetch()</code> method can optionally accept a second parameter, an <code>init</code> object that allows you to control a number of different settings:</p>
<p>See {{domxref(“fetch()”)}} for the full options available, and more details.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb2-1" title="1"><span class="co">// Example POST method implementation:</span></a>
<a class="sourceLine" id="cb2-2" title="2"><span class="kw">async</span> <span class="kw">function</span> <span class="at">postData</span>(url <span class="op">=</span> <span class="st">&#39;&#39;</span><span class="op">,</span> data <span class="op">=</span> <span class="op">{}</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb2-3" title="3">  <span class="co">// Default options are marked with *</span></a>
<a class="sourceLine" id="cb2-4" title="4">  <span class="kw">const</span> response <span class="op">=</span> <span class="cf">await</span> <span class="at">fetch</span>(url<span class="op">,</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb2-5" title="5">    <span class="dt">method</span><span class="op">:</span> <span class="st">&#39;POST&#39;</span><span class="op">,</span> <span class="co">// *GET, POST, PUT, DELETE, etc.</span></a>
<a class="sourceLine" id="cb2-6" title="6">    <span class="dt">mode</span><span class="op">:</span> <span class="st">&#39;cors&#39;</span><span class="op">,</span> <span class="co">// no-cors, *cors, same-origin</span></a>
<a class="sourceLine" id="cb2-7" title="7">    <span class="dt">cache</span><span class="op">:</span> <span class="st">&#39;no-cache&#39;</span><span class="op">,</span> <span class="co">// *default, no-cache, reload, force-cache, only-if-cached</span></a>
<a class="sourceLine" id="cb2-8" title="8">    <span class="dt">credentials</span><span class="op">:</span> <span class="st">&#39;same-origin&#39;</span><span class="op">,</span> <span class="co">// include, *same-origin, omit</span></a>
<a class="sourceLine" id="cb2-9" title="9">    <span class="dt">headers</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb2-10" title="10">      <span class="st">&#39;Content-Type&#39;</span><span class="op">:</span> <span class="st">&#39;application/json&#39;</span></a>
<a class="sourceLine" id="cb2-11" title="11">      <span class="co">// &#39;Content-Type&#39;: &#39;application/x-www-form-urlencoded&#39;,</span></a>
<a class="sourceLine" id="cb2-12" title="12">    <span class="op">},</span></a>
<a class="sourceLine" id="cb2-13" title="13">    <span class="dt">redirect</span><span class="op">:</span> <span class="st">&#39;follow&#39;</span><span class="op">,</span> <span class="co">// manual, *follow, error</span></a>
<a class="sourceLine" id="cb2-14" title="14">    <span class="dt">referrerPolicy</span><span class="op">:</span> <span class="st">&#39;no-referrer&#39;</span><span class="op">,</span> <span class="co">// no-referrer, *no-referrer-when-downgrade, origin, origin-when-cross-origin, same-origin, strict-origin, strict-origin-when-cross-origin, unsafe-url</span></a>
<a class="sourceLine" id="cb2-15" title="15">    <span class="dt">body</span><span class="op">:</span> <span class="va">JSON</span>.<span class="at">stringify</span>(data) <span class="co">// body data type must match &quot;Content-Type&quot; header</span></a>
<a class="sourceLine" id="cb2-16" title="16">  <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-17" title="17">  <span class="cf">return</span> <span class="va">response</span>.<span class="at">json</span>()<span class="op">;</span> <span class="co">// parses JSON response into native JavaScript objects</span></a>
<a class="sourceLine" id="cb2-18" title="18"><span class="op">}</span></a>
<a class="sourceLine" id="cb2-19" title="19"></a>
<a class="sourceLine" id="cb2-20" title="20"><span class="at">postData</span>(<span class="st">&#39;https://example.com/answer&#39;</span><span class="op">,</span> <span class="op">{</span> <span class="dt">answer</span><span class="op">:</span> <span class="dv">42</span> <span class="op">}</span>)</a>
<a class="sourceLine" id="cb2-21" title="21">  .<span class="at">then</span>(data <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb2-22" title="22">    <span class="va">console</span>.<span class="at">log</span>(data)<span class="op">;</span> <span class="co">// JSON data parsed by `data.json()` call</span></a>
<a class="sourceLine" id="cb2-23" title="23">  <span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>Note that <code>mode: "no-cors"</code> only allows a limited set of headers in the request:</p>
<ul>
<li><code>Accept</code></li>
<li><code>Accept-Language</code></li>
<li><code>Content-Language</code></li>
<li><code>Content-Type</code> with a value of <code>application/x-www-form-urlencoded</code>, <code>multipart/form-data</code>, or <code>text/plain</code></li>
</ul>
<h3 id="sending-a-request-with-credentials-included">Sending a request with credentials included</h3>
<p>To cause browsers to send a request with credentials included on both same-origin and cross-origin calls, add <code>credentials: 'include'</code> to the <code>init</code> object you pass to the <code>fetch()</code> method.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb3-1" title="1"><span class="at">fetch</span>(<span class="st">&#39;https://example.com&#39;</span><span class="op">,</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb3-2" title="2">  <span class="dt">credentials</span><span class="op">:</span> <span class="st">&#39;include&#39;</span></a>
<a class="sourceLine" id="cb3-3" title="3"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<blockquote>
<p><strong>Note:</strong> <code>Access-Control-Allow-Origin</code> is prohibited from using a wildcard for requests with <code>credentials: 'include'</code>. In such cases, the exact origin must be provided; even if you are using a CORS unblocker extension, the requests will still fail.</p>
</blockquote>
<blockquote>
<p><strong>Note:</strong> Browsers should not send credentials in <em>preflight requests</em> irrespective of this setting. For more information see: <a href="/en-US/docs/Web/HTTP/CORS#requests_with_credentials">CORS &gt; Requests with credentials</a>.</p>
</blockquote>
<p>If you only want to send credentials if the request URL is on the same origin as the calling script, add <code>credentials: 'same-origin'</code>.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb4-1" title="1"><span class="co">// The calling script is on the origin &#39;https://example.com&#39;</span></a>
<a class="sourceLine" id="cb4-2" title="2"></a>
<a class="sourceLine" id="cb4-3" title="3"><span class="at">fetch</span>(<span class="st">&#39;https://example.com&#39;</span><span class="op">,</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb4-4" title="4">  <span class="dt">credentials</span><span class="op">:</span> <span class="st">&#39;same-origin&#39;</span></a>
<a class="sourceLine" id="cb4-5" title="5"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>To instead ensure browsers don’t include credentials in the request, use <code>credentials: 'omit'</code>.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb5-1" title="1"><span class="at">fetch</span>(<span class="st">&#39;https://example.com&#39;</span><span class="op">,</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb5-2" title="2">  <span class="dt">credentials</span><span class="op">:</span> <span class="st">&#39;omit&#39;</span></a>
<a class="sourceLine" id="cb5-3" title="3"><span class="op">}</span>)</a></code></pre></div>
<h3 id="uploading-json-data">Uploading JSON data</h3>
<p>Use {{domxref(“fetch()”)}} to POST JSON-encoded data.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb6-1" title="1"><span class="kw">const</span> data <span class="op">=</span> <span class="op">{</span> <span class="dt">username</span><span class="op">:</span> <span class="st">&#39;example&#39;</span> <span class="op">};</span></a>
<a class="sourceLine" id="cb6-2" title="2"></a>
<a class="sourceLine" id="cb6-3" title="3"><span class="at">fetch</span>(<span class="st">&#39;https://example.com/profile&#39;</span><span class="op">,</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb6-4" title="4">  <span class="dt">method</span><span class="op">:</span> <span class="st">&#39;POST&#39;</span><span class="op">,</span> <span class="co">// or &#39;PUT&#39;</span></a>
<a class="sourceLine" id="cb6-5" title="5">  <span class="dt">headers</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb6-6" title="6">    <span class="st">&#39;Content-Type&#39;</span><span class="op">:</span> <span class="st">&#39;application/json&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb6-7" title="7">  <span class="op">},</span></a>
<a class="sourceLine" id="cb6-8" title="8">  <span class="dt">body</span><span class="op">:</span> <span class="va">JSON</span>.<span class="at">stringify</span>(data)<span class="op">,</span></a>
<a class="sourceLine" id="cb6-9" title="9"><span class="op">}</span>)</a>
<a class="sourceLine" id="cb6-10" title="10">.<span class="at">then</span>(response <span class="kw">=&gt;</span> <span class="va">response</span>.<span class="at">json</span>())</a>
<a class="sourceLine" id="cb6-11" title="11">.<span class="at">then</span>(data <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb6-12" title="12">  <span class="va">console</span>.<span class="at">log</span>(<span class="st">&#39;Success:&#39;</span><span class="op">,</span> data)<span class="op">;</span></a>
<a class="sourceLine" id="cb6-13" title="13"><span class="op">}</span>)</a>
<a class="sourceLine" id="cb6-14" title="14">.<span class="at">catch</span>((error) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb6-15" title="15">  <span class="va">console</span>.<span class="at">error</span>(<span class="st">&#39;Error:&#39;</span><span class="op">,</span> error)<span class="op">;</span></a>
<a class="sourceLine" id="cb6-16" title="16"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<h3 id="uploading-a-file">Uploading a file</h3>
<p>Files can be uploaded using an HTML <code>&lt;input type="file" /&gt;</code> input element, {{domxref(“FormData.FormData”,“FormData()”)}} and {{domxref(“fetch()”)}}.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb7-1" title="1"><span class="kw">const</span> formData <span class="op">=</span> <span class="kw">new</span> <span class="at">FormData</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb7-2" title="2"><span class="kw">const</span> fileField <span class="op">=</span> <span class="va">document</span>.<span class="at">querySelector</span>(<span class="st">&#39;input[type=&quot;file&quot;]&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb7-3" title="3"></a>
<a class="sourceLine" id="cb7-4" title="4"><span class="va">formData</span>.<span class="at">append</span>(<span class="st">&#39;username&#39;</span><span class="op">,</span> <span class="st">&#39;abc123&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb7-5" title="5"><span class="va">formData</span>.<span class="at">append</span>(<span class="st">&#39;avatar&#39;</span><span class="op">,</span> <span class="va">fileField</span>.<span class="at">files</span>[<span class="dv">0</span>])<span class="op">;</span></a>
<a class="sourceLine" id="cb7-6" title="6"></a>
<a class="sourceLine" id="cb7-7" title="7"><span class="at">fetch</span>(<span class="st">&#39;https://example.com/profile/avatar&#39;</span><span class="op">,</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb7-8" title="8">  <span class="dt">method</span><span class="op">:</span> <span class="st">&#39;PUT&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb7-9" title="9">  <span class="dt">body</span><span class="op">:</span> formData</a>
<a class="sourceLine" id="cb7-10" title="10"><span class="op">}</span>)</a>
<a class="sourceLine" id="cb7-11" title="11">.<span class="at">then</span>(response <span class="kw">=&gt;</span> <span class="va">response</span>.<span class="at">json</span>())</a>
<a class="sourceLine" id="cb7-12" title="12">.<span class="at">then</span>(result <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb7-13" title="13">  <span class="va">console</span>.<span class="at">log</span>(<span class="st">&#39;Success:&#39;</span><span class="op">,</span> result)<span class="op">;</span></a>
<a class="sourceLine" id="cb7-14" title="14"><span class="op">}</span>)</a>
<a class="sourceLine" id="cb7-15" title="15">.<span class="at">catch</span>(error <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb7-16" title="16">  <span class="va">console</span>.<span class="at">error</span>(<span class="st">&#39;Error:&#39;</span><span class="op">,</span> error)<span class="op">;</span></a>
<a class="sourceLine" id="cb7-17" title="17"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<h3 id="uploading-multiple-files">Uploading multiple files</h3>
<p>Files can be uploaded using an HTML <code>&lt;input type="file" multiple /&gt;</code> input element, {{domxref(“FormData.FormData”,“FormData()”)}} and {{domxref(“fetch()”)}}.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb8-1" title="1"><span class="kw">const</span> formData <span class="op">=</span> <span class="kw">new</span> <span class="at">FormData</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb8-2" title="2"><span class="kw">const</span> photos <span class="op">=</span> <span class="va">document</span>.<span class="at">querySelector</span>(<span class="st">&#39;input[type=&quot;file&quot;][multiple]&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb8-3" title="3"></a>
<a class="sourceLine" id="cb8-4" title="4"><span class="va">formData</span>.<span class="at">append</span>(<span class="st">&#39;title&#39;</span><span class="op">,</span> <span class="st">&#39;My Vegas Vacation&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb8-5" title="5"><span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="va">photos</span>.<span class="va">files</span>.<span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb8-6" title="6">  <span class="va">formData</span>.<span class="at">append</span>(<span class="vs">`photos_</span><span class="sc">${</span>i<span class="sc">}</span><span class="vs">`</span><span class="op">,</span> <span class="va">photos</span>.<span class="at">files</span>[i])<span class="op">;</span></a>
<a class="sourceLine" id="cb8-7" title="7"><span class="op">}</span></a>
<a class="sourceLine" id="cb8-8" title="8"></a>
<a class="sourceLine" id="cb8-9" title="9"><span class="at">fetch</span>(<span class="st">&#39;https://example.com/posts&#39;</span><span class="op">,</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb8-10" title="10">  <span class="dt">method</span><span class="op">:</span> <span class="st">&#39;POST&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb8-11" title="11">  <span class="dt">body</span><span class="op">:</span> formData<span class="op">,</span></a>
<a class="sourceLine" id="cb8-12" title="12"><span class="op">}</span>)</a>
<a class="sourceLine" id="cb8-13" title="13">.<span class="at">then</span>(response <span class="kw">=&gt;</span> <span class="va">response</span>.<span class="at">json</span>())</a>
<a class="sourceLine" id="cb8-14" title="14">.<span class="at">then</span>(result <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb8-15" title="15">  <span class="va">console</span>.<span class="at">log</span>(<span class="st">&#39;Success:&#39;</span><span class="op">,</span> result)<span class="op">;</span></a>
<a class="sourceLine" id="cb8-16" title="16"><span class="op">}</span>)</a>
<a class="sourceLine" id="cb8-17" title="17">.<span class="at">catch</span>(error <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb8-18" title="18">  <span class="va">console</span>.<span class="at">error</span>(<span class="st">&#39;Error:&#39;</span><span class="op">,</span> error)<span class="op">;</span></a>
<a class="sourceLine" id="cb8-19" title="19"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<h3 id="processing-a-text-file-line-by-line">Processing a text file line by line</h3>
<p>The chunks that are read from a response are not broken neatly at line boundaries and are Uint8Arrays, not strings. If you want to fetch a text file and process it line by line, it is up to you to handle these complications. The following example shows one way to do this by creating a line iterator (for simplicity, it assumes the text is UTF-8, and doesn’t handle fetch errors).</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb9-1" title="1"><span class="kw">async</span> <span class="kw">function</span><span class="op">*</span> <span class="at">makeTextFileLineIterator</span>(fileURL) <span class="op">{</span></a>
<a class="sourceLine" id="cb9-2" title="2">  <span class="kw">const</span> utf8Decoder <span class="op">=</span> <span class="kw">new</span> <span class="at">TextDecoder</span>(<span class="st">&#39;utf-8&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb9-3" title="3">  <span class="kw">const</span> response <span class="op">=</span> <span class="cf">await</span> <span class="at">fetch</span>(fileURL)<span class="op">;</span></a>
<a class="sourceLine" id="cb9-4" title="4">  <span class="kw">const</span> reader <span class="op">=</span> <span class="va">response</span>.<span class="va">body</span>.<span class="at">getReader</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb9-5" title="5">  <span class="kw">let</span> <span class="op">{</span> <span class="dt">value</span><span class="op">:</span> chunk<span class="op">,</span> <span class="dt">done</span><span class="op">:</span> readerDone <span class="op">}</span> <span class="op">=</span> <span class="cf">await</span> <span class="va">reader</span>.<span class="at">read</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb9-6" title="6">  chunk <span class="op">=</span> chunk <span class="op">?</span> <span class="va">utf8Decoder</span>.<span class="at">decode</span>(chunk) : <span class="st">&#39;&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb9-7" title="7"></a>
<a class="sourceLine" id="cb9-8" title="8">  <span class="kw">const</span> re <span class="op">=</span> <span class="ss">/</span><span class="sc">\n|\r|\r\n</span><span class="ss">/gm</span><span class="op">;</span></a>
<a class="sourceLine" id="cb9-9" title="9">  <span class="kw">let</span> startIndex <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></a>
<a class="sourceLine" id="cb9-10" title="10">  <span class="kw">let</span> result<span class="op">;</span></a>
<a class="sourceLine" id="cb9-11" title="11"></a>
<a class="sourceLine" id="cb9-12" title="12">  <span class="cf">for</span> (<span class="op">;;</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb9-13" title="13">    <span class="kw">let</span> result <span class="op">=</span> <span class="va">re</span>.<span class="at">exec</span>(chunk)<span class="op">;</span></a>
<a class="sourceLine" id="cb9-14" title="14">    <span class="cf">if</span> (<span class="op">!</span>result) <span class="op">{</span></a>
<a class="sourceLine" id="cb9-15" title="15">      <span class="cf">if</span> (readerDone) <span class="op">{</span></a>
<a class="sourceLine" id="cb9-16" title="16">        <span class="cf">break</span><span class="op">;</span></a>
<a class="sourceLine" id="cb9-17" title="17">      <span class="op">}</span></a>
<a class="sourceLine" id="cb9-18" title="18">      <span class="kw">let</span> remainder <span class="op">=</span> <span class="va">chunk</span>.<span class="at">substr</span>(startIndex)<span class="op">;</span></a>
<a class="sourceLine" id="cb9-19" title="19">      (<span class="op">{</span> <span class="dt">value</span><span class="op">:</span> chunk<span class="op">,</span> <span class="dt">done</span><span class="op">:</span> readerDone <span class="op">}</span> <span class="op">=</span> <span class="cf">await</span> <span class="va">reader</span>.<span class="at">read</span>())<span class="op">;</span></a>
<a class="sourceLine" id="cb9-20" title="20">      chunk <span class="op">=</span> remainder <span class="op">+</span> (chunk <span class="op">?</span> <span class="va">utf8Decoder</span>.<span class="at">decode</span>(chunk) : <span class="st">&#39;&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb9-21" title="21">      startIndex <span class="op">=</span> <span class="va">re</span>.<span class="at">lastIndex</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></a>
<a class="sourceLine" id="cb9-22" title="22">      <span class="cf">continue</span><span class="op">;</span></a>
<a class="sourceLine" id="cb9-23" title="23">    <span class="op">}</span></a>
<a class="sourceLine" id="cb9-24" title="24">    <span class="kw">yield</span> <span class="va">chunk</span>.<span class="at">substring</span>(startIndex<span class="op">,</span> <span class="va">result</span>.<span class="at">index</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb9-25" title="25">    startIndex <span class="op">=</span> <span class="va">re</span>.<span class="at">lastIndex</span><span class="op">;</span></a>
<a class="sourceLine" id="cb9-26" title="26">  <span class="op">}</span></a>
<a class="sourceLine" id="cb9-27" title="27">  <span class="cf">if</span> (startIndex <span class="op">&lt;</span> <span class="va">chunk</span>.<span class="at">length</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb9-28" title="28">    <span class="co">// last line didn&#39;t end in a newline char</span></a>
<a class="sourceLine" id="cb9-29" title="29">    <span class="kw">yield</span> <span class="va">chunk</span>.<span class="at">substr</span>(startIndex)<span class="op">;</span></a>
<a class="sourceLine" id="cb9-30" title="30">  <span class="op">}</span></a>
<a class="sourceLine" id="cb9-31" title="31"><span class="op">}</span></a>
<a class="sourceLine" id="cb9-32" title="32"></a>
<a class="sourceLine" id="cb9-33" title="33"><span class="kw">async</span> <span class="kw">function</span> <span class="at">run</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb9-34" title="34">  <span class="cf">for</span> <span class="cf">await</span> (<span class="kw">let</span> line <span class="kw">of</span> <span class="at">makeTextFileLineIterator</span>(urlOfFile)) <span class="op">{</span></a>
<a class="sourceLine" id="cb9-35" title="35">    <span class="at">processLine</span>(line)<span class="op">;</span></a>
<a class="sourceLine" id="cb9-36" title="36">  <span class="op">}</span></a>
<a class="sourceLine" id="cb9-37" title="37"><span class="op">}</span></a>
<a class="sourceLine" id="cb9-38" title="38"></a>
<a class="sourceLine" id="cb9-39" title="39"><span class="at">run</span>()<span class="op">;</span></a></code></pre></div>
<h3 id="checking-that-the-fetch-was-successful">Checking that the fetch was successful</h3>
<p>A {{domxref(“fetch()”)}} promise will reject with a {{jsxref(“TypeError”)}} when a network error is encountered or CORS is misconfigured on the server-side, although this usually means permission issues or similar — a 404 does not constitute a network error, for example. An accurate check for a successful <code>fetch()</code> would include checking that the promise resolved, then checking that the {{domxref(“Response.ok”)}} property has a value of true. The code would look something like this:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb10-1" title="1"><span class="at">fetch</span>(<span class="st">&#39;flowers.jpg&#39;</span>)</a>
<a class="sourceLine" id="cb10-2" title="2">  .<span class="at">then</span>(response <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb10-3" title="3">    <span class="cf">if</span> (<span class="op">!</span><span class="va">response</span>.<span class="at">ok</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb10-4" title="4">      <span class="cf">throw</span> <span class="kw">new</span> <span class="at">Error</span>(<span class="st">&#39;Network response was not OK&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb10-5" title="5">    <span class="op">}</span></a>
<a class="sourceLine" id="cb10-6" title="6">    <span class="cf">return</span> <span class="va">response</span>.<span class="at">blob</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb10-7" title="7">  <span class="op">}</span>)</a>
<a class="sourceLine" id="cb10-8" title="8">  .<span class="at">then</span>(myBlob <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb10-9" title="9">    <span class="va">myImage</span>.<span class="at">src</span> <span class="op">=</span> <span class="va">URL</span>.<span class="at">createObjectURL</span>(myBlob)<span class="op">;</span></a>
<a class="sourceLine" id="cb10-10" title="10">  <span class="op">}</span>)</a>
<a class="sourceLine" id="cb10-11" title="11">  .<span class="at">catch</span>(error <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb10-12" title="12">    <span class="va">console</span>.<span class="at">error</span>(<span class="st">&#39;There has been a problem with your fetch operation:&#39;</span><span class="op">,</span> error)<span class="op">;</span></a>
<a class="sourceLine" id="cb10-13" title="13">  <span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<h3 id="supplying-your-own-request-object">Supplying your own request object</h3>
<p>Instead of passing a path to the resource you want to request into the <code>fetch()</code> call, you can create a request object using the {{domxref(“Request.Request”,“Request()”)}} constructor, and pass that in as a <code>fetch()</code> method argument:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb11-1" title="1"><span class="kw">const</span> myHeaders <span class="op">=</span> <span class="kw">new</span> <span class="at">Headers</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb11-2" title="2"></a>
<a class="sourceLine" id="cb11-3" title="3"><span class="kw">const</span> myRequest <span class="op">=</span> <span class="kw">new</span> <span class="at">Request</span>(<span class="st">&#39;flowers.jpg&#39;</span><span class="op">,</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb11-4" title="4">  <span class="dt">method</span><span class="op">:</span> <span class="st">&#39;GET&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb11-5" title="5">  <span class="dt">headers</span><span class="op">:</span> myHeaders<span class="op">,</span></a>
<a class="sourceLine" id="cb11-6" title="6">  <span class="dt">mode</span><span class="op">:</span> <span class="st">&#39;cors&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb11-7" title="7">  <span class="dt">cache</span><span class="op">:</span> <span class="st">&#39;default&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb11-8" title="8"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb11-9" title="9"></a>
<a class="sourceLine" id="cb11-10" title="10"><span class="at">fetch</span>(myRequest)</a>
<a class="sourceLine" id="cb11-11" title="11">  .<span class="at">then</span>(response <span class="kw">=&gt;</span> <span class="va">response</span>.<span class="at">blob</span>())</a>
<a class="sourceLine" id="cb11-12" title="12">  .<span class="at">then</span>(myBlob <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb11-13" title="13">    <span class="va">myImage</span>.<span class="at">src</span> <span class="op">=</span> <span class="va">URL</span>.<span class="at">createObjectURL</span>(myBlob)<span class="op">;</span></a>
<a class="sourceLine" id="cb11-14" title="14">  <span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p><code>Request()</code> accepts exactly the same parameters as the <code>fetch()</code> method. You can even pass in an existing request object to create a copy of it:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb12-1" title="1"><span class="kw">const</span> anotherRequest <span class="op">=</span> <span class="kw">new</span> <span class="at">Request</span>(myRequest<span class="op">,</span> myInit)<span class="op">;</span></a></code></pre></div>
<p>This is pretty useful, as request and response bodies are one use only. Making a copy like this allows you to make use of the request/response again while varying the <code>init</code> options if desired. The copy must be made before the body is read, and reading the body in the copy will also mark it as read in the original request.</p>
<blockquote>
<p><strong>Note:</strong> There is also a {{domxref(“Request.clone”,“clone()”)}} method that creates a copy. Both methods of creating a copy will fail if the body of the original request or response has already been read, but reading the body of a cloned response or request will not cause it to be marked as read in the original.</p>
</blockquote>
<h2 id="headers">Headers</h2>
<p>The {{domxref(“Headers”)}} interface allows you to create your own headers object via the {{domxref(“Headers.Headers”,“Headers()”)}} constructor. A headers object is a simple multi-map of names to values:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb13-1" title="1"><span class="kw">const</span> content <span class="op">=</span> <span class="st">&#39;Hello World&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb13-2" title="2"><span class="kw">const</span> myHeaders <span class="op">=</span> <span class="kw">new</span> <span class="at">Headers</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb13-3" title="3"><span class="va">myHeaders</span>.<span class="at">append</span>(<span class="st">&#39;Content-Type&#39;</span><span class="op">,</span> <span class="st">&#39;text/plain&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb13-4" title="4"><span class="va">myHeaders</span>.<span class="at">append</span>(<span class="st">&#39;Content-Length&#39;</span><span class="op">,</span> <span class="va">content</span>.<span class="va">length</span>.<span class="at">toString</span>())<span class="op">;</span></a>
<a class="sourceLine" id="cb13-5" title="5"><span class="va">myHeaders</span>.<span class="at">append</span>(<span class="st">&#39;X-Custom-Header&#39;</span><span class="op">,</span> <span class="st">&#39;ProcessThisImmediately&#39;</span>)<span class="op">;</span></a></code></pre></div>
<p>The same can be achieved by passing an array of arrays or an object literal to the constructor:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb14-1" title="1"><span class="kw">const</span> myHeaders <span class="op">=</span> <span class="kw">new</span> <span class="at">Headers</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb14-2" title="2">  <span class="st">&#39;Content-Type&#39;</span><span class="op">:</span> <span class="st">&#39;text/plain&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb14-3" title="3">  <span class="st">&#39;Content-Length&#39;</span><span class="op">:</span> <span class="va">content</span>.<span class="va">length</span>.<span class="at">toString</span>()<span class="op">,</span></a>
<a class="sourceLine" id="cb14-4" title="4">  <span class="st">&#39;X-Custom-Header&#39;</span><span class="op">:</span> <span class="st">&#39;ProcessThisImmediately&#39;</span></a>
<a class="sourceLine" id="cb14-5" title="5"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>The contents can be queried and retrieved:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb15-1" title="1"><span class="va">console</span>.<span class="at">log</span>(<span class="va">myHeaders</span>.<span class="at">has</span>(<span class="st">&#39;Content-Type&#39;</span>))<span class="op">;</span> <span class="co">// true</span></a>
<a class="sourceLine" id="cb15-2" title="2"><span class="va">console</span>.<span class="at">log</span>(<span class="va">myHeaders</span>.<span class="at">has</span>(<span class="st">&#39;Set-Cookie&#39;</span>))<span class="op">;</span> <span class="co">// false</span></a>
<a class="sourceLine" id="cb15-3" title="3"><span class="va">myHeaders</span>.<span class="at">set</span>(<span class="st">&#39;Content-Type&#39;</span><span class="op">,</span> <span class="st">&#39;text/html&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb15-4" title="4"><span class="va">myHeaders</span>.<span class="at">append</span>(<span class="st">&#39;X-Custom-Header&#39;</span><span class="op">,</span> <span class="st">&#39;AnotherValue&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb15-5" title="5"></a>
<a class="sourceLine" id="cb15-6" title="6"><span class="va">console</span>.<span class="at">log</span>(<span class="va">myHeaders</span>.<span class="at">get</span>(<span class="st">&#39;Content-Length&#39;</span>))<span class="op">;</span> <span class="co">// 11</span></a>
<a class="sourceLine" id="cb15-7" title="7"><span class="va">console</span>.<span class="at">log</span>(<span class="va">myHeaders</span>.<span class="at">get</span>(<span class="st">&#39;X-Custom-Header&#39;</span>))<span class="op">;</span> <span class="co">// [&#39;ProcessThisImmediately&#39;, &#39;AnotherValue&#39;]</span></a>
<a class="sourceLine" id="cb15-8" title="8"></a>
<a class="sourceLine" id="cb15-9" title="9"><span class="va">myHeaders</span>.<span class="at">delete</span>(<span class="st">&#39;X-Custom-Header&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb15-10" title="10"><span class="va">console</span>.<span class="at">log</span>(<span class="va">myHeaders</span>.<span class="at">get</span>(<span class="st">&#39;X-Custom-Header&#39;</span>))<span class="op">;</span> <span class="co">// null</span></a></code></pre></div>
<p>Some of these operations are only useful in {{domxref(“Service_Worker_API”,“ServiceWorkers”)}}, but they provide a much nicer API for manipulating headers.</p>
<p>All of the Headers methods throw a <code>TypeError</code> if a header name is used that is not a valid HTTP Header name. The mutation operations will throw a <code>TypeError</code> if there is an immutable guard (<a href="#guard">see below</a>). Otherwise, they fail silently. For example:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb16-1" title="1"><span class="kw">const</span> myResponse <span class="op">=</span> <span class="va">Response</span>.<span class="at">error</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb16-2" title="2"><span class="cf">try</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb16-3" title="3">  <span class="va">myResponse</span>.<span class="va">headers</span>.<span class="at">set</span>(<span class="st">&#39;Origin&#39;</span><span class="op">,</span> <span class="st">&#39;http://mybank.com&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb16-4" title="4"><span class="op">}</span> <span class="cf">catch</span> (e) <span class="op">{</span></a>
<a class="sourceLine" id="cb16-5" title="5">  <span class="va">console</span>.<span class="at">log</span>(<span class="st">&#39;Cannot pretend to be a bank!&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb16-6" title="6"><span class="op">}</span></a></code></pre></div>
<p>A good use case for headers is checking whether the content type is correct before you process it further. For example:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb17-1" title="1"><span class="at">fetch</span>(myRequest)</a>
<a class="sourceLine" id="cb17-2" title="2">  .<span class="at">then</span>(response <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb17-3" title="3">     <span class="kw">const</span> contentType <span class="op">=</span> <span class="va">response</span>.<span class="va">headers</span>.<span class="at">get</span>(<span class="st">&#39;content-type&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb17-4" title="4">     <span class="cf">if</span> (<span class="op">!</span>contentType <span class="op">||</span> <span class="op">!</span><span class="va">contentType</span>.<span class="at">includes</span>(<span class="st">&#39;application/json&#39;</span>)) <span class="op">{</span></a>
<a class="sourceLine" id="cb17-5" title="5">       <span class="cf">throw</span> <span class="kw">new</span> <span class="at">TypeError</span>(<span class="st">&quot;Oops, we haven&#39;t got JSON!&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb17-6" title="6">     <span class="op">}</span></a>
<a class="sourceLine" id="cb17-7" title="7">     <span class="cf">return</span> <span class="va">response</span>.<span class="at">json</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb17-8" title="8">  <span class="op">}</span>)</a>
<a class="sourceLine" id="cb17-9" title="9">  .<span class="at">then</span>(data <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb17-10" title="10">      <span class="co">/* process your data further */</span></a>
<a class="sourceLine" id="cb17-11" title="11">  <span class="op">}</span>)</a>
<a class="sourceLine" id="cb17-12" title="12">  .<span class="at">catch</span>(error <span class="kw">=&gt;</span> <span class="va">console</span>.<span class="at">error</span>(error))<span class="op">;</span></a></code></pre></div>
<h3 id="guard">Guard</h3>
<p>Since headers can be sent in requests and received in responses, and have various limitations about what information can and should be mutable, headers’ objects have a <em>guard</em> property. This is not exposed to the Web, but it affects which mutation operations are allowed on the headers object.</p>
<p>Possible guard values are:</p>
<ul>
<li><code>none</code>: default.</li>
<li><code>request</code>: guard for a headers object obtained from a request ({{domxref(“Request.headers”)}}).</li>
<li><code>request-no-cors</code>: guard for a headers object obtained from a request created with {{domxref(“Request.mode”)}} <code>no-cors</code>.</li>
<li><code>response</code>: guard for a headers object obtained from a response ({{domxref(“Response.headers”)}}).</li>
<li><code>immutable</code>: guard that renders a headers object read-only; mostly used for ServiceWorkers.</li>
</ul>
<blockquote>
<p><strong>Note:</strong> You may not append or set the <code>Content-Length</code> header on a guarded headers object for a <code>response</code>. Similarly, inserting <code>Set-Cookie</code> into a response header is not allowed: ServiceWorkers are not allowed to set cookies via synthesized responses.</p>
</blockquote>
<h2 id="response-objects">Response objects</h2>
<p>As you have seen above, {{domxref(“Response”)}} instances are returned when <code>fetch()</code> promises are resolved.</p>
<p>The most common response properties you’ll use are:</p>
<ul>
<li>{{domxref(“Response.status”)}} — An integer (default value 200) containing the response status code.</li>
<li>{{domxref(“Response.statusText”)}} — A string (default value ""), which corresponds to the HTTP status code message. Note that HTTP/2 <a href="https://fetch.spec.whatwg.org/#concept-response-status-message">does not support</a> status messages.</li>
<li>{{domxref(“Response.ok”)}} — seen in use above, this is a shorthand for checking that status is in the range 200-299 inclusive. This returns a boolean value.</li>
</ul>
<p>They can also be created programmatically via JavaScript, but this is only really useful in {{domxref(“Service_Worker_API”, “ServiceWorkers”)}}, when you are providing a custom response to a received request using a {{domxref(“FetchEvent.respondWith”,“respondWith()”)}} method:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb18-1" title="1"><span class="kw">const</span> myBody <span class="op">=</span> <span class="kw">new</span> <span class="at">Blob</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb18-2" title="2"></a>
<a class="sourceLine" id="cb18-3" title="3"><span class="at">addEventListener</span>(<span class="st">&#39;fetch&#39;</span><span class="op">,</span> <span class="kw">function</span>(event) <span class="op">{</span></a>
<a class="sourceLine" id="cb18-4" title="4">  <span class="co">// ServiceWorker intercepting a fetch</span></a>
<a class="sourceLine" id="cb18-5" title="5">  <span class="va">event</span>.<span class="at">respondWith</span>(</a>
<a class="sourceLine" id="cb18-6" title="6">    <span class="kw">new</span> <span class="at">Response</span>(myBody<span class="op">,</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb18-7" title="7">      <span class="dt">headers</span><span class="op">:</span> <span class="op">{</span> <span class="st">&#39;Content-Type&#39;</span><span class="op">:</span> <span class="st">&#39;text/plain&#39;</span> <span class="op">}</span></a>
<a class="sourceLine" id="cb18-8" title="8">    <span class="op">}</span>)</a>
<a class="sourceLine" id="cb18-9" title="9">  )<span class="op">;</span></a>
<a class="sourceLine" id="cb18-10" title="10"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>The {{domxref(“Response.Response”,“Response()”)}} constructor takes two optional arguments — a body for the response, and an init object (similar to the one that {{domxref(“Request.Request”,“Request()”)}} accepts.)</p>
<blockquote>
<p><strong>Note:</strong> The static method {{domxref(“Response.error”,“error()”)}} returns an error response. Similarly, {{domxref(“Response.redirect”,“redirect()”)}} returns a response resulting in a redirect to a specified URL. These are also only relevant to Service Workers.</p>
</blockquote>
<h2 id="body">Body</h2>
<p>Both requests and responses may contain body data. A body is an instance of any of the following types:</p>
<ul>
<li>{{jsxref(“ArrayBuffer”)}}</li>
<li>{{domxref(“ArrayBufferView”)}} (Uint8Array and friends)</li>
<li>{{domxref(“Blob”)}}/File</li>
<li>string</li>
<li>{{domxref(“URLSearchParams”)}}</li>
<li>{{domxref(“FormData”)}}</li>
</ul>
<p>The {{domxref(“Request”)}} and {{domxref(“Response”)}} interfaces share the following methods to extract a body. These all return a promise that is eventually resolved with the actual content.</p>
<ul>
<li>{{domxref(“Request.arrayBuffer()”)}} / {{domxref(“Response.arrayBuffer()”)}}</li>
<li>{{domxref(“Request.blob()”)}} / {{domxref(“Response.blob()”)}}</li>
<li>{{domxref(“Request.formData()”)}} / {{domxref(“Response.formData()”)}}</li>
<li>{{domxref(“Request.json()”)}} / {{domxref(“Response.json()”)}}</li>
<li>{{domxref(“Request.text()”)}} / {{domxref(“Response.text()”)}}</li>
</ul>
<p>This makes usage of non-textual data much easier than it was with XHR.</p>
<p>Request bodies can be set by passing body parameters:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb19-1" title="1"><span class="kw">const</span> form <span class="op">=</span> <span class="kw">new</span> <span class="at">FormData</span>(<span class="va">document</span>.<span class="at">getElementById</span>(<span class="st">&#39;login-form&#39;</span>))<span class="op">;</span></a>
<a class="sourceLine" id="cb19-2" title="2"><span class="at">fetch</span>(<span class="st">&#39;/login&#39;</span><span class="op">,</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb19-3" title="3">  <span class="dt">method</span><span class="op">:</span> <span class="st">&#39;POST&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb19-4" title="4">  <span class="dt">body</span><span class="op">:</span> form</a>
<a class="sourceLine" id="cb19-5" title="5"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>Both request and response (and by extension the <code>fetch()</code> function), will try to intelligently determine the content type. A request will also automatically set a <code>Content-Type</code> header if none is set in the dictionary.</p>
<h2 id="feature-detection">Feature detection</h2>
<p>Fetch API support can be detected by checking for the existence of {{domxref(“Headers”)}}, {{domxref(“Request”)}}, {{domxref(“Response”)}} or {{domxref(“fetch()”)}} on the {{domxref(“Window”)}} or {{domxref(“Worker”)}} scope. For example:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb20-1" title="1"><span class="cf">if</span> (<span class="va">window</span>.<span class="at">fetch</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb20-2" title="2">  <span class="co">// run my fetch request here</span></a>
<a class="sourceLine" id="cb20-3" title="3"><span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb20-4" title="4">  <span class="co">// do something with XMLHttpRequest?</span></a>
<a class="sourceLine" id="cb20-5" title="5"><span class="op">}</span></a></code></pre></div>
<h2 id="polyfill">Polyfill</h2>
<p>To use Fetch in unsupported browsers, there is a <a href="https://github.com/github/fetch">Fetch Polyfill</a> available that recreates the functionality for non-supporting browsers.</p>
<h2 id="specifications">Specifications</h2>
<table>
<thead>
<tr class="header">
<th>Specification</th>
<th>Status</th>
<th>Comment</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>{{SpecName(‘Fetch’)}}</td>
<td>{{Spec2(‘Fetch’)}}</td>
<td>Initial definition</td>
</tr>
</tbody>
</table>
<h2 id="browser-compatibility">Browser compatibility</h2>
<p>{{Compat(“api.fetch”)}}</p>
<h2 id="see-also">See also</h2>
<ul>
<li><a href="/en-US/docs/Web/API/Service_Worker_API">ServiceWorker API</a></li>
<li><a href="/en-US/docs/Web/HTTP/CORS">HTTP access control (CORS)</a></li>
<li><a href="/en-US/docs/Web/HTTP">HTTP</a></li>
<li><a href="https://github.com/github/fetch">Fetch polyfill</a></li>
<li><a href="https://github.com/mdn/fetch-examples/">Fetch examples on Github</a></li>
</ul>
