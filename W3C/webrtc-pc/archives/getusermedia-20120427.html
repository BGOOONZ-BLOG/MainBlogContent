<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.0 Transitional//EN' 'http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd'>
<html dir="ltr" xmlns="http://www.w3.org/1999/xhtml" typeof="bibo:Document">
<head>
  <meta content="HTML Tidy for HTML5 (experimental) for Mac OS X https://github.com/w3c/tidy-html5/tree/d193420" name="generator" />
  <link type="text/css" rel="stylesheet" href="getusermedia.css" />
  <link type="text/css" rel="stylesheet" href="ReSpec.js/css/respec.css" />

  <title>getusermedia: Getting access to local devices that can generate
  multimedia streams</title>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type" />
<!--  
    === NOTA BENE ===
      For the three scripts below, if your spec resides on dev.w3 you can
      check them out in the same tree and use relative links so that they'll
      work offline.

    To generate the dated version of the specification:

      Open this doc in Mozilla. 

      Do a CTRL-ALT-SHIFT-S

      Select "XHMTL( source)" from dialog box. This will pop a new tab with
      genreated version of the document.

      This will open a new tab with generated html. Copy and paste this to
      a new file. Note if you use Chrome or Safari, this step will not
      work. What will happen is the paste will have th original document,
      not what was displayed in the window that you did the copy on.

      Rename the new file to the correct day such as
      getusermedia-20111003.html then search for and edit the links for
      "This version" and "Previos version". Add the new file into git and
      check in. 

      Once everyone is happy, the getusermedia.html and
      getusermedia-20111003.html files can be coppied to
      getusermedia.html and getusermedia-20111003.html
      respectively in the ../editor/. W3C directory. 
   -->


  
  
<style type="text/css">
/*****************************************************************
 * ReSpec CSS
 * Robin Berjon (robin at berjon dot com)
 * v0.05 - 2009-07-31
 *****************************************************************/


/* --- INLINES --- */
em.rfc2119 { 
    text-transform:     lowercase;
    font-variant:       small-caps;
    font-style:         normal;
    color:              #900;
}

h1 acronym, h2 acronym, h3 acronym, h4 acronym, h5 acronym, h6 acronym, a acronym,
h1 abbr, h2 abbr, h3 abbr, h4 abbr, h5 abbr, h6 abbr, a abbr {
    border: none;
}

dfn {
    font-weight:    bold;
}

a.internalDFN {
    color:  inherit;
    border-bottom:  1px solid #99c;
    text-decoration:    none;
}

a.externalDFN {
    color:  inherit;
    border-bottom:  1px dotted #ccc;
    text-decoration:    none;
}

a.bibref {
    text-decoration:    none;
}

code {
    color:  #ff4500;
}


/* --- WEB IDL --- */
pre.idl {
    border-top: 1px solid #90b8de;
    border-bottom: 1px solid #90b8de;
    padding:    1em;
    line-height:    120%;
}

pre.idl::before {
    content:    "WebIDL";
    display:    block;
    width:      150px;
    background: #90b8de;
    color:  #fff;
    font-family:    initial;
    padding:    3px;
    font-weight:    bold;
    margin: -1em 0 1em -1em;
}

.idlType {
    color:  #ff4500;
    font-weight:    bold;
    text-decoration:    none;
}

/*.idlModule*/
/*.idlModuleID*/
/*.idlInterface*/
.idlInterfaceID, .idlDictionaryID {
    font-weight:    bold;
    color:  #005a9c;
}

.idlSuperclass {
    font-style: italic;
    color:  #005a9c;
}

/*.idlAttribute*/
.idlAttrType, .idlFieldType, .idlMemberType {
    color:  #005a9c;
}
.idlAttrName, .idlFieldName, .idlMemberName {
    color:  #ff4500;
}
.idlAttrName a, .idlFieldName a, .idlMemberName a {
    color:  #ff4500;
    border-bottom:  1px dotted #ff4500;
    text-decoration: none;
}

/*.idlMethod*/
.idlMethType {
    color:  #005a9c;
}
.idlMethName {
    color:  #ff4500;
}
.idlMethName a {
    color:  #ff4500;
    border-bottom:  1px dotted #ff4500;
    text-decoration: none;
}

/*.idlParam*/
.idlParamType {
    color:  #005a9c;
}
.idlParamName {
    font-style: italic;
}

.extAttr {
    color:  #666;
}

/*.idlConst*/
.idlConstType {
    color:  #005a9c;
}
.idlConstName {
    color:  #ff4500;
}
.idlConstName a {
    color:  #ff4500;
    border-bottom:  1px dotted #ff4500;
    text-decoration: none;
}

/*.idlException*/
.idlExceptionID {
    font-weight:    bold;
    color:  #c00;
}

.idlTypedefID, .idlTypedefType {
    color:  #005a9c;
}

.idlRaises, .idlRaises a.idlType, .idlRaises a.idlType code, .excName a, .excName a code {
    color:  #c00;
    font-weight:    normal;
}

.excName a {
    font-family:    monospace;
}

.idlRaises a.idlType, .excName a.idlType {
    border-bottom:  1px dotted #c00;
}

.excGetSetTrue, .excGetSetFalse, .prmNullTrue, .prmNullFalse, .prmOptTrue, .prmOptFalse {
    width:  45px;
    text-align: center;
}
.excGetSetTrue, .prmNullTrue, .prmOptTrue { color:  #0c0; }
.excGetSetFalse, .prmNullFalse, .prmOptFalse { color:  #c00; }

.idlImplements a {
    font-weight:    bold;
}

dl.attributes, dl.methods, dl.constants, dl.fields, dl.dictionary-members {
    margin-left:    2em;
}

.attributes dt, .methods dt, .constants dt, .fields dt, .dictionary-members dt {
    font-weight:    normal;
}

.attributes dt code, .methods dt code, .constants dt code, .fields dt code, .dictionary-members dt code {
    font-weight:    bold;
    color:  #000;
    font-family:    monospace;
}

.attributes dt code, .fields dt code, .dictionary-members dt code {
    background:  #ffffd2;
}

.attributes dt .idlAttrType code, .fields dt .idlFieldType code, .dictionary-members dt .idlMemberType code {
    color:  #005a9c;
    background:  transparent;
    font-family:    inherit;
    font-weight:    normal;
    font-style: italic;
}

.methods dt code {
    background:  #d9e6f8;
}

.constants dt code {
    background:  #ddffd2;
}

.attributes dd, .methods dd, .constants dd, .fields dd, .dictionary-members dd {
    margin-bottom:  1em;
}

table.parameters, table.exceptions {
    border-spacing: 0;
    border-collapse:    collapse;
    margin: 0.5em 0;
    width:  100%;
}
table.parameters { border-bottom:  1px solid #90b8de; }
table.exceptions { border-bottom:  1px solid #deb890; }

.parameters th, .exceptions th {
    color:  #fff;
    padding:    3px 5px;
    text-align: left;
    font-family:    initial;
    font-weight:    normal;
    text-shadow:    #666 1px 1px 0;
}
.parameters th { background: #90b8de; }
.exceptions th { background: #deb890; }

.parameters td, .exceptions td {
    padding:    3px 10px;
    border-top: 1px solid #ddd;
    vertical-align: top;
}

.parameters tr:first-child td, .exceptions tr:first-child td {
    border-top: none;
}

.parameters td.prmName, .exceptions td.excName, .exceptions td.excCodeName {
    width:  100px;
}

.parameters td.prmType {
    width:  120px;
}

table.exceptions table {
    border-spacing: 0;
    border-collapse:    collapse;
    width:  100%;
}

/* --- TOC --- */
.toc a {
    text-decoration:    none;
}

a .secno {
    color:  #000;
}

/* --- TABLE --- */
table.simple {
    border-spacing: 0;
    border-collapse:    collapse;
    border-bottom:  3px solid #005a9c;
}

.simple th {
    background: #005a9c;
    color:  #fff;
    padding:    3px 5px;
    text-align: left;
}

.simple th[scope="row"] {
    background: inherit;
    color:  inherit;
    border-top: 1px solid #ddd;
}

.simple td {
    padding:    3px 10px;
    border-top: 1px solid #ddd;
}

.simple tr:nth-child(even) {
    background: #f0f6ff;
}

/* --- DL --- */
.section dd > p:first-child {
    margin-top: 0;
}

.section dd > p:last-child {
    margin-bottom: 0;
}

.section dd {
    margin-bottom:  1em;
}

.section dl.attrs dd, .section dl.eldef dd {
    margin-bottom:  0;
}

/* --- EXAMPLES --- */
pre.example {
    border-top: 1px solid #ff4500;
    border-bottom: 1px solid #ff4500;
    padding:    1em;
    margin-top: 1em;
}

pre.example::before {
    content:    "Example";
    display:    block;
    width:      150px;
    background: #ff4500;
    color:  #fff;
    font-family:    initial;
    padding:    3px;
    font-weight:    bold;
    margin: -1em 0 1em -1em;
}

/* --- EDITORIAL NOTES --- */
.issue {
    padding:    1em;
    margin: 1em 0em 0em;
    border: 1px solid #f00;
    background: #ffc;
}

.issue::before {
    content:    "Issue";
    display:    block;
    width:  150px;
    margin: -1.5em 0 0.5em 0;
    font-weight:    bold;
    border: 1px solid #f00;
    background: #fff;
    padding:    3px 1em;
}

.note {
    margin: 1em 0em 0em;
    padding:    1em;
    border: 2px solid #cff6d9;
    background: #e2fff0;
}

.note::before {
    content:    "Note";
    display:    block;
    width:  150px;
    margin: -1.5em 0 0.5em 0;
    font-weight:    bold;
    border: 1px solid #cff6d9;
    background: #fff;
    padding:    3px 1em;
}

/* --- Best Practices --- */
div.practice {
    border: solid #bebebe 1px;
    margin: 2em 1em 1em 2em;
}

span.practicelab {
    margin: 1.5em 0.5em 1em 1em;
    font-weight: bold;
    font-style: italic;
}

span.practicelab   { background: #dfffff; }

span.practicelab {
    position: relative;
    padding: 0 0.5em;
    top: -1.5em;
}

p.practicedesc {
    margin: 1.5em 0.5em 1em 1em;
}

@media screen {
    p.practicedesc {
        position: relative;
        top: -2em;
        padding: 0;
        margin: 1.5em 0.5em -1em 1em;
    }
}

/* --- SYNTAX HIGHLIGHTING --- */
pre.sh_sourceCode {
  background-color: white;
  color: black;
  font-style: normal;
  font-weight: normal;
}

pre.sh_sourceCode .sh_keyword { color: #005a9c; font-weight: bold; }           /* language keywords */
pre.sh_sourceCode .sh_type { color: #666; }                            /* basic types */
pre.sh_sourceCode .sh_usertype { color: teal; }                             /* user defined types */
pre.sh_sourceCode .sh_string { color: red; font-family: monospace; }        /* strings and chars */
pre.sh_sourceCode .sh_regexp { color: orange; font-family: monospace; }     /* regular expressions */
pre.sh_sourceCode .sh_specialchar { color: 	#ffc0cb; font-family: monospace; }  /* e.g., \n, \t, \\ */
pre.sh_sourceCode .sh_comment { color: #A52A2A; font-style: italic; }         /* comments */
pre.sh_sourceCode .sh_number { color: purple; }                             /* literal numbers */
pre.sh_sourceCode .sh_preproc { color: #00008B; font-weight: bold; }       /* e.g., #include, import */
pre.sh_sourceCode .sh_symbol { color: blue; }                            /* e.g., *, + */
pre.sh_sourceCode .sh_function { color: black; font-weight: bold; }         /* function calls and declarations */
pre.sh_sourceCode .sh_cbracket { color: red; }                              /* block brackets (e.g., {, }) */
pre.sh_sourceCode .sh_todo { font-weight: bold; background-color: #00FFFF; }   /* TODO and FIXME */

/* Predefined variables and functions (for instance glsl) */
pre.sh_sourceCode .sh_predef_var { color: #00008B; }
pre.sh_sourceCode .sh_predef_func { color: #00008B; font-weight: bold; }

/* for OOP */
pre.sh_sourceCode .sh_classname { color: teal; }

/* line numbers (not yet implemented) */
pre.sh_sourceCode .sh_linenum { display: none; }

/* Internet related */
pre.sh_sourceCode .sh_url { color: blue; text-decoration: underline; font-family: monospace; }

/* for ChangeLog and Log files */
pre.sh_sourceCode .sh_date { color: blue; font-weight: bold; }
pre.sh_sourceCode .sh_time, pre.sh_sourceCode .sh_file { color: #00008B; font-weight: bold; }
pre.sh_sourceCode .sh_ip, pre.sh_sourceCode .sh_name { color: #006400; }

/* for Prolog, Perl... */
pre.sh_sourceCode .sh_variable { color: #006400; }

/* for LaTeX */
pre.sh_sourceCode .sh_italics { color: #006400; font-style: italic; }
pre.sh_sourceCode .sh_bold { color: #006400; font-weight: bold; }
pre.sh_sourceCode .sh_underline { color: #006400; text-decoration: underline; }
pre.sh_sourceCode .sh_fixed { color: green; font-family: monospace; }
pre.sh_sourceCode .sh_argument { color: #006400; }
pre.sh_sourceCode .sh_optionalargument { color: purple; }
pre.sh_sourceCode .sh_math { color: orange; }
pre.sh_sourceCode .sh_bibtex { color: blue; }

/* for diffs */
pre.sh_sourceCode .sh_oldfile { color: orange; }
pre.sh_sourceCode .sh_newfile { color: #006400; }
pre.sh_sourceCode .sh_difflines { color: blue; }

/* for css */
pre.sh_sourceCode .sh_selector { color: purple; }
pre.sh_sourceCode .sh_property { color: blue; }
pre.sh_sourceCode .sh_value { color: #006400; font-style: italic; }

/* other */
pre.sh_sourceCode .sh_section { color: black; font-weight: bold; }
pre.sh_sourceCode .sh_paren { color: red; }
pre.sh_sourceCode .sh_attribute { color: #006400; }

</style><link href="http://www.w3.org/StyleSheets/TR/W3C-ED" rel="stylesheet" type="text/css" charset="utf-8" /></head>

<body style="display: inherit;"><div class="head"><p><a href="http://www.w3.org/"><img width="72" height="48" alt="W3C" src="http://www.w3.org/Icons/w3c_home" /></a></p><h1 id="title" class="title">getusermedia: Getting access to local devices that can generate multimedia streams</h1><h2 id="w3c-editor-s-draft-27-april-2012"><acronym title="World Wide Web Consortium">W3C</acronym> Editor's Draft 27 April 2012</h2><dl><dt>This version:</dt><dd><a href="http://dev.w3.org/2011/webrtc/editor/getusermedia-20120427.html">http://dev.w3.org/2011/webrtc/editor/getusermedia-20120427.html</a></dd><dt>Latest published version:</dt><dd><a href="http://www.w3.org/TR/getusermedia/">http://www.w3.org/TR/getusermedia/</a></dd><dt>Latest editor's draft:</dt><dd><a href="http://dev.w3.org/2011/webrtc/editor/getusermedia.html">http://dev.w3.org/2011/webrtc/editor/getusermedia.html</a></dd><dt>Previous version:</dt><dd><a href="http://dev.w3.org/2011/webrtc/editor/getusermedia-20111222.html">http://dev.w3.org/2011/webrtc/editor/getusermedia-20111222.html</a></dd><dt>Editors:</dt><dd><span>Daniel C. Burnett</span>, Voxeo</dd>
<dd><span>Anant Narayanan</span>, Mozilla</dd>
</dl><p class="copyright">Initial Author of this Specification was Ian Hickson, Google Inc., with the following copyright statement:<br /> © Copyright 2004-2011 Apple Computer, Inc., Mozilla Foundation, and Opera Software ASA. You are granted a license to use, reproduce and create derivative works of this document.</p> <p class="copyright">All subsequent changes since 26 July 2011 done by the <acronym title="World Wide Web Consortium">W3C</acronym> WebRTC Working Group are under the following <a href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a>:<br />© 2011 <a href="http://www.w3.org/"><acronym title="World Wide Web Consortium">W3C</acronym></a><sup>®</sup> (<a href="http://www.csail.mit.edu/"><acronym title="Massachusetts Institute of Technology">MIT</acronym></a>, <a href="http://www.ercim.eu/"><acronym title="European Research Consortium for Informatics and Mathematics">ERCIM</acronym></a>, <a href="http://www.keio.ac.jp/">Keio</a>), All Rights Reserved. <a href="http://www.w3.org/Consortium/Legal/copyright-documents">Document use</a>  rules apply.</p> <p class="copyright">For the entire publication on the <acronym title="World Wide Web Consortium">W3C</acronym> site the <a href="http://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a> and <a href="http://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a> rules apply.</p><hr /></div>
  <div id="abstract" class="introductory section"><h2>Abstract</h2>
    <p>This document defines a set of APIs that allow local media, including
    audio and video, to be requested from a platform.</p>
  </div><div class="introductory section" id="sotd"><h2>Status of This Document</h2><p><em>This section describes the status of this document at the time of its publication. Other documents may supersede this document. A list of current <acronym title="World Wide Web Consortium">W3C</acronym> publications and the latest revision of this technical report can be found in the <a href="http://www.w3.org/TR/"><acronym title="World Wide Web Consortium">W3C</acronym> technical reports index</a> at http://www.w3.org/TR/.</em></p>
    <p>This document is not complete. It is subject to major changes and, while
    early experimentations are encouraged, it is therefore not intended for
    implementation. The API is based on preliminary work done in the WHATWG.
    The Media Capture Task Force expects this specification to evolve
    significantly based on:</p>

    <ul>
      <li>Privacy issues that arise when exposing local capabilities and local
      streams.</li>

      <li>Technical discussions within the task force.</li>

      <li>Experience gained through early experimentations.</li>

      <li>Feedback received from other groups and individuals.</li>
    </ul>
  <p>This document was published by the <a href="-">Media Capture TF</a> as an Editor's Draft. If you wish to make comments regarding this document, please send them to <a href="mailto:public-media-capture@w3.org">public-media-capture@w3.org</a> (<a href="mailto:public-media-capture-request@w3.org?subject=subscribe">subscribe</a>, <a href="http://lists.w3.org/Archives/Public/public-media-capture/">archives</a>). All feedback is welcome.</p><p>Publication as an Editor's Draft does not imply endorsement by the <acronym title="World Wide Web Consortium">W3C</acronym> Membership. This is a draft document and may be updated, replaced or obsoleted by other documents at any time. It is inappropriate to cite this document as other than work in progress.</p><p>This document was produced by a group operating under the <a href="http://www.w3.org/Consortium/Patent-Policy-20040205/">5 February 2004 <acronym title="World Wide Web Consortium">W3C</acronym> Patent Policy</a>. <acronym title="World Wide Web Consortium">W3C</acronym> maintains a <a rel="disclosure" href="">public list of any patent disclosures</a> made in connection with the deliverables of the group; that page also includes instructions for disclosing a patent. An individual who has actual knowledge of a patent which the individual believes contains <a href="http://www.w3.org/Consortium/Patent-Policy-20040205/#def-essential">Essential Claim(s)</a> must disclose the information in accordance with <a href="http://www.w3.org/Consortium/Patent-Policy-20040205/#sec-Disclosure">section 6 of the <acronym title="World Wide Web Consortium">W3C</acronym> Patent Policy</a>.</p></div><div id="toc" class="section"><h2 class="introductory">Table of Contents</h2><ul class="toc"><li class="tocline"><a href="#intro" class="tocxref"><span class="secno">1. </span>Introduction</a></li><li class="tocline"><a href="#stream-api" class="tocxref"><span class="secno">2. </span>Stream API</a><ul class="toc"><li class="tocline"><a href="#introduction" class="tocxref"><span class="secno">2.1 </span>Introduction</a></li><li class="tocline"><a href="#mediastream" class="tocxref"><span class="secno">2.2 </span>MediaStream</a><ul class="toc"><li class="tocline"><a href="#attributes" class="tocxref"><span class="secno">2.2.1 </span>Attributes</a></li></ul></li><li class="tocline"><a href="#localmediastream" class="tocxref"><span class="secno">2.3 </span>LocalMediaStream</a><ul class="toc"><li class="tocline"><a href="#methods" class="tocxref"><span class="secno">2.3.1 </span>Methods</a></li></ul></li><li class="tocline"><a href="#mediastreamtrack" class="tocxref"><span class="secno">2.4 </span>MediaStreamTrack</a><ul class="toc"><li class="tocline"><a href="#attributes-1" class="tocxref"><span class="secno">2.4.1 </span>Attributes</a></li><li class="tocline"><a href="#constants" class="tocxref"><span class="secno">2.4.2 </span>Constants</a></li></ul></li><li class="tocline"><a href="#url" class="tocxref"><span class="secno">2.5 </span>URL</a><ul class="toc"><li class="tocline"><a href="#methods-1" class="tocxref"><span class="secno">2.5.1 </span>Methods</a></li></ul></li><li class="tocline"><a href="#mediastreamtracklist" class="tocxref"><span class="secno">2.6 </span>MediaStreamTrackList</a><ul class="toc"><li class="tocline"><a href="#attributes-2" class="tocxref"><span class="secno">2.6.1 </span>Attributes</a></li><li class="tocline"><a href="#methods-2" class="tocxref"><span class="secno">2.6.2 </span>Methods</a></li></ul></li></ul></li><li class="tocline"><a href="#local-content" class="tocxref"><span class="secno">3. </span>Obtaining local multimedia content</a><ul class="toc"><li class="tocline"><a href="#navigatorusermedia" class="tocxref"><span class="secno">3.1 </span>NavigatorUserMedia</a><ul class="toc"><li class="tocline"><a href="#methods-3" class="tocxref"><span class="secno">3.1.1 </span>Methods</a></li></ul></li><li class="tocline"><a href="#mediastreamoptions" class="tocxref"><span class="secno">3.2 </span>MediaStreamOptions</a><ul class="toc"><li class="tocline"><a href="#dictionary-mediastreamoptions-members" class="tocxref"><span class="secno">3.2.1 </span>Dictionary <span class="idlType formerLink idlType"><code>MediaStreamOptions</code></span> Members</a></li></ul></li><li class="tocline"><a href="#navigatorusermediasuccesscallback" class="tocxref"><span class="secno">3.3 </span>NavigatorUserMediaSuccessCallback</a><ul class="toc"><li class="tocline"><a href="#methods-4" class="tocxref"><span class="secno">3.3.1 </span>Methods</a></li></ul></li><li class="tocline"><a href="#navigatorusermediaerror-and-navigatorusermediaerrorcallback" class="tocxref"><span class="secno">3.4 </span>NavigatorUserMediaError and NavigatorUserMediaErrorCallback</a><ul class="toc"><li class="tocline"><a href="#attributes-3" class="tocxref"><span class="secno">3.4.1 </span>Attributes</a></li><li class="tocline"><a href="#constants-1" class="tocxref"><span class="secno">3.4.2 </span>Constants</a></li><li class="tocline"><a href="#methods-5" class="tocxref"><span class="secno">3.4.3 </span>Methods</a></li></ul></li></ul></li><li class="tocline"><a href="#examples" class="tocxref"><span class="secno">4. </span>Examples</a></li><li class="tocline"><a href="#garbage-collection" class="tocxref"><span class="secno">5. </span>Garbage collection</a></li><li class="tocline"><a href="#event-definitions" class="tocxref"><span class="secno">6. </span>Event definitions</a></li><li class="tocline"><a href="#event-summary" class="tocxref"><span class="secno">7. </span>Event summary</a></li><li class="tocline"><a href="#change-log" class="tocxref"><span class="secno">8. </span>Change Log</a></li><li class="tocline"><a href="#acknowledgements" class="tocxref"><span class="secno">A. </span>Acknowledgements</a></li><li class="tocline"><a href="#references" class="tocxref"><span class="secno">B. </span>References</a><ul class="toc"><li class="tocline"><a href="#normative-references" class="tocxref"><span class="secno">B.1 </span>Normative references</a></li><li class="tocline"><a href="#informative-references" class="tocxref"><span class="secno">B.2 </span>Informative references</a></li></ul></li></ul></div>

  

  <div class="informative section" id="intro">
    
<!-- OddPage -->
<h2><span class="secno">1. </span>Introduction</h2><p><em>This section is non-normative.</em></p>

    <p>Access to multimedia streams (video, audio, or both) from local devices
    (video cameras, microphones, Web cams) can have a number of uses, such as
    real-time communication, recording, surveillance.</p>

    <p>This document defines the APIs used to get access to local devices
    (video cameras, microphones, Web cams) that can generate multimedia stream
    data. This document also defines the stream API by which JavaScript is able
    to manipulate the stream data or otherwise process it.</p>
  </div>

  <div id="stream-api" class="section">
    
<!-- OddPage -->
<h2><span class="secno">2. </span>Stream API</h2>

    <div id="introduction" class="section">
      <h3><span class="secno">2.1 </span>Introduction</h3>

      <p>The <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> interface is used to represent
      streams of media data, typically (but not necessarily) of audio and/or
      video content, e.g. from a local camera. The data from a
      <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> object does not necessarily have a
      canonical binary form; for example, it could just be &quot;the video currently
      coming from the user’s video camera&quot;. This allows user agents to
      manipulate media streams in whatever fashion is most suitable on the
      user’s platform.</p>

      <p>Each <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> object can contain zero or more
      tracks, in particular audio and video tracks. All tracks in a MediaStream
      are intended to be synchronized when rendered. Different MediaStreams do
      not need to be synchronized.</p>

      <p>Each track in a MediaStream object has a corresponding
      <code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code> object.</p>

      <p>A <code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code> represents content comprising
      one or more channels, where the channels have a defined well known
      relationship to each other (such as a stereo or 5.1 audio signal).</p>

      <p>A channel is the smallest unit considered in this API
      specification.</p>

      <p>A <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> object has an input and an output.
      The input depends on how the object was created: a
      <code><a href="#idl-def-LocalMediaStream" class="idlType"><code>LocalMediaStream</code></a></code> object generated by a
      <code><a href="#dom-navigator-getusermedia">getUserMedia()</a></code>
      call (which is described later in this
      document), for instance, might take its input from the user’s local
      camera. The output of the object controls how the object is used, e.g.
      what is saved if the object is written to a file, what is displayed if
      the object is used in a <code>video</code> element</p>

      <p>Each track in a <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> object can be
      disabled, meaning that it is muted in the object’s output. All tracks are
      initially enabled.</p>

      <p>A <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> can be <a href="#dfn-finished" class="internalDFN">finished</a>, indicating
      that its inputs have forever stopped providing data.</p>

      <p>The output of a <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> object <em class="rfc2119" title="must">must</em> correspond
      to the tracks in its input. Muted audio tracks <em class="rfc2119" title="must">must</em> be replaced with
      silence. Muted video tracks <em class="rfc2119" title="must">must</em> be replaced with blackness.</p>

      <p>A new <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> object can be created from
      existing <code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code> objects using the
      <code><a href="#dom-mediastream">MediaStream()</a></code> constructor.
      The constructor takes two lists of <code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code>
      objects as arguments; one for audio tracks and one for video tracks. The
      lists can either be the track lists of another stream, subsets of such
      lists, or compositions of <code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code> objects
      from different <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> objects.</p>

      <p><img src="images/media-stream-1.png" alt="" /></p>

      <p>The ability to duplicate a <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code>, i.e.
      create a new <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> object from the track lists
      of an existing stream, allows for greater control since separate
      <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> instances can be manipulated and
      <a title="consumer" href="#dfn-consumer" class="internalDFN">consumed</a> individually.</p>

      <p>The <code><a href="#idl-def-LocalMediaStream" class="idlType"><code>LocalMediaStream</code></a></code> interface is used when the
      user agent is generating the stream’s data (e.g. from a camera or
      streaming it from a local video file).</p>

      <p>When a <code><a href="#idl-def-LocalMediaStream" class="idlType"><code>LocalMediaStream</code></a></code> object is being generated
      from a local file (as opposed to a live audio/video source), the user
      agent <em class="rfc2119" title="should">should</em> stream the data from the file in real time, not all at once.
      The <code>MediaStream</code> object is also used in contexts outside
      <code>getUserMedia</code>, such as [<cite><a class="bibref" rel="biblioentry" href="#bib-WEBRTC10">WEBRTC10</a></cite>]. Hence ensuring a
      realtime stream in both cases, reduces the ease with which pages can
      distinguish live video from pre-recorded video, which can help protect
      the user’s privacy.</p>
    </div>

    <div id="mediastream" class="section">
      <h3><span class="secno">2.2 </span>MediaStream</h3>

      <p>The <dfn id="dom-mediastream"><code>MediaStream()</code></dfn>
      constructor takes two arguments. The arguments are two lists with
      <code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code> objects which will be used to
      construct the audio and video track lists of the new
      <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> object. When the constructor is invoked,
      the UA must run the following steps:</p>

      <ol>
        <li>
          <p>Let <var>audioTracks</var> be the constructor’s first
          argument.</p>
        </li>

        <li>
          <p>Let <var>videoTracks</var> be the constructor’s second
          argument.</p>
        </li>

        <li>
          <p>Let <var>stream</var> be a newly constructed
          <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> object.</p>
        </li>

        <li>
          <p>Set <var>stream’s</var> label attribute to a newly generated
          value.</p>
        </li>

        <li>
          <p>If <var>audioTracks</var> is not null, then run the following sub
          steps for each element <var>track</var> in
          <var>audioTracks</var>:</p>

          <ol>
            <li>
              <p>If <var>track</var> is of any other kind than
              &quot;<code>audio</code>&quot;, then throw a <code>SyntaxError</code>
              exception.</p>
            </li>

            <li>
              <p>If <var>track</var> has the same underlying source as another
              element in <var>stream’s</var> audio track list, then abort these
              steps.</p>
            </li>

            <li>
              <p>Add <var>track</var> to <var>stream’s</var> audio track
              list.</p>
            </li>
          </ol>
        </li>

        <li>
          <p>If <var>videoTracks</var> is not null, then run the following sub
          steps for each element <var>track</var> in
          <var>videoTracks</var>:</p>

          <ol>
            <li>
              <p>If <var>track</var> is of any other kind than
              &quot;<code>video</code>&quot;, then throw a <code>SyntaxError</code>
              exception.</p>
            </li>

            <li>
              <p>If <var>track</var> has the same underlying source as another
              element in <var>stream’s</var> video track list, then abort these
              steps.</p>
            </li>

            <li>
              <p>Add <var>track</var> to <var>stream’s</var> video track
              list.</p>
            </li>
          </ol>
        </li>
      </ol>

      <p>A <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> can have multiple audio and video
      sources (e.g. because the user has multiple microphones, or because the
      real source of the stream is a media resource with many media tracks).
      The stream represented by a <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> thus has zero
      or more tracks.</p>

      <p>The tracks of a <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> are stored in two
      track lists represented by <code><a href="#idl-def-MediaStreamTrackList" class="idlType"><code>MediaStreamTrackList</code></a></code>
      objects; one for audio tracks and one for video tracks. The two track
      lists <em class="rfc2119" title="must">must</em> contain the <code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code> objects that
      correspond to the tracks of the stream. The relative order of all tracks
      in a user agent <em class="rfc2119" title="must">must</em> be stable. Tracks that come from a media resource
      whose format defines an order <em class="rfc2119" title="must">must</em> be in the order defined by the format;
      tracks that come from a media resource whose format does not define an
      order <em class="rfc2119" title="must">must</em> be in the relative order in which the tracks are declared in
      that media resource. Within these constraints, the order is user-agent
      defined.</p>

      <p>An object that reads data from the output of a
      <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> is referred to as a
      <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> <dfn id="dfn-consumer">consumer</dfn>. The list of
      <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> consumers currently includes the media
      elements, <code><a>PeerConnection</a></code> (specified in
      [<cite><a class="bibref" rel="biblioentry" href="#bib-WEBRTC10">WEBRTC10</a></cite>]).</p>

      <p class="note"><code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> consumers must be able to
      handle tracks being added and removed. This behavior is specified per
      consumer.</p>

      <p>A <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> object is said to be
      <dfn id="dfn-finished">finished</dfn> when all tracks belonging to the stream have
      <a href="#dfn-ended-1" class="internalDFN">ended</a>. When this happens for any reason other than the
      <code><a href="#dom-mediastream-stop">stop()</a></code> method being
      invoked, the user agent <em class="rfc2119" title="must">must</em> queue a task that runs the following
      steps:</p>

      <ol>
        <li>
          <p>If the object’s <code><a href="#dom-mediastream-ended">ended</a></code> attribute has the value
          true already, then abort these steps. (The <code><a href="#dom-mediastream-stop">stop()</a></code> method was probably called
          just before the stream stopped for other reasons, e.g. the user
          clicked an in-page stop button and then the user-agent-provided stop
          button.)</p>
        </li>

        <li>
          <p>Set the object’s <code><a href="#dom-mediastream-ended">ended</a></code> attribute to true.</p>
        </li>

        <li>
          <p>Fire a simple event named <code title="event-MediaStream-ended"><a href="#event-mediastream-ended">ended</a></code> at the object.</p>
        </li>
      </ol>

      <p>If the end of the stream was reached due to a user request, the task
      source for this <span title="concept-task">task</span> is the user
      interaction task source. Otherwise the task source for this <span title="concept-task">task</span> is the networking task source.</p>

      <pre class="idl"><span id="idl-def-MediaStream" class="idlInterface">[<span class="extAttr">Constructor (MediaStreamTrackList? audioTracks, MediaStreamTrackList? videoTracks)</span>]
interface <span class="idlInterfaceID">MediaStream</span> {
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a>DOMString</a></span>            <span class="idlAttrName"><a href="#widl-MediaStream-label">label</a></span>;</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a href="#idl-def-MediaStreamTrackList" class="idlType"><code>MediaStreamTrackList</code></a></span> <span class="idlAttrName"><a href="#widl-MediaStream-audioTracks">audioTracks</a></span>;</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a href="#idl-def-MediaStreamTrackList" class="idlType"><code>MediaStreamTrackList</code></a></span> <span class="idlAttrName"><a href="#widl-MediaStream-videoTracks">videoTracks</a></span>;</span>
<span class="idlAttribute">             attribute <span class="idlAttrType"><a>boolean</a></span>              <span class="idlAttrName"><a href="#widl-MediaStream-ended">ended</a></span>;</span>
<span class="idlAttribute">             attribute <span class="idlAttrType"><a>Function</a>?</span>            <span class="idlAttrName"><a href="#widl-MediaStream-onended">onended</a></span>;</span>
};</span>
</pre><div id="attributes" class="section"><h4><span class="secno">2.2.1 </span>Attributes</h4><dl class="attributes"><dt id="widl-MediaStream-audioTracks"><code>audioTracks</code> of type <span class="idlAttrType"><a href="#idl-def-MediaStreamTrackList" class="idlType"><code>MediaStreamTrackList</code></a></span>, readonly</dt><dd>
          <p>Returns a <code><a href="#idl-def-MediaStreamTrackList" class="idlType"><code>MediaStreamTrackList</code></a></code> object
          representing the audio tracks that can be enabled and disabled.</p>

          <p>The <dfn id="dom-mediastream-audiotracks"><code>audioTracks</code></dfn>
          attribute <em class="rfc2119" title="must">must</em> return an <span title="array host objects">array host
          object</span> for objects of type
          <code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code> that is <em>fixed length</em>
          and <em>read only</em>. The same object <em class="rfc2119" title="must">must</em> be returned each time
          the attribute is accessed.</p>
        </dd><dt id="widl-MediaStream-ended"><code>ended</code> of type <span class="idlAttrType"><a>boolean</a></span></dt><dd>
          <p>The <dfn id="dom-mediastream-ended"><code>MediaStream.ended</code></dfn>
          attribute <em class="rfc2119" title="must">must</em> return true if the <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> has
          <a href="#dfn-finished" class="internalDFN">finished</a>, and false otherwise.</p>

          <p>When a <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> object is created, its
          <code><a href="#dom-mediastream-ended">ended</a></code> attribute
          <em class="rfc2119" title="must">must</em> be set to false, unless it is being created using the
          <code><a href="#dom-mediastream">MediaStream()</a></code> constructor
          whose arguments are lists of <code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code>
          objects that are all <a href="#dfn-ended-1" class="internalDFN">ended</a>, in which case the
          <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> object <em class="rfc2119" title="must">must</em> be created with its
          <code><a href="#dom-mediastream-ended">ended</a></code> attribute set
          to true.</p>
        </dd><dt id="widl-MediaStream-label"><code>label</code> of type <span class="idlAttrType"><a>DOMString</a></span>, readonly</dt><dd>
          <p>When a <code><a href="#localmediastream">LocalMediaStream</a></code> object is created,
          the user agent <em class="rfc2119" title="must">must</em> generate a globally unique identifier string, and
          <em class="rfc2119" title="must">must</em> initialize the object’s <code><a href="#dom-mediastream-label">label</a></code> attribute to that string.
          Such strings <em class="rfc2119" title="must">must</em> only use characters in the ranges U+0021, U+0023 to
          U+0027, U+002A to U+002B, U+002D to U+002E, U+0030 to U+0039, U+0041
          to U+005A, U+005E to U+007E, and <em class="rfc2119" title="must">must</em> be 36 characters long.</p>
          
<!--  UUIDs have 36 characters
      including hyphens; the ranges above comes from RFC4574 (the a=label:
      thing in SDP)  -->

          
<!--  described below  -->


          <p>When a <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> is created from another
          using the <code><a href="#dom-mediastream">MediaStream()</a></code>
          constructor, the <code title="dom-MediaStream-label"><a href="#dom-mediastream-label">label</a></code> attribute is initialized to
          a newly generated value.</p>
<!--  described above  -->


          <p>The <dfn id="dom-mediastream-label"><code>label</code></dfn>
          attribute <em class="rfc2119" title="must">must</em> return the value to which it was initialized when the
          object was created.</p>
        </dd><dt id="widl-MediaStream-onended"><code>onended</code> of type <span class="idlAttrType"><a>Function</a></span>, nullable</dt><dd>This event handler, of type <code><a href="#event-mediastream-ended">ended</a></code>, <em class="rfc2119" title="must">must</em> be supported by all
        objects implementing the <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code>
        interface.</dd><dt id="widl-MediaStream-videoTracks"><code>videoTracks</code> of type <span class="idlAttrType"><a href="#idl-def-MediaStreamTrackList" class="idlType"><code>MediaStreamTrackList</code></a></span>, readonly</dt><dd>
          <p>Returns a <code><a href="#idl-def-MediaStreamTrackList" class="idlType"><code>MediaStreamTrackList</code></a></code> object
          representing the video tracks that can be enabled and disabled.</p>

          <p>The <dfn id="dom-mediastream-videotracks"><code>videoTracks</code></dfn>
          attribute <em class="rfc2119" title="must">must</em> return an <span title="array host objects">array host
          object</span> for objects of type
          <code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code> that is <em>fixed length</em>
          and <em>read only</em>. The same object <em class="rfc2119" title="must">must</em> be returned each time
          the attribute is accessed.</p>
        </dd></dl></div>

      <pre class="idl"><span class="idlImplements"><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a> implements <a>EventTarget</a>;</span></pre><div class="idlImplementsDesc"><p>All instances of the <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> type are defined to also implement the <a>EventTarget</a> interface.</p></div>
    </div>

    <div id="localmediastream" class="section">
      <h3><span class="secno">2.3 </span>LocalMediaStream</h3>

      <p>Before the web application can access the users media input devices it
      must let <code><a href="#dom-navigator-getusermedia">getUserMedia()</a></code> create a
      <code><a href="#idl-def-LocalMediaStream" class="idlType"><code>LocalMediaStream</code></a></code>. Once the application is done using,
      e.g., a webcam and a microphone, it may revoke its own access by calling
      <code><a href="#dom-mediastream-stop">stop()</a></code> on the
      <code><a href="#idl-def-LocalMediaStream" class="idlType"><code>LocalMediaStream</code></a></code> . 
      
<!-- If the web application no longer has access to any media input devices, any
 "on air" indicators in the browser UI MUST be turned off. -->
</p>

      <p>A web application may, once it has access to a
      <code><a href="#idl-def-LocalMediaStream" class="idlType"><code>LocalMediaStream</code></a></code>, use the <code><a href="#dom-mediastream">MediaStream()</a></code> constructor to construct
      additional <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> objects. Since a derived
      <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> object is created from the tracks of an
      existing stream, it cannot use any media input devices that have not been
      approved by the user.</p>

      <pre class="idl"><span id="idl-def-LocalMediaStream" class="idlInterface">interface <span class="idlInterfaceID">LocalMediaStream</span> : <span class="idlSuperclass"><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></span> {
<span class="idlMethod">    <span class="idlMethType"><a>void</a></span> <span class="idlMethName"><a href="#widl-LocalMediaStream-stop-void">stop</a></span> ();</span>
};</span>
</pre><div id="methods" class="section"><h4><span class="secno">2.3.1 </span>Methods</h4><dl class="methods"><dt id="widl-LocalMediaStream-stop-void"><code>stop</code></dt><dd>
          <p>When a <code><a href="#idl-def-LocalMediaStream" class="idlType"><code>LocalMediaStream</code></a></code> object’s <dfn id="dom-mediastream-stop"><code>stop()</code></dfn> method is invoked,
          the user agent <em class="rfc2119" title="must">must</em> queue a task that runs the following steps on
          every track:</p>

          <ol>
            <li>
              <p>Let <var>track</var> be the current
              <code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code> object.</p>
            </li>

            <li>
              <p><a title="ended" href="#dfn-ended-1" class="internalDFN">End</a> <var>track</var>. The track start
              outputting only silence and/or blackness, as appropriate.</p>
            </li>

            <li>
              <p>Dereference <var>track’s</var> underlying media source.</p>
            </li>

            <li>
              <p>If the reference count of <var>track’s</var> underlying media
              source is greater than zero, then abort these steps.</p>
            </li>

            <li>
              <p>Permanently stop the generation of data for <var>track’s</var>
              source. If the data is being generated from a live source (e.g. a
              microphone or camera), then the user agent <em class="rfc2119" title="should">should</em> remove any
              active &quot;on-air&quot; indicator for that source. If the data is being
              generated from a prerecorded source (e.g. a video file), any
              remaining content in the file is ignored.</p>
            </li>
          </ol>

          <p>The task source for the <span title="concept-task">tasks</span>
          queued for the <code><a href="#dom-mediastream-stop">stop()</a></code> method is the DOM
          manipulation task source.</p>
        <div><em>No parameters.</em></div><div><em>Return type: </em><code><a>void</a></code></div></dd></dl></div>
    </div>

    <div id="mediastreamtrack" class="section">
      <h3><span class="secno">2.4 </span>MediaStreamTrack</h3>

      <p>A <code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code> object represents a media
      source in the user agent. Several <code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code>
      objects can represent the same media source, e.g., when the user chooses
      the same camera in the UI shown by two consecutive calls to
      <code><a href="#dom-navigator-getusermedia">getUserMedia()</a></code>.</p>

      <p>A <code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code> object can reference its media
      source in two ways, either with a strong or a weak reference, depending
      on how the track was created. For example, a track in a
      <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code>, derived from a
      <code><a href="#idl-def-LocalMediaStream" class="idlType"><code>LocalMediaStream</code></a></code> with the <code><a href="#dom-mediastream">MediaStream()</a></code> constructor, has a weak
      reference to a local media source, while a track in a
      <code><a href="#idl-def-LocalMediaStream" class="idlType"><code>LocalMediaStream</code></a></code> has a strong reference. This means
      that a track in a <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code>, derived from a
      <code><a href="#idl-def-LocalMediaStream" class="idlType"><code>LocalMediaStream</code></a></code>, will end if there is no
      non-<a href="#dfn-ended-1" class="internalDFN">ended</a> track in a <code><a href="#idl-def-LocalMediaStream" class="idlType"><code>LocalMediaStream</code></a></code> which
      references the same local media source.</p>

      <p class="note">The concept with strong and weak references to media
      sources allows the web application to derive new
      <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> objects from
      <code><a href="#idl-def-LocalMediaStream" class="idlType"><code>LocalMediaStream</code></a></code> objects (created via
      <code><a href="#dom-navigator-getusermedia">getUserMedia()</a></code>),
      and still be able to revoke all given permissions with <code><a href="#dom-mediastream-stop">LocalMediaStream.stop()</a></code>.</p>

      <p>A <code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code> object is said to <em>end</em>
      when the user agent learns that no more data will ever be forthcoming for
      this track.</p>

      <p>When a <code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code> object ends for any reason
      (e.g. because the user rescinds the permission for the page to use the
      local camera, or because the data comes from a finite file and the file’s
      end has been reached and the user has not requested that it be looped, or
      because the UA has instructed the track to end for any reason, or because
      the reference count of the track’s underlying media source has reached
      zero, it is said to be <dfn id="dfn-ended">ended</dfn>. When track instance
      <var>track</var> ends for any reason other than <code><a href="#dom-mediastream-stop">stop()</a></code> method being invoked on the
      <code><a href="#idl-def-LocalMediaStream" class="idlType"><code>LocalMediaStream</code></a></code> object that represents
      <var>track</var>, the user agent <em class="rfc2119" title="must">must</em> queue a task that runs the
      following steps:</p>

      <ol>
        <li>
          <p>If the track’s <code><a href="#dom-mediastreamtrack-readystate">readyState</a></code> attribute
          has the value <code><a href="#widl-MediaStreamTrack-ENDED">ENDED</a></code> (2) already, then
          abort these steps.</p>
        </li>

        <li>
          <p>Set <var>track’s</var> <code><a href="#dom-mediastreamtrack-readystate">readyState</a></code> attribute to
          <code><a href="#widl-MediaStreamTrack-ENDED">ENDED</a></code>
          (2).</p>
        </li>

        <li>
          <p>Fire a simple event named <code><a href="#event-mediastreamtrack-ended">ended</a></code> at the object.</p>
        </li>
      </ol>

      <p>If the end of the stream was reached due to a user request, the event
      source for this event is the user interaction event source.</p>

      <pre class="idl"><span id="idl-def-MediaStreamTrack" class="idlInterface">interface <span class="idlInterfaceID">MediaStreamTrack</span> {
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a>DOMString</a></span>      <span class="idlAttrName"><a href="#widl-MediaStreamTrack-kind">kind</a></span>;</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a>DOMString</a></span>      <span class="idlAttrName"><a href="#widl-MediaStreamTrack-label">label</a></span>;</span>
<span class="idlAttribute">             attribute <span class="idlAttrType"><a>boolean</a></span>        <span class="idlAttrName"><a href="#widl-MediaStreamTrack-enabled">enabled</a></span>;</span>
<span class="idlConst">    const <span class="idlConstType"><a>unsigned short</a></span> <span class="idlConstName"><a href="#widl-MediaStreamTrack-LIVE">LIVE</a></span> = <span class="idlConstValue">0</span>;</span>
<span class="idlConst">    const <span class="idlConstType"><a>unsigned short</a></span> <span class="idlConstName"><a href="#widl-MediaStreamTrack-MUTED">MUTED</a></span> = <span class="idlConstValue">1</span>;</span>
<span class="idlConst">    const <span class="idlConstType"><a>unsigned short</a></span> <span class="idlConstName"><a href="#widl-MediaStreamTrack-ENDED">ENDED</a></span> = <span class="idlConstValue">2</span>;</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a>unsigned short</a></span> <span class="idlAttrName"><a href="#widl-MediaStreamTrack-readyState">readyState</a></span>;</span>
<span class="idlAttribute">             attribute <span class="idlAttrType"><a>Function</a>?</span>      <span class="idlAttrName"><a href="#widl-MediaStreamTrack-onmute">onmute</a></span>;</span>
<span class="idlAttribute">             attribute <span class="idlAttrType"><a>Function</a>?</span>      <span class="idlAttrName"><a href="#widl-MediaStreamTrack-onunmute">onunmute</a></span>;</span>
<span class="idlAttribute">             attribute <span class="idlAttrType"><a>Function</a>?</span>      <span class="idlAttrName"><a href="#widl-MediaStreamTrack-onended">onended</a></span>;</span>
};</span>
</pre><div id="attributes-1" class="section"><h4><span class="secno">2.4.1 </span>Attributes</h4><dl class="attributes"><dt id="widl-MediaStreamTrack-enabled"><code>enabled</code> of type <span class="idlAttrType"><a>boolean</a></span></dt><dd>
          <p>The <dfn id="dom-mediastreamtrack-enabled"><code>MediaStreamTrack.enabled</code></dfn>
          attribute, on getting, <em class="rfc2119" title="must">must</em> return the last value to which it was
          set. On setting, it <em class="rfc2119" title="must">must</em> be set to the new value, and then, if the
          <code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code> object is still associated with
          a track, <em class="rfc2119" title="must">must</em> enable the track if the new value is true, and disable
          it otherwise.</p>

          <p class="note">Thus, after a <code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code> is
          disassociated from its track, its <code><a href="#dom-mediastreamtrack-enabled">enabled</a></code> attribute still
          changes value when set, it just doesn’t do anything with that new
          value.</p>
        </dd><dt id="widl-MediaStreamTrack-kind"><code>kind</code> of type <span class="idlAttrType"><a>DOMString</a></span>, readonly</dt><dd>
          <p>The <dfn id="dom-mediastreamtrack-kind"><code>MediaStreamTrack.kind</code></dfn>
          attribute <em class="rfc2119" title="must">must</em> return the string &quot;<code>audio</code>&quot; if the object’s
          corresponding track is or was an audio track, &quot;<code>video</code>&quot; if
          the corresponding track is or was a video track, and a user-agent
          defined string otherwise.</p>
        </dd><dt id="widl-MediaStreamTrack-label"><code>label</code> of type <span class="idlAttrType"><a>DOMString</a></span>, readonly</dt><dd>
          <p>User agents <em class="rfc2119" title="may">may</em> label audio and video sources (e.g. &quot;Internal
          microphone&quot; or &quot;External USB Webcam&quot;). The <dfn id="dom-mediastreamtrack-label"><code>MediaStreamTrack.label</code></dfn>
          attribute <em class="rfc2119" title="must">must</em> return the label of the object’s corresponding track,
          if any. If the corresponding track has or had no label, the attribute
          <em class="rfc2119" title="must">must</em> instead return the empty string.</p>

          <p class="note">Thus the <code><a href="#dom-mediastreamtrack-kind">kind</a></code> and <code title="dom-MediaStreamTrack-label"><a href="#dom-mediastreamtrack-label">label</a></code> attributes do not
          change value, even if the <code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code> object
          is disassociated from its corresponding track.</p>
        </dd><dt id="widl-MediaStreamTrack-onended"><code>onended</code> of type <span class="idlAttrType"><a>Function</a></span>, nullable</dt><dd>This event handler, of type <code><a href="#event-mediastreamtrack-ended">ended</a></code>, <em class="rfc2119" title="must">must</em> be supported by
        all objects implementing the <code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code>
        interface.</dd><dt id="widl-MediaStreamTrack-onmute"><code>onmute</code> of type <span class="idlAttrType"><a>Function</a></span>, nullable</dt><dd>This event handler, of type <code><a href="#event-mediastreamtrack-muted">muted</a></code>, <em class="rfc2119" title="must">must</em> be supported by
        all objects implementing the <code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code>
        interface.</dd><dt id="widl-MediaStreamTrack-onunmute"><code>onunmute</code> of type <span class="idlAttrType"><a>Function</a></span>, nullable</dt><dd>This event handler, of type <code><a href="#event-mediastreamtrack-unmuted">unmuted</a></code>, <em class="rfc2119" title="must">must</em> be supported
        by all objects implementing the <code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code>
        interface.</dd><dt id="widl-MediaStreamTrack-readyState"><code>readyState</code> of type <span class="idlAttrType"><a>unsigned short</a></span>, readonly</dt><dd>
          <p>The <dfn id="dom-mediastreamtrack-readystate"><code>readyState</code></dfn>
          attribute represents the state of the track. It <em class="rfc2119" title="must">must</em> return the value
          to which the user agent last set it (as defined below). It can have
          the following values: <dfn id="dfn-live">LIVE</dfn>, <dfn id="dfn-muted">MUTED</dfn> or
          <dfn id="dfn-ended-1">ENDED</dfn>.</p>

          <p>When a <code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code> object is created, its
          <code><a href="#dom-mediastreamtrack-readystate">readyState</a></code> is either
          <code><a href="#widl-MediaStreamTrack-LIVE">LIVE</a></code> (0) or
          <code><a href="#widl-MediaStreamTrack-MUTED">MUTED</a></code> (1),
          depending on the state of the track’s underlying media source. For
          example, a track in a <code><a href="#idl-def-LocalMediaStream" class="idlType"><code>LocalMediaStream</code></a></code>, created
          with <code><a href="#dom-navigator-getusermedia">getUserMedia()</a>
          </code>, <em class="rfc2119" title="must">must</em> initially have its <code><a href="#dom-mediastreamtrack-readystate">readyState</a></code> attribute
          set to <code><a href="#widl-MediaStreamTrack-LIVE">LIVE</a></code>
          (1).</p>
        </dd></dl></div><div id="constants" class="section"><h4><span class="secno">2.4.2 </span>Constants</h4><dl class="constants"><dt id="widl-MediaStreamTrack-ENDED"><code>ENDED</code> of type <span class="idlConstType"><a>unsigned short</a></span></dt><dd>
          <p>The track has <a href="#dfn-ended-1" class="internalDFN">ended</a> (the track’s underlying media source is
          no longer providing data, and will never provide more data for this
          track).</p>

          <p>For example, a video track in a
          <code><a href="#idl-def-LocalMediaStream" class="idlType"><code>LocalMediaStream</code></a></code> finishes if the user unplugs the
          USB web camera that acts as the track’s media source.</p>
        </dd><dt id="widl-MediaStreamTrack-LIVE"><code>LIVE</code> of type <span class="idlConstType"><a>unsigned short</a></span></dt><dd>
          <p>The track is active (the track’s underlying media source is making
          a best-effort attempt to provide data in real time).</p>

          <p>The output of a track in the <code><a href="#widl-MediaStreamTrack-LIVE">LIVE</a></code> state can be switched
          on and off with the <code><a href="#dom-mediastreamtrack-enabled">enabled</a></code> attribute.</p>
        </dd><dt id="widl-MediaStreamTrack-MUTED"><code>MUTED</code> of type <span class="idlConstType"><a>unsigned short</a></span></dt><dd>
          <p>The track is muted (the track’s underlying media source is
          temporarily unable to provide data).</p>

          <p>A <code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code> in a
          <code><a href="#idl-def-LocalMediaStream" class="idlType"><code>LocalMediaStream</code></a></code> may be muted if the user
          temporarily revokes the web application’s permission to use a media
          input device.</p>
        </dd></dl></div>
    </div>

    <div id="url" class="section">
      <h3><span class="secno">2.5 </span>URL</h3>

      <pre class="idl"><span id="idl-def-URL" class="idlInterface">partial interface <span class="idlInterfaceID">URL</span> {
<span class="idlMethod">    <span class="idlMethType"><a>static DOMString</a></span> <span class="idlMethName"><a href="#widl-URL-createObjectURL-static-DOMString-MediaStream-stream">createObjectURL</a></span> (<span class="idlParam"><span class="idlParamType"><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></span> <span class="idlParamName">stream</span></span>);</span>
};</span>
</pre><div id="methods-1" class="section"><h4><span class="secno">2.5.1 </span>Methods</h4><dl class="methods"><dt id="widl-URL-createObjectURL-static-DOMString-MediaStream-stream"><code>createObjectURL</code></dt><dd>
          <p>Mints a <a href="#blob-url">Blob URL</a> to refer to the given
          <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code>.</p>

          <p>When the <dfn id="dom-url-createobjecturl"><code>createObjectURL()</code></dfn> method
          is called with a <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> argument, the user
          agent <em class="rfc2119" title="must">must</em> return a unique <a href="#blob-url">Blob URL</a> for the
          given <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code>. [<cite><a class="bibref" rel="biblioentry" href="#bib-FILE-API">FILE-API</a></cite>]</p>

          <p>For audio and video streams, the data exposed on that stream <em class="rfc2119" title="must">must</em>
          be in a format supported by the user agent for use in
          <code>audio</code> and <code>video</code> elements.</p>

          <p class="bookkeeping">A <dfn id="blob-url">Blob URL</dfn> is the
          same as what the File API specification calls a Blob URI, except that
          anything in the definition of that feature that refers to
          <code>File</code> and <code>Blob</code> objects is hereby extended to
          also apply to <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> and
          <code><a href="#idl-def-LocalMediaStream" class="idlType"><code>LocalMediaStream</code></a></code> objects.</p>
        <table class="parameters"><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">stream</td><td class="prmType"><code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code></td><td class="prmNullFalse">✘</td><td class="prmOptFalse">✘</td><td class="prmDesc"></td></tr></table><div><em>Return type: </em><code><a>static DOMString</a></code></div></dd></dl></div>
    </div>

    <div id="mediastreamtracklist" class="section">
      <h3><span class="secno">2.6 </span>MediaStreamTrackList</h3>

      <p>A <code><a href="#idl-def-MediaStreamTrackList" class="idlType"><code>MediaStreamTrackList</code></a></code> object’s <dfn id="concept-track-list-corresponding-stream">corresponding</dfn>
      <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> refers to the
      <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> object which the current
      <code><a href="#idl-def-MediaStreamTrackList" class="idlType"><code>MediaStreamTrackList</code></a></code> object is a property of.</p>

      <pre class="idl"><span id="idl-def-MediaStreamTrackList" class="idlInterface">interface <span class="idlInterfaceID">MediaStreamTrackList</span> {
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a>unsigned long</a></span> <span class="idlAttrName"><a href="#widl-MediaStreamTrackList-length">length</a></span>;</span>
<span class="idlMethod">    <span class="idlMethType"><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></span> <span class="idlMethName"><a href="#widl-MediaStreamTrackList-item-MediaStreamTrack-unsigned-long-index">item</a></span> (<span class="idlParam"><span class="idlParamType"><a>unsigned long</a></span> <span class="idlParamName">index</span></span>);</span>
<span class="idlMethod">    <span class="idlMethType"><a>void</a></span>             <span class="idlMethName"><a href="#widl-MediaStreamTrackList-add-void-MediaStreamTrack-track">add</a></span> (<span class="idlParam"><span class="idlParamType"><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></span> <span class="idlParamName">track</span></span>);</span>
<span class="idlMethod">    <span class="idlMethType"><a>void</a></span>             <span class="idlMethName"><a href="#widl-MediaStreamTrackList-remove-void-MediaStreamTrack-track">remove</a></span> (<span class="idlParam"><span class="idlParamType"><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></span> <span class="idlParamName">track</span></span>);</span>
<span class="idlAttribute">             attribute <span class="idlAttrType"><a>Function</a>?</span>     <span class="idlAttrName"><a href="#widl-MediaStreamTrackList-onaddtrack">onaddtrack</a></span>;</span>
<span class="idlAttribute">             attribute <span class="idlAttrType"><a>Function</a>?</span>     <span class="idlAttrName"><a href="#widl-MediaStreamTrackList-onremovetrack">onremovetrack</a></span>;</span>
};</span>
</pre><div id="attributes-2" class="section"><h4><span class="secno">2.6.1 </span>Attributes</h4><dl class="attributes"><dt id="widl-MediaStreamTrackList-length"><code>length</code> of type <span class="idlAttrType"><a>unsigned long</a></span>, readonly</dt><dd>Returns the number of tracks in the list.</dd><dt id="widl-MediaStreamTrackList-onaddtrack"><code>onaddtrack</code> of type <span class="idlAttrType"><a>Function</a></span>, nullable</dt><dd>This event handler, of type <code><a href="#event-mediastreamtracklist-addtrack">addtrack</a></code>, <em class="rfc2119" title="must">must</em> be
        supported by all objects implementing the
        <code><a href="#idl-def-MediaStreamTrackList" class="idlType"><code>MediaStreamTrackList</code></a></code> interface.</dd><dt id="widl-MediaStreamTrackList-onremovetrack"><code>onremovetrack</code> of type <span class="idlAttrType"><a>Function</a></span>, nullable</dt><dd>This event handler, of type <code><a href="#event-mediastreamtracklist-removetrack">removetrack</a></code>, <em class="rfc2119" title="must">must</em>
        be supported by all objects implementing the
        <code><a href="#idl-def-MediaStreamTrackList" class="idlType"><code>MediaStreamTrackList</code></a></code> interface.</dd></dl></div><div id="methods-2" class="section"><h4><span class="secno">2.6.2 </span>Methods</h4><dl class="methods"><dt id="widl-MediaStreamTrackList-add-void-MediaStreamTrack-track"><code>add</code></dt><dd>
          <p>Adds the given <code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code> to this
          <code><a href="#idl-def-MediaStreamTrackList" class="idlType"><code>MediaStreamTrackList</code></a></code> according to the ordering
          rules for tracks.</p>

          <p>When the <dfn id="dom-mediastreamtracklist-add"><code>add()</code></dfn> method is
          invoked, the user agent <em class="rfc2119" title="must">must</em> run the following steps:</p>

          <ol>
            <li>
              <p>Let <var>track</var> be the
              <code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code> argument.</p>
            </li>

            <li>
              <p>Let <var>stream</var> be the
              <code><a href="#idl-def-MediaStreamTrackList" class="idlType"><code>MediaStreamTrackList</code></a></code> object’s <a title="concept-track-list-corresponding-stream" href="#concept-track-list-corresponding-stream">corresponding</a>
              <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> object.</p>
            </li>

            <li>
              <p>If <var>stream</var> is <a href="#dfn-finished" class="internalDFN">finished</a>, throw an
              <code>INVALID_STATE_ERR</code> exception.</p>
            </li>

            <li>
              <p>If <var>track</var> is already in the
              <code><a href="#idl-def-MediaStreamTrackList" class="idlType"><code>MediaStreamTrackList</code></a></code>, object’s internal list,
              then abort these steps.</p>
            </li>

            <li>
              <p>Add <var>track</var> to the end of the
              <code><a href="#idl-def-MediaStreamTrackList" class="idlType"><code>MediaStreamTrackList</code></a></code> object’s internal
              list.</p>
            </li>
          </ol>
        <table class="parameters"><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">track</td><td class="prmType"><code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code></td><td class="prmNullFalse">✘</td><td class="prmOptFalse">✘</td><td class="prmDesc"></td></tr></table><div><em>Return type: </em><code><a>void</a></code></div></dd><dt id="widl-MediaStreamTrackList-item-MediaStreamTrack-unsigned-long-index"><code>item</code></dt><dd>Returns the <code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code> object at the
        specified index.<table class="parameters"><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">index</td><td class="prmType"><code><a>unsigned long</a></code></td><td class="prmNullFalse">✘</td><td class="prmOptFalse">✘</td><td class="prmDesc"></td></tr></table><div><em>Return type: </em><code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code></div></dd><dt id="widl-MediaStreamTrackList-remove-void-MediaStreamTrack-track"><code>remove</code></dt><dd>
          <p>Removes the given <code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code> from this
          <code><a href="#idl-def-MediaStreamTrackList" class="idlType"><code>MediaStreamTrackList</code></a></code>.</p>

          <p>When the <dfn id="dom-mediastreamtracklist-remove"><code>remove()</code></dfn> method
          is invoked, the user agent <em class="rfc2119" title="must">must</em> run the following steps:</p>

          <ol>
            <li>
              <p>Let <var>track</var> be the
              <code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code> argument.</p>
            </li>

            <li>
              <p>Let <var>stream</var> be the
              <code><a href="#idl-def-MediaStreamTrackList" class="idlType"><code>MediaStreamTrackList</code></a></code> object’s <a title="concept-track-list-corresponding-stream" href="#concept-track-list-corresponding-stream">corresponding</a>
              <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> object.</p>
            </li>

            <li>
              <p>If <var>stream</var> is <a href="#dfn-finished" class="internalDFN">finished</a>, throw an
              <code>INVALID_STATE_ERR</code> exception.</p>
            </li>

            <li>
              <p>If <var>track</var> is not in the
              <code><a href="#idl-def-MediaStreamTrackList" class="idlType"><code>MediaStreamTrackList</code></a></code>, object’s internal list,
              then abort these steps.</p>
            </li>

            <li>
              <p>Remove <var>track</var> from the
              <code><a href="#idl-def-MediaStreamTrackList" class="idlType"><code>MediaStreamTrackList</code></a></code> object’s internal
              list.</p>
            </li>
          </ol>
        <table class="parameters"><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">track</td><td class="prmType"><code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code></td><td class="prmNullFalse">✘</td><td class="prmOptFalse">✘</td><td class="prmDesc"></td></tr></table><div><em>Return type: </em><code><a>void</a></code></div></dd></dl></div>
    </div>
  </div>

  <div id="local-content" class="section">
    
<!-- OddPage -->
<h2><span class="secno">3. </span>Obtaining local multimedia content</h2>

    <div id="navigatorusermedia" class="section">
      <h3><span class="secno">3.1 </span>NavigatorUserMedia</h3>

      <pre class="idl"><span id="idl-def-NavigatorUserMedia" class="idlInterface">[<span class="extAttr">NoInterfaceObject</span>]
interface <span class="idlInterfaceID">NavigatorUserMedia</span> {
<span class="idlMethod">    <span class="idlMethType"><a>void</a></span> <span class="idlMethName"><a href="#widl-NavigatorUserMedia-getUserMedia-void-MediaStreamOptions-options-NavigatorUserMediaSuccessCallback-successCallback-NavigatorUserMediaErrorCallback-errorCallback">getUserMedia</a></span> (<span class="idlParam"><span class="idlParamType"><a href="#idl-def-MediaStreamOptions" class="idlType"><code>MediaStreamOptions</code></a>?</span> <span class="idlParamName">options</span></span>, <span class="idlParam"><span class="idlParamType"><a href="#idl-def-NavigatorUserMediaSuccessCallback" class="idlType"><code>NavigatorUserMediaSuccessCallback</code></a>?</span> <span class="idlParamName">successCallback</span></span>, <span class="idlParam">optional <span class="idlParamType"><a href="#idl-def-NavigatorUserMediaErrorCallback" class="idlType"><code>NavigatorUserMediaErrorCallback</code></a>?</span> <span class="idlParamName">errorCallback</span></span>);</span>
};</span>
</pre><div id="methods-3" class="section"><h4><span class="secno">3.1.1 </span>Methods</h4><dl class="methods"><dt id="widl-NavigatorUserMedia-getUserMedia-void-MediaStreamOptions-options-NavigatorUserMediaSuccessCallback-successCallback-NavigatorUserMediaErrorCallback-errorCallback"><code>getUserMedia</code></dt><dd>
          <p>Prompts the user for permission to use their Web cam or other
          video or audio input.</p>

          <p>The <var>options</var> argument is an object of type
          <code><a href="#idl-def-MediaStreamOptions" class="idlType"><code>MediaStreamOptions</code></a></code>.</p>

          <p>If the user accepts, the <var>successCallback</var> is invoked,
          with a suitable <code><a href="webrtc.html#localmediastream">LocalMediaStream</a></code> object
          [<cite><a class="bibref" rel="biblioentry" href="#bib-WEBRTC10">WEBRTC10</a></cite>] as its argument.</p>

          <p>If the user declines, the <var>errorCallback</var> (if any) is
          invoked.</p>

          <p>When the <dfn id="dom-navigator-getusermedia">
          <code>getUserMedia()</code></dfn> method is called, the user agent
          <em class="rfc2119" title="must">must</em> run the following steps:</p>

          <ol>
            <li>
              <p>Let <var>options</var> be the method's first argument.</p>
            </li>

            <li>
              <p>Let <var>successCallback</var> be the callback indicated by
              the method's second argument.</p>
            </li>

            <li>
              <p>Let <var>errorCallback</var> be the callback indicated by the
              method's third argument, if any, or null otherwise.</p>
            </li>

            <li>
              <p>If <var>successCallback</var> is null, abort these steps.</p>
            </li>
<!--  we could throw an exception instead (that's
   why the method doesn't return until later: so that we can add an
   exception here, or for /options/ below, without changing the
   algorithm)  -->


            <li>
              <p>For each member of the <code><a href="#idl-def-MediaStreamOptions" class="idlType"><code>MediaStreamOptions</code></a></code>
              dictionary create a local representation and set it to false.</p>
            </li>

            <li>
              <p>For each property in <var>options</var> that is present and
              set to true, let the corresponding local representation be
              true.</p>
            </li>

            <li>
              <p>If none of the local representations of the
              <code><a href="#idl-def-MediaStreamOptions" class="idlType"><code>MediaStreamOptions</code></a></code> dictionary members is set
              to true, then throw a <code>NOT_SUPPORTED_ERR</code> exception
              and abort these steps.</p>
            </li>

            <li>
              <p>Return, and run the remaining steps asynchronously.</p>
            </li>

            <li>
              <p>Optionally, e.g. based on a previously-established user
              preference, for security reasons, or due to platform limitations,
              jump to the step labeled <em>failure</em> below.</p>
            </li>

            <li>
              <p>Prompt the user in a user-agent-specific manner for permission
              to provide the entry script's origin with a <code><a href="webrtc.html#localmediastream">LocalMediaStream</a></code> object
              [<cite><a class="bibref" rel="biblioentry" href="#bib-WEBRTC10">WEBRTC10</a></cite>] representing a media stream.</p>

              <p>The provided media <em class="rfc2119" title="should">should</em> include a track for each local
              representation of the <code><a href="#idl-def-MediaStreamOptions" class="idlType"><code>MediaStreamOptions</code></a></code>
              dictionary members that is set to true.</p>

              <p>The provided media <em class="rfc2119" title="must not">must not</em> include a track for any of the
              local representation of the
              <code><a href="#idl-def-MediaStreamOptions" class="idlType"><code>MediaStreamOptions</code></a></code> dictionary members that is
              not set to true.</p>

              <p>User agents are encouraged to default to using the user's
              primary or system default camera and/or microphone (as
              appropriate) to generate the media stream. User agents <em class="rfc2119" title="may">may</em> allow
              users to use any media source, including pre-recorded media
              files.</p>

              <p>User agents <em class="rfc2119" title="may">may</em> wish to offer the user more control over the
              provided media. For example, a user agent could offer to enable a
              camera light or flash, or to change settings such as the frame
              rate or shutter speed.</p>

              <p>If the user grants permission to use local recording devices,
              user agents are encouraged to include a prominent indicator that
              the devices are &quot;hot&quot; (i.e. an &quot;on-air&quot; or &quot;recording&quot;
              indicator).</p>

              <p>If the user denies permission, jump to the step labeled
              <em>failure</em> below. If the user never responds, this
              algorithm stalls on this step.</p>
            </li>

            <li>
              <p>Let <var>stream</var> be the <code><a href="webrtc.html#localmediastream">LocalMediaStream</a></code> object
              [<cite><a class="bibref" rel="biblioentry" href="#bib-WEBRTC10">WEBRTC10</a></cite>] for which the user granted permission.</p>
            </li>

            <li>
              <p>Queue a task to invoke <var>successCallback</var> with
              <var>stream</var> as its argument.</p>
            </li>

            <li>
              <p>Abort these steps.</p>
            </li>

            <li>
              <p><em>Failure</em>: If <var>errorCallback</var> is null, abort
              these steps.</p>
            </li>

            <li>
              <p>Let <var>error</var> be a new <code><a href="#navigatorusermediaerror">NavigatorUserMediaError</a></code>
              object whose <code title="dom-NavigatorUserMediaError-code"><a href="#dom-navigatorusermediaerror-code">code</a></code> attribute has
              the numeric value 1 (<code title="dom-NavigatorUserMediaError-PERMISSION_DENIED"><a href="#dom-navigatorusermediaerror-permission_denied">PERMISSION_DENIED</a></code>).</p>
            </li>

            <li>
              <p>Queue a task to invoke <var>errorCallback</var> with
              <var>error</var> as its argument.</p>
            </li>
          </ol>

          <p>The task source for these <span title="concept-task">tasks</span>
          is the user interaction task source.</p>
        <table class="parameters"><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">options</td><td class="prmType"><code><a href="#idl-def-MediaStreamOptions" class="idlType"><code>MediaStreamOptions</code></a></code></td><td class="prmNullTrue">✔</td><td class="prmOptFalse">✘</td><td class="prmDesc"></td></tr><tr><td class="prmName">successCallback</td><td class="prmType"><code><a href="#idl-def-NavigatorUserMediaSuccessCallback" class="idlType"><code>NavigatorUserMediaSuccessCallback</code></a></code></td><td class="prmNullTrue">✔</td><td class="prmOptFalse">✘</td><td class="prmDesc"></td></tr><tr><td class="prmName">errorCallback</td><td class="prmType"><code><a href="#idl-def-NavigatorUserMediaErrorCallback" class="idlType"><code>NavigatorUserMediaErrorCallback</code></a></code></td><td class="prmNullTrue">✔</td><td class="prmOptTrue">✔</td><td class="prmDesc"></td></tr></table><div><em>Return type: </em><code><a>void</a></code></div></dd></dl></div>

      <pre class="idl"><span class="idlImplements"><a>Navigator</a> implements <a href="#idl-def-NavigatorUserMedia" class="idlType"><code>NavigatorUserMedia</code></a>;</span></pre><div class="idlImplementsDesc"><p>All instances of the <code><a>Navigator</a></code> type are defined to also implement the <a href="#idl-def-NavigatorUserMedia" class="idlType"><code>NavigatorUserMedia</code></a> interface.</p></div>
    </div>

    <div id="mediastreamoptions" class="section">
      <h3><span class="secno">3.2 </span>MediaStreamOptions</h3>

      <pre class="idl"><span id="idl-def-MediaStreamOptions" class="idlDictionary">dictionary <span class="idlDictionaryID">MediaStreamOptions</span> {
<span class="idlMember">    <span class="idlMemberType"><a>boolean</a></span> <span class="idlMemberName"><a href="#widl-MediaStreamOptions-audio">audio</a></span>;</span>
<span class="idlMember">    <span class="idlMemberType"><a>boolean</a></span> <span class="idlMemberName"><a href="#widl-MediaStreamOptions-video">video</a></span>;</span>
};</span>
</pre><div id="dictionary-mediastreamoptions-members" class="section"><h4><span class="secno">3.2.1 </span>Dictionary <a class="idlType" href="#idl-def-MediaStreamOptions"><code>MediaStreamOptions</code></a> Members</h4><dl class="dictionary-members"><dt id="widl-MediaStreamOptions-audio"><code>audio</code> of type <span class="idlMemberType"><a>boolean</a></span></dt><dd>Set to true if an audio track is requested, default is false</dd><dt id="widl-MediaStreamOptions-video"><code>video</code> of type <span class="idlMemberType"><a>boolean</a></span></dt><dd>Set to true if a video track is requested, default is false</dd></dl></div>
    </div>

    <div id="navigatorusermediasuccesscallback" class="section">
      <h3><span class="secno">3.3 </span>NavigatorUserMediaSuccessCallback</h3>

      <pre class="idl"><span id="idl-def-NavigatorUserMediaSuccessCallback" class="idlInterface">[<span class="extAttr">Callback=FunctionOnly, NoInterfaceObject</span>]
interface <span class="idlInterfaceID">NavigatorUserMediaSuccessCallback</span> {
<span class="idlMethod">    <span class="idlMethType"><a>void</a></span> <span class="idlMethName"><a href="#widl-NavigatorUserMediaSuccessCallback-handleEvent-void-LocalMediaStream-stream">handleEvent</a></span> (<span class="idlParam"><span class="idlParamType"><a href="#idl-def-LocalMediaStream" class="idlType"><code>LocalMediaStream</code></a></span> <span class="idlParamName">stream</span></span>);</span>
};</span>
</pre><div id="methods-4" class="section"><h4><span class="secno">3.3.1 </span>Methods</h4><dl class="methods"><dt id="widl-NavigatorUserMediaSuccessCallback-handleEvent-void-LocalMediaStream-stream"><code>handleEvent</code></dt><dd>(Explanation of handleEvent TBD)<table class="parameters"><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">stream</td><td class="prmType"><code><a href="#idl-def-LocalMediaStream" class="idlType"><code>LocalMediaStream</code></a></code></td><td class="prmNullFalse">✘</td><td class="prmOptFalse">✘</td><td class="prmDesc"></td></tr></table><div><em>Return type: </em><code><a>void</a></code></div></dd></dl></div>
    </div>

    <div id="navigatorusermediaerror-and-navigatorusermediaerrorcallback" class="section">
      <h3><span class="secno">3.4 </span>NavigatorUserMediaError and NavigatorUserMediaErrorCallback</h3>

      <pre class="idl"><span id="idl-def-NavigatorUserMediaError" class="idlInterface">[<span class="extAttr">NoInterfaceObject</span>]
interface <span class="idlInterfaceID">NavigatorUserMediaError</span> {
<span class="idlConst">    const <span class="idlConstType"><a>unsigned short</a></span> <span class="idlConstName"><a href="#widl-NavigatorUserMediaError-PERMISSION_DENIED">PERMISSION_DENIED</a></span> = <span class="idlConstValue">1</span>;</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a>unsigned short</a></span> <span class="idlAttrName"><a href="#widl-NavigatorUserMediaError-code">code</a></span>;</span>
};</span>
</pre><div id="attributes-3" class="section"><h4><span class="secno">3.4.1 </span>Attributes</h4><dl class="attributes"><dt id="widl-NavigatorUserMediaError-code"><code>code</code> of type <span class="idlAttrType"><a>unsigned short</a></span>, readonly</dt><dd>Returns the current error's error code. At this time, this will
        always be 1, for which the constant <code title="dom-NavigatorUserMediaError-PERMISSION_DENIED"><a href="#dom-navigatorusermediaerror-permission_denied">PERMISSION_DENIED</a></code>
        is defined.</dd></dl></div><div id="constants-1" class="section"><h4><span class="secno">3.4.2 </span>Constants</h4><dl class="constants"><dt id="widl-NavigatorUserMediaError-PERMISSION_DENIED"><code>PERMISSION_DENIED</code> of type <span class="idlConstType"><a>unsigned short</a></span></dt><dd>The user denied the page permission to use the user's media
        devices.</dd></dl></div>

      <pre class="idl"><span id="idl-def-NavigatorUserMediaErrorCallback" class="idlInterface">[<span class="extAttr">Callback=FunctionOnly, NoInterfaceObject</span>]
interface <span class="idlInterfaceID">NavigatorUserMediaErrorCallback</span> {
<span class="idlMethod">    <span class="idlMethType"><a>void</a></span> <span class="idlMethName"><a href="#widl-NavigatorUserMediaErrorCallback-handleEvent-void-NavigatorUserMediaError-error">handleEvent</a></span> (<span class="idlParam"><span class="idlParamType"><a href="#idl-def-NavigatorUserMediaError" class="idlType"><code>NavigatorUserMediaError</code></a></span> <span class="idlParamName">error</span></span>);</span>
};</span>
</pre><div id="methods-5" class="section"><h4><span class="secno">3.4.3 </span>Methods</h4><dl class="methods"><dt id="widl-NavigatorUserMediaErrorCallback-handleEvent-void-NavigatorUserMediaError-error"><code>handleEvent</code></dt><dd>(Explanation of handleEvent TBD)<table class="parameters"><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">error</td><td class="prmType"><code><a href="#idl-def-NavigatorUserMediaError" class="idlType"><code>NavigatorUserMediaError</code></a></code></td><td class="prmNullFalse">✘</td><td class="prmOptFalse">✘</td><td class="prmDesc"></td></tr></table><div><em>Return type: </em><code><a>void</a></code></div></dd></dl></div>
    </div>
  </div>

  <div id="examples" class="section">
    
<!-- OddPage -->
<h2><span class="secno">4. </span>Examples</h2>

    <div>
      <p>This sample code exposes a button. When clicked, the button is
      disabled and the user is prompted to offer a stream. The user can cause
      the button to be re-enabled by providing a stream (e.g. giving the page
      access to the local camera) and then disabling the stream (e.g. revoking
      that access).</p>
      <pre class="example sh_javascript sh_sourceCode">&lt;input type=&quot;button&quot; value=&quot;Start&quot; onclick=&quot;start()&quot; id=&quot;startBtn&quot;&gt;
&lt;script&gt;
 var startBtn = document.getElementById('startBtn');
 function start() {
   navigator.getUserMedia({audio:true, video:true}, gotStream);
   startBtn.disabled = true;
 }
 function gotStream(stream) {
   stream.onended = function () {
     startBtn.disabled = false;
   }
 }
&lt;/script&gt;</pre>
    </div>

    
<!--  Put back when we define MediaStreamRecorder
    <div>
      <p>This example allows people to record a short audio message and upload
      it to the server. This example even shows rudimentary error handling.</p>
      <pre class='example sh_javascript'>
&lt;input type="button" value="⚫" onclick="msgRecord()" id="recBtn"&gt;
&lt;input type="button" value="◼" onclick="msgStop()" id="stopBtn" disabled&gt;
&lt;p id="status"&gt;To start recording, press the ⚫ button.&lt;/p&gt;
&lt;script&gt;
 var recBtn = document.getElementById('recBtn');
 var stopBtn = document.getElementById('stopBtn');
 function report(s) {
   document.getElementById('status').textContent = s;
 }
 function msgRecord() {
   report('Attempting to access microphone...');
   navigator.getUserMedia({audio:true}, gotStream, noStream);
   recBtn.disabled = true;
 }
 var msgStream, msgStreamRecorder;
 function gotStream(stream) {
   report('Recording... To stop, press to ◼ button.');
   msgStream = stream;
   msgStreamRecorder = stream.record();
   stopBtn.disabled = false;
   stream.onended = function () {
     msgStop();     
   }
 }
 function msgStop() {
   report('Creating file...');
   stopBtn.disabled = true;
   msgStream.onended = null;
   msgStream.stop();
   msgStreamRecorder.getRecordedData(msgSave);
 }
 function msgSave(blob) {
   report('Uploading file...');
   var x = new XMLHttpRequest();
   x.open('POST', 'uploadMessage');
   x.send(blob);
   x.onload = function () {
     report('Done! To record a new message, press the ⚫ button.');
     recBtn.disabled = false;
   };
   x.onerror = function () {
     report('Failed to upload message. To try recording a message again, press the ⚫ button.');
     recBtn.disabled = false;
   };
 }
 function noStream() {
   report('Could not obtain access to your microphone. To try again, press the ⚫ button.');
   recBtn.disabled = false;
 }
&lt;/script&gt;
</pre>
    </div> -->


    <div>
      <p>This example allows people to take photos of themselves from the local
      video camera.</p>
      <pre class="example sh_javascript">&lt;article&gt;
 &lt;style scoped&gt;
  video { transform: scaleX(-1); }
  p { text-align: center; }
 &lt;/style&gt;
 &lt;h1&gt;Snapshot Kiosk&lt;/h1&gt;
 &lt;section id=&quot;splash&quot;&gt;
  &lt;p id=&quot;errorMessage&quot;&gt;Loading...&lt;/p&gt;
 &lt;/section&gt;
 &lt;section id=&quot;app&quot; hidden&gt;
  &lt;p&gt;&lt;video id=&quot;monitor&quot; autoplay&gt;&lt;/video&gt; &lt;canvas id=&quot;photo&quot;&gt;&lt;/canvas&gt;
  &lt;p&gt;&lt;input type=button value=&quot;&amp;#x1F4F7;&quot; onclick=&quot;snapshot()&quot;&gt;
 &lt;/section&gt;
 &lt;script&gt;
  navigator.getUserMedia({video:true}, gotStream, noStream);
  var video = document.getElementById('monitor');
  var canvas = document.getElementById('photo');
  function gotStream(stream) {
    video.src = URL.createObjectURL(stream);
    video.onerror = function () {
      stream.stop();
    };
    stream.onended = noStream;
    video.onloadedmetadata = function () {
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      document.getElementById('splash').hidden = true;
      document.getElementById('app').hidden = false;
    };
  }
  function noStream() {
    document.getElementById('errorMessage').textContent = 'No camera available.';
  }
  function snapshot() {
    canvas.getContext('2d').drawImage(video, 0, 0);
  }
 &lt;/script&gt;
&lt;/article&gt;</pre>
    </div>
  </div>

  <div id="garbage-collection" class="section">
    
<!-- OddPage -->
<h2><span class="secno">5. </span>Garbage collection</h2>
  </div>

  <div id="event-definitions" class="section">
    
<!-- OddPage -->
<h2><span class="secno">6. </span>Event definitions</h2>
  </div>

  <div class="informative section" id="event-summary">
    
<!-- OddPage -->
<h2><span class="secno">7. </span>Event summary</h2><p><em>This section is non-normative.</em></p>
  </div>

  <div id="change-log" class="section">
    
<!-- OddPage -->
<h2><span class="secno">8. </span>Change Log</h2>

    <p>This section will be removed before publication.</p>

    <h3 id="to-do-items">To Do Items</h3>

    <p>-</p>

    <h3 id="apr-23-2012">Apr 23 2012</h3>
    <ol>
      <li>Remove MediaStreamRecorder.</li>
    </ol>
    
    <h3 id="apr-20-2012">Apr 20 2012</h3>

    <ol>
      <li>Add definitions of MediaStreams and related objects.</li>
    </ol>

    <h3 id="dec-21-2011">Dec 21 2011</h3>

    <ol>
      <li>Changed to make wanted media opt in (rather than opt out). Minor
      edits.</li>
    </ol>

    <h3 id="nov-29-2011">Nov 29 2011</h3>

    <ol>
      <li>Changed examples to use MediaStreamOptions objects rather than
      strings. Minor edits.</li>
    </ol>

    <h3 id="nov-15-2011">Nov 15 2011</h3>

    <ol>
      <li>Removed MediaStream stuff. Refers to webrtc 1.0 spec for that part
      instead.</li>
    </ol>

    <h3 id="nov-9-2011">Nov 9 2011</h3>

    <ol>
      <li>Created first version by copying the webrtc spec and ripping out
      stuff. Put it on github.</li>
    </ol>
  </div>

  <div class="appendix section" id="acknowledgements">
    
<!-- OddPage -->
<h2><span class="secno">A. </span>Acknowledgements</h2>
  </div>


<div id="references" class="appendix section">
<!-- OddPage -->
<h2><span class="secno">B. </span>References</h2><div id="normative-references" class="section"><h3><span class="secno">B.1 </span>Normative references</h3><dl class="bibliography"><dt id="bib-FILE-API">[FILE-API]</dt><dd>Arun Ranganathan; Jonas Sicking. <a href="http://www.w3.org/TR/2011/WD-FileAPI-20111020/"><cite>File API.</cite></a> 20 October 2011. W3C Working Draft. (Work in progress.) URL: <a href="http://www.w3.org/TR/2011/WD-FileAPI-20111020/">http://www.w3.org/TR/2011/WD-FileAPI-20111020/</a> 
</dd><dt id="bib-WEBRTC10">[WEBRTC10]</dt><dd>A Bergkvist; D Burnett; C Jennings; A Narayanan. <a href="http://www.w3.org/TR/2011/WD-webrtc-20111027/"><cite>WebRTC 1.0.</cite></a> 27 October 2011. W3C Working Draft. (Work in progress.) URL: <a href="http://www.w3.org/TR/2011/WD-webrtc-20111027/">http://www.w3.org/TR/2011/WD-webrtc-20111027/</a> 
</dd></dl></div><div id="informative-references" class="section"><h3><span class="secno">B.2 </span>Informative references</h3><p>No informative references.</p></div></div></body></html>
