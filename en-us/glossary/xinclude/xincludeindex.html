<p><a href="https://www.w3.org/TR/xinclude/#text-included-items">XML Inclusions (XInclude)</a> is a W3C Recommendation to allow inclusion of XML more different sources in a more convenient fashion than XML external entities. When used in conjunction with XPointer (Firefox supports a subset of it, and is used in the code sample below), XInclude can also target just specific portions of a document for inclusion. Firefox does not support it natively, but the following function aims to allow its use with documents passed into it.</p>
<h3 id="code-sample">Code sample</h3>
<p>The following code aims to let &lt;xi:include&gt; and &lt;xi:fallback&gt; tags (the two elements in the language) with all of the attributes of &lt;xi:include&gt; be included in an XML document so as to be resolvable into a single XML document.</p>
<p>(Note that this has not been thoroughly tested for all circumstances and may not necessarily reflect the standard behavior completely.)</p>
<p>Note also that if you wish to allow xml:base, you will need the <a href="/en-US/docs/Archive/Add-ons/Code_snippets/XML/base_function">xml:base function</a>, and the line beginning <code>var href = ...</code> should become:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">var</span> href <span class="op">=</span> <span class="at">getXmlBaseLink</span> (<span class="co">/* XLink sans xml:base */</span> <span class="va">xinclude</span>.<span class="at">getAttribute</span>(<span class="st">&#39;href&#39;</span>)<span class="op">,</span> <span class="co">/* Element to query from */</span> xinclude)<span class="op">;</span></a></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">function</span> <span class="at">resolveXIncludes</span>(docu) <span class="op">{</span></a>
<a class="sourceLine" id="cb2-2" title="2">    <span class="co">// http://www.w3.org/TR/xinclude/#xml-included-items</span></a>
<a class="sourceLine" id="cb2-3" title="3">    <span class="kw">var</span> xincludes <span class="op">=</span> <span class="va">docu</span>.<span class="at">getElementsByTagNameNS</span>(<span class="st">&#39;http://www.w3.org/2001/XInclude&#39;</span><span class="op">,</span> <span class="st">&#39;include&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-4" title="4">    <span class="cf">if</span> (xincludes) <span class="op">{</span></a>
<a class="sourceLine" id="cb2-5" title="5">        <span class="cf">for</span> (i<span class="op">=</span><span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="va">xincludes</span>.<span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb2-6" title="6">            <span class="kw">var</span> xinclude <span class="op">=</span> xincludes[i]<span class="op">;</span></a>
<a class="sourceLine" id="cb2-7" title="7">            <span class="kw">var</span> href <span class="op">=</span> <span class="va">xinclude</span>.<span class="at">getAttribute</span>(<span class="st">&#39;href&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-8" title="8">            <span class="kw">var</span> parse <span class="op">=</span> <span class="va">xinclude</span>.<span class="at">getAttribute</span>(<span class="st">&#39;parse&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-9" title="9">            <span class="kw">var</span> xpointer <span class="op">=</span> <span class="va">xinclude</span>.<span class="at">getAttribute</span>(<span class="st">&#39;xpointer&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-10" title="10">            <span class="kw">var</span> encoding <span class="op">=</span> <span class="va">xinclude</span>.<span class="at">getAttribute</span>(<span class="st">&#39;encoding&#39;</span>)<span class="op">;</span> <span class="co">// e.g., UTF-8 // &quot;text/xml or application/xml or matches text/*+xml or application/*+xml&quot; before encoding (then UTF-8)</span></a>
<a class="sourceLine" id="cb2-11" title="11">            <span class="kw">var</span> accept <span class="op">=</span> <span class="va">xinclude</span>.<span class="at">getAttribute</span>(<span class="st">&#39;accept&#39;</span>)<span class="op">;</span> <span class="co">// header &quot;Accept: &quot;+x</span></a>
<a class="sourceLine" id="cb2-12" title="12">            <span class="kw">var</span> acceptLanguage <span class="op">=</span> <span class="va">xinclude</span>.<span class="at">getAttribute</span>(<span class="st">&#39;accept-language&#39;</span>)<span class="op">;</span> <span class="co">// &quot;Accept-Language: &quot;+x</span></a>
<a class="sourceLine" id="cb2-13" title="13">            <span class="kw">var</span> xiFallback <span class="op">=</span> <span class="va">xinclude</span>.<span class="at">getElementsByTagNameNS</span>(<span class="st">&#39;http://www.w3.org/2001/XInclude&#39;</span><span class="op">,</span> <span class="st">&#39;fallback&#39;</span>)[<span class="dv">0</span>]<span class="op">;</span> <span class="co">// Only one such child is allowed</span></a>
<a class="sourceLine" id="cb2-14" title="14">            <span class="cf">if</span> (href <span class="op">===</span> <span class="st">&#39;&#39;</span> <span class="op">||</span> href <span class="op">===</span> <span class="kw">null</span>) <span class="op">{</span> <span class="co">// Points to same document if empty (null is equivalent to empty string)</span></a>
<a class="sourceLine" id="cb2-15" title="15">                href <span class="op">=</span> <span class="kw">null</span><span class="op">;</span> <span class="co">// Set for uniformity in testing below</span></a>
<a class="sourceLine" id="cb2-16" title="16">                <span class="cf">if</span> (parse <span class="op">===</span> <span class="st">&#39;xml&#39;</span> <span class="op">&amp;&amp;</span> xpointer <span class="op">===</span> <span class="kw">null</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb2-17" title="17">                    <span class="at">alert</span>(<span class="st">&#39;There must be an XPointer attribute present if &quot;href&quot; is empty an parse is &quot;xml&quot;&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-18" title="18">                    <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></a>
<a class="sourceLine" id="cb2-19" title="19">                <span class="op">}</span></a>
<a class="sourceLine" id="cb2-20" title="20">            <span class="op">}</span></a>
<a class="sourceLine" id="cb2-21" title="21">            <span class="cf">else</span> <span class="cf">if</span> (<span class="va">href</span>.<span class="at">match</span>(<span class="ss">/#</span><span class="sc">$</span><span class="ss">/</span><span class="op">,</span> <span class="st">&#39;&#39;</span>) <span class="op">||</span> <span class="va">href</span>.<span class="at">match</span>(<span class="ss">/</span><span class="sc">^</span><span class="ss">#/</span><span class="op">,</span> <span class="st">&#39;&#39;</span>)) <span class="op">{</span></a>
<a class="sourceLine" id="cb2-22" title="22">                <span class="at">alert</span>(<span class="st">&#39;Fragment identifiers are disallowed in an XInclude &quot;href&quot; attribute&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-23" title="23">                <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></a>
<a class="sourceLine" id="cb2-24" title="24">            <span class="op">}</span></a>
<a class="sourceLine" id="cb2-25" title="25">            <span class="kw">var</span> j<span class="op">;</span></a>
<a class="sourceLine" id="cb2-26" title="26">            <span class="kw">var</span> xincludeParent <span class="op">=</span> <span class="va">xinclude</span>.<span class="at">parentNode</span><span class="op">;</span></a>
<a class="sourceLine" id="cb2-27" title="27">            <span class="cf">try</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb2-28" title="28">                <span class="va">netscape</span>.<span class="va">security</span>.<span class="va">PrivilegeManager</span>.<span class="at">enablePrivilege</span>(<span class="st">&#39;UniversalXPConnect UniversalBrowserRead&#39;</span>)<span class="op">;</span> <span class="co">// Necessary with file:///-located files trying to reach external sites</span></a>
<a class="sourceLine" id="cb2-29" title="29">                <span class="cf">if</span> (href <span class="op">!==</span> <span class="kw">null</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb2-30" title="30">                    <span class="kw">var</span> response<span class="op">,</span> responseType<span class="op">;</span></a>
<a class="sourceLine" id="cb2-31" title="31">                    <span class="kw">var</span> request <span class="op">=</span> <span class="kw">new</span> <span class="at">XMLHttpRequest</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb2-32" title="32">                    <span class="va">request</span>.<span class="at">open</span>(<span class="st">&#39;GET&#39;</span><span class="op">,</span> href<span class="op">,</span> <span class="kw">false</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-33" title="33">                    <span class="va">request</span>.<span class="at">setRequestHeader</span>(<span class="st">&#39;If-Modified-Since&#39;</span><span class="op">,</span> <span class="st">&#39;Thu, 1 Jan 1970 00:00:00 GMT&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-34" title="34">                    <span class="va">request</span>.<span class="at">setRequestHeader</span>(<span class="st">&#39;Cache-Control&#39;</span><span class="op">,</span> <span class="st">&#39;no-cache&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-35" title="35">                    <span class="cf">if</span> (accept) <span class="op">{</span></a>
<a class="sourceLine" id="cb2-36" title="36">                        <span class="va">request</span>.<span class="at">setRequestHeader</span>(<span class="st">&#39;Accept&#39;</span><span class="op">,</span> accept)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-37" title="37">                    <span class="op">}</span></a>
<a class="sourceLine" id="cb2-38" title="38">                    <span class="cf">if</span> (acceptLanguage) <span class="op">{</span></a>
<a class="sourceLine" id="cb2-39" title="39">                        <span class="va">request</span>.<span class="at">setRequestHeader</span>(<span class="st">&#39;Accept-Language&#39;</span><span class="op">,</span> acceptLanguage)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-40" title="40">                    <span class="op">}</span></a>
<a class="sourceLine" id="cb2-41" title="41">                    <span class="cf">switch</span> (parse) <span class="op">{</span></a>
<a class="sourceLine" id="cb2-42" title="42">                        <span class="cf">case</span> <span class="st">&#39;text&#39;</span><span class="op">:</span></a>
<a class="sourceLine" id="cb2-43" title="43">                            <span class="co">// Priority should be on media type:</span></a>
<a class="sourceLine" id="cb2-44" title="44"></a>
<a class="sourceLine" id="cb2-45" title="45">                            <span class="kw">var</span> contentType <span class="op">=</span> <span class="va">request</span>.<span class="at">getResponseHeader</span>(<span class="st">&#39;Content-Type&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-46" title="46"></a>
<a class="sourceLine" id="cb2-47" title="47">                            <span class="co">//text/xml; charset=&quot;utf-8&quot; // Send to get headers first?</span></a>
<a class="sourceLine" id="cb2-48" title="48">                            <span class="co">// Fix: We test for file extensions as well in case file:// doesn&#39;t return content type (as seems to be the case); can some other tool be used in FF (or IE) to detect encoding of local file? Probably just need BOM test since other encodings must be specified</span></a>
<a class="sourceLine" id="cb2-49" title="49">                            <span class="kw">var</span> patternXML <span class="op">=</span> <span class="ss">/</span><span class="sc">\.(</span><span class="ss">svg</span><span class="sc">|</span><span class="ss">xml</span><span class="sc">|</span><span class="ss">xul</span><span class="sc">|</span><span class="ss">rdf</span><span class="sc">|</span><span class="ss">xhtml</span><span class="sc">)$</span><span class="ss">/</span><span class="op">;</span></a>
<a class="sourceLine" id="cb2-50" title="50">                            <span class="cf">if</span> ((contentType <span class="op">&amp;&amp;</span> <span class="va">contentType</span>.<span class="at">match</span>(<span class="ss">/</span><span class="sc">[text|application]\/(</span><span class="ss">.</span><span class="sc">*)\+?</span><span class="ss">xml/</span>)) <span class="op">||</span> (<span class="va">href</span>.<span class="at">indexOf</span>(<span class="st">&#39;file://&#39;</span>) <span class="op">===</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> <span class="va">href</span>.<span class="at">match</span>(patternXML))) <span class="op">{</span></a>
<a class="sourceLine" id="cb2-51" title="51">                                <span class="co">/* Grab the response as text (see below for that routine) and then find encoding within*/</span></a>
<a class="sourceLine" id="cb2-52" title="52">                               <span class="kw">var</span> encName <span class="op">=</span> <span class="st">&#39;([A-Za-z][A-Za-z0-9._-]*)&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb2-53" title="53">                               <span class="kw">var</span> pattern <span class="op">=</span> <span class="kw">new</span> <span class="at">RegExp</span>(<span class="st">&#39;^&lt;</span><span class="sc">\\</span><span class="st">?xml</span><span class="sc">\\</span><span class="st">s+.*encoding</span><span class="sc">\\</span><span class="st">s*=</span><span class="sc">\\</span><span class="st">s*([</span><span class="sc">\&#39;</span><span class="st">&quot;])&#39;</span><span class="op">+</span>encName<span class="op">+</span><span class="st">&#39;</span><span class="sc">\\</span><span class="st">1.*</span><span class="sc">\\</span><span class="st">?&gt;&#39;</span>)<span class="op">;</span> <span class="co">// Check document if not?</span></a>
<a class="sourceLine" id="cb2-54" title="54">                               <span class="co">// Let the request be processed below</span></a>
<a class="sourceLine" id="cb2-55" title="55">                            <span class="op">}</span></a>
<a class="sourceLine" id="cb2-56" title="56">                            <span class="cf">else</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb2-57" title="57">                                <span class="cf">if</span> (encoding <span class="op">===</span> <span class="st">&#39;&#39;</span> <span class="op">||</span> encoding <span class="op">===</span> <span class="kw">null</span>) <span class="op">{</span> <span class="co">// Encoding has no effect on XML</span></a>
<a class="sourceLine" id="cb2-58" title="58">                                    encoding <span class="op">=</span> <span class="st">&#39;utf-8&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb2-59" title="59">                                <span class="op">}</span></a>
<a class="sourceLine" id="cb2-60" title="60">                                <span class="va">request</span>.<span class="at">overrideMimeType</span>(<span class="st">&#39;text/plain; charset=&#39;</span><span class="op">+</span>encoding)<span class="op">;</span> <span class="co">//&#39;x-user-defined&#39;</span></a>
<a class="sourceLine" id="cb2-61" title="61">                            <span class="op">}</span></a>
<a class="sourceLine" id="cb2-62" title="62">                            responseType <span class="op">=</span> <span class="st">&#39;responseText&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb2-63" title="63">                            <span class="cf">break</span><span class="op">;</span></a>
<a class="sourceLine" id="cb2-64" title="64">                        <span class="cf">case</span> <span class="dt">null</span><span class="op">:</span></a>
<a class="sourceLine" id="cb2-65" title="65">                        <span class="cf">case</span> <span class="st">&#39;xml&#39;</span><span class="op">:</span></a>
<a class="sourceLine" id="cb2-66" title="66">                            responseType <span class="op">=</span> <span class="st">&#39;responseXML&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb2-67" title="67">                            <span class="cf">break</span><span class="op">;</span></a>
<a class="sourceLine" id="cb2-68" title="68">                        <span class="cf">default</span><span class="op">:</span></a>
<a class="sourceLine" id="cb2-69" title="69">                            <span class="at">alert</span>(<span class="st">&#39;XInclude element contains an invalid &quot;parse&quot; attribute value&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-70" title="70">                            <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></a>
<a class="sourceLine" id="cb2-71" title="71">                            <span class="cf">break</span><span class="op">;</span></a>
<a class="sourceLine" id="cb2-72" title="72">                    <span class="op">}</span></a>
<a class="sourceLine" id="cb2-73" title="73">                    <span class="va">request</span>.<span class="at">send</span>(<span class="kw">null</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-74" title="74">                    <span class="cf">if</span>((<span class="va">request</span>.<span class="at">status</span> <span class="op">===</span> <span class="dv">200</span> <span class="op">||</span> <span class="va">request</span>.<span class="at">status</span> <span class="op">===</span> <span class="dv">0</span>) <span class="op">&amp;&amp;</span> request[responseType] <span class="op">!==</span> <span class="kw">null</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb2-75" title="75">                        response <span class="op">=</span> request[responseType]<span class="op">;</span></a>
<a class="sourceLine" id="cb2-76" title="76">                         <span class="cf">if</span> (responseType <span class="op">===</span> <span class="st">&#39;responseXML&#39;</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb2-77" title="77">                            <span class="co">// apply xpointer (only xpath1() subset is supported)</span></a>
<a class="sourceLine" id="cb2-78" title="78">                            <span class="kw">var</span> responseNodes<span class="op">;</span></a>
<a class="sourceLine" id="cb2-79" title="79">                            <span class="cf">if</span> (xpointer) <span class="op">{</span></a>
<a class="sourceLine" id="cb2-80" title="80">                                <span class="kw">var</span> xpathResult <span class="op">=</span> <span class="va">response</span>.<span class="at">evaluate</span>(</a>
<a class="sourceLine" id="cb2-81" title="81">                                                                 xpointer<span class="op">,</span></a>
<a class="sourceLine" id="cb2-82" title="82">                                                                 response<span class="op">,</span></a>
<a class="sourceLine" id="cb2-83" title="83">                                                                 <span class="kw">null</span><span class="op">,</span></a>
<a class="sourceLine" id="cb2-84" title="84">                                                                 <span class="va">XPathResult</span>.<span class="at">ORDERED_NODE_SNAPSHOT_TYPE</span><span class="op">,</span></a>
<a class="sourceLine" id="cb2-85" title="85">                                                                 <span class="kw">null</span></a>
<a class="sourceLine" id="cb2-86" title="86">                                                              )<span class="op">;</span></a>
<a class="sourceLine" id="cb2-87" title="87">                                <span class="kw">var</span> a <span class="op">=</span> []<span class="op">;</span></a>
<a class="sourceLine" id="cb2-88" title="88">                                <span class="cf">for</span>(<span class="kw">var</span> k <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> k <span class="op">&lt;</span> <span class="va">xpathResult</span>.<span class="at">snapshotLength</span><span class="op">;</span> k<span class="op">++</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb2-89" title="89">                                a[k] <span class="op">=</span> <span class="va">xpathResult</span>.<span class="at">snapshotItem</span>(k)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-90" title="90">                                <span class="op">}</span></a>
<a class="sourceLine" id="cb2-91" title="91">                                responseNodes <span class="op">=</span> a<span class="op">;</span></a>
<a class="sourceLine" id="cb2-92" title="92">                            <span class="op">}</span></a>
<a class="sourceLine" id="cb2-93" title="93">                            <span class="cf">else</span> <span class="op">{</span> <span class="co">// Otherwise, the response must be a single well-formed document response</span></a>
<a class="sourceLine" id="cb2-94" title="94">                                responseNodes <span class="op">=</span> [<span class="va">response</span>.<span class="at">documentElement</span>]<span class="op">;</span> <span class="co">// Put in array so can be treated the same way as the above</span></a>
<a class="sourceLine" id="cb2-95" title="95">                            <span class="op">}</span></a>
<a class="sourceLine" id="cb2-96" title="96">                            <span class="co">// PREPEND ANY NODE(S) (AS XML) THEN REMOVE XINCLUDE</span></a>
<a class="sourceLine" id="cb2-97" title="97">                            <span class="cf">for</span> (j<span class="op">=</span><span class="dv">0</span><span class="op">;</span> j <span class="op">&lt;</span> <span class="va">responseNodes</span>.<span class="at">length</span> <span class="op">;</span> j<span class="op">++</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb2-98" title="98">                                <span class="va">xincludeParent</span>.<span class="at">insertBefore</span>(responseNodes[j]<span class="op">,</span> xinclude)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-99" title="99">                            <span class="op">}</span></a>
<a class="sourceLine" id="cb2-100" title="100">                            <span class="va">xincludeParent</span>.<span class="at">removeChild</span>(xinclude)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-101" title="101">                         <span class="op">}</span></a>
<a class="sourceLine" id="cb2-102" title="102">                         <span class="cf">else</span> <span class="cf">if</span> (responseType <span class="op">===</span> <span class="st">&#39;responseText&#39;</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb2-103" title="103">                             <span class="cf">if</span> (encName) <span class="op">{</span></a>
<a class="sourceLine" id="cb2-104" title="104">                                  <span class="kw">var</span> encodingType <span class="op">=</span> <span class="va">response</span>.<span class="at">match</span>(pattern)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-105" title="105">                                  <span class="cf">if</span> (encodingType) <span class="op">{</span></a>
<a class="sourceLine" id="cb2-106" title="106">                                      encodingType <span class="op">=</span> encodingType[<span class="dv">2</span>]<span class="op">;</span></a>
<a class="sourceLine" id="cb2-107" title="107">                                  <span class="op">}</span></a>
<a class="sourceLine" id="cb2-108" title="108">                                  <span class="cf">else</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb2-109" title="109">                                      encodingType <span class="op">=</span> <span class="st">&#39;utf-8&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb2-110" title="110">                                  <span class="op">}</span></a>
<a class="sourceLine" id="cb2-111" title="111">                                  <span class="co">// Need to make a whole new request apparently since cannot convert the encoding after receiving it (to know what the encoding was)</span></a>
<a class="sourceLine" id="cb2-112" title="112">                                  <span class="kw">var</span> request2 <span class="op">=</span> <span class="kw">new</span> <span class="at">XMLHttpRequest</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb2-113" title="113">                                  <span class="va">request2</span>.<span class="at">overrideMimeType</span>(<span class="st">&#39;text/plain; charset=&#39;</span><span class="op">+</span>encodingType)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-114" title="114">                                  <span class="va">request2</span>.<span class="at">open</span>(<span class="st">&#39;GET&#39;</span><span class="op">,</span> href<span class="op">,</span> <span class="kw">false</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-115" title="115">                                  <span class="va">request2</span>.<span class="at">setRequestHeader</span>(<span class="st">&#39;If-Modified-Since&#39;</span><span class="op">,</span> <span class="st">&#39;Thu, 1 Jan 1970 00:00:00 GMT&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-116" title="116">                                  <span class="va">request2</span>.<span class="at">setRequestHeader</span>(<span class="st">&#39;Cache-Control&#39;</span><span class="op">,</span> <span class="st">&#39;no-cache&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-117" title="117">                                  <span class="va">request2</span>.<span class="at">send</span>(<span class="kw">null</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-118" title="118">                                  response <span class="op">=</span> request2[responseType]<span class="op">;</span> <span class="co">// Update the response for processing</span></a>
<a class="sourceLine" id="cb2-119" title="119">                             <span class="op">}</span></a>
<a class="sourceLine" id="cb2-120" title="120"></a>
<a class="sourceLine" id="cb2-121" title="121">                             <span class="co">// REPLACE XINCLUDE WITH THE RESPONSE AS TEXT</span></a>
<a class="sourceLine" id="cb2-122" title="122">                             <span class="kw">var</span> textNode <span class="op">=</span> <span class="va">docu</span>.<span class="at">createTextNode</span>(response)<span class="op">;</span>                             <span class="va">xincludeParent</span>.<span class="at">replaceChild</span>(textNode<span class="op">,</span> xinclude)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-123" title="123">                         <span class="op">}</span></a>
<a class="sourceLine" id="cb2-124" title="124"></a>
<a class="sourceLine" id="cb2-125" title="125">                        <span class="co">// replace xinclude in doc with response now (as plain text or XML)</span></a>
<a class="sourceLine" id="cb2-126" title="126">                    <span class="op">}</span></a>
<a class="sourceLine" id="cb2-127" title="127">                <span class="op">}</span></a>
<a class="sourceLine" id="cb2-128" title="128">            <span class="op">}</span></a>
<a class="sourceLine" id="cb2-129" title="129">            <span class="cf">catch</span> (e) <span class="op">{</span> <span class="co">// Use xi:fallback if XInclude retrieval above failed</span></a>
<a class="sourceLine" id="cb2-130" title="130">                <span class="kw">var</span> xiFallbackChildren <span class="op">=</span> <span class="va">xiFallback</span>.<span class="at">childNodes</span><span class="op">;</span></a>
<a class="sourceLine" id="cb2-131" title="131">                <span class="co">// PREPEND ANY NODE(S) THEN REMOVE XINCLUDE</span></a>
<a class="sourceLine" id="cb2-132" title="132">                <span class="cf">for</span> (j<span class="op">=</span><span class="dv">0</span><span class="op">;</span> j <span class="op">&lt;</span> <span class="va">xiFallbackChildren</span>.<span class="at">length</span> <span class="op">;</span> j<span class="op">++</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb2-133" title="133">                    <span class="va">xincludeParent</span>.<span class="at">insertBefore</span>(xiFallbackChildren[j]<span class="op">,</span> xinclude)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-134" title="134">                <span class="op">}</span></a>
<a class="sourceLine" id="cb2-135" title="135">                <span class="va">xincludeParent</span>.<span class="at">removeChild</span>(xinclude)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-136" title="136">            <span class="op">}</span></a>
<a class="sourceLine" id="cb2-137" title="137">        <span class="op">}</span></a>
<a class="sourceLine" id="cb2-138" title="138">    <span class="op">}</span></a>
<a class="sourceLine" id="cb2-139" title="139">    <span class="cf">return</span> docu<span class="op">;</span></a>
<a class="sourceLine" id="cb2-140" title="140"><span class="op">}</span></a></code></pre></div>
