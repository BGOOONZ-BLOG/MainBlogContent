<!DOCTYPE html><html lang=en><head>
  <meta content="text/html; charset=utf-8" http-equiv=Content-Type>
  <title>Requirements for Powerful Features</title>
  <link href=default.css rel=stylesheet type=text/css>
  <link href=https://www.w3.org/StyleSheets/TR/W3C-WD rel=stylesheet type=text/css>
</head>
<body class=h-entry>
<div class=head>
  <p data-fill-with=logo><a class=logo href=http://www.w3.org/>
    <img alt=W3C height=48 src=https://www.w3.org/Icons/w3c_home width=72>
</a>
</p>
  <h1 class="p-name no-ref" id=title>Requirements for Powerful Features</h1>
  <h2 class="no-num no-toc no-ref heading settled" id=subtitle><span class=content>W3C First Public Working Draft,
    <span class=dt-updated><span class=value-title title=20141204>4 December 2014</span></span></span></h2>
  <div data-fill-with=spec-metadata><dl><dt>This version:<dd><a class=u-url href=http://www.w3.org/TR/2014/WD-POWER-1-20141204/>http://www.w3.org/TR/2014/WD-POWER-1-20141204/</a><dt>Latest version:<dd><a href=http://www.w3c.org/TR/powerful-features/>http://www.w3c.org/TR/powerful-features/</a><dt>Editor's Draft:<dd><a href=https://w3c.github.io/webappsec/specs/powerfulfeatures/>https://w3c.github.io/webappsec/specs/powerfulfeatures/</a><dt>Version History:<dd><a href=https://github.com/w3c/webappsec/commits/master/specs/powerfulfeatures/index.src.html>https://github.com/w3c/webappsec/commits/master/specs/powerfulfeatures/index.src.html</a><dt>Feedback:<dd><span><a href="mailto:public-webappsec@w3.org?subject=%5BPOWER%5D%20feedback">public-webappsec@w3.org</a> with subject line “<kbd>[POWER] <var>… message topic …</var></kbd>” (<a href=http://lists.w3.org/Archives/Public/public-webappsec/ rel=discussion>archives</a>)</span><dt class=editor>Editor:<dd class=editor><div class="p-author h-card vcard"><a class="p-name fn u-email email" href=mailto:mkwst@google.com>Mike West</a> (<span class="p-org org">Google Inc.</span>)</div></dl></div>
  <div data-fill-with=warning></div>
  <p class=copyright data-fill-with=copyright><a href=http://www.w3.org/Consortium/Legal/ipr-notice#Copyright>Copyright</a> © 2014
  <a href=http://www.w3.org/><abbr title="World Wide Web Consortium">W3C</abbr></a><sup>®</sup>
  (<a href=http://www.csail.mit.edu/><abbr title="Massachusetts Institute of Technology">MIT</abbr></a>,
  <a href=http://www.ercim.eu/><abbr title="European Research Consortium for Informatics and Mathematics">ERCIM</abbr></a>,
  <a href=http://www.keio.ac.jp/>Keio</a>, <a href=http://ev.buaa.edu.cn/>Beihang</a>),

  All Rights Reserved.

  <abbr title="World Wide Web Consortium">W3C</abbr> <a href=http://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer>liability</a>,
  <a href=http://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks>trademark</a> and

  <a href=http://www.w3.org/Consortium/Legal/copyright-documents>document use</a>
  rules apply.
</p>
  <hr title="Separator for header">
</div>

<h2 class="no-num no-toc no-ref heading settled" id=abstract><span class=content>Abstract</span></h2>
<div class=p-summary data-fill-with=abstract><p>This specification provides guidelines for user agent implementors and spec

authors for implementing features whose properties dictate that they only be
exposed to the web within a trustworthy environment.</p>

</div>

<h2 class="no-num no-toc no-ref heading settled" id=status><span class=content>Status of this document</span></h2>
<div data-fill-with=status><p>
  <em>This section describes the status of this document at the time of
  its publication. Other documents may supersede this document. A list of
  current W3C publications and the latest revision of this technical report
  can be found in the <a href=http://www.w3.org/TR/>W3C technical reports
  index at http://www.w3.org/TR/.</a></em>

<p>
  This document was published by the
  <a href=http://www.w3.org/2011/webappsec/>Web Application Security Working Group</a>
  as a Working Draft. This document is intended to become a W3C Recommendation. 

<p>
	The (<a href=http://lists.w3.org/Archives/Public/public-webappsec/>archived</a>) public mailing list
	<a href="mailto:public-webappsec@w3.org?Subject=%5BPOWER%5D%20PUT%20SUBJECT%20HERE">public-webappsec@w3.org</a>
	(see <a href=http://www.w3.org/Mail/Request>instructions</a>)
	is preferred for discussion of this specification.
	When sending e-mail,
	please put the text “POWER” in the subject,
	preferably like this:
	“[POWER] <em>…summary of comment…</em>”
  
<p>
  This document is a <strong>First Public Working Draft</strong>.

<p>
  Publication as a First Public Working Draft does not imply endorsement by the W3C
  Membership. This is a draft document and may be updated, replaced or
  obsoleted by other documents at any time. It is inappropriate to cite this
  document as other than work in progress.

<p>
	This document was produced by the
  <a href=http://www.w3.org/2011/webappsec/>Web Application Security Working Group</a>.

<p>
	This document was produced by a group operating under
	the <a href=http://www.w3.org/Consortium/Patent-Policy-20040205/>5 February 2004 W3C Patent Policy</a>.
	W3C maintains a <a href=http://www.w3.org/2004/01/pp-impl/49309/status rel=disclosure>public list of any patent disclosures</a>
	made in connection with the deliverables of the group;
	that page also includes instructions for disclosing a patent.
	An individual who has actual knowledge of a patent which the individual believes contains <a href=http://www.w3.org/Consortium/Patent-Policy-20040205/#def-essential>Essential Claim(s)</a>
	must disclose the information in accordance with <a href=http://www.w3.org/Consortium/Patent-Policy-20040205/#sec-Disclosure>section 6 of the W3C Patent Policy</a>.

<p>
  This document is governed by the <a href=http://www.w3.org/2014/Process-20140801/ id=w3c_process_revision>1 August 2014 W3C Process Document</a>.
</div>
<div data-fill-with=at-risk></div>

<h2 class="no-num no-toc no-ref heading settled" id=contents><span class=content>Table of Contents</span></h2>
<div data-fill-with=table-of-contents role=navigation><ul class=toc role=directory><li><a href=#intro><span class=secno>1</span> <span class=content>Introduction</span></a><li><a href=#terms><span class=secno>2</span> <span class=content>Key Concepts and Terminology</span></a><ul class=toc><li><a href=#terms-defined-here><span class=secno>2.1</span> <span class=content>Terms defined by this specification</span></a><li><a href=#terms-defined-by-reference><span class=secno>2.2</span> <span class=content>Terms defined by reference</span></a></ul><li><a href=#is-feature-powerful><span class=secno>3</span> <span class=content>
    Is <var>[insert feature here]</var> powerful?
  </span></a><ul class=toc><li><a href=#threat-models><span class=secno>3.1</span> <span class=content>Threat Models</span></a><ul class=toc><li><a href=#passive-network-attacker><span class=secno>3.1.1</span> <span class=content>Passive Network Attacker</span></a><li><a href=#active-network-attacker><span class=secno>3.1.2</span> <span class=content>Active Network Attacker</span></a></ul></ul><li><a href=#algorithms><span class=secno>4</span> <span class=content>Algorithms</span></a><ul class=toc><li><a href=#document-sufficiently-secure><span class=secno>4.1</span> <span class=content>
      Is <var>Document</var> a sufficiently secure context?
    </span></a><li><a href=#settings-sufficiently-secure><span class=secno>4.2</span> <span class=content>
      Is <var>settings object</var> a sufficiently secure context?
    </span></a><li><a href=#is-origin-trustworthy><span class=secno>4.3</span> <span class=content>
      Is <var>origin</var> potentially trustworthy?
    </span></a></ul><li><a href=#implementation-considerations><span class=secno>5</span> <span class=content>Implementation Considerations</span></a><ul class=toc><li><a href=#packaged-applications><span class=secno>5.1</span> <span class=content>Packaged Applications</span></a><li><a href=#development-environments><span class=secno>5.2</span> <span class=content>Development Environments</span></a></ul><li><a href=#acknowledgements><span class=secno>6</span> <span class=content>Acknowledgements</span></a><li><a href=#conformance><span class=secno></span> <span class=content>Conformance</span></a><ul class=toc><li><a href=#conventions><span class=secno></span> <span class=content>Document conventions</span></a><li><a href=#conformant-algorithms><span class=secno></span> <span class=content>Conformant Algorithms</span></a><li><a href=#conformance-classes><span class=secno></span> <span class=content>Conformance Classes</span></a></ul><li><a href=#references><span class=secno></span> <span class=content>References</span></a><ul class=toc><li><a href=#normative><span class=secno></span> <span class=content>Normative References</span></a><li><a href=#informative><span class=secno></span> <span class=content>Informative References</span></a></ul><li><a href=#index><span class=secno></span> <span class=content>Index</span></a><li><a href=#issues-index><span class=secno></span> <span class=content>Issues Index</span></a></ul></div>
<main>









<section>
  <h2 class="heading settled" data-level=1 id=intro><span class=secno>1. </span><span class=content>Introduction</span><a class=self-link href=#intro></a></h2>

<p><em>This section is not normative.</em></p>

<p>As the Web platform is extended to enable more useful and powerful
  applications, it becomes increasingly important to ensure that the features
  which enable those applications are enabled only in contexts which meet a minimum
  security bar. This document outlines threat models for feature abuse on the Web
  and outline normative requirements which should be incorporated into documents
  specifying new features.</p>

<p>The most obvious of the requirements discussed here is that application code
  with access to sensitive or private data be delivered over authenticated and
  confidential channels that guarantee data integrity. Delivering code securely
  cannot ensure that an application will always meet a user’s security and
  privacy requirments, but it is a necessary precondition.</p>
</section>


<section>
  <h2 class="heading settled" data-level=2 id=terms><span class=secno>2. </span><span class=content>Key Concepts and Terminology</span><a class=self-link href=#terms></a></h2>

  <h3 class="heading settled" data-level=2.1 id=terms-defined-here><span class=secno>2.1. </span><span class=content>Terms defined by this specification</span><a class=self-link href=#terms-defined-here></a></h3>
  <dl>
    <dt><dfn data-dfn-type=dfn data-export="" id=powerful-feature>powerful feature<a class=self-link href=#powerful-feature></a></dfn></dt>
    <dd>
      Defined in <a data-section="" href=#is-feature-powerful>§3 
    Is [insert feature here] powerful?
  </a>.
    </dd>

    <dt><dfn data-dfn-type=dfn data-export="" id=sufficiently-secure-context>
      sufficiently secure context
    <a class=self-link href=#sufficiently-secure-context></a></dfn></dt>
    <dd>
      A <code class=idl><a data-link-type=idl href=http://www.w3.org/TR/html5/dom.html#the-document-object title=Document>Document</a></code> is considered <strong>sufficiently secure</strong> if
      the algorithm defined in <a data-section="" href=#document-sufficiently-secure>§4.1 
      Is Document a sufficiently secure context?
    </a> returns
      <code>Sufficiently Secure</code> when executed upon it.

<p>Likewise, a <a data-link-type=dfn href=http://www.w3.org/TR/html5/webappapis.html#settings-object title="settings object">settings object</a> is considered <strong>sufficiently
      secure</strong> if the algorithm defined in
      <a data-section="" href=#settings-sufficiently-secure>§4.2 
      Is settings object a sufficiently secure context?
    </a> returns <code>Sufficiently
      Secure</code> when executed upon it.</p>
    </dd>

    <dt><dfn data-dfn-type=dfn data-noexport="" id=embedding-document>embedding document<a class=self-link href=#embedding-document></a></dfn></dt>
    <dd>
      Given a <code class=idl><a data-link-type=idl href=http://www.w3.org/TR/html5/dom.html#the-document-object title=Document>Document</a></code> <var>A</var>, the <strong>embedding
      document</strong> of <var>A</var> is the <code class=idl><a data-link-type=idl href=http://www.w3.org/TR/html5/dom.html#the-document-object title=Document>Document</a></code>
      <a data-link-type=dfn href=http://www.w3.org/TR/html5/browsers.html#browsing-context-nested-through title="nested through">through which</a> <var>A</var>’s <a data-link-type=dfn href=http://www.w3.org/TR/html5/browsers.html#browsing-context title="browsing context">browsing
      context</a> is nested.
    </dd>
  </dl>

  <h3 class="heading settled" data-level=2.2 id=terms-defined-by-reference><span class=secno>2.2. </span><span class=content>Terms defined by reference</span><a class=self-link href=#terms-defined-by-reference></a></h3>

<p>An <strong><a data-link-type=dfn href=https://tools.ietf.org/html/rfc6454#section-3.2 title=origin>origin</a></strong> defines the scope of authority or privilege
  under which a resource operates. It boils down to a tuple of scheme, host,
  and port. The concept is defined in detail in <a data-biblio-type=normative data-link-type=biblio href=#biblio-rfc6454 title=RFC6454>[RFC6454]</a>.</p>

<p>A <strong><a data-link-type=dfn href=http://www.w3.org/TR/mixed-content/#potentially-secure-origin title="potentially secure origin">potentially secure origin</a></strong> is an origin that isn’t
  insecure <i lang=la>a priori</i>, defined in detail in <a data-biblio-type=normative data-link-type=biblio href=#biblio-mix title=MIX>[MIX]</a>.</p>

<p>The <strong><a data-link-type=dfn href=https://fetch.spec.whatwg.org/#concept-response-tls-state title="TLS State">TLS State</a></strong> of a <strong><code class=idl><a data-link-type=idl href=https://fetch.spec.whatwg.org/#response-class title=Response>Response</a></code></strong> is
  defined in <a data-biblio-type=normative data-link-type=biblio href=#biblio-fetch title=FETCH>[FETCH]</a>.</p>

<p>The following terms are defined in <a data-biblio-type=normative data-link-type=biblio href=#biblio-html5 title=HTML5>[HTML5]</a>:</p>

  <ul>
    <li><strong><a data-link-type=dfn href=http://www.w3.org/TR/html5/embedded-content-0.html#an-iframe-srcdoc-document title="an iframe srcdoc document">an iframe srcdoc document</a></strong></li>
    <li><strong><a data-link-type=dfn href=http://www.w3.org/TR/html5/browsers.html#browsing-context title="browsing context">browsing context</a></strong></li>
    <li><strong><a data-link-type=dfn href=http://www.w3.org/TR/html5/browsers.html#browsing-context-container title="browsing context container">browsing context container</a></strong></li>
    <li><strong><code class=idl><a data-link-type=idl href=http://www.w3.org/TR/html5/dom.html#the-document-object title=Document>Document</a></code></strong></li>
    <li><strong><a data-link-type=dfn href=http://www.w3.org/TR/html5/webappapis.html#incumbent-settings-object title="incumbent settings object">incumbent settings object</a></strong></li>
    <li><strong><a data-link-type=dfn href=http://www.w3.org/TR/html5/browsers.html#browsing-context-nested-through title="nested through">nested through</a></strong></li>
    <li><strong><a data-link-type=dfn href=http://www.w3.org/TR/html5/browsers.html#sandboxed-origin-browsing-context-flag title="sandboxed origin browsing context flag">sandboxed origin browsing context flag</a></strong></li>
    <li><strong><a data-link-type=dfn href=http://www.w3.org/TR/html5/browsers.html#sandboxing-flag-set title="sandboxing flag set">sandboxing flag set</a></strong></li>
    <li><strong><a data-link-type=dfn href=http://www.w3.org/TR/html5/webappapis.html#settings-object title="settings object">settings object</a></strong></li>
    <li><strong><a data-link-type=dfn href=http://www.w3.org/TR/html5/browsers.html#top-level-browsing-context title="top-level browsing context">top-level browsing context</a></strong></li>
  </ul>
</section>

<section>
  <h2 class="heading settled" data-level=3 id=is-feature-powerful><span class=secno>3. </span><span class=content>
    Is <var>[insert feature here]</var> powerful?
  </span><a class=self-link href=#is-feature-powerful></a></h2>

<p>Certain web platform features that have a distinct impact on a user’s
  security or privacy should be available for use only in <a data-link-type=dfn href=#sufficiently-secure-context title="sufficiently secure contexts">sufficiently
  secure contexts</a>.</p>

<p>Broadly speaking, we consider a feature powerful enough to restrict when it
  fits into one or more of the following categories:</p>

  <ol>
    <li>
      The feature provides access to sensitive data (personally-identifying
      information, credentials, payment instruments, and so on).
      <a data-biblio-type=informative data-link-type=biblio href=#biblio-credential-management title=CREDENTIAL-MANAGEMENT>[CREDENTIAL-MANAGEMENT]</a> is an example of such an API.
    </li>
    <li>
      The feature provides access to sensor data on a user’s device (camera,
      microphone, and GPS being particularly noteworthy, but certainly including
      less obviously dangerous sensors like the accelerometer).
      <a data-biblio-type=informative data-link-type=biblio href=#biblio-geolocation-api title=GEOLOCATION-API>[GEOLOCATION-API]</a> and <a data-biblio-type=informative data-link-type=biblio href=#biblio-mediacapture-streams title=MEDIACAPTURE-STREAMS>[MEDIACAPTURE-STREAMS]</a> are historical examples.
    </li>
    <li>
      The feature provides access to or information about other devices a user
      has access to. <a data-biblio-type=informative data-link-type=biblio href=#biblio-discovery title=DISCOVERY>[DISCOVERY]</a> and <a data-biblio-type=informative data-link-type=biblio href=#biblio-bluetooth title=BLUETOOTH>[BLUETOOTH]</a> are good examples.
    </li>
    <li>
      The feature exposes temporary or persistent identifiers, including
      identifying hardware features the user can’t easily reset.
      <a data-biblio-type=informative data-link-type=biblio href=#biblio-encrypted-media title=ENCRYPTED-MEDIA>[ENCRYPTED-MEDIA]</a> for instance.
    </li>
    <li>
      The feature introduces some state for an origin which persists across
      browsing sessions. <a data-biblio-type=informative data-link-type=biblio href=#biblio-service-workers title=SERVICE-WORKERS>[SERVICE-WORKERS]</a> is a great example.
    </li>
    <li>
      The feature introduces some functionality for which user permission will
      be required.
    </li>
  </ol>

<p>This list is non-exhaustive, but should give you a feel for the types of
  features you should be concerned about.</p>

<p class=issue id=issue-afa6c332><a class=self-link href=#issue-afa6c332></a>We need to distinguish between legacy features like cookies,
  <code>localStorage</code>, IndexedDB, etc, which all persist state (and
  potentially identifiers) across browsing sessions. They’re certainly not
  features we can reasonably limit to secure contexts in the forseeable future.
  This might involve language along the lines of what mnot@ proposed in
  <a href=https://gist.github.com/mnot/38df717849b775eec3a4/550e9adc5791786ca1c8a0ade72712c466ef6978#adapting-existing-specifications>"Adapting
  Existing Specifications"</a>.</p>

<p class=note role=note>Note: While restricting the feature itself to <a data-link-type=dfn href=#sufficiently-secure-context title="sufficiently secure contexts">sufficiently secure
  contexts</a> is critical, we ought not forget that facilities that carry such
  information (such as new network access mechanisms, or other generic
  functions with access to network data) are equally sensitive.</p>

  <h3 class="heading settled" data-level=3.1 id=threat-models><span class=secno>3.1. </span><span class=content>Threat Models</span><a class=self-link href=#threat-models></a></h3>

<p>Granting permissions to unauthenticated origins is, in the presence of a
  network attacker, equivalent to granting the permissions to any origin. The
  state of the Internet is such that we must indeed assume that a network
  attacker is present. Generally, network attackers fall into 2 classes:
  passive and active.</p>

  <h4 class="heading settled" data-level=3.1.1 id=passive-network-attacker><span class=secno>3.1.1. </span><span class=content>Passive Network Attacker</span><a class=self-link href=#passive-network-attacker></a></h4>

<p>A "Passive Network Attacker" is a party who is able to observe traffic
  flows but who lacks the ability or chooses not to modify traffic at
  the layers which this specification is concerned with.</p>

<p>Surveillance of networks in this manner "subverts the intent of communicating
  parties without the agreement of these parties" and one "cannot defend against
  the most nefarious actors while allowing monitoring by other actors no matter
  how benevolent some might consider them to be." <a data-biblio-type=informative data-link-type=biblio href=#biblio-rfc7258 title=RFC7258>[RFC7258]</a> Therefore, the
  algorithms defined in this document require mechansims that provide for the
  privacy of data at the application layer, not simply integrity.</p>

  <h4 class="heading settled" data-level=3.1.2 id=active-network-attacker><span class=secno>3.1.2. </span><span class=content>Active Network Attacker</span><a class=self-link href=#active-network-attacker></a></h4>

<p>An "Active Network Attacker" has all the capabilities of a "Passive Network
  Attacker" and is additionally able to modify, block or replay any data
  transiting the network.  These capabilties are available to potential
  adversaries at many levels of capability, from compromised devices offering
  or simply participating in public wireless networks, to Internet Service
  Providers indirectly introducing security and privacy vulnerabilities while
  manipulating traffic for financial gain (<a data-biblio-type=informative data-link-type=biblio href=#biblio-verizon title=VERIZON>[VERIZON]</a> and <a data-biblio-type=informative data-link-type=biblio href=#biblio-comcast title=COMCAST>[COMCAST]</a> are
  recent examples), to parties with direct intent to compromise security or
  privacy who are able to target individual users, organizations or even
  entire populations.</p>
</section>

<section>
  <h2 class="heading settled" data-level=4 id=algorithms><span class=secno>4. </span><span class=content>Algorithms</span><a class=self-link href=#algorithms></a></h2>

  <section>
    <h3 class="heading settled" data-level=4.1 id=document-sufficiently-secure><span class=secno>4.1. </span><span class=content>
      Is <var>Document</var> a sufficiently secure context?
    </span><a class=self-link href=#document-sufficiently-secure></a></h3>

<p>Given a <code class=idl><a data-link-type=idl href=http://www.w3.org/TR/html5/dom.html#the-document-object title=Document>Document</a></code> <var>document</var>, this algorithm returns
    <code>Sufficiently Secure</code> if the <code class=idl><a data-link-type=idl href=http://www.w3.org/TR/html5/dom.html#the-document-object title=Document>Document</a></code> represents a
    <a data-link-type=dfn href=#sufficiently-secure-context title="sufficiently secure context">sufficiently secure context</a> or <code>Insecure</code> otherwise.</p>

    <ol>
      <li>
        While <var>document</var> corresponds to <a data-link-type=dfn href=http://www.w3.org/TR/html5/embedded-content-0.html#an-iframe-srcdoc-document title="an iframe srcdoc Document">an iframe srcdoc
        Document</a>, let <var>document</var> be that Document’s <a data-link-type=dfn href=http://www.w3.org/TR/html5/browsers.html#browsing-context title="browsing context">browsing
        context</a>’s <a data-link-type=dfn href=http://www.w3.org/TR/html5/browsers.html#browsing-context-container title="browsing context container">browsing context container</a>’s <code class=idl><a data-link-type=idl href=http://www.w3.org/TR/html5/dom.html#the-document-object title=Document>Document</a></code>.
      </li>
      <li>
        Let <var>origin</var> be the <a data-link-type=dfn href=https://tools.ietf.org/html/rfc6454#section-3.2 title=origin>origin</a> of <var>document</var>.
      </li>
      <li>
        If <var>document</var>’s active <a data-link-type=dfn href=http://www.w3.org/TR/html5/browsers.html#sandboxing-flag-set title="sandboxing flag set">sandboxing flag set</a> has its
        <a data-link-type=dfn href=http://www.w3.org/TR/html5/browsers.html#sandboxed-origin-browsing-context-flag title="sandboxed origin browsing context flag">sandboxed origin browsing context flag</a> set:

        <ol>
          <li>
            Set <var>origin</var> to the <a data-link-type=dfn href=https://tools.ietf.org/html/rfc6454#section-3.2 title=origin>origin</a> of
            <var>document</var>’s address.
          </li>
        </ol>
      </li>
      <li>
        Let <var>result</var> be the result of executing the
        <a data-section="" href=#settings-sufficiently-secure>§4.2 
      Is settings object a sufficiently secure context?
    </a> algorithm on <var>document</var>’s
        <a data-link-type=dfn href=http://www.w3.org/TR/html5/webappapis.html#incumbent-settings-object title="incumbent settings object">incumbent settings object</a>.
      </li>
      <li>
        If <var>result</var> is <code>Insecure</code>, return
        <code>Insecure</code>.
      </li>
      <li>
        Otherwise:

        <ol>
          <li>
            If <var>document</var> has an <a data-link-type=dfn href=#embedding-document title="embedding document">embedding document</a>, return the
            result of executing <a data-section="" href=#document-sufficiently-secure>§4.1 
      Is Document a sufficiently secure context?
    </a> on
            <var>document</var>’s <a data-link-type=dfn href=#embedding-document title="embedding document">embedding document</a> with the
            <var>ancestors flag</var> set to <code>true</code>.
          </li>
          <li>
            Otherwise, return <var>result</var>.
          </li>
        </ol>
      </li>
    </ol>

<p class=note role=note>Note: Sandboxed documents will have a unique origin. This algorithm uses the
    location of a sandboxed document to determine whether it should be considered
    authenticated. That is, the document inside
    <code>&lt;iframe src="https://example.com/" sandbox="allow-script"&gt;</code>
    would be considered to allow powerful features.</p>

<p class=issue id=issue-3be2330b><a class=self-link href=#issue-3be2330b></a>Need to consider how contexts created from blob: and data: are treated
    here, e.g. when used to create a Worker or SharedWorker.</p>
  </section>

  <section>
    <h3 class="heading settled" data-level=4.2 id=settings-sufficiently-secure><span class=secno>4.2. </span><span class=content>
      Is <var>settings object</var> a sufficiently secure context?
    </span><a class=self-link href=#settings-sufficiently-secure></a></h3>

<p>Given an <a data-link-type=dfn href=http://www.w3.org/TR/html5/webappapis.html#settings-object title="settings object">settings object</a> <var>settings</var>, this algorithm returns
    <code>Sufficiently Secure</code> if the object represents a <a data-link-type=dfn href=#sufficiently-secure-context title="sufficiently secure context">sufficiently
    secure context</a>, and <code>Insecure</code> otherwise.</p>

    <ol>
      <li>
        If <var>settings</var>' <a data-link-type=dfn href=https://fetch.spec.whatwg.org/#concept-response-tls-state title="TLS state">TLS state</a> is
        <code>authenticated</code>, return <code>Sufficiently Secure</code>.
      </li>
      <li>
        Otherwise:

        <ol>
          <li>
            Let <var>origin</var> be <var>settings</var>' <a data-link-type=dfn href=https://tools.ietf.org/html/rfc6454#section-3.2 title=origin>origin</a>.
          </li>
          <li>
            If the result of executing the <a data-section="" href=#is-origin-trustworthy>§4.3 
      Is origin potentially trustworthy?
    </a> algorithm
            on <var>origin</var> is <code>Potentially Trustworthy</code>, return
            <code>Sufficiently Secure</code>.
          </li>
        </ol>
      </li>
      <li>
        Return <code>Insecure</code>.
      </li>
    </ol>
  </section>

  <section>
    <h3 class="heading settled" data-level=4.3 id=is-origin-trustworthy><span class=secno>4.3. </span><span class=content>
      Is <var>origin</var> potentially trustworthy?
    </span><a class=self-link href=#is-origin-trustworthy></a></h3>

<p>Certain origins are always potentially trustworthy. In particular, UAs
    MUST treat <code>file</code> URLs and URLs with hostnames names equivalent
    to "localhost" as potentially trustworthy. In principle the UA could treat
    local files and local web servers as untrustworthy. However, <em>given the
    information that is available to the UA at runtime</em>, the resources
    appear to have been transported securely. Additionally, treating such
    resources as potentially trustworthy is convenient for developers building
    an application before deploying it to the public.</p>

<p>A user agent MAY choose to extend this trust to other, vendor-specific URL
    schemes like <code>app:</code> or <code>chrome-extension:</code>.</p>

<p>Given an <a data-link-type=dfn href=https://tools.ietf.org/html/rfc6454#section-3.2 title=origin>origin</a> <var>origin</var>, the following algorithm returns
    <code>Potentially Trustworthy</code> or <code>Not Trustworthy</code> as
    appropriate.</p>

    <ol>
      <li>
        If <var>origin</var> is a <a data-link-type=dfn href=http://www.w3.org/TR/mixed-content/#potentially-secure-origin title="potentially secure origin">potentially secure origin</a>,
        return <code>Potentially Trustworthy</code>.

<p class=note role=note>Note: The origin of <code>blob:</code> and <code>filesystem:</code> URLs
        is the origin of the context in which they were created. Therefore,
        blobs created in an potentially secure origin will themselves be
        potentially secure. The origin of <code>data:</code> and
        <code>javascript:</code> URLs is an opaque identifier, which will not
        be considered potentially secure.</p>
      </li>
      <li>
        If <var>origin</var>’s <code>host</code> component is or falls within
        <code>localhost.</code> <a data-biblio-type=normative data-link-type=biblio href=#biblio-rfc6761 title=RFC6761>[RFC6761]</a>, return <code>Potentially
        Trustworthy</code>.
      </li>
      <li>
        If <var>origin</var>’s <code>host</code> component matches one of
        the CIDR notations <code>127.0.0.0/8</code> or <code>::1/128</code>
        <a data-biblio-type=normative data-link-type=biblio href=#biblio-rfc4632 title=RFC4632>[RFC4632]</a>, return <code>Potentially Trustworthy</code>.
      </li>
      <li>
        If <var>origin</var>’s <code>scheme</code> component is
        <code>file</code>, return <code>Potentially Trustworthy</code>.
      </li>
      <li>
        If <var>origin</var>’s <code>scheme</code> component is one which
        the user agent considers to be authenticated, return
        <code>Potentially Trustworthy</code>.

<p class=note role=note>Note: See <a data-section="" href=#packaged-applications>§5.1 Packaged Applications</a> for detail here.</p>
      </li>
      <li>
        If <var>origin</var> has been configured as a trustworthy origin,
        return <code>Potentially Trustworthy</code>.

<p class=note role=note>Note: See <a data-section="" href=#development-environments>§5.2 Development Environments</a> for detail here.</p>
      </li>
      <li>
        Return <code>Not Trusted</code>.
      </li>
    </ol>
  </section>
</section>

<section>
  <h2 class="heading settled" data-level=5 id=implementation-considerations><span class=secno>5. </span><span class=content>Implementation Considerations</span><a class=self-link href=#implementation-considerations></a></h2>

  <h3 class="heading settled" data-level=5.1 id=packaged-applications><span class=secno>5.1. </span><span class=content>Packaged Applications</span><a class=self-link href=#packaged-applications></a></h3>

<p>User agents that support packaged applications MAY whitelist specific URL
  schemes whose contents are authenticated by the user agent. For example,
  FirefoxOS application resources are referred to by a URL whose
  <code>scheme</code> component is <code>app:</code>. Likewise, Chrome’s
  extensions and apps live on <code>chrome-extension:</code> schemes. These
  could reasonably be considered trusted origins.</p>

  <h3 class="heading settled" data-level=5.2 id=development-environments><span class=secno>5.2. </span><span class=content>Development Environments</span><a class=self-link href=#development-environments></a></h3>

<p>In order to support developers who run staging servers on non-loopback hosts,
  user agents MAY allow users to configure specific sets of origins as
  trustworthy, even though <a data-section="" href=#is-origin-trustworthy>§4.3 
      Is origin potentially trustworthy?
    </a> would normally return
  <code>Not Trusted</code>.</p>
</section>


<section>
  <h2 class="heading settled" data-level=6 id=acknowledgements><span class=secno>6. </span><span class=content>Acknowledgements</span><a class=self-link href=#acknowledgements></a></h2>

<p>This document is largely based on the Chrome Security team’s work on
  <a data-biblio-type=informative data-link-type=biblio href=#biblio-powerful-new-features title=POWERFUL-NEW-FEATURES>[POWERFUL-NEW-FEATURES]</a>. Chris Palmer, Ryan Sleevi, and David Dorwin have
  been particularly engaged. Anne van Kesteren and Henri Sivonen have also
  provided very helpful feedback.</p>
</section>

</main>
<h2 class="no-ref no-num heading settled" id=conformance><span class=content>Conformance</span><a class=self-link href=#conformance></a></h2>

<h3 class="no-ref no-num heading settled" id=conventions><span class=content>Document conventions</span><a class=self-link href=#conventions></a></h3>

    <p>Conformance requirements are expressed with a combination of
    descriptive assertions and RFC 2119 terminology. The key words "MUST",
    "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT",
    "RECOMMENDED", "MAY", and "OPTIONAL" in the normative parts of this
    document are to be interpreted as described in RFC 2119.
    However, for readability, these words do not appear in all uppercase
    letters in this specification.

    <p>All of the text of this specification is normative except sections
    explicitly marked as non-normative, examples, and notes. <a data-biblio-type=normative data-link-type=biblio href=#biblio-rfc2119 title=RFC2119>[RFC2119]</a></p>

    <p>Examples in this specification are introduced with the words "for example"
    or are set apart from the normative text with <code>class="example"</code>,
    like this:

    <div class=example>
        <p>This is an example of an informative example.</p>
    </div>

    <p>Informative notes begin with the word "Note" and are set apart from the
    normative text with <code>class="note"</code>, like this:

    <p class=note role=note>Note, this is an informative note.</p>

<h3 class="no-ref no-num heading settled" id=conformant-algorithms><span class=content>Conformant Algorithms</span><a class=self-link href=#conformant-algorithms></a></h3>

    <p>Requirements phrased in the imperative as part of algorithms (such as
    "strip any leading space characters" or "return false and abort these
    steps") are to be interpreted with the meaning of the key word ("must",
    "should", "may", etc) used in introducing the algorithm.</p>

    <p>Conformance requirements phrased as algorithms or specific steps can be
    implemented in any manner, so long as the end result is equivalent. In
    particular, the algorithms defined in this specification are intended to
    be easy to understand and are not intended to be performant. Implementers
    are encouraged to optimize.</p>

<h3 class="no-ref no-num heading settled" id=conformance-classes><span class=content>Conformance Classes</span><a class=self-link href=#conformance-classes></a></h3>

    <p>A <dfn data-dfn-type=dfn data-noexport="" id=conformant-user-agent>conformant user agent<a class=self-link href=#conformant-user-agent></a></dfn> must implement all the requirements
    listed in this specification that are applicable to user agents.</p>

    <p>A <dfn data-dfn-type=dfn data-noexport="" id=conformant-server>conformant server<a class=self-link href=#conformant-server></a></dfn> must implement all the requirements listed
    in this specification that are applicable to servers.</p>



<h2 class="no-num heading settled" id=references><span class=content>References</span><a class=self-link href=#references></a></h2><h3 class="no-num heading settled" id=normative><span class=content>Normative References</span><a class=self-link href=#normative></a></h3><dl><dt id=biblio-fetch title=FETCH><a class=self-link href=#biblio-fetch></a>[FETCH]<dd>Anne van Kesteren. <a href=https://fetch.spec.whatwg.org/>Fetch</a>. Living Standard. URL: <a href=https://fetch.spec.whatwg.org/>https://fetch.spec.whatwg.org/</a><dt id=biblio-mix title=MIX><a class=self-link href=#biblio-mix></a>[MIX]<dd>Mike West. <a href=https://w3c.github.io/webappsec/specs/mixedcontent/>Mixed Content</a>. ED. URL: <a href=https://w3c.github.io/webappsec/specs/mixedcontent/>https://w3c.github.io/webappsec/specs/mixedcontent/</a><dt id=biblio-rfc4632 title=RFC4632><a class=self-link href=#biblio-rfc4632></a>[RFC4632]<dd>Vince Fuller; Tony Li. <a href=http://www.ietf.org/rfc/rfc4632.txt>Classless Inter-domain Routing (CIDR): The Internet Address Assignment and Aggregation Plan</a>. RFC. URL: <a href=http://www.ietf.org/rfc/rfc4632.txt>http://www.ietf.org/rfc/rfc4632.txt</a><dt id=biblio-rfc6454 title=RFC6454><a class=self-link href=#biblio-rfc6454></a>[RFC6454]<dd>Adam Barth. <a href=http://www.ietf.org/rfc/rfc6454.txt>The Web Origin Concept</a>. RFC. URL: <a href=http://www.ietf.org/rfc/rfc6454.txt>http://www.ietf.org/rfc/rfc6454.txt</a><dt id=biblio-rfc6761 title=RFC6761><a class=self-link href=#biblio-rfc6761></a>[RFC6761]<dd>Stuart Cheshire; Marc Krochmal. <a href=http://www.ietf.org/rfc/rfc6761.txt>Special-Use Domain Names</a>. RFC. URL: <a href=http://www.ietf.org/rfc/rfc6761.txt>http://www.ietf.org/rfc/rfc6761.txt</a><dt id=biblio-html5 title=html5><a class=self-link href=#biblio-html5></a>[html5]<dd>Robin Berjon; et al. <a href=http://www.w3.org/TR/html5/>HTML5</a>. 28 October 2014. REC. URL: <a href=http://www.w3.org/TR/html5/>http://www.w3.org/TR/html5/</a><dt id=biblio-rfc2119 title=rfc2119><a class=self-link href=#biblio-rfc2119></a>[rfc2119]<dd>S. Bradner. <a href=http://www.ietf.org/rfc/rfc2119.txt>Key words for use in RFCs to Indicate Requirement Levels</a>. March 1997. Best Current Practice. URL: <a href=http://www.ietf.org/rfc/rfc2119.txt>http://www.ietf.org/rfc/rfc2119.txt</a></dl><h3 class="no-num heading settled" id=informative><span class=content>Informative References</span><a class=self-link href=#informative></a></h3><dl><dt id=biblio-bluetooth title=BLUETOOTH><a class=self-link href=#biblio-bluetooth></a>[BLUETOOTH]<dd>Jeffrey Yasskin; Vincent Scheib. <a href=https://webbluetoothcg.github.io/web-bluetooth/>Web Bluetooth</a>. URL: <a href=https://webbluetoothcg.github.io/web-bluetooth/>https://webbluetoothcg.github.io/web-bluetooth/</a><dt id=biblio-comcast title=COMCAST><a class=self-link href=#biblio-comcast></a>[COMCAST]<dd>David Kravets. <a href=http://arstechnica.com/tech-policy/2014/09/why-comcasts-javascript-ad-injections-threaten-security-net-neutrality/>Comcast Wi-Fi serving self-promotional ads via JavaScript injection</a>. URL: <a href=http://arstechnica.com/tech-policy/2014/09/why-comcasts-javascript-ad-injections-threaten-security-net-neutrality/>http://arstechnica.com/tech-policy/2014/09/why-comcasts-javascript-ad-injections-threaten-security-net-neutrality/</a><dt id=biblio-credential-management title=CREDENTIAL-MANAGEMENT><a class=self-link href=#biblio-credential-management></a>[CREDENTIAL-MANAGEMENT]<dd>Mike West. <a href=https://w3c.github.io/webappsec/specs/credentialmanagement/>Credential Management</a>. ED. URL: <a href=https://w3c.github.io/webappsec/specs/credentialmanagement/>https://w3c.github.io/webappsec/specs/credentialmanagement/</a><dt id=biblio-discovery title=DISCOVERY><a class=self-link href=#biblio-discovery></a>[DISCOVERY]<dd>Rich Tibbett. <a href=https://dvcs.w3.org/hg/dap/raw-file/tip/discovery-api/Overview.html>Network Service Discovery</a>. URL: <a href=https://dvcs.w3.org/hg/dap/raw-file/tip/discovery-api/Overview.html>https://dvcs.w3.org/hg/dap/raw-file/tip/discovery-api/Overview.html</a><dt id=biblio-powerful-new-features title=POWERFUL-NEW-FEATURES><a class=self-link href=#biblio-powerful-new-features></a>[POWERFUL-NEW-FEATURES]<dd>Chrome Security Team. <a href=https://www.chromium.org/Home/chromium-security/prefer-secure-origins-for-powerful-new-features>Prefer Secure Origins For Powerful New Features</a>. URL: <a href=https://www.chromium.org/Home/chromium-security/prefer-secure-origins-for-powerful-new-features>https://www.chromium.org/Home/chromium-security/prefer-secure-origins-for-powerful-new-features</a><dt id=biblio-rfc7258 title=RFC7258><a class=self-link href=#biblio-rfc7258></a>[RFC7258]<dd>Stephen Farrell; Hannes Tschofenig. <a href=http://www.ietf.org/rfc/rfc7258.txt>Pervasive Monitoring Is an Attack</a>. RFC. URL: <a href=http://www.ietf.org/rfc/rfc7258.txt>http://www.ietf.org/rfc/rfc7258.txt</a><dt id=biblio-verizon title=VERIZON><a class=self-link href=#biblio-verizon></a>[VERIZON]<dd>Mark Bergen; Alex Kantrowitz. <a href=http://adage.com/article/digital/verizon-target-mobile-subscribers-ads/293356/>Verizon looks to target its mobile subscribers with ads</a>. URL: <a href=http://adage.com/article/digital/verizon-target-mobile-subscribers-ads/293356/>http://adage.com/article/digital/verizon-target-mobile-subscribers-ads/293356/</a><dt id=biblio-encrypted-media title=encrypted-media><a class=self-link href=#biblio-encrypted-media></a>[encrypted-media]<dd>David Dorwin; et al. <a href=http://www.w3.org/TR/encrypted-media/>Encrypted Media Extensions</a>. 28 August 2014. WD. URL: <a href=http://www.w3.org/TR/encrypted-media/>http://www.w3.org/TR/encrypted-media/</a><dt id=biblio-geolocation-api title=geolocation-API><a class=self-link href=#biblio-geolocation-api></a>[geolocation-API]<dd>Andrei Popescu. <a href=http://www.w3.org/TR/geolocation-API/>Geolocation API Specification</a>. 24 October 2013. REC. URL: <a href=http://www.w3.org/TR/geolocation-API/>http://www.w3.org/TR/geolocation-API/</a><dt id=biblio-mediacapture-streams title=mediacapture-streams><a class=self-link href=#biblio-mediacapture-streams></a>[mediacapture-streams]<dd>Daniel Burnett; et al. <a href=http://www.w3.org/TR/mediacapture-streams/>Media Capture and Streams</a>. 3 September 2013. WD. URL: <a href=http://www.w3.org/TR/mediacapture-streams/>http://www.w3.org/TR/mediacapture-streams/</a><dt id=biblio-service-workers title=service-workers><a class=self-link href=#biblio-service-workers></a>[service-workers]<dd>Alex Russell; Jungkee Song. <a href=http://www.w3.org/TR/service-workers/>Service Workers</a>. 8 May 2014. WD. URL: <a href=http://www.w3.org/TR/service-workers/>http://www.w3.org/TR/service-workers/</a></dl><h2 class="no-num heading settled" id=index><span class=content>Index</span><a class=self-link href=#index></a></h2><ul class=indexlist><li>conformant server, <a href=#conformant-server title="section Unnumbered section">Unnumbered section</a><li>conformant user agent, <a href=#conformant-user-agent title="section Unnumbered section">Unnumbered section</a><li>embedding document, <a href=#embedding-document title="section 2.1">2.1</a><li>powerful feature, <a href=#powerful-feature title="section 2.1">2.1</a><li>sufficiently secure context, <a href=#sufficiently-secure-context title="section 2.1">2.1</a></ul><h2 class="no-num heading settled" id=issues-index><span class=content>Issues Index</span><a class=self-link href=#issues-index></a></h2><div style=counter-reset:issue><div class=issue>We need to distinguish between legacy features like cookies,
  <code>localStorage</code>, IndexedDB, etc, which all persist state (and
  potentially identifiers) across browsing sessions. They’re certainly not
  features we can reasonably limit to secure contexts in the forseeable future.
  This might involve language along the lines of what mnot@ proposed in
  <a href=https://gist.github.com/mnot/38df717849b775eec3a4/550e9adc5791786ca1c8a0ade72712c466ef6978#adapting-existing-specifications>"Adapting
  Existing Specifications"</a>.<a href=#issue-afa6c332> ↵ </a></div><div class=issue>Need to consider how contexts created from blob: and data: are treated
    here, e.g. when used to create a Worker or SharedWorker.<a href=#issue-3be2330b> ↵ </a></div></div>