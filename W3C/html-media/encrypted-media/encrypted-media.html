<!DOCTYPE html>
<html lang="en" dir="ltr" typeof="bibo:Document " about="" property="dcterms:language" content="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Encrypted Media Extensions</title>
    
    
    
    <!-- script to register bugs -->
    <script src="https://dvcs.w3.org/hg/webcomponents/raw-file/tip/assets/scripts/bug-assist.js"></script>
    <meta name="bug.product" content="HTML WG">
    <meta name="bug.component" content="Encrypted Media Extensions">

    <style>/* --- EXAMPLES --- */
div.example-title {
    min-width: 7.5em;
    color: #b9ab2d;
}
div.example-title span {
    text-transform: uppercase;   
}
aside.example, div.example, div.illegal-example {
    padding: 0.5em;
    margin: 1em 0;
    position: relative;
    clear: both;
}
div.illegal-example { color: red }
div.illegal-example p { color: black }
aside.example, div.example {
    padding: .5em;
    border-left-width: .5em;
    border-left-style: solid;
    border-color: #e0cb52;
    background: #fcfaee;    
}

aside.example div.example {
    border-left-width: .1em;
    border-color: #999;
    background: #fff;
}
aside.example div.example div.example-title {
    color: #999;
}
</style><style>/* --- ISSUES/NOTES --- */
div.issue-title, div.note-title {
    padding-right:  1em;
    min-width: 7.5em;
    color: #b9ab2d;
}
div.issue-title { color: #e05252; }
div.note-title { color: #2b2; }
div.issue-title span, div.note-title span {
    text-transform: uppercase;
}
div.note, div.issue {
    margin-top: 1em;
    margin-bottom: 1em;
}
.note > p:first-child, .issue > p:first-child { margin-top: 0 }
.issue, .note {
    padding: .5em;
    border-left-width: .5em;
    border-left-style: solid;
}
div.issue, div.note {
    padding: 1em 1.2em 0.5em;
    margin: 1em 0;
    position: relative;
    clear: both;
}
span.note, span.issue { padding: .1em .5em .15em; }

.issue {
    border-color: #e05252;
    background: #fbe9e9;
}
.note {
    border-color: #52e052;
    background: #e9fbe9;
}


</style><style>/* HIGHLIGHTS */
code.prettyprint {
    color:  inherit;
}

/* this from google-code-prettify */
.pln{color:#000}@media screen{.str{color:#080}.kwd{color:#008}.com{color:#800}.typ{color:#606}.lit{color:#066}.pun,.opn,.clo{color:#660}.tag{color:#008}.atn{color:#606}.atv{color:#080}.dec,.var{color:#606}.fun{color:red}}@media print,projection{.str{color:#060}.kwd{color:#006;font-weight:bold}.com{color:#600;font-style:italic}.typ{color:#404;font-weight:bold}.lit{color:#044}.pun,.opn,.clo{color:#440}.tag{color:#006;font-weight:bold}.atn{color:#404}.atv{color:#060}}ol.linenums{margin-top:0;margin-bottom:0}li.L0,li.L1,li.L2,li.L3,li.L5,li.L6,li.L7,li.L8{list-style-type:none}li.L1,li.L3,li.L5,li.L7,li.L9{background:#eee}
</style><style>/* --- WEB IDL --- */
pre.idl {
    border-top: 1px solid #90b8de;
    border-bottom: 1px solid #90b8de;
    padding:    1em;
    line-height:    120%;
}

pre.idl::before {
    content:    "WebIDL";
    display:    block;
    width:      150px;
    background: #90b8de;
    color:  #fff;
    font-family:    initial;
    padding:    3px;
    font-weight:    bold;
    margin: -1em 0 1em -1em;
}

.idlType {
    color:  #ff4500;
    font-weight:    bold;
    text-decoration:    none;
}

/*.idlModule*/
/*.idlModuleID*/
/*.idlInterface*/
.idlInterfaceID, .idlDictionaryID, .idlCallbackID, .idlEnumID {
    font-weight:    bold;
    color:  #005a9c;
}
a.idlEnumItem {
    color:  #000;
    border-bottom:  1px dotted #ccc;
    text-decoration: none;
}

.idlSuperclass {
    font-style: italic;
    color:  #005a9c;
}

/*.idlAttribute*/
.idlAttrType, .idlFieldType, .idlMemberType {
    color:  #005a9c;
}
.idlAttrName, .idlFieldName, .idlMemberName {
    color:  #ff4500;
}
.idlAttrName a, .idlFieldName a, .idlMemberName a {
    color:  #ff4500;
    border-bottom:  1px dotted #ff4500;
    text-decoration: none;
}

/*.idlMethod*/
.idlMethType, .idlCallbackType {
    color:  #005a9c;
}
.idlMethName {
    color:  #ff4500;
}
.idlMethName a {
    color:  #ff4500;
    border-bottom:  1px dotted #ff4500;
    text-decoration: none;
}

/*.idlCtor*/
.idlCtorName {
    color:  #ff4500;
}
.idlCtorName a {
    color:  #ff4500;
    border-bottom:  1px dotted #ff4500;
    text-decoration: none;
}

/*.idlParam*/
.idlParamType {
    color:  #005a9c;
}
.idlParamName, .idlDefaultValue {
    font-style: italic;
}

.extAttr {
    color:  #666;
}

/*.idlSectionComment*/
.idlSectionComment {
    color: gray;
}

/*.idlConst*/
.idlConstType {
    color:  #005a9c;
}
.idlConstName {
    color:  #ff4500;
}
.idlConstName a {
    color:  #ff4500;
    border-bottom:  1px dotted #ff4500;
    text-decoration: none;
}

/*.idlException*/
.idlExceptionID {
    font-weight:    bold;
    color:  #c00;
}

.idlTypedefID, .idlTypedefType {
    color:  #005a9c;
}

.idlRaises, .idlRaises a.idlType, .idlRaises a.idlType code, .excName a, .excName a code {
    color:  #c00;
    font-weight:    normal;
}

.excName a {
    font-family:    monospace;
}

.idlRaises a.idlType, .excName a.idlType {
    border-bottom:  1px dotted #c00;
}

.excGetSetTrue, .excGetSetFalse, .prmNullTrue, .prmNullFalse, .prmOptTrue, .prmOptFalse {
    width:  45px;
    text-align: center;
}
.excGetSetTrue, .prmNullTrue, .prmOptTrue { color:  #0c0; }
.excGetSetFalse, .prmNullFalse, .prmOptFalse { color:  #c00; }

.idlImplements a {
    font-weight:    bold;
}

dl.attributes, dl.methods, dl.constants, dl.constructors, dl.fields, dl.dictionary-members {
    margin-left:    2em;
}

.attributes dt, .methods dt, .constants dt, .constructors dt, .fields dt, .dictionary-members dt {
    font-weight:    normal;
}

.attributes dt code, .methods dt code, .constants dt code, .constructors dt code, .fields dt code, .dictionary-members dt code {
    font-weight:    bold;
    color:  #000;
    font-family:    monospace;
}

.attributes dt code, .fields dt code, .dictionary-members dt code {
    background:  #ffffd2;
}

.attributes dt .idlAttrType code, .fields dt .idlFieldType code, .dictionary-members dt .idlMemberType code {
    color:  #005a9c;
    background:  transparent;
    font-family:    inherit;
    font-weight:    normal;
    font-style: italic;
}

.methods dt code {
    background:  #d9e6f8;
}

.constants dt code {
    background:  #ddffd2;
}

.constructors dt code {
    background:  #cfc;
}

.attributes dd, .methods dd, .constants dd, .constructors dd, .fields dd, .dictionary-members dd {
    margin-bottom:  1em;
}

table.parameters, table.exceptions {
    border-spacing: 0;
    border-collapse:    collapse;
    margin: 0.5em 0;
    width:  100%;
}
table.parameters { border-bottom:  1px solid #90b8de; }
table.exceptions { border-bottom:  1px solid #deb890; }

.parameters th, .exceptions th {
    color:  #fff;
    padding:    3px 5px;
    text-align: left;
    font-family:    initial;
    font-weight:    normal;
    text-shadow:    #666 1px 1px 0;
}
.parameters th { background: #90b8de; }
.exceptions th { background: #deb890; }

.parameters td, .exceptions td {
    padding:    3px 10px;
    border-top: 1px solid #ddd;
    vertical-align: top;
}

.parameters tr:first-child td, .exceptions tr:first-child td {
    border-top: none;
}

.parameters td.prmName, .exceptions td.excName, .exceptions td.excCodeName {
    width:  100px;
}

.parameters td.prmType {
    width:  120px;
}

table.exceptions table {
    border-spacing: 0;
    border-collapse:    collapse;
    width:  100%;
}
</style><link rel="stylesheet" href="eme.css">
  <style>/*****************************************************************
 * ReSpec 3 CSS
 * Robin Berjon - http://berjon.com/
 *****************************************************************/

/* --- INLINES --- */
em.rfc2119 { 
    text-transform:     lowercase;
    font-variant:       small-caps;
    font-style:         normal;
    color:              #900;
}

h1 acronym, h2 acronym, h3 acronym, h4 acronym, h5 acronym, h6 acronym, a acronym,
h1 abbr, h2 abbr, h3 abbr, h4 abbr, h5 abbr, h6 abbr, a abbr {
    border: none;
}

dfn {
    font-weight:    bold;
}

a.internalDFN {
    color:  inherit;
    border-bottom:  1px solid #99c;
    text-decoration:    none;
}

a.externalDFN {
    color:  inherit;
    border-bottom:  1px dotted #ccc;
    text-decoration:    none;
}

a.bibref {
    text-decoration:    none;
}

cite .bibref {
    font-style: normal;
}

code {
    color:  #C83500;
}

/* --- TOC --- */
.toc a, .tof a {
    text-decoration:    none;
}

a .secno, a .figno {
    color:  #000;
}

ul.tof, ol.tof {
    list-style: none outside none;
}

.caption {
    margin-top: 0.5em;
    font-style:   italic;
}

/* --- TABLE --- */
table.simple {
    border-spacing: 0;
    border-collapse:    collapse;
    border-bottom:  3px solid #005a9c;
}

.simple th {
    background: #005a9c;
    color:  #fff;
    padding:    3px 5px;
    text-align: left;
}

.simple th[scope="row"] {
    background: inherit;
    color:  inherit;
    border-top: 1px solid #ddd;
}

.simple td {
    padding:    3px 10px;
    border-top: 1px solid #ddd;
}

.simple tr:nth-child(even) {
    background: #f0f6ff;
}

/* --- DL --- */
.section dd > p:first-child {
    margin-top: 0;
}

.section dd > p:last-child {
    margin-bottom: 0;
}

.section dd {
    margin-bottom:  1em;
}

.section dl.attrs dd, .section dl.eldef dd {
    margin-bottom:  0;
}

@media print {
    .removeOnSave {
        display: none;
    }
}
</style><link rel="stylesheet" href="https://www.w3.org/StyleSheets/TR/W3C-ED"><!--[if lt IE 9]><script src='https://www.w3.org/2008/site/js/html5shiv.js'></script><![endif]--></head>
  <body class="h-entry" role="document" id="respecDocument"><div class="head" role="contentinfo" id="respecHeader">
  <p>
      
        
            <a href="http://www.w3.org/"><img width="72" height="48" src="https://www.w3.org/Icons/w3c_home" alt="W3C"></a>
        
      
  </p>
  <h1 class="title p-name" id="title" property="dcterms:title">Encrypted Media Extensions</h1>
  
  <h2 property="dcterms:issued" datatype="xsd:dateTime" content="2014-10-31T00:45:30.000Z" id="w3c-editor-s-draft-30-october-2014"><abbr title="World Wide Web Consortium">W3C</abbr> Editor's Draft <time class="dt-published" datetime="2014-10-30">30 October 2014</time></h2>
  <dl>
    
      <dt>This version:</dt>
      <dd><a class="u-url" href="http://dvcs.w3.org/hg/html-media/raw-file/default/encrypted-media/encrypted-media.html">http://dvcs.w3.org/hg/html-media/raw-file/default/encrypted-media/encrypted-media.html</a></dd>
      <dt>Latest published version:</dt>
      <dd><a href="http://www.w3.org/TR/encrypted-media/">http://www.w3.org/TR/encrypted-media/</a></dd>
    
    
      <dt>Latest editor's draft:</dt>
      <dd><a href="http://dvcs.w3.org/hg/html-media/raw-file/default/encrypted-media/encrypted-media.html">http://dvcs.w3.org/hg/html-media/raw-file/default/encrypted-media/encrypted-media.html</a></dd>
    
    
    
    
    
      
    
    
    
    <dt>Editors:</dt>
    <dd class="p-author h-card vcard" rel="bibo:editor" inlist=""><span typeof="foaf:Person"><span property="foaf:name" class="p-name fn">David Dorwin</span>, <a rel="foaf:workplaceHomepage" class="p-org org h-org h-card" href="http://www.google.com/">Google Inc.</a></span>
</dd>
<dd class="p-author h-card vcard" rel="bibo:editor" inlist=""><span typeof="foaf:Person"><span property="foaf:name" class="p-name fn">Jerry Smith</span>, <a rel="foaf:workplaceHomepage" class="p-org org h-org h-card" href="http://www.microsoft.com/">Microsoft Corporation</a></span>
</dd>
<dd class="p-author h-card vcard" rel="bibo:editor" inlist=""><span typeof="foaf:Person"><span property="foaf:name" class="p-name fn">Mark Watson</span>, <a rel="foaf:workplaceHomepage" class="p-org org h-org h-card" href="http://www.netflix.com/">Netflix Inc.</a></span>
</dd>
<dd class="p-author h-card vcard" rel="bibo:editor" inlist=""><span typeof="foaf:Person"><span property="foaf:name" class="p-name fn">Adrian Bateman (until May 2014)</span>, <a rel="foaf:workplaceHomepage" class="p-org org h-org h-card" href="http://www.microsoft.com/">Microsoft Corporation</a></span>
</dd>

    
    
  </dl>
  
  
  
  
    
      <p class="copyright">
        <a href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> ©
        2014
        
        <a href="http://www.w3.org/"><abbr title="World Wide Web Consortium">W3C</abbr></a><sup>®</sup>
        (<a href="http://www.csail.mit.edu/"><abbr title="Massachusetts Institute of Technology">MIT</abbr></a>,
        <a href="http://www.ercim.eu/"><abbr title="European Research Consortium for Informatics and Mathematics">ERCIM</abbr></a>,
        <a href="http://www.keio.ac.jp/">Keio</a>, <a href="http://ev.buaa.edu.cn/">Beihang</a>), 
        
        All Rights Reserved.
        
        <abbr title="World Wide Web Consortium">W3C</abbr> <a href="http://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>,
        <a href="http://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a> and
        
          <a href="http://www.w3.org/Consortium/Legal/copyright-documents">document use</a>
        
        rules apply.
      </p>
    
  
  <hr>
</div>

    <section id="abstract" class="introductory" property="dcterms:abstract" datatype="" typeof="bibo:Chapter" resource="#abstract" rel="bibo:Chapter"><h2 role="heading" id="h2_abstract">Abstract</h2>
      <p>This proposal extends <code><a href="http://www.w3.org/TR/html5/embedded-content-0.html#htmlmediaelement">HTMLMediaElement</a></code> [<cite><a class="bibref" href="#bib-HTML5">HTML5</a></cite>] providing APIs to control playback of protected content.</p>
      <p>The API supports use cases ranging from simple clear key decryption to high value video (given an appropriate user agent implementation).
      License/key exchange is controlled by the application, facilitating the development of robust playback applications supporting a range of content decryption and protection technologies.</p>
      <p>This specification does not define a content protection or Digital Rights Management system. Rather, it defines a common API that may be used to discover, select and interact with
      such systems as well as with simpler content encryption systems. Implementation of Digital Rights Management is not required for compliance with this specification: only the
      Clear Key system is required to be implemented as a common baseline.</p>
      <p>The common API supports a simple set of content encryption capabilities, leaving application functions such as authentication and authorization to page authors. This is achieved by
      requiring content protection system-specific messaging to be mediated by the page rather than assuming out-of-band communication between the encryption system and a license
      or other server.</p>
    </section><section id="sotd" class="introductory" typeof="bibo:Chapter" resource="#sotd" rel="bibo:Chapter"><h2 role="heading" id="h2_sotd">Status of This Document</h2>
  
    
      
        <p>
          <em>This section describes the status of this document at the time of its publication.
          Other documents may supersede this document. A list of current <abbr title="World Wide Web Consortium">W3C</abbr> publications and the
          latest revision of this technical report can be found in the <a href="http://www.w3.org/TR/"><abbr title="World Wide Web Consortium">W3C</abbr> technical reports index</a> at
          http://www.w3.org/TR/.</em>
        </p>
        
      <p>The working groups maintains <a href="http://w3.org/brief/MjY5">a list of all bug reports that the editors have not yet tried to address</a>. This draft highlights some of the pending issues that are still to be discussed in the working group. No decision has been taken on the outcome of these issues including whether they are valid.</p>
      <p>Implementors should be aware that this specification is not stable. <strong>Implementors who are not taking part in the discussions are likely to find the specification changing out from under them in incompatible ways.</strong> Vendors interested in implementing this specification before it eventually reaches the Candidate Recommendation stage should join the mailing list mentioned below and take part in the discussions.</p>

      <div class="issue"><div class="issue-title" aria-level="1" role="heading" id="h_issue_1"><span>Issue 1</span></div><p class=""><a href="https://www.w3.org/Bugs/Public/show_bug.cgi?id=20944">Bug 20944</a> - The specification should do more to encourage/ensure CDM-level interoperability.</p></div>
      <div class="issue"><div class="issue-title" aria-level="1" role="heading" id="h_issue_2"><span>Issue 2</span></div><p class="">This specification contains sections for describing <a href="#security">security</a> and <a href="#privacy">privacy</a> considerations. These sections are not final and review is welcome.</p></div>

<!-- This will be populated when addressing https://www.w3.org/Bugs/Public/show_bug.cgi?id=23827.
      <p>The following features are <strong>at risk</strong> and may be removed due to lack of implementation.
      </p>
      <ul>
        <li><a def-id=""></a></li>
      </ul>
 -->
    
        <p>
          This document was published by the <a href="http://www.w3.org/html/wg/">HTML Working Group</a> as an Editor's Draft.
          
          
            If you wish to make comments regarding this document, please send them to 
            <a href="mailto:public-html-media@w3.org">public-html-media@w3.org</a> 
            (<a href="mailto:public-html-media-request@w3.org?subject=subscribe">subscribe</a>,
            <a href="http://lists.w3.org/Archives/Public/public-html-media/">archives</a>).
          
          
          
          
            All comments are welcome.
          
        </p>
        
        
          <p>
            Publication as an Editor's Draft does not imply endorsement by the <abbr title="World Wide Web Consortium">W3C</abbr>
            Membership. This is a draft document and may be updated, replaced or obsoleted by other
            documents at any time. It is inappropriate to cite this document as other than work in
            progress.
          </p>
        
        
        
        <p>
          
            This document was produced by a group operating under the 
            <a id="sotd_patent" about="" rel="w3p:patentRules" href="http://www.w3.org/Consortium/Patent-Policy-20040205/">5 February 2004 <abbr title="World Wide Web Consortium">W3C</abbr> Patent
            Policy</a>.
          
          
          
            
              <abbr title="World Wide Web Consortium">W3C</abbr> maintains a <a href="http://www.w3.org/2004/01/pp-impl/40318/status" rel="disclosure">public list of any patent
              disclosures</a> 
            
            made in connection with the deliverables of the group; that page also includes
            instructions for disclosing a patent. An individual who has actual knowledge of a patent
            which the individual believes contains
            <a href="http://www.w3.org/Consortium/Patent-Policy-20040205/#def-essential">Essential
            Claim(s)</a> must disclose the information in accordance with
            <a href="http://www.w3.org/Consortium/Patent-Policy-20040205/#sec-Disclosure">section
            6 of the <abbr title="World Wide Web Consortium">W3C</abbr> Patent Policy</a>.
          
          
        </p>
        
          <p>This document is governed by the <a id="w3c_process_revision" href="http://www.w3.org/2014/Process-20140801/">1 August 2014 <abbr title="World Wide Web Consortium">W3C</abbr> Process Document</a>.
          </p>
        
        
      
    
  
</section><section id="toc"><h2 class="introductory" role="heading" id="h2_toc">Table of Contents</h2><ul class="toc" role="directory" id="respecContents"><li class="tocline"><a href="#introduction" class="tocxref"><span class="secno">1. </span>Introduction</a><ul class="toc"><li class="tocline"><a href="#definitions" class="tocxref"><span class="secno">1.1 </span>Definitions</a></li></ul></li><li class="tocline"><a href="#obtaining-access-to-key-systems" class="tocxref"><span class="secno">2. </span>Obtaining Access to Key Systems</a><ul class="toc"><li class="tocline"><a href="#requestmediakeysystemaccess" class="tocxref"><span class="secno">2.1 </span>requestMediaKeySystemAccess()</a><ul class="toc"><li class="tocline"><a href="#methods" class="tocxref"><span class="secno">2.1.1 </span>Methods</a></li></ul></li><li class="tocline"><a href="#mediakeysystemoptions-dictionary" class="tocxref"><span class="secno">2.2 </span><span class="formerLink"><code>MediaKeySystemOptions</code></span> dictionary</a><ul class="toc"><li class="tocline"><a href="#dictionary-mediakeysystemoptions-members" class="tocxref"><span class="secno">2.2.1 </span>Dictionary <span class="formerLink"><code>MediaKeySystemOptions</code></span> Members</a></li></ul></li></ul></li><li class="tocline"><a href="#mediakeysystemaccess-interface" class="tocxref"><span class="secno">3. </span><span class="formerLink"><code>MediaKeySystemAccess</code></span> Interface</a><ul class="toc"><li class="tocline"><a href="#attributes" class="tocxref"><span class="secno">3.1 </span>Attributes</a></li><li class="tocline"><a href="#methods-1" class="tocxref"><span class="secno">3.2 </span>Methods</a></li></ul></li><li class="tocline"><a href="#mediakeys-interface" class="tocxref"><span class="secno">4. </span><span class="formerLink"><code>MediaKeys</code></span> Interface</a><ul class="toc"><li class="tocline"><a href="#methods-2" class="tocxref"><span class="secno">4.1 </span>Methods</a></li></ul></li><li class="tocline"><a href="#mediakeysession-interface" class="tocxref"><span class="secno">5. </span><span class="formerLink"><code>MediaKeySession</code></span> Interface</a><ul class="toc"><li class="tocline"><a href="#attributes-1" class="tocxref"><span class="secno">5.1 </span>Attributes</a></li><li class="tocline"><a href="#methods-3" class="tocxref"><span class="secno">5.2 </span>Methods</a></li><li class="tocline"><a href="#mediakeymessageevent" class="tocxref"><span class="secno">5.3 </span><span class="formerLink"><code>MediaKeyMessageEvent</code></span></a><ul class="toc"><li class="tocline"><a href="#constructors" class="tocxref"><span class="secno">5.3.1 </span>Constructors</a></li><li class="tocline"><a href="#attributes-2" class="tocxref"><span class="secno">5.3.2 </span>Attributes</a></li><li class="tocline"><a href="#mediakeymessageeventinit" class="tocxref"><span class="secno">5.3.3 </span><span class="formerLink"><code>MediaKeyMessageEventInit</code></span></a><ul class="toc"><li class="tocline"><a href="#dictionary-mediakeymessageeventinit-members" class="tocxref"><span class="secno">5.3.3.1 </span>Dictionary <span class="formerLink"><code>MediaKeyMessageEventInit</code></span> Members</a></li></ul></li></ul></li><li class="tocline"><a href="#mediakeysession-events" class="tocxref"><span class="secno">5.4 </span>Event Summary</a></li><li class="tocline"><a href="#mediakeysession-algorithms" class="tocxref"><span class="secno">5.5 </span>Algorithms</a><ul class="toc"><li class="tocline"><a href="#algorithms-queue-message" class="tocxref"><span class="secno">5.5.1 </span>Queue a "message" Event</a></li><li class="tocline"><a href="#algorithms-keys-changed" class="tocxref"><span class="secno">5.5.2 </span>Usable Keys Changed</a></li><li class="tocline"><a href="#algorithms-update-expiration" class="tocxref"><span class="secno">5.5.3 </span>Update Expiration</a></li><li class="tocline"><a href="#algorithms-session-close" class="tocxref"><span class="secno">5.5.4 </span>Session Close</a></li></ul></li><li class="tocline"><a href="#exceptions" class="tocxref"><span class="secno">5.6 </span>Exceptions</a></li><li class="tocline"><a href="#session-storage" class="tocxref"><span class="secno">5.7 </span>Session Storage and Persistence</a></li></ul></li><li class="tocline"><a href="#htmlmediaelement-extensions" class="tocxref"><span class="secno">6. </span><span class="formerLink"><code>HTMLMediaElement</code></span> Extensions</a><ul class="toc"><li class="tocline"><a href="#attributes-3" class="tocxref"><span class="secno">6.1 </span>Attributes</a></li><li class="tocline"><a href="#methods-4" class="tocxref"><span class="secno">6.2 </span>Methods</a></li><li class="tocline"><a href="#mediaencryptedevent" class="tocxref"><span class="secno">6.3 </span><span class="formerLink"><code>MediaEncryptedEvent</code></span></a><ul class="toc"><li class="tocline"><a href="#constructors-1" class="tocxref"><span class="secno">6.3.1 </span>Constructors</a></li><li class="tocline"><a href="#attributes-4" class="tocxref"><span class="secno">6.3.2 </span>Attributes</a></li><li class="tocline"><a href="#mediaencryptedeventinit" class="tocxref"><span class="secno">6.3.3 </span><span class="formerLink"><code>MediaEncryptedEventInit</code></span></a><ul class="toc"><li class="tocline"><a href="#dictionary-mediaencryptedeventinit-members" class="tocxref"><span class="secno">6.3.3.1 </span>Dictionary <span class="formerLink"><code>MediaEncryptedEventInit</code></span> Members</a></li></ul></li></ul></li><li class="tocline"><a href="#htmlmediaelement-events" class="tocxref"><span class="secno">6.4 </span>Event Summary</a></li><li class="tocline"><a href="#htmlmediaelement-algorithms" class="tocxref"><span class="secno">6.5 </span>Algorithms</a><ul class="toc"><li class="tocline"><a href="#algorithms-initdata-encountered" class="tocxref"><span class="secno">6.5.1 </span>Initialization Data Encountered</a></li><li class="tocline"><a href="#algorithms-encrypted-block" class="tocxref"><span class="secno">6.5.2 </span>Encrypted Block Encountered</a></li><li class="tocline"><a href="#algorithms-queue-waiting" class="tocxref"><span class="secno">6.5.3 </span>Queue a "waiting" Event</a></li><li class="tocline"><a href="#algorithms-resume-playback" class="tocxref"><span class="secno">6.5.4 </span>Attempt to Resume Playback If Necessary</a></li><li class="tocline"><a href="#htmlmediaelement-playing-the-media-resource" class="tocxref"><span class="secno">6.5.5 </span>Playing the Media Resource Algorithm Modifications</a></li></ul></li><li class="tocline"><a href="#media-element-restictions" class="tocxref"><span class="secno">6.6 </span>Media Element Restrictions</a></li></ul></li><li class="tocline"><a href="#common-key-systems" class="tocxref"><span class="secno">7. </span>Common Key Systems</a><ul class="toc"><li class="tocline"><a href="#clear-key" class="tocxref"><span class="secno">7.1 </span>Clear Key</a><ul class="toc"><li class="tocline"><a href="#clear-key-capabilities" class="tocxref"><span class="secno">7.1.1 </span>Capabilities</a></li><li class="tocline"><a href="#clear-key-behavior" class="tocxref"><span class="secno">7.1.2 </span>Behavior</a></li><li class="tocline"><a href="#clear-key-request-format" class="tocxref"><span class="secno">7.1.3 </span>License Request Format</a><ul class="toc"><li class="tocline"><a href="#clear-key-request-format-example" class="tocxref"><span class="secno">7.1.3.1 </span>Example</a></li></ul></li><li class="tocline"><a href="#clear-key-license-format" class="tocxref"><span class="secno">7.1.4 </span>License Format</a><ul class="toc"><li class="tocline"><a href="#clear-key-license-format-example" class="tocxref"><span class="secno">7.1.4.1 </span>Example</a></li></ul></li><li class="tocline"><a href="#using-base64url" class="tocxref"><span class="secno">7.1.5 </span>Using base64url</a></li></ul></li></ul></li><li class="tocline"><a href="#security" class="tocxref"><span class="secno">8. </span>Security Considerations</a></li><li class="tocline"><a href="#privacy" class="tocxref"><span class="secno">9. </span>Privacy Considerations</a><ul class="toc"><li class="tocline"><a href="#privacy-disclosure" class="tocxref"><span class="secno">9.1 </span>Information Disclosed by EME and Key Systems</a></li><li class="tocline"><a href="#privacy-fingerprinting" class="tocxref"><span class="secno">9.2 </span>Fingerprinting</a></li><li class="tocline"><a href="#privacy-leakage" class="tocxref"><span class="secno">9.3 </span>Information Leakage</a></li><li class="tocline"><a href="#privacy-tracking" class="tocxref"><span class="secno">9.4 </span>Tracking</a><ul class="toc"><li class="tocline"><a href="#privacy-individualization" class="tocxref"><span class="secno">9.4.1 </span>Individualization</a></li></ul></li><li class="tocline"><a href="#privacy-storedinfo" class="tocxref"><span class="secno">9.5 </span>Information Stored on User Devices</a></li><li class="tocline"><a href="#privacy-secureorigin" class="tocxref"><span class="secno">9.6 </span>Use Secure Origin and Transport</a></li></ul></li><li class="tocline"><a href="#examples" class="tocxref"><span class="secno">10. </span>Examples</a><ul class="toc"><li class="tocline"><a href="#example-source-and-key-known" class="tocxref"><span class="secno">10.1 </span>Source and Key Known at Page Load (Clear Key)</a></li><li class="tocline"><a href="#example-selecting-key-system" class="tocxref"><span class="secno">10.2 </span>Selecting a Supported Key System and Using Initialization Data from the "encrypted" Event</a></li><li class="tocline"><a href="#example-mediakeys-before-source" class="tocxref"><span class="secno">10.3 </span>Create MediaKeys Before Loading Media</a></li><li class="tocline"><a href="#example-using-all-events" class="tocxref"><span class="secno">10.4 </span>Using All Events</a></li><li class="tocline"><a href="#example-stored-license" class="tocxref"><span class="secno">10.5 </span>Stored License</a></li></ul></li><li class="tocline"><a href="#revision-history" class="tocxref"><span class="secno">11. </span>Revision History</a></li><li class="tocline"><a href="#references" class="tocxref"><span class="secno">A. </span>References</a><ul class="toc"><li class="tocline"><a href="#normative-references" class="tocxref"><span class="secno">A.1 </span>Normative references</a></li><li class="tocline"><a href="#informative-references" class="tocxref"><span class="secno">A.2 </span>Informative references</a></li></ul></li></ul></section>
 
 
    


    <section id="introduction" class="informative" typeof="bibo:Chapter" resource="#introduction" rel="bibo:Chapter">
      <!--OddPage--><h2 role="heading" id="h2_introduction"><span class="secno">1. </span>Introduction</h2><p><em>This section is non-normative.</em></p>
      <p>
        This proposal allows JavaScript to select content protection mechanisms, control license/key exchange, and implement custom license management algorithms.
        It supports a wide range of use cases without requiring client-side modifications in each user agent for each use case.
        This also enables content providers to develop a single application solution for all devices.
        A generic stack implemented using the proposed APIs is shown below.
        This diagram shows an example flow: other combinations of API calls and events are possible.
      </p>
      <img src="stack_overview.svg" alt="A generic stack implemented using the proposed APIs" height="700">
  
      <section id="definitions" typeof="bibo:Chapter" resource="#definitions" rel="bibo:Chapter">
        <h3 role="heading" id="h3_definitions"><span class="secno">1.1 </span>Definitions</h3>
    
        <dl>
          <dt id="cdm">Content Decryption Module (CDM)</dt>
          <dd>
            <p>Content Decryption Module (CDM) is a generic term for the client component that provides the functionality, including decryption, for one or more <a href="#key-system">Key Systems</a>.</p>
            <div class="note"><div class="note-title" aria-level="2" role="heading" id="h_note_1"><span>Note</span></div><p class="">Implementations may or may not separate the implementations of CDMs or treat them as separate from the user agent.
            This is transparent to the API and application.</p></div>

            <p>All messages and communication to and from the CDM, such as between the CDM and a license server, <em class="rfc2119" title="MUST">MUST</em> be passed through the user agent.
              The CDM <em class="rfc2119" title="MUST NOT">MUST NOT</em> make direct out-of band network requests.
              All messages and communication other than those covered in the following paragraph <em class="rfc2119" title="MUST">MUST</em> be passed through the application via the APIs defined in this specification.
              Specifically, all communication that contains application-, origin-, or content-specific information or is sent to a URL specified by the application or based on its origin, <em class="rfc2119" title="MUST">MUST</em> pass through the APIs.
              This includes all license exchange messages.              
            </p>
            <p>Application- and origin-independent messages related to per-client initialization (or reinitialization) that are sent to a fixed non-application-dependent URL <em class="rfc2119" title="MUST">MUST</em> be handled by the user agent and <em class="rfc2119" title="MUST NOT">MUST NOT</em> be passed to the application via the APIs.
              The related message exchange and operations <em class="rfc2119" title="MUST">MUST</em> be performed by the user agent via the user agent's network stack.
            </p>
            <div class="note"><div class="note-title" aria-level="2" role="heading" id="h_note_2"><span>Note</span></div><p class="">For example, an initialization, provisioning, or individualization process for a client device that involves communicating with a server hosted by the user agent or CDM vendor and does not contain application- or origin-specific information <em class="rfc2119" title="MUST">MUST</em> be performed by the user agent without involving the application.
              The same applies to reinitialization, reprovisioning, or reindividualization.
            </p></div>
            <p>For implementations that support per-origin initialization, such messages <em class="rfc2119" title="MUST">MUST</em> be passed to the application via the APIs.
              Such messages <em class="rfc2119" title="MUST NOT">MUST NOT</em> contain non-origin-specific per-client information, such as unique client identifiers.
              As with all other uses of the APIs, responses passed to the CDM <em class="rfc2119" title="MUST NOT">MUST NOT</em> contain executable code.
            </p>
            <div class="note"><div class="note-title" aria-level="2" role="heading" id="h_note_3"><span>Note</span></div><p class="">To preserve the privacy properties of per-origin initialization, applications and key system servers should not defer initialization to a non-origin-specific server.
              See <a href="#privacy-individualization">Individualization</a>.
            </p></div>
          </dd>
    
          <dt id="key-system">Key System</dt>
          <dd>
            <p>A Key System is a generic term for a decryption mechanism and/or content protection provider.
            Key System strings provide unique identification of a Key System.
            They are used by the user agent to select a <a href="#cdm">CDM</a> and identify the source of a key-related event.
            User agents <em class="rfc2119" title="MUST">MUST</em> support the <a href="#common-key-systems">Common Key Systems</a>.
            User agents <em class="rfc2119" title="MAY">MAY</em> also provide additional CDMs with corresponding Key System strings.
            </p>
        
            <p>A Key System string is always a reverse domain name.
            Key System strings are compared using case-sensitive matching. It is <em class="rfc2119" title="RECOMMENDED">RECOMMENDED</em> that CDMs use simple lower-case ASCII key system strings.</p>
            <div class="note"><div class="note-title" aria-level="2" role="heading" id="h_note_4"><span>Note</span></div><p class="">For example, "com.example.somesystem".</p></div>
        
            <div class="note"><div class="note-title" aria-level="2" role="heading" id="h_note_5"><span>Note</span></div><p class="">
            Within a given system ("somesystem" in the example), subsystems may be defined as determined by the key system provider.
            For example, "com.example.somesystem.1" and "com.example.somesystem.1_5".
            Key System providers should keep in mind that these will be used for comparison and discovery, so they should be easy to compare and the structure should remain reasonably simple.
            </p></div>
          </dd>
    
          <dt id="key-session">Key Session</dt>
          <dd>
            <p>A Key Session, or simply Session, provides a context for message exchange with the CDM as a result of which key(s) are made available to the <a href="#cdm">CDM</a>.
            Sessions are embodied as <code><a href="#idl-def-MediaKeySession">MediaKeySession</a></code> objects.
            Each Key session is associated with a single instance of <a href="#initialization-data">Initialization Data</a> provided in the <code><a href="#widl-MediaKeySession-generateRequest-Promise-void--DOMString-initDataType-BufferSource-initData">generateRequest()</a></code> call.
            </p>
            <p>Each Key Session is associated with a single <code><a href="#idl-def-MediaKeys">MediaKeys</a></code> object, and only media element(s) associated with that object may access key(s) associated with the session.
            Other <code><a href="#idl-def-MediaKeys">MediaKeys</a></code> objects, <a href="#cdm">CDM</a> instances, and media elements <em class="rfc2119" title="MUST NOT">MUST NOT</em> access the key session or use its key(s).
            Key sessions and the keys they contain are no longer usable by the CDM for decryption when the <a href="#algorithms-session-close">session is closed</a>, including when the <code><a href="#idl-def-MediaKeySession">MediaKeySession</a></code> object is destroyed.
            </p>
          </dd>
    
          <dt id="session-id">Session ID</dt>
          <dd>
            <p>A Session ID is a unique string identifier generated by the <a href="#cdm">CDM</a> that can be used by the application to identify <code><a href="#idl-def-MediaKeySession">MediaKeySession</a></code> objects.</p>
        
            <p>A new Session ID is generated each time the user agent and CDM successfully create a new session.</p>
        
            <p>Each Session ID <em class="rfc2119" title="SHALL">SHALL</em> be unique within the browsing context in which it was created.
              Session IDs for <code><a href="#idl-def-SessionType.persistent">"persistent"</a></code> sessions <em class="rfc2119" title="MUST">MUST</em> be unique within the <a href="http://www.w3.org/TR/html5/browsers.html#origin-0">origin</a> over time, including across browsing sessions.
            </p>
        
            <div class="note"><div class="note-title" aria-level="2" role="heading" id="h_note_6"><span>Note</span></div><p class="">The underlying content protection protocol does not necessarily need to support Session IDs.</p></div>
          </dd>
    
          <dt id="decryption-key">Key</dt>
          <dd>
            <p>Unless otherwise stated, key refers to a decryption key that can be used to decrypt blocks within <a href="http://www.w3.org/TR/html5/embedded-content-0.html#media-data">media data</a>.
            Each such key is uniquely identified by a <a href="#decryption-key-id">key ID</a>.
            A key is associated with the <a href="#key-session">session</a> used to provide it to the CDM. (The same key may be present in multiple sessions.)
            Such keys <em class="rfc2119" title="MUST">MUST</em> only be provided to the <a href="#cdm">CDM</a> via an <code><a href="#widl-MediaKeySession-update-Promise-void--BufferSource-response">update()</a></code> call. (They may later be loaded by <code><a href="#widl-MediaKeySession-load-Promise-boolean--DOMString-sessionId">load()</a></code> as part of the stored session data.)
            </p>
            
            <p>A key is considered <em>usable</em> if the CDM is certain the key is currently usable for decryption.</p>
            <div class="note"><div class="note-title" aria-level="2" role="heading" id="h_note_7"><span>Note</span></div><p class="">For example, a key is not usable if its license has expired.</p></div>
          </dd>
    
          <dt id="decryption-key-id">Key ID</dt>
          <dd>
            <p>A <a href="#decryption-key">key</a> is associated with a key ID, which uniquely identifies a key.
            The container specifies the ID of the key that can decrypt a block or set of blocks within the <a href="http://www.w3.org/TR/html5/embedded-content-0.html#media-data">media data</a>.
            <a href="#initialization-data">Initialization Data</a> <em class="rfc2119" title="MAY">MAY</em> contain key ID(s) to identify the keys that are needed to decrypt the media data.
            However, there is no requirement that Initialization Data contain any or all key IDs used in the <a href="http://www.w3.org/TR/html5/embedded-content-0.html#media-data">media data</a> or <a href="http://www.w3.org/TR/html5/embedded-content-0.html#media-resource">media resource</a>.
            <a href="#license">Licenses</a> provided to the CDM associate each key with a key ID so the <a href="#cdm">CDM</a> can select the appropriate key when decrypting an encrypted block of media data.
            </p>
          </dd>
    
          <dt id="license">License</dt>
          <dd>
            <p>A license is key system-specific state information that includes one or more <a href="#decryption-key">key(s)</a> - each associated with a <a href="#decryption-key-id">key ID</a> - and potentially other information about key usage.</p>
          </dd>
    
          <dt id="initialization-data">Initialization Data</dt>
          <dd>
            <div class="note"><div class="note-title" aria-level="2" role="heading" id="h_note_8"><span>Note</span></div><p class="">
            <a href="#key-system">Key Systems</a> usually require a block of initialization data containing information about the stream to be decrypted before they can construct a license request message.
            This block could be a simple key or content ID or a more complex structure containing such information.
            It should always allow unique identification of the key(s) needed to decrypt the content.
            This initialization information <em class="rfc2119" title="MAY">MAY</em> be obtained in some application-specific way or provided with the <a href="http://www.w3.org/TR/html5/embedded-content-0.html#media-data">media data</a>.
            </p></div>
        
            <p>
            Initialization Data is a generic term for container-specific data that is used by a <a href="#cdm">CDM</a> to generate a license request.
            Initialization data found with the <a href="http://www.w3.org/TR/html5/embedded-content-0.html#media-data">media data</a> is provided to the application in the <code><a href="#widl-MediaEncryptedEventInit-initData">initData</a></code> attribute of the <code><a href="#dom-evt-encrypted">encrypted</a></code> event.
            </p>
        
            <p>
            The format of the initialization data depends upon the type of container, and containers <em class="rfc2119" title="MAY">MAY</em> support more than one format
            of initialization data. The <dfn id="initialization-data-type">Initialization Data Type</dfn> is a string that indicates what
            format the initialization data is provided in. Initialization Data Type strings are always matched case-sensitively. It is
            <em class="rfc2119" title="RECOMMENDED">RECOMMENDED</em> that Initialization Data Type strings are lower-case ASCII strings.
            </p>
        
            <p>
            The Encrypted Media Extensions Stream Format and Initialization Data Format Registry [<cite><a class="bibref" href="#bib-EME-REGISTRY">EME-REGISTRY</a></cite>]
            provides the mapping from initialization data type string to the specification for each format.
            </p>

            <p>Initialization Data <em class="rfc2119" title="MUST">MUST</em> be a fixed value for a given set of stream(s) or <a href="http://www.w3.org/TR/html5/embedded-content-0.html#media-data">media data</a>.
              It <em class="rfc2119" title="MUST">MUST</em> only contain information related to the keys required to play a given set of stream(s) or <a href="http://www.w3.org/TR/html5/embedded-content-0.html#media-data">media data</a>.
              It <em class="rfc2119" title="MUST NOT">MUST NOT</em> contain application data, client-specific data, user-specific data, <a href="#decryption-key">key(s)</a>, or executable code.
            </p>
            
            <p>Initialization Data <em class="rfc2119" title="SHOULD NOT">SHOULD NOT</em> contain Key System-specific data or values.
              Implementations <em class="rfc2119" title="MUST">MUST</em> support the common formats defined [<cite><a class="bibref" href="#bib-EME-REGISTRY">EME-REGISTRY</a></cite>] for each <a href="#initialization-data-type">Initialization Data Type</a> they support.
            </p>
            <div class="note"><div class="note-title" aria-level="2" role="heading" id="h_note_9"><span>Note</span></div><p class="">
              Use of proprietary formats/contents is discouraged, and supporting or using <em>only</em> proprietary formats is strongly discouraged.
              Proprietary formats should only be used with pre-existing content or on pre-existing devices that do not support the common formats.
            </p></div>            
          </dd>
    
          <dt id="cross-origin">Cross Origin Limitations</dt>
          <dd>
            <p>During playback, embedded media data is exposed to script in the embedding <a href="http://www.w3.org/TR/html5/browsers.html#origin-0">origin</a>.
            In order for the API to provide <a href="#initialization-data">Initialization Data</a> in the <code><a href="#dom-evt-encrypted">encrypted</a></code> event, <a href="http://www.w3.org/TR/html5/embedded-content-0.html#media-data">media data</a> <em class="rfc2119" title="MUST">MUST</em> be <a href="http://www.w3.org/TR/html5/infrastructure.html#cors-same-origin">CORS-same-origin</a> with the embedding page.
            If <a href="http://www.w3.org/TR/html5/embedded-content-0.html#media-data">media data</a> is cross-origin with the embedding document, authors <em class="rfc2119" title="SHOULD">SHOULD</em> use the <code><a href="http://www.w3.org/TR/html5/embedded-content-0.html#attr-media-crossorigin">crossorigin</a></code> attribute
            on the <code><a href="http://www.w3.org/TR/html5/embedded-content-0.html#htmlmediaelement">HTMLMediaElement</a></code> and CORS headers on the <a href="http://www.w3.org/TR/html5/embedded-content-0.html#media-data">media data</a> response to make it <a href="http://www.w3.org/TR/html5/infrastructure.html#cors-same-origin">CORS-same-origin</a>.
            </p>
          </dd>
    
          <dt id="mixed-content">Mixed Content Limitations</dt>
          <dd>
            <p>During playback, embedded media data is exposed to script in the embedding <a href="http://www.w3.org/TR/html5/browsers.html#origin-0">origin</a>.
            In order for the API to provide <a href="#initialization-data">Initialization Data</a> in the <code><a href="#dom-evt-encrypted">encrypted</a></code> event, <a href="http://www.w3.org/TR/html5/embedded-content-0.html#media-data">media data</a> <em class="rfc2119" title="MUST NOT">MUST NOT</em> be Mixed Content [<cite><a class="bibref" href="#bib-MIXED-CONTENT">MIXED-CONTENT</a></cite>].
            </p>
          </dd>
        </dl>
      </section>
    </section>


    <section id="obtaining-access-to-key-systems">
      <!--OddPage--><h2 role="heading" id="h2_obtaining-access-to-key-systems"><span class="secno">2. </span>Obtaining Access to Key Systems</h2>

      <section typeof="bibo:Chapter" resource="#requestMediaKeySystemAccess" rel="bibo:Chapter" id="requestmediakeysystemaccess">
        <h3 id="requestMediaKeySystemAccess" role="heading"><span class="secno">2.1 </span>requestMediaKeySystemAccess()</h3>

        <pre class="idl"><span class="idlInterface" id="idl-def-Navigator">partial interface <span class="idlInterfaceID">Navigator</span> {
<span class="idlMethod">    <span class="idlMethType">Promise&lt;<a href="#idl-def-MediaKeySystemAccess" class="idlType"><code>MediaKeySystemAccess</code></a>&gt;</span> <span class="idlMethName"><a href="#widl-Navigator-requestMediaKeySystemAccess-Promise-MediaKeySystemAccess--DOMString-keySystem-sequence-MediaKeySystemOptions--supportedConfigurations">requestMediaKeySystemAccess</a></span> (<span class="idlParam"><span class="idlParamType">DOMString</span> <span class="idlParamName">keySystem</span></span>, <span class="idlParam">optional <span class="idlParamType">sequence&lt;<a href="#idl-def-MediaKeySystemOptions" class="idlType"><code>MediaKeySystemOptions</code></a>&gt;</span> <span class="idlParamName">supportedConfigurations</span></span>);</span>
};</span></pre><section id="methods"><h4 role="heading" id="h4_methods"><span class="secno">2.1.1 </span>Methods</h4><dl class="methods"><dt id="widl-Navigator-requestMediaKeySystemAccess-Promise-MediaKeySystemAccess--DOMString-keySystem-sequence-MediaKeySystemOptions--supportedConfigurations"><code>requestMediaKeySystemAccess</code></dt><dd>
            <p>Requests access to the specified <a href="#key-system">Key System</a>.
              When <code>supportedConfigurations</code> is specified, the combination specified by at least one of its elements must be supported.
              The resulting <a href="#idl-def-MediaKeySystemAccess" class="idlType"><code>MediaKeySystemAccess</code></a> will correspond to the first such elment.
            </p>
            <p>Any permission checks or user interaction, such as a prompt, <em class="rfc2119" title="SHOULD">SHOULD</em> be performed before resolving the promise.</p>
            <p>If the <code>keySystem</code> is not supported or not allowed (in one at least one of the <code>supportedConfigurations</code>, if specified), the promise is rejected.
              Otherwise, it is resolved with a new MediaKeySystemAccess object.
            </p>

            

            
          <table class="parameters"><tbody><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">keySystem</td><td class="prmType"><code>DOMString</code></td><td class="prmNullFalse"><span role="img" aria-label="False">✘</span></td><td class="prmOptFalse"><span role="img" aria-label="False">✘</span></td><td class="prmDesc">
                The <a href="#key-system">Key System</a> for which access is being requested.
              </td></tr><tr><td class="prmName">supportedConfigurations</td><td class="prmType"><code>sequence&lt;<a href="#idl-def-MediaKeySystemOptions" class="idlType"><code>MediaKeySystemOptions</code></a>&gt;</code></td><td class="prmNullFalse"><span role="img" aria-label="False">✘</span></td><td class="prmOptTrue"><span role="img" aria-label="True">✔</span></td><td class="prmDesc">
                A sequence of <a href="#idl-def-MediaKeySystemOptions" class="idlType"><code>MediaKeySystemOptions</code></a> configurations to try in order.
                The first element with a satisfiable combination will be used. 
              </td></tr></tbody></table><div><em>Return type: </em><code>Promise&lt;<a href="#idl-def-MediaKeySystemAccess" class="idlType"><code>MediaKeySystemAccess</code></a>&gt;</code></div><p>When this method is invoked, the user agent must run the following steps:</p><ol class="method-algorithm">
              <li><p>If <var title="true">keySystem</var> is an empty string, return a promise rejected with a new <code><a href="http://heycam.github.io/webidl/#dfn-DOMException">DOMException</a></code> whose name is <code><a href="#dfn-InvalidAccessError">InvalidAccessError</a></code>.</p></li>
              <li><p>If <var title="true">supportedConfigurations</var> was provided and is empty, return a promise rejected with a new <code><a href="http://heycam.github.io/webidl/#dfn-DOMException">DOMException</a></code> whose name is <code><a href="#dfn-InvalidAccessError">InvalidAccessError</a></code>.</p></li>
              <li><p>If the <a href="http://www.w3.org/TR/html5/browsers.html#origin-0">origin</a> of the calling context's <a href="http://dom.spec.whatwg.org/#concept-document">Document</a> is not an <a href="http://www.w3.org/TR/mixed-content/#authenticated-origin">authenticated origin</a> [<cite><a class="bibref" href="#bib-MIXED-CONTENT">MIXED-CONTENT</a></cite>]:
                </p><ul style="list-style-type:none">
                  <li>
                    <div class="issue"><div class="issue-title" aria-level="3" role="heading" id="h_issue_3"><span>Issue 3</span></div><p class="">
                      <a href="https://www.w3.org/Bugs/Public/show_bug.cgi?id=26332">Bug 26332</a> - The availability of this API on unauthenticated origins is an open issue. It has been proposed
                      that such access not be allowed at all or be allowed only in specific circumstances. It is likely that there will be scenarios where access from an unauthenticated origin
                      is not allowed. It is also an open issue whether and how the impact of serving audio/video media over secure transport can be mitigated.
                    </p></div>
                  </li>
                </ul>
              <p></p>

              </li>
              <li><p>If <var title="true">keySystem</var> is not one of the <a href="#key-system">Key Systems</a> supported by the user agent, return a promise rejected with a new <code><a href="http://heycam.github.io/webidl/#dfn-DOMException">DOMException</a></code> whose name is <code><a href="#dfn-NotSupportedError">NotSupportedError</a></code>. String comparison is case-sensitive.</p></li>
              <li><p>Let <var>promise</var> be a new promise.</p></li>
              <li><p>Run the following steps asynchronously:</p>
                <ol>
                  <li><p>If <var title="true">keySystem</var> is not supported or not allowed in the <a href="http://www.w3.org/TR/html5/browsers.html#origin-0">origin</a> of the calling context's <a href="http://dom.spec.whatwg.org/#concept-document">Document</a>, return a promise rejected with a new <code><a href="http://heycam.github.io/webidl/#dfn-DOMException">DOMException</a></code> whose name is <code><a href="#dfn-NotSupportedError">NotSupportedError</a></code>.</p>
                    <div class="issue"><div class="issue-title" aria-level="3" role="heading" id="h_issue_4"><span>Issue 4</span></div><p class=""><a href="https://www.w3.org/Bugs/Public/show_bug.cgi?id=25923">Bug 25923</a> - It is TBD whether rejecting the promise is the correct behavior or whether the promise should instead be resolved with <code>null</code>.</p></div>
                  </li>
                  <li><p>If <code>supportedConfigurations</code> was not provided, resolve the promise with a new <a href="#idl-def-MediaKeySystemAccess" class="idlType"><code>MediaKeySystemAccess</code></a> object, execute the following steps:</p>
                    <ol>
                      <li>
                        <p>Let <var title="true">access</var> be a new <a href="#idl-def-MediaKeySystemAccess" class="idlType"><code>MediaKeySystemAccess</code></a> object, and initialize it as follows:</p>
                        <ol>
                          <li><p>Set the <code><a href="#widl-MediaKeySystemAccess-keySystem">keySystem</a></code> attribute to <var title="true">keySystem</var>.</p></li>
                        </ol>
                      </li>
                      <li><p>Resolve <var>promise</var> with <var title="true">access</var> and abort these steps.</p></li>
                    </ol>
                  </li>
                  <li>
                    <p>For each element of <code>supportedConfigurations</code>:</p>
                    <ol>
                      <li><p>Let <var>combination</var> be the element.</p></li>
                      <li>
                        <p>For each dictionary member in <var>combination</var>:</p>
                        <ol>
                          <li><p>If the member’s value cannot be satisfied together in combination with the previous members, continue to the next iteration of the loop.</p></li>
                        </ol>
                        <div class="note"><div class="note-title" aria-level="3" role="heading" id="h_note_10"><span>Note</span></div><p class="">Unrecognized dictionary members are ignored per [<cite><a class="bibref" href="#bib-WebIDL">WebIDL</a></cite>], and will never reach this algorithm. Thus, they cannot be considered as part of the combination.</p></div>
                        </li><li>
                          <p>If <var title="true">keySystem</var> is supported and allowed in the <a href="http://www.w3.org/TR/html5/browsers.html#origin-0">origin</a> of the calling context's <a href="http://dom.spec.whatwg.org/#concept-document">Document</a> in the configuration specified by the combination of the values in <var>combination</var>, execute the following steps:</p>
                          <ol>
                            <li>
                              <p>Let <var title="true">access</var> be a new <a href="#idl-def-MediaKeySystemAccess" class="idlType"><code>MediaKeySystemAccess</code></a> object, and initialize it as follows:</p>
                              <ol>
                                <li><p>Set the <code><a href="#widl-MediaKeySystemAccess-keySystem">keySystem</a></code> attribute to <var title="true">keySystem</var>.</p></li>
                                <!-- TODO: Initialize the object further if necessary. -->
                              </ol>
                            </li>
                            <li><p>Resolve <var>promise</var> with <var title="true">access</var> and abort these steps.</p></li>
                          </ol>
                        </li>
                      
                    </ol>
                  </li>
                  <li><p>Reject <var>promise</var> with a new <code><a href="http://heycam.github.io/webidl/#dfn-DOMException">DOMException</a></code> whose name is <code><a href="#dfn-NotSupportedError">NotSupportedError</a></code>.</p> 
                    <div class="note"><div class="note-title" aria-level="3" role="heading" id="h_note_11"><span>Note</span></div><p class="">There were no supported combinations in <code>supportedConfigurations</code>.</p></div>
                  </li>
                </ol>
              </li>
              <li><p>Return <var>promise</var>.</p></li>
            </ol></dd></dl></section>
      </section>

      <section id="mediakeysystemoptions-dictionary">
        <h3 role="heading" id="h3_mediakeysystemoptions-dictionary"><span class="secno">2.2 </span><a href="#idl-def-MediaKeySystemOptions" class="idlType"><code>MediaKeySystemOptions</code></a> dictionary</h3>
  
        <pre class="idl"><span class="idlEnum" id="idl-def-MediaKeysRequirement">enum <span class="idlEnumID">MediaKeysRequirement</span> {
    "<a href="#idl-def-MediaKeysRequirement.required" class="idlEnumItem">required</a>",
    "<a href="#idl-def-MediaKeysRequirement.optional" class="idlEnumItem">optional</a>",
    "<a href="#idl-def-MediaKeysRequirement.disallowed" class="idlEnumItem">disallowed</a>"
};</span></pre><table class="simple"><tbody><tr><th colspan="2">Enumeration description</th></tr><tr><td><code id="idl-def-MediaKeysRequirement.required">required</code></td><td>
            The returned object <em class="rfc2119" title="MUST">MUST</em> support this feature.
          </td></tr><tr><td><code id="idl-def-MediaKeysRequirement.optional">optional</code></td><td>
            The returned object <em class="rfc2119" title="MAY">MAY</em> support this feature.
          </td></tr><tr><td><code id="idl-def-MediaKeysRequirement.disallowed">disallowed</code></td><td>
            The returned object <em class="rfc2119" title="MUST NOT">MUST NOT</em> support this feature.
          </td></tr></tbody></table>

        <pre class="idl"><span class="idlDictionary" id="idl-def-MediaKeySystemOptions">dictionary <span class="idlDictionaryID">MediaKeySystemOptions</span> {
<span class="idlMember">    <span class="idlMemberType">DOMString</span>            <span class="idlMemberName"><a href="#widl-MediaKeySystemOptions-initDataType">initDataType</a></span> = <span class="idlMemberValue">""</span>;</span>
<span class="idlMember">    <span class="idlMemberType">DOMString</span>            <span class="idlMemberName"><a href="#widl-MediaKeySystemOptions-audioType">audioType</a></span> = <span class="idlMemberValue">""</span>;</span>
<span class="idlMember">    <span class="idlMemberType">DOMString</span>            <span class="idlMemberName"><a href="#widl-MediaKeySystemOptions-audioCapability">audioCapability</a></span> = <span class="idlMemberValue">""</span>;</span>
<span class="idlMember">    <span class="idlMemberType">DOMString</span>            <span class="idlMemberName"><a href="#widl-MediaKeySystemOptions-videoType">videoType</a></span> = <span class="idlMemberValue">""</span>;</span>
<span class="idlMember">    <span class="idlMemberType">DOMString</span>            <span class="idlMemberName"><a href="#widl-MediaKeySystemOptions-videoCapability">videoCapability</a></span> = <span class="idlMemberValue">""</span>;</span>
<span class="idlMember">    <span class="idlMemberType"><a href="#idl-def-MediaKeysRequirement" class="idlType"><code>MediaKeysRequirement</code></a></span> <span class="idlMemberName"><a href="#widl-MediaKeySystemOptions-uniqueidentifier">uniqueidentifier</a></span> = <span class="idlMemberValue">"optional"</span>;</span>
<span class="idlMember">    <span class="idlMemberType"><a href="#idl-def-MediaKeysRequirement" class="idlType"><code>MediaKeysRequirement</code></a></span> <span class="idlMemberName"><a href="#widl-MediaKeySystemOptions-stateful">stateful</a></span> = <span class="idlMemberValue">"optional"</span>;</span>
};</span></pre><section id="dictionary-mediakeysystemoptions-members"><h4 role="heading" id="h4_dictionary-mediakeysystemoptions-members"><span class="secno">2.2.1 </span>Dictionary <a class="idlType" href="#idl-def-MediaKeySystemOptions"><code>MediaKeySystemOptions</code></a> Members</h4><dl class="dictionary-members"><dt id="widl-MediaKeySystemOptions-audioCapability"><code>audioCapability</code> of type <span class="idlMemberType">DOMString</span>, defaulting to <code>""</code></dt><dd>
            The required audio capability.
          </dd><dt id="widl-MediaKeySystemOptions-audioType"><code>audioType</code> of type <span class="idlMemberType">DOMString</span>, defaulting to <code>""</code></dt><dd>
            The required audio content type.
          </dd><dt id="widl-MediaKeySystemOptions-initDataType"><code>initDataType</code> of type <span class="idlMemberType">DOMString</span>, defaulting to <code>""</code></dt><dd>
            The required <a href="#initialization-data-type">Initialization Data Type</a>.
          </dd><dt id="widl-MediaKeySystemOptions-stateful"><code>stateful</code> of type <span class="idlMemberType"><a href="#idl-def-MediaKeysRequirement" class="idlType"><code>MediaKeysRequirement</code></a></span>, defaulting to <code>"optional"</code></dt><dd>
            Whether the ability to persist state is required. This includes session data and any other type of state.<br>
            Only <code><a href="#idl-def-SessionType.temporary">"temporary"</a></code> sessions may be created when statefulness is not supported.
            <div class="note"><div class="note-title" aria-level="3" role="heading" id="h_note_12"><span>Note</span></div><p class="">
              Except for <code><a href="#idl-def-SessionType.persistent">"persistent"</a></code> sessions, the need and ability to store state is Key System implementation-specific and may vary by feature used.</p></div>
          </dd><dt id="widl-MediaKeySystemOptions-uniqueidentifier"><code>uniqueidentifier</code> of type <span class="idlMemberType"><a href="#idl-def-MediaKeysRequirement" class="idlType"><code>MediaKeysRequirement</code></a></span>, defaulting to <code>"optional"</code></dt><dd>
            Whether a unique identifier is required.
          </dd><dt id="widl-MediaKeySystemOptions-videoCapability"><code>videoCapability</code> of type <span class="idlMemberType">DOMString</span>, defaulting to <code>""</code></dt><dd>
            The required video capability.
          </dd><dt id="widl-MediaKeySystemOptions-videoType"><code>videoType</code> of type <span class="idlMemberType">DOMString</span>, defaulting to <code>""</code></dt><dd>
            The required video content type.
          </dd></dl></section>
  
        <div class="issue"><div class="issue-title" aria-level="2" role="heading" id="h_issue_5"><span>Issue 5</span></div><p class=""><a href="https://www.w3.org/Bugs/Public/show_bug.cgi?id=25923">Bug 25923</a> - The structure of the <code>DOMString</code> members may change. If it is, other methods may be added.</p></div>
  
        <p>Implementations <em class="rfc2119" title="SHOULD NOT">SHOULD NOT</em> add members to the this dictionary.
          Should member(s) be added, they <em class="rfc2119" title="MUST">MUST</em> be of type MediaKeysRequirement, and it is <em class="rfc2119" title="RECOMMENDED">RECOMMENDED</em> that they have default values of <code><a href="#idl-def-MediaKeysRequirement.optional">"optional"</a></code> to support the widest range of application and client combinations.
        </p>
        <p>This dictionary <em class="rfc2119" title="MUST NOT">MUST NOT</em> be used to pass state or data to the CDM.</p>

      </section>
    </section>

        
    <section id="mediakeysystemaccess-interface">
      <!--OddPage--><h2 role="heading" id="h2_mediakeysystemaccess-interface"><span class="secno">3. </span><a href="#idl-def-MediaKeySystemAccess" class="idlType"><code>MediaKeySystemAccess</code></a> Interface</h2>
      <p>The MediaKeySystemAccess object provides access to a <a href="#key-system">Key System</a>.</p>

      <pre class="idl"><span class="idlInterface" id="idl-def-MediaKeySystemAccess">interface <span class="idlInterfaceID">MediaKeySystemAccess</span> {
<span class="idlAttribute">    readonly    attribute <span class="idlAttrType">DOMString</span> <span class="idlAttrName"><a href="#widl-MediaKeySystemAccess-keySystem">keySystem</a></span>;</span>
<span class="idlMethod">    <span class="idlMethType">Promise&lt;<a href="#idl-def-MediaKeys" class="idlType"><code>MediaKeys</code></a>&gt;</span> <span class="idlMethName"><a href="#widl-MediaKeySystemAccess-createMediaKeys-Promise-MediaKeys">createMediaKeys</a></span> ();</span>
};</span></pre><section id="attributes"><h3 role="heading" id="h3_attributes"><span class="secno">3.1 </span>Attributes</h3><dl class="attributes"><dt id="widl-MediaKeySystemAccess-keySystem"><code>keySystem</code> of type <span class="idlAttrType">DOMString</span>, readonly   </dt><dd>
          Identifies the <a href="#key-system">Key System</a> being used.
        </dd></dl></section><section id="methods-1"><h3 role="heading" id="h3_methods-1"><span class="secno">3.2 </span>Methods</h3><dl class="methods"><dt id="widl-MediaKeySystemAccess-createMediaKeys-Promise-MediaKeys"><code>createMediaKeys</code></dt><dd>
          <p>Creates a new <code><a href="#idl-def-MediaKeys">MediaKeys</a></code> object for <var title="true">keySystem</var>.</p>

          
        <div><em>No parameters.</em></div><div><em>Return type: </em><code>Promise&lt;<a href="#idl-def-MediaKeys" class="idlType"><code>MediaKeys</code></a>&gt;</code></div><p>When this method is invoked, the user agent must run the following steps:</p><ol class="method-algorithm">
            <li><p>Let <var>promise</var> be a new promise.</p></li>
            <li><p>Run the following steps asynchronously:</p>
              <ol>
                <li><p>Let <var title="true">cdm</var> be the <a href="#cdm">CDM</a> corresponding to this object.</p></li>
                <li><p>Load and initialize the <var title="true">cdm</var> if necessary.</p></li>
                <li><p>If <var title="true">cdm</var> fails to load or initialize, reject <var>promise</var> with a new <code><a href="http://heycam.github.io/webidl/#dfn-DOMException">DOMException</a></code> whose name is the appropriate <a href="#error-names">error name</a>.</p></li>
                <li><p>Let <var title="true">media keys</var> be a new <code><a href="#idl-def-MediaKeys">MediaKeys</a></code> object.</p></li>
                <li><p>Resolve <var>promise</var> with <var title="true">media keys</var>.</p></li>
              </ol>
            </li>
            <li><p>Return <var>promise</var>.</p></li>
          </ol></dd></dl></section>
    </section>


    <section id="mediakeys-interface">
      <!--OddPage--><h2 role="heading" id="h2_mediakeys-interface"><span class="secno">4. </span><a href="#idl-def-MediaKeys" class="idlType"><code>MediaKeys</code></a> Interface</h2>
      <p>The MediaKeys object represents a set of keys that an associated HTMLMediaElement can use for decryption of <a href="http://www.w3.org/TR/html5/embedded-content-0.html#media-data">media data</a> during playback.
        It also represents a CDM instance.
      </p>
      <p>For methods that return a promise, all errors are reported asynchronously by rejecting the returned Promise. This includes [<cite><a class="bibref" href="#bib-WebIDL">WebIDL</a></cite>] type mapping errors.</p>
      <p>The steps of an algorithm are always aborted when resolving or rejecting a promise.</p>
      
  <!-- TODO: Move or remove depending on the outcome of Bug 25923.
      <dl title="enum IsTypeSupportedResult" class="idl">
        <dt>/* empty string */</dt><!-- TODO: Fix. -- >
        <dd>
          The combination is not supported.
        </dd>
        <dt>maybe</dt>
        <dd>
          The combination may be supported.
        </dd>
        <dt>probably</dt>
        <dd>
          The combination is likely supported.
        </dd>
      </dl>
-->
  
      <pre class="idl"><span class="idlEnum" id="idl-def-SessionType">enum <span class="idlEnumID">SessionType</span> {
    "<a href="#idl-def-SessionType.temporary" class="idlEnumItem">temporary</a>",
    "<a href="#idl-def-SessionType.persistent" class="idlEnumItem">persistent</a>"
};</span></pre><table class="simple"><tbody><tr><th colspan="2">Enumeration description</th></tr><tr><td><code id="idl-def-SessionType.temporary">temporary</code></td><td>
           A session for which a record of or data related to the session <em class="rfc2119" title="MUST NOT">MUST NOT</em> be persisted.
           The application need not worry about managing such storage.
        </td></tr><tr><td><code id="idl-def-SessionType.persistent">persistent</code></td><td>
          A session for which a record of or data related to the session <em class="rfc2119" title="MAY">MAY</em> be persisted.
          The application is responsible for managing any such storage that may be generated by the CDM.
          See <a href="#session-storage">Session Storage and Persistence</a>.
        </td></tr></tbody></table>
  
      <pre class="idl"><span class="idlInterface" id="idl-def-MediaKeys">interface <span class="idlInterfaceID">MediaKeys</span> {
<span class="idlMethod">    <span class="idlMethType"><a href="#idl-def-MediaKeySession" class="idlType"><code>MediaKeySession</code></a></span> <span class="idlMethName"><a href="#widl-MediaKeys-createSession-MediaKeySession-SessionType-sessionType">createSession</a></span> (<span class="idlParam">optional <span class="idlParamType"><a href="#idl-def-SessionType" class="idlType"><code>SessionType</code></a></span> <span class="idlParamName">sessionType</span> = <span class="idlDefaultValue">"temporary"</span></span>);</span>
<span class="idlMethod">    <span class="idlMethType">Promise&lt;void&gt;</span>   <span class="idlMethName"><a href="#widl-MediaKeys-setServerCertificate-Promise-void--BufferSource-serverCertificate">setServerCertificate</a></span> (<span class="idlParam"><span class="idlParamType">BufferSource</span> <span class="idlParamName">serverCertificate</span></span>);</span>
};</span></pre><section id="methods-2"><h3 role="heading" id="h3_methods-2"><span class="secno">4.1 </span>Methods</h3><dl class="methods"><dt id="widl-MediaKeys-createSession-MediaKeySession-SessionType-sessionType"><code>createSession</code></dt><dd>
          <p>Returns a new <code><a href="#idl-def-MediaKeySession">MediaKeySession</a></code> object.</p>

          

          
        <table class="parameters"><tbody><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">sessionType</td><td class="prmType"><code><a href="#idl-def-SessionType" class="idlType"><code>SessionType</code></a> = "temporary"</code></td><td class="prmNullFalse"><span role="img" aria-label="False">✘</span></td><td class="prmOptTrue"><span role="img" aria-label="True">✔</span></td><td class="prmDesc">
              The type of session to create. The session type affects the behavior of the returned object.
            </td></tr></tbody></table><div><em>Return type: </em><code><a href="#idl-def-MediaKeySession" class="idlType"><code>MediaKeySession</code></a></code></div><p>When this method is invoked, the user agent must run the following steps:</p><ol class="method-algorithm">
            <!-- TODO: Find a better way to reference MediaKeySystemAccess attributes, including the outcome vs. what was specified. -->
            <li><p>If this object was created by a <a href="#idl-def-MediaKeySystemAccess" class="idlType"><code>MediaKeySystemAccess</code></a> object that was created with a <code><a href="#widl-MediaKeySystemOptions-stateful">stateful</a></code> value of <code><a href="#idl-def-MediaKeysRequirement.disallowed">"disallowed"</a></code> and <var title="true">sessionType</var> is not <code><a href="#idl-def-SessionType.temporary">"temporary"</a></code>, throw a new <code><a href="http://heycam.github.io/webidl/#dfn-DOMException">DOMException</a></code> whose name is <code><a href="#dfn-NotSupportedError">NotSupportedError</a></code>.</p></li>
            <!-- TODO: Reference the CDM loaded during initialization instead of "<a def-id="cdm"></a> corresponding to the <a def-id="keySystem-attribute"></a> attribute", especially since it is now a member of MediaKeySystemAccess. Here and elsewhere. -->
            <li><p>If <var title="true">sessionType</var> is not supported by the <a href="#cdm">CDM</a> corresponding to the <code><a href="#widl-MediaKeySystemAccess-keySystem">keySystem</a></code> attribute, throw a new <code><a href="http://heycam.github.io/webidl/#dfn-DOMException">DOMException</a></code> whose name is <code><a href="#dfn-NotSupportedError">NotSupportedError</a></code>.</p></li>
            <li><p>Let <var title="true">session</var> be a new <code><a href="#idl-def-MediaKeySession">MediaKeySession</a></code> object, and initialize it as follows:</p>
              <ol>
                <li><p>Let the <code><a href="#widl-MediaKeySession-sessionId">sessionId</a></code> attribute be the empty string.</p></li>
                <li><p>Let the <code><a href="#widl-MediaKeySession-expiration">expiration</a></code> attribute be <code>NaN</code>.</p></li>
                <li><p>Let the <code><a href="#widl-MediaKeySession-closed">closed</a></code> attribute be a new promise.</p></li>
                <li><p>Let the <var title="true">session type</var> be <var title="true">sessionType</var>.</p></li>
                <li><p>Let <var title="true">uninitialized</var> be true.</p></li>
                <li><p>Let <var title="true">callable</var> be false.</p></li>
              </ol>
            </li>
            <li><p>Return <var title="true">session</var>.</p></li>
          </ol></dd><dt id="widl-MediaKeys-setServerCertificate-Promise-void--BufferSource-serverCertificate"><code>setServerCertificate</code></dt><dd>
          <p id="server-certificate">Provides a server certificate to be used to encrypt messages to the license server.</p>
          <p>Key Systems that use such certificates <em class="rfc2119" title="MUST">MUST</em> also support requesting the certificate from the server via the <a href="#algorithms-queue-message">queue a "message" event algorithm</a>.</p>
          <div class="note"><div class="note-title" aria-level="2" role="heading" id="h_note_13"><span>Note</span></div><p class="">This method allows an application to proactively provide a server certificate to implementations that support it to avod the additional round trip should the CDM request it.
            It is intended as an optimization, and applications are not required to use it.
          </p></div>

          

          
        <table class="parameters"><tbody><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">serverCertificate</td><td class="prmType"><code>BufferSource</code></td><td class="prmNullFalse"><span role="img" aria-label="False">✘</span></td><td class="prmOptFalse"><span role="img" aria-label="False">✘</span></td><td class="prmDesc">
              The server certificate.
              The contents are <a href="#key-system">Key System</a>-specific.
              It <em class="rfc2119" title="MUST NOT">MUST NOT</em> contain executable code.
            </td></tr></tbody></table><div><em>Return type: </em><code>Promise&lt;void&gt;</code></div><p>When this method is invoked, the user agent must run the following steps:</p><ol class="method-algorithm">
            <li><p>If <var title="true">serverCertificate</var> is an empty array, return a promise rejected with a new a new <code><a href="http://heycam.github.io/webidl/#dfn-DOMException">DOMException</a></code> whose name is <code><a href="#dfn-InvalidAccessError">InvalidAccessError</a></code>.</p></li>
            <li><p>If the <a href="#cdm">CDM</a> corresponding to the <code><a href="#widl-MediaKeySystemAccess-keySystem">keySystem</a></code> attribute does not support server certificates, return a promise rejected with a new <code><a href="http://heycam.github.io/webidl/#dfn-DOMException">DOMException</a></code> whose name is <code><a href="#dfn-NotSupportedError">NotSupportedError</a></code>.</p></li>
            <li><p>Let <var>certificate</var> be a copy of the contents of the <var title="true">serverCertificate</var> parameter.</p></li>
            <li><p>Let <var>promise</var> be a new promise.</p></li>
            <li><p>Run the following steps asynchronously:</p>
              <ol>
                <li><p>Let <var title="true">cdm</var> be the <var title="true">cdm</var> during the <a href="#widl-MediaKeySystemAccess-createMediaKeys-Promise-MediaKeys">initialization</a> of this object.</p></li>
                <li><p>Use the <var title="true">cdm</var> to process <var>certificate</var>.</p></li>
                <li><p>If any of the preceding steps failed, reject <var>promise</var> with a new <code><a href="http://heycam.github.io/webidl/#dfn-DOMException">DOMException</a></code> whose name is the appropriate <a href="#error-names">error name</a>.</p></li>
                <li><p>Resolve <var>promise</var>.</p></li>
              </ol>
            </li>
            <li><p>Return <var>promise</var>.</p></li>
          </ol></dd></dl></section>

    </section>


    <section id="mediakeysession-interface">
      <!--OddPage--><h2 role="heading" id="h2_mediakeysession-interface"><span class="secno">5. </span><a href="#idl-def-MediaKeySession" class="idlType"><code>MediaKeySession</code></a> Interface</h2>
      <p>The MediaKeySession object represents a <a href="#key-session">key session</a>.</p>
  
      <p>For methods that return a promise, all errors are reported asynchronously by rejecting the returned Promise. This includes [<cite><a class="bibref" href="#bib-WebIDL">WebIDL</a></cite>] type mapping errors.</p>
      <p>The steps of an algorithm are always aborted when resolving or rejecting a promise.</p>
  
      <pre class="idl"><span class="idlInterface" id="idl-def-MediaKeySession">interface <span class="idlInterfaceID">MediaKeySession</span> : <span class="idlSuperclass">EventTarget</span> {
<span class="idlAttribute">    readonly    attribute <span class="idlAttrType">DOMString</span>           <span class="idlAttrName"><a href="#widl-MediaKeySession-sessionId">sessionId</a></span>;</span>
<span class="idlAttribute">    readonly    attribute <span class="idlAttrType">unrestricted double</span> <span class="idlAttrName"><a href="#widl-MediaKeySession-expiration">expiration</a></span>;</span>
<span class="idlAttribute">    readonly    attribute <span class="idlAttrType">Promise&lt;void&gt;</span>       <span class="idlAttrName"><a href="#widl-MediaKeySession-closed">closed</a></span>;</span>
<span class="idlMethod">    <span class="idlMethType">Promise&lt;void&gt;</span>                  <span class="idlMethName"><a href="#widl-MediaKeySession-generateRequest-Promise-void--DOMString-initDataType-BufferSource-initData">generateRequest</a></span> (<span class="idlParam"><span class="idlParamType">DOMString</span> <span class="idlParamName">initDataType</span></span>, <span class="idlParam"><span class="idlParamType">BufferSource</span> <span class="idlParamName">initData</span></span>);</span>
<span class="idlMethod">    <span class="idlMethType">Promise&lt;boolean&gt;</span>               <span class="idlMethName"><a href="#widl-MediaKeySession-load-Promise-boolean--DOMString-sessionId">load</a></span> (<span class="idlParam"><span class="idlParamType">DOMString</span> <span class="idlParamName">sessionId</span></span>);</span>
<span class="idlMethod">    <span class="idlMethType">Promise&lt;void&gt;</span>                  <span class="idlMethName"><a href="#widl-MediaKeySession-update-Promise-void--BufferSource-response">update</a></span> (<span class="idlParam"><span class="idlParamType">BufferSource</span> <span class="idlParamName">response</span></span>);</span>
<span class="idlMethod">    <span class="idlMethType">Promise&lt;void&gt;</span>                  <span class="idlMethName"><a href="#widl-MediaKeySession-close-Promise-void">close</a></span> ();</span>
<span class="idlMethod">    <span class="idlMethType">Promise&lt;void&gt;</span>                  <span class="idlMethName"><a href="#widl-MediaKeySession-remove-Promise-void">remove</a></span> ();</span>
<span class="idlMethod">    <span class="idlMethType">Promise&lt;sequence&lt;ArrayBuffer&gt;&gt;</span> <span class="idlMethName"><a href="#widl-MediaKeySession-getUsableKeyIds-Promise-sequence-ArrayBuffer">getUsableKeyIds</a></span> ();</span>
};</span></pre><section id="attributes-1"><h3 role="heading" id="h3_attributes-1"><span class="secno">5.1 </span>Attributes</h3><dl class="attributes"><dt id="widl-MediaKeySession-closed"><code>closed</code> of type <span class="idlAttrType">Promise&lt;void&gt;</span>, readonly   </dt><dd>
          <p>Signals when object becomes closed as a result of the <a href="#algorithms-session-close">session close algorithm</a> being run.
          This promise can only be fulfilled and is never rejected.</p>
        </dd><dt id="widl-MediaKeySession-expiration"><code>expiration</code> of type <span class="idlAttrType">unrestricted double</span>, readonly   </dt><dd>
          <p>The time, in milliseconds since 01 January, 1970 UTC, after which the key(s) in the session will no longer be usable to decrypt <a href="http://www.w3.org/TR/html5/embedded-content-0.html#media-data">media data</a>, or <code>NaN</code> if no such time exists, as determined by the CDM.</p>
        </dd><dt id="widl-MediaKeySession-sessionId"><code>sessionId</code> of type <span class="idlAttrType">DOMString</span>, readonly   </dt><dd>
          <p>The <a href="#session-id">Session ID</a> for this object and the associated key(s) or license(s).</p>
        </dd></dl></section><section id="methods-3"><h3 role="heading" id="h3_methods-3"><span class="secno">5.2 </span>Methods</h3><dl class="methods"><dt id="widl-MediaKeySession-close-Promise-void"><code>close</code></dt><dd>
          <p>Indicates that the application no longer needs the session and the CDM should release any resources associated with this object and close it.</p>
          <div class="note"><div class="note-title" aria-level="2" role="heading" id="h_note_14"><span>Note</span></div><p class="">The returned promise is resolved when the request has been processed, and the <code><a href="#widl-MediaKeySession-closed">closed</a></code> attribute promise is resolved when the session is closed.</p></div>

          
        <div><em>No parameters.</em></div><div><em>Return type: </em><code>Promise&lt;void&gt;</code></div><p>When this method is invoked, the user agent must run the following steps:</p><ol class="method-algorithm">
            <li><p>If this object's <var title="true">callable</var> value is false, return a promise rejected with a new <code><a href="http://heycam.github.io/webidl/#dfn-DOMException">DOMException</a></code> whose name is <code><a href="#dfn-InvalidStateError">InvalidStateError</a></code>.</p></li>
            <li><p>If the <a href="#algorithms-session-close">session close algorithm</a> has been run on this object, return a resolved promise.</p></li>
            <li><p>Let <var>promise</var> be a new promise.</p></li>
            <li><p>Run the following steps asynchronously:</p>
              <ol>
                <li><p>Let <var title="true">cdm</var> be the CDM loaded during the <a href="#widl-MediaKeySystemAccess-createMediaKeys-Promise-MediaKeys">initialization</a> of the <code><a href="#idl-def-MediaKeys">MediaKeys</a></code> object that created this object.</p></li>
                <li><p>Use the <var title="true">cdm</var> to execute the following steps:</p>
                  <ol>
                    <li>
                      <p>Process the close request.</p>
                      <p>Do not remove stored session data.</p>
                    </li>
                    <li><p>If the previous step caused the session to be closed, run the <a href="#algorithms-session-close">session close algorithm</a> on this object.</p></li>
                  </ol>
                </li>
                <li><p>Resolve <var>promise</var>.</p></li>
              </ol>
            </li>
            <li><p>Return <var>promise</var>.</p></li>
          </ol></dd><dt id="widl-MediaKeySession-generateRequest-Promise-void--DOMString-initDataType-BufferSource-initData"><code>generateRequest</code></dt><dd>
          <p>Generates a request based on the <var title="true">initData</var>.</p>

          

          
        <table class="parameters"><tbody><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">initDataType</td><td class="prmType"><code>DOMString</code></td><td class="prmNullFalse"><span role="img" aria-label="False">✘</span></td><td class="prmOptFalse"><span role="img" aria-label="False">✘</span></td><td class="prmDesc">
              <a href="#initialization-data">Initialization Data</a>
            </td></tr><tr><td class="prmName">initData</td><td class="prmType"><code>BufferSource</code></td><td class="prmNullFalse"><span role="img" aria-label="False">✘</span></td><td class="prmOptFalse"><span role="img" aria-label="False">✘</span></td><td class="prmDesc">
              The <a href="#initialization-data-type">Initialization Data Type</a> of the <var title="true">initData</var>.
            </td></tr></tbody></table><div><em>Return type: </em><code>Promise&lt;void&gt;</code></div><p>When this method is invoked, the user agent must run the following steps:</p><ol class="method-algorithm">
            <li><p>If this object's <var title="true">uninitialized</var> value is false, return a promise rejected with a new <code><a href="http://heycam.github.io/webidl/#dfn-DOMException">DOMException</a></code> whose name is <code><a href="#dfn-InvalidStateError">InvalidStateError</a></code>.</p></li>
            <li><p>Let this object's <var title="true">uninitialized</var> be false.</p></li><!-- For simplicity and consistency, this object cannot be reused after any failure. -->
            <li><p>If <var title="true">initDataType</var> is an empty string, return a promise rejected with a new <code><a href="http://heycam.github.io/webidl/#dfn-DOMException">DOMException</a></code> whose name is <code><a href="#dfn-InvalidAccessError">InvalidAccessError</a></code>.</p></li>
            <li><p>If <var title="true">initData</var> is an empty array, return a promise rejected with a new <code><a href="http://heycam.github.io/webidl/#dfn-DOMException">DOMException</a></code> whose name is <code><a href="#dfn-InvalidAccessError">InvalidAccessError</a></code>.</p></li>
            <li><p>Let <var title="true">media keys</var> be the <code><a href="#idl-def-MediaKeys">MediaKeys</a></code> object that created this object.</p></li>
            <li><p>If the <a href="#cdm">CDM</a> corresponding to <var title="true">media keys</var>'s <code><a href="#widl-MediaKeySystemAccess-keySystem">keySystem</a></code> attribute does not support <var title="true">initDataType</var> as an <a href="#initialization-data-type">Initialization Data Type</a>, return a promise rejected with a new <code><a href="http://heycam.github.io/webidl/#dfn-DOMException">DOMException</a></code> whose name is <code><a href="#dfn-NotSupportedError">NotSupportedError</a></code>. String comparison is case-sensitive.</p></li>
            <li><p>Let <var>init data</var> be a copy of the contents of the <var title="true">initData</var> parameter.</p></li>
            <li><p>Let <var title="true">session type</var> be this object's <var title="true">session type</var>.</p></li>
            <li><p>Let <var>promise</var> be a new promise.</p></li>
            <li><p>Run the following steps asynchronously:</p>
              <ol>
                <li><p>If the <var>init data</var> is not valid for <var title="true">initDataType</var>, reject <var>promise</var> with a new <code><a href="http://heycam.github.io/webidl/#dfn-DOMException">DOMException</a></code> whose name is <code><a href="#dfn-InvalidAccessError">InvalidAccessError</a></code>.</p></li>
                <li><p>Let <var>sanitized init data</var> be a validated and sanitized version of <var>init data</var>.</p>
                  <p>The user agent <em class="rfc2119" title="MUST">MUST</em> thoroughly validate the <a href="#initialization-data">Initialization Data</a> before passing it to the CDM.
                    This includes verifying that the length and values of fields are reasonable, verifying that values are within reasonable limits, and stripping irrelevant, unsupported, or unknown data or fields.
                    It is <em class="rfc2119" title="RECOMMENDED">RECOMMENDED</em> that user agents pre-parse, sanitize, and/or generate a fully sanitized version of the <a href="#initialization-data">Initialization Data</a>.
                    If the <a href="#initialization-data">Initialization Data</a> format specified by <var title="true">initDataType</var> support multiple entries, the user agent <em class="rfc2119" title="SHOULD">SHOULD</em> remove entries that are not needed by the CDM.
                  </p>
                </li>
                <li><p>If the previous step failed, reject <var>promise</var> with a new <code><a href="http://heycam.github.io/webidl/#dfn-DOMException">DOMException</a></code> whose name is <code><a href="#dfn-InvalidAccessError">InvalidAccessError</a></code>.</p></li>
                <li><p>Let <var title="true">session id</var> be the empty string.</p></li>
                <li><p>Let <var title="true">message</var> be null.</p></li>
                <li><p>Let <var title="true">cdm</var> be the CDM loaded during the <a href="#widl-MediaKeySystemAccess-createMediaKeys-Promise-MediaKeys">initialization</a> of <var title="true">media keys</var>.</p></li>
                <li><p>Use the <var title="true">cdm</var> to execute the following steps:</p>
                  <ol>
                    <li><p>If the <var>init data</var> is not supported by the <var title="true">cdm</var>, reject <var>promise</var> with a new <code><a href="http://heycam.github.io/webidl/#dfn-DOMException">DOMException</a></code> whose name is <code><a href="#dfn-NotSupportedError">NotSupportedError</a></code>.</p></li>
                    <li><p>Follow the steps for the first matching condition from the following list:</p>
                      <dl class="switch">
                        <dt>If <var title="true">session type</var> is <code><a href="#idl-def-SessionType.temporary">"temporary"</a></code></dt>
                        <dd>Let <var title="true">requested session type</var> be a temporary non-persisted session.<p></p>
                          <div class="note"><div class="note-title" aria-level="2" role="heading" id="h_note_15"><span>Note</span></div><p class="">The returned license must not be persistable.</p></div>
                        </dd>
                        <dt>If <var title="true">session type</var> is <code><a href="#idl-def-SessionType.persistent">"persistent"</a></code></dt>
                        <dd>Let <var title="true">requested session type</var> be a persistable session.<p>
                          </p><div class="note"><div class="note-title" aria-level="2" role="heading" id="h_note_16"><span>Note</span></div><p class="">The returned license may be persistable.</p></div>
                        </dd>
                      </dl>
                      <div class="note"><div class="note-title" aria-level="2" role="heading" id="h_note_17"><span>Note</span></div><p class="">The license server determines the type of license that is returned, either persistent or non-persistent. A persistent license cannot be added to a non-persistable session.</p></div>
                    </li>
      
                    <li><p>Let <var title="true">session id</var> be a unique <a href="#session-id">Session ID</a> string.</p>
                      <p>If <var title="true">session type</var> is <code><a href="#idl-def-SessionType.persistent">"persistent"</a></code>, the ID <em class="rfc2119" title="MUST">MUST</em> be unique within the the <a href="http://www.w3.org/TR/html5/browsers.html#origin-0">origin</a> of this object's <a href="http://dom.spec.whatwg.org/#concept-document">Document</a> over time, including across Documents and browsing sessions.</p>
                    </li>
                    <li><p>Let <var title="true">message</var> be a request for the <var title="true">requested session type</var> generated based on the <var>init data</var>, which is interpreted per <var title="true">initDataType</var>.</p>
                      <div class="note"><div class="note-title" aria-level="2" role="heading" id="h_note_18"><span>Note</span></div><p class="">For example, a license request.</p></div>
                      <p>The <var title="true">cdm</var> <em class="rfc2119" title="MUST NOT">MUST NOT</em> use any stream-specific data, including <a href="http://www.w3.org/TR/html5/embedded-content-0.html#media-data">media data</a>, not provided via the <var>init data</var>.</p>
                      <p>The <var title="true">cdm</var> <em class="rfc2119" title="SHOULD NOT">SHOULD NOT</em> store session data, including the session ID, at this point. See <a href="#session-storage">Session Storage and Persistence</a>.</p>
                    </li>
                  </ol>
                </li>
                <li><p>If any of the preceding steps failed, reject <var>promise</var> with a new <code><a href="http://heycam.github.io/webidl/#dfn-DOMException">DOMException</a></code> whose name is the appropriate <a href="#error-names">error name</a>.</p></li>
                <li><p>Set the <code><a href="#widl-MediaKeySession-sessionId">sessionId</a></code> attribute to <var title="true">session id</var>.</p></li>
                <li><p>Let this object's <var title="true">callable</var> be true.</p></li>
                <li><p>Run the <a href="#algorithms-queue-message">queue a "message" event algorithm</a> on the <var title="true">session</var>, providing <code><a href="#idl-def-MediaKeyMessageType.licenserequest">"licenserequest"</a></code> and <var title="true">message</var>.</p></li>
                <li><p>Resolve <var>promise</var>.</p></li>
              </ol>
            </li>
            <li><p>Return <var>promise</var>.</p></li>
          </ol></dd><dt id="widl-MediaKeySession-getUsableKeyIds-Promise-sequence-ArrayBuffer"><code>getUsableKeyIds</code></dt><dd>
          <div class="issue"><div class="issue-title" aria-level="2" role="heading" id="h_issue_6"><span>Issue 6</span></div><p class=""><a href="https://www.w3.org/Bugs/Public/show_bug.cgi?id=26372">Bug 26372</a> - getUsableKeyIds() may be replaced.</p></div>
          <p>Gets the key IDs for keys in the session that the CDM <em>knows</em> are currently usable to decrypt <a href="http://www.w3.org/TR/html5/embedded-content-0.html#media-data">media data</a>.</p>

          
        <div><em>No parameters.</em></div><div><em>Return type: </em><code>Promise&lt;sequence&lt;ArrayBuffer&gt;&gt;</code></div><p>When this method is invoked, the user agent must run the following steps:</p><ol class="method-algorithm">
            <li><p>If this object's <var title="true">callable</var> value is false, return a promise rejected with a new <code><a href="http://heycam.github.io/webidl/#dfn-DOMException">DOMException</a></code> whose name is <code><a href="#dfn-InvalidStateError">InvalidStateError</a></code>.</p></li>
            <li><p>Let <var>promise</var> be a new promise.</p></li>
            <li><p>Run the following steps asynchronously:</p>
              <ol>
                <li><p>Let <var title="true">cdm</var> be the CDM loaded during the <a href="#widl-MediaKeySystemAccess-createMediaKeys-Promise-MediaKeys">initialization</a> of the <code><a href="#idl-def-MediaKeys">MediaKeys</a></code> object that created this object.</p></li>
                <li><p>Use the <var title="true">cdm</var> to execute the following steps:</p>
                  <ol>
                    <li><p>Let <var title="true">usable key ids</var> be a list of the key IDs for keys in the session that the CDM <em>knows</em> are currently usable to decrypt <a href="http://www.w3.org/TR/html5/embedded-content-0.html#media-data">media data</a>. <var title="true">usable key ids</var> <em class="rfc2119" title="MUST NOT">MUST NOT</em> contain IDs for keys that <em>may not</em> currently be usable. Each element <em class="rfc2119" title="MUST">MUST</em> be unique.</p></li>
                  </ol>
                </li>
                <li>
                  <p>If the preceding step failed, reject <var>promise</var> with a new <code><a href="http://heycam.github.io/webidl/#dfn-DOMException">DOMException</a></code> whose name is the appropriate <a href="#error-names">error name</a>.</p>
                </li>
                <li>
                  <p>Resolve <var>promise</var> with a new sequence object, each element of which contains one element of <var title="true">usable key ids</var>.</p>
                </li>
              </ol>
            </li>
          </ol></dd><dt id="widl-MediaKeySession-load-Promise-boolean--DOMString-sessionId"><code>load</code></dt><dd>
          <p>Loads the data stored for the specified session into this object.</p>

          

          
        <table class="parameters"><tbody><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">sessionId</td><td class="prmType"><code>DOMString</code></td><td class="prmNullFalse"><span role="img" aria-label="False">✘</span></td><td class="prmOptFalse"><span role="img" aria-label="False">✘</span></td><td class="prmDesc">
              The <a href="#session-id">Session ID</a> of the session to load.
            </td></tr></tbody></table><div><em>Return type: </em><code>Promise&lt;boolean&gt;</code></div><p>When this method is invoked, the user agent must run the following steps:</p><ol class="method-algorithm">
            <li><p>If this object's <var title="true">uninitialized</var> value is false, return a promise rejected with a new <code><a href="http://heycam.github.io/webidl/#dfn-DOMException">DOMException</a></code> whose name is <code><a href="#dfn-InvalidStateError">InvalidStateError</a></code>.</p></li>
            <li><p>Let this object's <var title="true">uninitialized</var> be false.</p></li><!-- For simplicity and consistency, this object cannot be reused after any failure. -->
            <li><p>If <var title="true">sessionId</var> is an empty string, return a promise rejected with a new <code><a href="http://heycam.github.io/webidl/#dfn-DOMException">DOMException</a></code> whose name is <code><a href="#dfn-InvalidAccessError">InvalidAccessError</a></code>.</p></li>
            <li><p>If this object's <var title="true">session type</var> is not <code><a href="#idl-def-SessionType.persistent">"persistent"</a></code>, return a promise rejected with a new <code><a href="http://heycam.github.io/webidl/#dfn-DOMException">DOMException</a></code> whose name is <code><a href="#dfn-InvalidAccessError">InvalidAccessError</a></code>.</p></li>
            <li><p>Let <var title="true">media keys</var> be the <code><a href="#idl-def-MediaKeys">MediaKeys</a></code> object that created this object.</p></li>
            <li><p>If the <a href="#cdm">CDM</a> corresponding to <var title="true">media keys</var>'s <code><a href="#widl-MediaKeySystemAccess-keySystem">keySystem</a></code> attribute does not support loading previous sessions, return a promise rejected with a new <code><a href="http://heycam.github.io/webidl/#dfn-DOMException">DOMException</a></code> whose name is <code><a href="#dfn-NotSupportedError">NotSupportedError</a></code>.</p></li>
            <li><p>Let <var>promise</var> be a new promise.</p></li>
            <li><p>Run the following steps asynchronously:</p>
              <ol>
                <li><p>Let <var>sanitized session ID</var> be a validated and/or sanitized version of <var title="true">sessionId</var>.</p>
                  <div class="note"><div class="note-title" aria-level="2" role="heading" id="h_note_19"><span>Note</span></div><p class="">The user agent should thoroughly validate the sessionId value before passing it to the CDM.
                    At a minimum, this should include checking that the length and value (e.g. alphanumeric) are reasonable.
                  </p></div>
                </li>
                <li><p>If the previous step failed, reject <var>promise</var> with a new <code><a href="http://heycam.github.io/webidl/#dfn-DOMException">DOMException</a></code> whose name is <code><a href="#dfn-InvalidAccessError">InvalidAccessError</a></code>.</p></li>
                <li><p>Let <var title="true">expiration time</var> be <code>NaN</code>.</p></li>
                <li><p>Let <var title="true">message</var> be null.</p></li>
                <li><p>Let <var title="true">message type</var> be null.</p></li>
                <li><p>Let <var title="true">origin</var> be the <a href="http://www.w3.org/TR/html5/browsers.html#origin-0">origin</a> of this object's <a href="http://dom.spec.whatwg.org/#concept-document">Document</a>.</p></li>
                <li><p>Let <var title="true">cdm</var> be the CDM loaded during the <a href="#widl-MediaKeySystemAccess-createMediaKeys-Promise-MediaKeys">initialization</a> of <var title="true">media keys</var>.</p></li>
                <li><p>Use the <var title="true">cdm</var> to execute the following steps:</p>
                  <ol>
                    <li><p>If there is no data stored for the <var>sanitized session ID</var> in the <var title="true">origin</var>, resolve <var>promise</var> with <code>false</code>.</p></li><!-- Per https://github.com/w3ctag/promises-guide#rejections-should-be-used-for-exceptional-situations. -->
                    <li><p>Let <var title="true">session data</var> be the data stored for the <var>sanitized session ID</var> in the <var title="true">origin</var>.
                    This <em class="rfc2119" title="MUST NOT">MUST NOT</em> include data from other origin(s) or that is not associated with an origin.</p></li>
                    <li><p>If there is an unclosed <code><a href="#idl-def-SessionType.persistent">"persistent"</a></code> session in any <a href="http://dom.spec.whatwg.org/#concept-document">Document</a> representing the <var title="true">session data</var>, reject <var>promise</var> with a new <code><a href="http://heycam.github.io/webidl/#dfn-DOMException">DOMException</a></code> whose name is <code><a href="#dfn-QuotaExceededError">QuotaExceededError</a></code>.</p>
                      <div class="note"><div class="note-title" aria-level="2" role="heading" id="h_note_20"><span>Note</span></div><p class="">In other words, do not create a session if a non-closed persistent session already exists for this <var>sanitized session ID</var> in any browsing context.</p></div>
                    </li>
                    <li><p>Load the <var title="true">session data</var>.</p></li>
                    <li><p>If the <var title="true">session data</var> indicates an expiration time for the session, let <var title="true">expiration time</var> be the expiration time in milliseconds since 01 January 1970 UTC.</p></li>
                    <li><p>If the CDM needs to send a message:</p>
                      <ol>
                        <li><p>Let <var title="true">message</var> be a message generated by the <a href="#cdm">CDM</a> based on the <var title="true">session data</var>.</p></li>
                        <li><p>Let <var title="true">message type</var> be the appropriate <code><a href="#idl-def-MediaKeyMessageType">MediaKeyMessageType</a></code> for the message.</p></li>
                      </ol>
                    </li>
                  </ol>
                </li>
                <li><p>If any of the preceding steps failed, reject <var>promise</var> with a new <code><a href="http://heycam.github.io/webidl/#dfn-DOMException">DOMException</a></code> whose name is the appropriate <a href="#error-names">error name</a>.</p></li>
                <li><p>Set the <code><a href="#widl-MediaKeySession-sessionId">sessionId</a></code> attribute to <var>sanitized session ID</var>.</p></li>
                <li><p>Let this object's <var title="true">callable</var> be true.</p></li>
                <li><p>If the loaded session contains usable keys, run the <a href="#algorithms-keys-changed">usable keys changed algorithm</a> on the <var title="true">session</var>.</p>
                  <p>The algorithm <em class="rfc2119" title="MAY">MAY</em> also be run later should additional processing be necessary to determine with certainty whether one or more keys is usable.</p>
                </li>
                <li><p>Run the <a href="#algorithms-update-expiration">update expiration algorithm</a> on the <var title="true">session</var>, providing <var title="true">expiration time</var>.</p></li>
                <li><p>If <var title="true">message</var> is not null, run the <a href="#algorithms-queue-message">queue a "message" event algorithm</a> on the <var title="true">session</var>, providing <var title="true">message type</var> and <var title="true">message</var>.</p></li>
                <li><p>Resolve <var>promise</var> with <code>true</code>.</p></li>
              </ol>
            </li>
            <li><p>Return <var>promise</var>.</p></li>
          </ol></dd><dt id="widl-MediaKeySession-remove-Promise-void"><code>remove</code></dt><dd>
          <p>Removes stored session data associated with this object.</p>

          
        <div><em>No parameters.</em></div><div><em>Return type: </em><code>Promise&lt;void&gt;</code></div><p>When this method is invoked, the user agent must run the following steps:</p><ol class="method-algorithm">
            <li><p>If this object's <var title="true">callable</var> value is false, return a promise rejected with a new <code><a href="http://heycam.github.io/webidl/#dfn-DOMException">DOMException</a></code> whose name is <code><a href="#dfn-InvalidStateError">InvalidStateError</a></code>.</p></li>
            <li><p>If this object's <var title="true">session type</var> is not <code><a href="#idl-def-SessionType.persistent">"persistent"</a></code>, return a promise rejected with a new <code><a href="http://heycam.github.io/webidl/#dfn-DOMException">DOMException</a></code> whose name is <code><a href="#dfn-InvalidAccessError">InvalidAccessError</a></code>.</p></li>
            <li><p>If the <a href="#algorithms-session-close">session close algorithm</a> has been run on this object, return a promise rejected with a new <code><a href="http://heycam.github.io/webidl/#dfn-DOMException">DOMException</a></code> whose name is <code><a href="#dfn-InvalidStateError">InvalidStateError</a></code>.</p></li>
            <li><p>Let <var>promise</var> be a new promise.</p></li>
            <li><p>Run the following steps asynchronously:</p>
              <ol>
                <li><p>Let <var title="true">cdm</var> be the CDM loaded during the <a href="#widl-MediaKeySystemAccess-createMediaKeys-Promise-MediaKeys">initialization</a> of the <code><a href="#idl-def-MediaKeys">MediaKeys</a></code> object that created this object.</p></li>
                <li><p>Use the <var title="true">cdm</var> to execute the following steps:</p>
                  <ol>
                    <li>
                      <p>Process the remove request.</p>
                      <p>This <em class="rfc2119" title="MAY">MAY</em> involve exchanging message(s) with the application.</p>
                      <p>Unless this step fails, the CDM <em class="rfc2119" title="MUST">MUST</em> have cleared all stored session data associated with this object, including the <code><a href="#widl-MediaKeySession-sessionId">sessionId</a></code>, before proceeding to the next step.</p>
                      <div class="note"><div class="note-title" aria-level="2" role="heading" id="h_note_21"><span>Note</span></div><p class="">A subsequent call to <code><a href="#widl-MediaKeySession-load-Promise-boolean--DOMString-sessionId">load()</a></code> with the value <code><a href="#widl-MediaKeySession-sessionId">sessionId</a></code> would fail because there is no data stored for that session ID.</p></div>
                    </li>
                  </ol>
                </li>
                <li><p>Run the following steps asynchronously once the above step has completed:</p>
                  <ol>
                    <li><p>If any of the preceding steps failed, reject <var>promise</var> with a new <code><a href="http://heycam.github.io/webidl/#dfn-DOMException">DOMException</a></code> whose name is the appropriate <a href="#error-names">error name</a>.</p></li>
                    <li><p>Run the <a href="#algorithms-session-close">session close algorithm</a> on this object.</p></li>
                    <li><p>Resolve <var>promise</var>.</p></li>
                  </ol>
                </li>
              </ol>
            </li>
            <li><p>Return <var>promise</var>.</p></li>
          </ol></dd><dt id="widl-MediaKeySession-update-Promise-void--BufferSource-response"><code>update</code></dt><dd>
          <p>Provides messages, including licenses, to the CDM.</p>

          

          
        <table class="parameters"><tbody><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">response</td><td class="prmType"><code>BufferSource</code></td><td class="prmNullFalse"><span role="img" aria-label="False">✘</span></td><td class="prmOptFalse"><span role="img" aria-label="False">✘</span></td><td class="prmDesc">
              A message to be provided to the CDM.
              The contents are <a href="#key-system">Key System</a>-specific.
              It <em class="rfc2119" title="MUST NOT">MUST NOT</em> contain executable code.
            </td></tr></tbody></table><div><em>Return type: </em><code>Promise&lt;void&gt;</code></div><p>When this method is invoked, the user agent must run the following steps:</p><ol class="method-algorithm">
            <li><p>If this object's <var title="true">callable</var> value is false, return a promise rejected with a new <code><a href="http://heycam.github.io/webidl/#dfn-DOMException">DOMException</a></code> whose name is <code><a href="#dfn-InvalidStateError">InvalidStateError</a></code>.</p></li>
            <li><p>If <var title="true">response</var> is an empty array, return a promise rejected with a new <code><a href="http://heycam.github.io/webidl/#dfn-DOMException">DOMException</a></code> whose name is <code><a href="#dfn-InvalidAccessError">InvalidAccessError</a></code>.</p></li>
            <li><p>Let <var>response copy</var> be a copy of the contents of the <var title="true">response</var> parameter.</p></li>
            <li><p>Let <var>promise</var> be a new promise.</p></li>
            <li><p>Run the following steps asynchronously:</p>
              <ol>
                <li><p>Let <var>sanitized response</var> be a validated and/or sanitized version of <var>response copy</var>.</p>
                  <div class="note"><div class="note-title" aria-level="2" role="heading" id="h_note_22"><span>Note</span></div><p class="">The user agent should thoroughly validate the response before passing it to the CDM.
                    This may include verifying values are within reasonable limits, stripping irrelevant data or fields, pre-parsing it, sanitizing it, and/or generating a fully sanitized version.
                    The user agent should check that the length and values of fields are reasonable.
                    Unknown fields should be rejected or removed.
                  </p></div>
                </li>
                <li><p>If the previous step failed, reject <var>promise</var> with a new <code><a href="http://heycam.github.io/webidl/#dfn-DOMException">DOMException</a></code> whose name is <code><a href="#dfn-InvalidAccessError">InvalidAccessError</a></code>.</p></li>
                <li><p>Let <var title="true">cdm</var> be the CDM loaded during the <a href="#widl-MediaKeySystemAccess-createMediaKeys-Promise-MediaKeys">initialization</a> of the <code><a href="#idl-def-MediaKeys">MediaKeys</a></code> object that created this object.</p></li>
                <li><p>Let <var title="true">message</var> be null.</p></li>
                <li><p>Let <var title="true">message type</var> be null.</p></li>
                <li><p>Use the <var title="true">cdm</var> to execute the following steps:</p>
                  <ol>
                    <li><p>If the format of <var>sanitized response</var> is invalid in any way, reject <var>promise</var> with a new <code><a href="http://heycam.github.io/webidl/#dfn-DOMException">DOMException</a></code> whose name is <code><a href="#dfn-InvalidAccessError">InvalidAccessError</a></code>.</p></li>
                    <li><p>Process <var>sanitized response</var>, following the stipulation for the first matching condition from the following list:</p>
                      <dl class="switch">
                        <dt>If <var title="true">sessionType</var> is <code><a href="#idl-def-SessionType.temporary">"temporary"</a></code> and <var>sanitized response</var> does not specify that session data, including any license, key(s), or similar session data it contains, should be stored</dt>
                        <dd>Continue processing <var>sanitized response</var>, not storing any session data.</dd>
                        <dt>If <var title="true">sessionType</var> is <code><a href="#idl-def-SessionType.persistent">"persistent"</a></code></dt>
                        <dd>Continue processing <var>sanitized response</var>, storing the license, key(s), or similar session data contained in <var>sanitized response</var> as permitted or instructed by the license.
                          Such data <em class="rfc2119" title="MUST">MUST</em> be stored such that only the <a href="http://www.w3.org/TR/html5/browsers.html#origin-0">origin</a> of this object's <a href="http://dom.spec.whatwg.org/#concept-document">Document</a> can access it.
                        </dd>
                        <dt>Otherwise</dt>
                        <dd>Reject <var>promise</var> with a new <code><a href="http://heycam.github.io/webidl/#dfn-DOMException">DOMException</a></code> whose name is <code><a href="#dfn-InvalidAccessError">InvalidAccessError</a></code>.</dd>
                      </dl>
                      <p>See also <a href="#session-storage">Session Storage and Persistence</a>.</p>
                      <div class="note"><div class="note-title" aria-level="2" role="heading" id="h_note_23"><span>Note</span></div><p class="">When <var>sanitized response</var> contains key(s) and/or related data, <var title="true">cdm</var> will likely cache the key and related data indexed by key ID.</p></div>
                      <div class="note"><div class="note-title" aria-level="2" role="heading" id="h_note_24"><span>Note</span></div><p class="">The replacement algorithm within a session is <a href="#key-system">Key System</a>-dependent.</p></div>
                      <p>Keys from different sessions <em class="rfc2119" title="SHOULD">SHOULD</em> be cached independently such that closing one session does not affect keys in other sessions, even if they have overlapping key IDs.</p>
                      <div class="note"><div class="note-title" aria-level="2" role="heading" id="h_note_25"><span>Note</span></div><p class="">It is <em class="rfc2119" title="RECOMMENDED">RECOMMENDED</em> that CDM implementations support a standard and reasonably high minimum number of keys per <code><a href="#idl-def-MediaKeySession">MediaKeySession</a></code> object, including a standard replacement algorithm, and a standard and reasonably high minimum number of <code><a href="#idl-def-MediaKeySession">MediaKeySession</a></code> objects.
                      This enables a reasonable number of key rotation algorithms to be implemented across user agents and may reduce the likelihood of playback interruptions in use cases that involve various streams in the same element (i.e. adaptive streams, various audio and video tracks) using different keys.
                      </p></div>
                    </li> 
                    <li><p>If the set of usable keys changed, run the <a href="#algorithms-keys-changed">usable keys changed algorithm</a> on the <var title="true">session</var>.</p>
                      <p>The algorithm <em class="rfc2119" title="MAY">MAY</em> also be run later should additional processing be necessary to determine with certainty whether one or more keys is usable.</p>
                    </li>
                    <li><p>If the expiration time for the session changed, run the <a href="#algorithms-update-expiration">update expiration algorithm</a> on the <var title="true">session</var>, providing the new expiration time.</p></li>
                    <li><p>If a message needs to be sent to the server, execute the following steps:</p>
                      <ol>
                        <li><p>Let <var title="true">message</var> be that message.</p></li>
                        <li><p>Let <var title="true">message type</var> be the appropriate <code><a href="#idl-def-MediaKeyMessageType">MediaKeyMessageType</a></code> for the message.</p></li>
                      </ol>
                    </li>
                  </ol>
                </li>
                <li><p>If any of the preceding steps failed, reject <var>promise</var> with a new <code><a href="http://heycam.github.io/webidl/#dfn-DOMException">DOMException</a></code> whose name is the appropriate <a href="#error-names">error name</a>.</p></li>
                <li><p>If <var title="true">message</var> is not null, run the <a href="#algorithms-queue-message">queue a "message" event algorithm</a> on the <var title="true">session</var>, providing <var title="true">message type</var> and <var title="true">message</var>.</p></li>
                <li><p>Resolve <var>promise</var>.</p></li>
              </ol>
            </li>
            <li><p>Return <var>promise</var>.</p></li>
          </ol></dd></dl></section>
  
      <section id="mediakeymessageevent">
        <h3 role="heading" id="h3_mediakeymessageevent"><span class="secno">5.3 </span><a href="#idl-def-MediaKeyMessageEvent" class="idlType"><code>MediaKeyMessageEvent</code></a></h3>
        <p>The MediaKeyMessageEvent object is used for the <code><a href="#dom-evt-message">message</a></code> event.</p>
        <p>Events are constructed as defined in <a href="http://dom.spec.whatwg.org/#constructing-events">Constructing events</a> [<cite><a class="bibref" href="#bib-DOM">DOM</a></cite>].</p>
  
        <pre class="idl"><span class="idlEnum" id="idl-def-MediaKeyMessageType">enum <span class="idlEnumID">MediaKeyMessageType</span> {
    "<a href="#idl-def-MediaKeyMessageType.licenserequest" class="idlEnumItem">licenserequest</a>",
    "<a href="#idl-def-MediaKeyMessageType.licenserenewal" class="idlEnumItem">licenserenewal</a>",
    "<a href="#idl-def-MediaKeyMessageType.licenserelease" class="idlEnumItem">licenserelease</a>"
};</span></pre><table class="simple"><tbody><tr><th colspan="2">Enumeration description</th></tr><tr><td><code id="idl-def-MediaKeyMessageType.licenserequest">licenserequest</code></td><td>The message contains a request for a new license.</td></tr><tr><td><code id="idl-def-MediaKeyMessageType.licenserenewal">licenserenewal</code></td><td>The message contains a request to renew an existing license.</td></tr><tr><td><code id="idl-def-MediaKeyMessageType.licenserelease">licenserelease</code></td><td>The message contains a proof of key release.</td></tr></tbody></table>
  
        <pre class="idl"><span class="idlInterface" id="idl-def-MediaKeyMessageEvent">[<span class="idlCtor"> <span class="idlCtorKeyword"></span><span class="idlCtorName"><a href="#widl-ctor-MediaKeyMessageEvent--DOMString-type-MediaKeyMessageEventInit-eventInitDict">Constructor</a></span> (<span class="idlParam"><span class="idlParamType">DOMString</span> <span class="idlParamName">type</span></span>, <span class="idlParam">optional <span class="idlParamType"><a href="#idl-def-MediaKeyMessageEventInit" class="idlType"><code>MediaKeyMessageEventInit</code></a></span> <span class="idlParamName">eventInitDict</span></span>)</span>]
interface <span class="idlInterfaceID">MediaKeyMessageEvent</span> : <span class="idlSuperclass">Event</span> {
<span class="idlAttribute">    readonly    attribute <span class="idlAttrType"><a href="#idl-def-MediaKeyMessageType" class="idlType"><code>MediaKeyMessageType</code></a></span> <span class="idlAttrName"><a href="#widl-MediaKeyMessageEvent-messageType">messageType</a></span>;</span>
<span class="idlAttribute">    readonly    attribute <span class="idlAttrType">ArrayBuffer</span>         <span class="idlAttrName"><a href="#widl-MediaKeyMessageEvent-message">message</a></span>;</span>
};</span></pre><section id="constructors"><h4 role="heading" id="h4_constructors"><span class="secno">5.3.1 </span>Constructors</h4><dl class="constructors"><dt id="widl-ctor-MediaKeyMessageEvent--DOMString-type-MediaKeyMessageEventInit-eventInitDict"><code>MediaKeyMessageEvent</code></dt><dd>
  
          <table class="parameters"><tbody><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">type</td><td class="prmType"><code>DOMString</code></td><td class="prmNullFalse"><span role="img" aria-label="False">✘</span></td><td class="prmOptFalse"><span role="img" aria-label="False">✘</span></td><td class="prmDesc"></td></tr><tr><td class="prmName">eventInitDict</td><td class="prmType"><code><a href="#idl-def-MediaKeyMessageEventInit" class="idlType"><code>MediaKeyMessageEventInit</code></a></code></td><td class="prmNullFalse"><span role="img" aria-label="False">✘</span></td><td class="prmOptTrue"><span role="img" aria-label="True">✔</span></td><td class="prmDesc"></td></tr></tbody></table></dd></dl></section><section id="attributes-2"><h4 role="heading" id="h4_attributes-2"><span class="secno">5.3.2 </span>Attributes</h4><dl class="attributes"><dt id="widl-MediaKeyMessageEvent-message"><code>message</code> of type <span class="idlAttrType">ArrayBuffer</span>, readonly   </dt><dd>
            The message from the CDM. Messages are Key System-specific.
          </dd><dt id="widl-MediaKeyMessageEvent-messageType"><code>messageType</code> of type <span class="idlAttrType"><a href="#idl-def-MediaKeyMessageType" class="idlType"><code>MediaKeyMessageType</code></a></span>, readonly   </dt><dd>
            The type of the message.
            <p>Implementations <em class="rfc2119" title="MUST NOT">MUST NOT</em> require applications to handle message types.
              Implementations <em class="rfc2119" title="MUST">MUST</em> support applications that do not differentiate messages and <em class="rfc2119" title="MUST NOT">MUST NOT</em> require that applications handle message types.
              Specifically, Key Systems <em class="rfc2119" title="MUST">MUST</em> support passing all types of messages to a single URL.
            </p>
            <div class="note"><div class="note-title" aria-level="3" role="heading" id="h_note_26"><span>Note</span></div><p class="">This attribute allows an application to differentiate messages without parsing the message.
              It is intended to enable optional application and/or server optimizations, but applications are not required to use it.
            </p></div>
          </dd></dl></section>
  
        <section id="mediakeymessageeventinit">
          <h4 role="heading" id="h4_mediakeymessageeventinit"><span class="secno">5.3.3 </span><a href="#idl-def-MediaKeyMessageEventInit" class="idlType"><code>MediaKeyMessageEventInit</code></a></h4>
          <pre class="idl"><span class="idlDictionary" id="idl-def-MediaKeyMessageEventInit">dictionary <span class="idlDictionaryID">MediaKeyMessageEventInit</span> : <span class="idlSuperclass">EventInit</span> {
<span class="idlMember">    <span class="idlMemberType"><a href="#idl-def-MediaKeyMessageType" class="idlType"><code>MediaKeyMessageType</code></a></span> <span class="idlMemberName"><a href="#widl-MediaKeyMessageEventInit-messageType">messageType</a></span> = <span class="idlMemberValue">"licenserequest"</span>;</span>
<span class="idlMember">    <span class="idlMemberType">ArrayBuffer</span>         <span class="idlMemberName"><a href="#widl-MediaKeyMessageEventInit-message">message</a></span> = <span class="idlMemberValue">ArrayBuffer()</span>;</span>
};</span></pre><section id="dictionary-mediakeymessageeventinit-members"><h5 role="heading" id="h5_dictionary-mediakeymessageeventinit-members"><span class="secno">5.3.3.1 </span>Dictionary <a class="idlType" href="#idl-def-MediaKeyMessageEventInit"><code>MediaKeyMessageEventInit</code></a> Members</h5><dl class="dictionary-members"><dt id="widl-MediaKeyMessageEventInit-message"><code>message</code> of type <span class="idlMemberType">ArrayBuffer</span>, defaulting to <code>ArrayBuffer()</code></dt><dd>
              The message.
            </dd><dt id="widl-MediaKeyMessageEventInit-messageType"><code>messageType</code> of type <span class="idlMemberType"><a href="#idl-def-MediaKeyMessageType" class="idlType"><code>MediaKeyMessageType</code></a></span>, defaulting to <code>"licenserequest"</code></dt><dd>
              The type of the message.
            </dd></dl></section>
        </section>
      </section>
  
      <section id="mediakeysession-events" class="informative" typeof="bibo:Chapter" resource="#mediakeysession-events" rel="bibo:Chapter">
        <h3 role="heading" id="h3_mediakeysession-events"><span class="secno">5.4 </span>Event Summary</h3><p><em>This section is non-normative.</em></p>
    
        <div class="note"><div class="note-title" aria-level="2" role="heading" id="h_note_27"><span>Note</span></div><p class="">In some implementations, <code><a href="#idl-def-MediaKeySession">MediaKeySession</a></code> objects may not fire any events until the <code><a href="#idl-def-MediaKeys">MediaKeys</a></code> object is associated with a media element using <code><a href="#widl-HTMLMediaElement-setMediaKeys-Promise-void--MediaKeys-mediaKeys">setMediaKeys()</a></code>.</p></div>
    
        <table class="old-table">
          <thead>
            <tr>
              <th>Event name</th>
              <th>Interface</th>
              <th>Dispatched when...</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><dfn id="dom-evt-keyschange"><code>keyschange</code></dfn></td>
              <td><code><a href="http://dom.spec.whatwg.org/#event">Event</a></code></td>
              <td>There has been a change in usable keys in the session.</td>
            </tr>
            <tr>
              <td><dfn id="dom-evt-message"><code>message</code></dfn></td>
              <td><a href="#idl-def-MediaKeyMessageEvent" class="idlType"><code>MediaKeyMessageEvent</code></a></td>
              <td>The CDM has generated a message for the session.</td>
            </tr>
          </tbody>
        </table>
      </section>
  
      <section id="mediakeysession-algorithms" typeof="bibo:Chapter" resource="#mediakeysession-algorithms" rel="bibo:Chapter">
        <h3 role="heading" id="h3_mediakeysession-algorithms"><span class="secno">5.5 </span>Algorithms</h3>
    
        <section id="algorithms-queue-message" typeof="bibo:Chapter" resource="#algorithms-queue-message" rel="bibo:Chapter">
          <h4 role="heading" id="h4_algorithms-queue-message"><span class="secno">5.5.1 </span>Queue a "message" Event</h4>
          <p>The Queue a "message" Event algorithm is run when the CDM needs to queue a message event to a <code><a href="#idl-def-MediaKeySession">MediaKeySession</a></code> object.
          Requests to run this algorithm include a target <code><a href="#idl-def-MediaKeySession">MediaKeySession</a></code> object, a <var title="true">message type</var>, and a <var title="true">message</var>.
          </p>
          <p>The following steps are run:</p>
          <ol>
            <li><p>Let the <var title="true">session</var> be the specified <code><a href="#idl-def-MediaKeySession">MediaKeySession</a></code> object.</p></li>
            <li>
              <p><a href="http://www.w3.org/TR/html5/webappapis.html#queue-a-task">Queue a task</a> to <a href="http://www.w3.org/TR/html5/webappapis.html#fire-a-simple-event">fire a simple event</a> named <code><a href="#dom-evt-message">message</a></code> at the <var title="true">session</var>.</p>
              <p>The event is of type <code><a href="#idl-def-MediaKeyMessageEvent">MediaKeyMessageEvent</a></code> and has:</p>
              <ul style="list-style-type:none"><li>
                <code><a href="#widl-MediaKeyMessageEvent-messageType">messageType</a></code> = the specified <var title="true">message type</var><br><br>
                <code><a href="#widl-MediaKeyMessageEvent-message">message</a></code> = the specified <var title="true">message</var>
              </li></ul>
            </li>
          </ol>
        </section>
    
        <section id="algorithms-keys-changed" typeof="bibo:Chapter" resource="#algorithms-keys-changed" rel="bibo:Chapter">
          <h4 role="heading" id="h4_algorithms-keys-changed"><span class="secno">5.5.2 </span>Usable Keys Changed</h4>
          <p>The Usable Keys Changed algorithm is run when the CDM changes the set of keys in the session that may be used for decryption.
          This can happen as the result of an <code><a href="#widl-MediaKeySession-update-Promise-void--BufferSource-response">update()</a></code> call or some other event.
          Requests to run this algorithm include a target <code><a href="#idl-def-MediaKeySession">MediaKeySession</a></code> object.
          </p>
          <p>The following steps are run:</p>
          <ol>
            <li><p>Let the <var title="true">session</var> be the associated <code><a href="#idl-def-MediaKeySession">MediaKeySession</a></code> object.</p></li>
            <li><p><a href="http://www.w3.org/TR/html5/webappapis.html#queue-a-task">Queue a task</a> to <a href="http://www.w3.org/TR/html5/webappapis.html#fire-a-simple-event">fire a simple event</a> named <code><a href="#dom-evt-keyschange">keyschange</a></code> at the <var title="true">session</var>.</p></li>
            <li><p><a href="http://www.w3.org/TR/html5/webappapis.html#queue-a-task">Queue a task</a> to run the <a href="#algorithms-resume-playback">attempt to resume playback if necessary algorithm</a> on each of the media element(s) whose <code><a href="#widl-HTMLMediaElement-mediaKeys">mediaKeys</a></code> attribute is the MediaKeys object that created the <var title="true">session</var>.</p>
              <p>The user agent <em class="rfc2119" title="MAY">MAY</em> choose to skip this step if it knows resuming will fail.</p>
              <div class="note"><div class="note-title" aria-level="3" role="heading" id="h_note_28"><span>Note</span></div><p class="">For example, the user agent may skip this step if no additional keys became available.</p></div>
            </li>
          </ol>
        </section>
    
        <section id="algorithms-update-expiration" typeof="bibo:Chapter" resource="#algorithms-update-expiration" rel="bibo:Chapter">
          <h4 role="heading" id="h4_algorithms-update-expiration"><span class="secno">5.5.3 </span>Update Expiration</h4>
          <p>The Update Expiration algorithm is run when the CDM changes the expiration time of a session.
          This can happen as the result of an <code><a href="#widl-MediaKeySession-update-Promise-void--BufferSource-response">update()</a></code> call or some other event.
          Requests to run this algorithm include a target <code><a href="#idl-def-MediaKeySession">MediaKeySession</a></code> object and the new expiration time, which may be <code>NaN</code>.
          </p>
          <p>The following steps are run:</p>
          <ol>
            <li><p>Let the <var title="true">session</var> be the associated <code><a href="#idl-def-MediaKeySession">MediaKeySession</a></code> object.</p></li>
            <li><p>Let <var title="true">expiration time</var> be <code>NaN</code>.</p></li>
            <li><p>If the new expiration time is not <code>NaN</code>, let <var title="true">expiration time</var> be the new expiration time in milliseconds since 01 January 1970 UTC.</p></li>
            <li><p>Set the <var title="true">session</var>'s <code><a href="#widl-MediaKeySession-expiration">expiration</a></code> attribute to <var title="true">expiration time</var>.</p></li>
          </ol>
        </section>
    
        <section id="algorithms-session-close" typeof="bibo:Chapter" resource="#algorithms-session-close" rel="bibo:Chapter">
          <h4 role="heading" id="h4_algorithms-session-close"><span class="secno">5.5.4 </span>Session Close</h4>
          <p>The Session Close algorithm is run when the CDM closes the session associated with a <code><a href="#idl-def-MediaKeySession">MediaKeySession</a></code> object.</p>
          <div class="note"><div class="note-title" aria-level="3" role="heading" id="h_note_29"><span>Note</span></div><p class="">The CDM may close a session at any point, such as in response to a <code><a href="#widl-MediaKeySession-close-Promise-void">close()</a></code> call, when the session is no longer needed, or when system resources are lost.
          Keys in other sessions <em class="rfc2119" title="SHOULD">SHOULD</em> be unaffected, even if they have overlapping key IDs.
          </p></div>
          <p>The following steps are run:</p>
          <ol>
            <li><p>Let the <var title="true">session</var> be the associated <code><a href="#idl-def-MediaKeySession">MediaKeySession</a></code> object.</p></li>
            <li><p>Let <var title="true">media keys</var> be the <code><a href="#idl-def-MediaKeys">MediaKeys</a></code> object that created this object.</p></li>
            <li><p>Let <var>promise</var> be the <code><a href="#widl-MediaKeySession-closed">closed</a></code> attribute of the <var title="true">session</var>.</p></li>
            <li><p>Resolve <var>promise</var>.</p></li>
          </ol>
        </section>
      </section>
  
      <section id="exceptions">
        <h3 role="heading" id="h3_exceptions"><span class="secno">5.6 </span>Exceptions</h3>
        <p id="error-names">The methods report errors by rejecting the returned promise with a <code><a href="http://heycam.github.io/webidl/#dfn-DOMException">DOMException</a></code>.
        The following <a href="http://heycam.github.io/webidl/#idl-DOMException-error-names">DOMException names from WebIDL</a> [<cite><a class="bibref" href="#bib-WebIDL">WebIDL</a></cite>] are used in the algorithms.
        Causes specified specified in the algorithms are listed alongside each name, though these names <em class="rfc2119" title="MAY">MAY</em> be used for other reasons as well.
        </p>
    
        <table class="old-table">
          <tbody>
            <tr>
              <th>Name</th>
              <th>Possible Causes (non-exhaustive)</th>
            </tr>
            <tr>
              <td><dfn id="dfn-NotSupportedError"><code>NotSupportedError</code></dfn></td>
              <td>
                The existing MediaKeys object cannot be removed.<br>
                The key system is not supported.<br>
                The key system is not supported on insecure origins.<br>
                The initialization data type is not supported by the key system.<br>
                The session type is not supported by the key system.<br>
                The initialization data is not supported by the key system.<br>
                The operation is not supported by the key system.
              </td>
            </tr>
            <tr>
              <td><dfn id="dfn-InvalidStateError"><code>InvalidStateError</code></dfn></td>
              <td>The existing MediaKeys object cannot be removed at this time.<br>
                The session has already been used.<br>
                The session is not yet initialized.<br>
                The session is closed.
              </td>
            </tr>
            <tr>
              <td><dfn id="dfn-InvalidAccessError"><code>InvalidAccessError</code></dfn></td>
              <td>
                The parameter is empty.<br>
                Invalid initialization data.<br>
                The operation is not supported on sessions of this type.<br>
                Invalid response format.<br>
                A persistent license was provided for a "temporary" session.
              </td>
            </tr>
            <tr>
              <td><dfn id="dfn-QuotaExceededError"><code>QuotaExceededError</code></dfn></td>
              <td>The MediaKeys object cannot be used with additional HTMLMediaElements.<br>
                A non-closed session already exists for this sessionId.
              </td>
            </tr>
          </tbody>
        </table>
      </section>
  
      <section id="session-storage" typeof="bibo:Chapter" resource="#session-storage" rel="bibo:Chapter">
        <h3 role="heading" id="h3_session-storage"><span class="secno">5.7 </span>Session Storage and Persistence</h3>
        <p>This section provides an overview of session stroage and persistence that complements the algorithms.</p>
        <p>If this object's <var title="true">session type</var> is not <code><a href="#idl-def-SessionType.persistent">"persistent"</a></code>, the user agent and CDM <em class="rfc2119" title="MUST NOT">MUST NOT</em> persist a record of or data related to the session at any point.
          This includes license(s), key(s), and the <a href="#session-id">Session ID</a>.
        </p>
        <p>The remainder of this section applies to <code><a href="#idl-def-SessionType.persistent">"persistent"</a></code> sessions, which are <em class="rfc2119" title="OPTIONAL">OPTIONAL</em> for implementatations to support.</p>
        <p>Persisted data <em class="rfc2119" title="MUST">MUST</em> always be stored such that only the <a href="http://www.w3.org/TR/html5/browsers.html#origin-0">origin</a> of this object's <a href="http://dom.spec.whatwg.org/#concept-document">Document</a> can access it.
          In addition, the data <em class="rfc2119" title="MUST">MUST</em> only be accessible by the current profile of this user agent - other user agent profiles, user agents, and applications <em class="rfc2119" title="MUST NOT">MUST NOT</em> be able to access the stored data.
        </p>
        <p>The CDM <em class="rfc2119" title="SHOULD NOT">SHOULD NOT</em> store session data, including the Session ID, until <code><a href="#widl-MediaKeySession-update-Promise-void--BufferSource-response">update()</a></code> is called the first time.
          Specifically, the CDM <em class="rfc2119" title="SHOULD NOT">SHOULD NOT</em> store session data during the <code><a href="#widl-MediaKeySession-generateRequest-Promise-void--DOMString-initDataType-BufferSource-initData">generateRequest()</a></code> algorithm.
          This ensures that the application is aware of the session and knows it needs to eventually remove it.
        </p>
        <p>The CDM <em class="rfc2119" title="MUST">MUST</em> ensure that data for a given session is only present in one active unclosed session in any <a href="http://dom.spec.whatwg.org/#concept-document">Document</a>.
          In other words, <code><a href="#widl-MediaKeySession-load-Promise-boolean--DOMString-sessionId">load()</a></code> <em class="rfc2119" title="MUST">MUST</em> fail when there is already a <code><a href="#idl-def-MediaKeySession">MediaKeySession</a></code> representing the session specified by the <var title="true">sessionId</var> parameter, either because the object that created it via <code><a href="#widl-MediaKeySession-generateRequest-Promise-void--DOMString-initDataType-BufferSource-initData">generateRequest()</a></code> is still active or it has been loaded into another object via <code><a href="#widl-MediaKeySession-load-Promise-boolean--DOMString-sessionId">load()</a></code>.
          A session <em class="rfc2119" title="MAY">MAY</em> only be loaded again after the <a href="#algorithms-session-close">session close algorithm</a> has not been run on the object representing it.
        </p>
        <p>An application that creates a <code><a href="#idl-def-SessionType.persistent">"persistent"</a></code> session <em class="rfc2119" title="SHOULD">SHOULD</em> later remove the stored data using <code><a href="#widl-MediaKeySession-remove-Promise-void">remove()</a></code>.
          The CDM <em class="rfc2119" title="MAY">MAY</em> also remove sessions as appropriate, but applications <em class="rfc2119" title="SHOULD NOT">SHOULD NOT</em> rely on this.
        </p>
        <div class="note"><div class="note-title" aria-level="2" role="heading" id="h_note_30"><span>Note</span></div><p class="">See the <a href="#security">Security Considerations</a> and <a href="#privacy">Privacy Considerations</a> sections for additional considerations when supporting persistent storage.</p></div>
      </section>
    </section>


    <section id="htmlmediaelement-extensions">
      <!--OddPage--><h2 role="heading" id="h2_htmlmediaelement-extensions"><span class="secno">6. </span><a href="#idl-def-HTMLMediaElement" class="idlType"><code>HTMLMediaElement</code></a> Extensions</h2>
      <p>This section specifies additions to and modifications of the <code><a href="http://www.w3.org/TR/html5/embedded-content-0.html#htmlmediaelement">HTMLMediaElement</a></code> [<cite><a class="bibref" href="#bib-HTML5">HTML5</a></cite>] when the Encrypted Media Extensions are supported.</p>
  
      <p>For methods that return a promise, all errors are reported asynchronously by rejecting the returned Promise. This includes [<cite><a class="bibref" href="#bib-WebIDL">WebIDL</a></cite>] type mapping errors.</p>
      <p>The steps of an algorithm are always aborted when resolving or rejecting a promise.</p>
  
      <pre class="idl"><span class="idlEnum" id="idl-def-MediaWaitingFor">enum <span class="idlEnumID">MediaWaitingFor</span> {
    "<a href="#idl-def-MediaWaitingFor.none" class="idlEnumItem">none</a>",
    "<a href="#idl-def-MediaWaitingFor.data" class="idlEnumItem">data</a>",
    "<a href="#idl-def-MediaWaitingFor.key" class="idlEnumItem">key</a>"
};</span></pre><table class="simple"><tbody><tr><th colspan="2">Enumeration description</th></tr><tr><td><code id="idl-def-MediaWaitingFor.none">none</code></td><td>
          The media element is not waiting for anything.
        </td></tr><tr><td><code id="idl-def-MediaWaitingFor.data">data</code></td><td>
          The media element is not waiting for data.
        </td></tr><tr><td><code id="idl-def-MediaWaitingFor.key">key</code></td><td>
          The media element is not waiting for a key.
        </td></tr></tbody></table>

      <pre class="idl"><span class="idlInterface" id="idl-def-HTMLMediaElement">partial interface <span class="idlInterfaceID">HTMLMediaElement</span> : <span class="idlSuperclass">EventTarget</span> {
<span class="idlAttribute">    readonly    attribute <span class="idlAttrType"><a href="#idl-def-MediaKeys" class="idlType"><code>MediaKeys</code></a>?</span>      <span class="idlAttrName"><a href="#widl-HTMLMediaElement-mediaKeys">mediaKeys</a></span>;</span>
<span class="idlAttribute">    readonly    attribute <span class="idlAttrType"><a href="#idl-def-MediaWaitingFor" class="idlType"><code>MediaWaitingFor</code></a></span> <span class="idlAttrName"><a href="#widl-HTMLMediaElement-waitingFor">waitingFor</a></span>;</span>
<span class="idlAttribute">                attribute <span class="idlAttrType">EventHandler</span>    <span class="idlAttrName"><a href="#widl-HTMLMediaElement-onencrypted">onencrypted</a></span>;</span>
<span class="idlMethod">    <span class="idlMethType">Promise&lt;void&gt;</span> <span class="idlMethName"><a href="#widl-HTMLMediaElement-setMediaKeys-Promise-void--MediaKeys-mediaKeys">setMediaKeys</a></span> (<span class="idlParam"><span class="idlParamType"><a href="#idl-def-MediaKeys" class="idlType"><code>MediaKeys</code></a>?</span> <span class="idlParamName">mediaKeys</span></span>);</span>
};</span></pre><section id="attributes-3"><h3 role="heading" id="h3_attributes-3"><span class="secno">6.1 </span>Attributes</h3><dl class="attributes"><dt id="widl-HTMLMediaElement-mediaKeys"><code>mediaKeys</code> of type <span class="idlAttrType"><a href="#idl-def-MediaKeys" class="idlType"><code>MediaKeys</code></a></span>, readonly   , nullable</dt><dd>
          <p>The <code><a href="#idl-def-MediaKeys">MediaKeys</a></code> being used when decrypting encrypted <a href="http://www.w3.org/TR/html5/embedded-content-0.html#media-data">media data</a> for this media element.</p>
        </dd><dt id="widl-HTMLMediaElement-onencrypted"><code>onencrypted</code> of type <span class="idlAttrType">EventHandler</span>,            </dt><dd>
          <p>Event handler for the <code><a href="#dom-evt-encrypted">encrypted</a></code> event <em class="rfc2119" title="MUST">MUST</em> be supported by all HTMLMediaElements as both a content attribute and an IDL attribute.</p>
        </dd><dt id="widl-HTMLMediaElement-waitingFor"><code>waitingFor</code> of type <span class="idlAttrType"><a href="#idl-def-MediaWaitingFor" class="idlType"><code>MediaWaitingFor</code></a></span>, readonly   </dt><dd>
          <p>Indicates what the media element is waiting for, if anything (indicated by the <code><a href="http://www.w3.org/TR/html5/embedded-content-0.html#event-media-waiting">waiting</a></code> and <code><a href="http://www.w3.org/TR/html5/embedded-content-0.html#event-media-canplay">canplay</a></code> events). This is described in the <a href="#algorithms-encrypted-block">encrypted block encountered algorithm</a>.</p>
        </dd></dl></section><section id="methods-4"><h3 role="heading" id="h3_methods-4"><span class="secno">6.2 </span>Methods</h3><dl class="methods"><dt id="widl-HTMLMediaElement-setMediaKeys-Promise-void--MediaKeys-mediaKeys"><code>setMediaKeys</code></dt><dd>
          <p>Provides the <code><a href="#idl-def-MediaKeys">MediaKeys</a></code> to use when decrypting media data during playback.</p>

          

          
          
          <div class="note"><div class="note-title" aria-level="2" role="heading" id="h_note_33"><span>Note</span></div><p class="">Support for clearing or replacing the associated <code><a href="#idl-def-MediaKeys">MediaKeys</a></code> object during playback is a quality of implementation issue. In many cases it will result in a bad user experience or rejected promise.</p></div>
          <div class="note"><div class="note-title" aria-level="2" role="heading" id="h_note_34"><span>Note</span></div><p class="">As a best practice, applications should create a MediaKeys object and call <code><a href="#widl-HTMLMediaElement-setMediaKeys-Promise-void--MediaKeys-mediaKeys">setMediaKeys()</a></code> before providing <a href="http://www.w3.org/TR/html5/embedded-content-0.html#media-data">media data</a> (for example, setting the <code><a href="http://www.w3.org/TR/html5/embedded-content-0.html#attr-media-src">src</a></code> attribute). This avoids potential delays in some implementations.</p></div>
        <table class="parameters"><tbody><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">mediaKeys</td><td class="prmType"><code><a href="#idl-def-MediaKeys" class="idlType"><code>MediaKeys</code></a></code></td><td class="prmNullTrue"><span role="img" aria-label="True">✔</span></td><td class="prmOptFalse"><span role="img" aria-label="False">✘</span></td><td class="prmDesc">
              A <code><a href="#idl-def-MediaKeys">MediaKeys</a></code> object.
            </td></tr></tbody></table><div><em>Return type: </em><code>Promise&lt;void&gt;</code></div><p>When this method is invoked, the user agent must run the following steps:</p><ol class="method-algorithm">
            <!-- For simplicity and consistency, do not allow multiple pending calls. -->
            <li><p>If <var>mediaKeys</var> and the <code><a href="#widl-HTMLMediaElement-mediaKeys">mediaKeys</a></code> attribute are the same object, return a resolved promise.</p></li>
            <li><p>If this object's <var title="true">attaching media keys</var> value is true, return a promise rejected with a new <code><a href="http://heycam.github.io/webidl/#dfn-DOMException">DOMException</a></code> whose name is <code><a href="#dfn-InvalidStateError">InvalidStateError</a></code>.</p></li>
            <li><p>Let this object's <var title="true">attaching media keys</var> value be true.</p></li>
            <li><p>Let <var>promise</var> be a new promise.</p></li>
            <li><p>Run the following steps asynchronously:</p>
              <ol>
                <li><p>If <var>mediaKeys</var> is not null, it is already in use by another media element, and the user agent is unable to use it with this element, let this object's <var title="true">attaching media keys</var> value be false and reject <var>promise</var> with a new <code><a href="http://heycam.github.io/webidl/#dfn-DOMException">DOMException</a></code> whose name is <code><a href="#dfn-QuotaExceededError">QuotaExceededError</a></code>.</p></li>
                <li><p>If the <code><a href="#widl-HTMLMediaElement-mediaKeys">mediaKeys</a></code> attribute is not null, run the following steps:</p>
                  <ol>
                    <li><p>If the user agent or CDM do not support removing the association, let this object's <var title="true">attaching media keys</var> value be false and reject <var>promise</var> with a new <code><a href="http://heycam.github.io/webidl/#dfn-DOMException">DOMException</a></code> whose name is <code><a href="#dfn-NotSupportedError">NotSupportedError</a></code>.</p></li>
                    <li><p>If the association cannot currently be removed, let this object's <var title="true">attaching media keys</var> value be false and reject <var>promise</var> with a new <code><a href="http://heycam.github.io/webidl/#dfn-DOMException">DOMException</a></code> whose name is <code><a href="#dfn-InvalidStateError">InvalidStateError</a></code>.</p>
                      <div class="note"><div class="note-title" aria-level="2" role="heading" id="h_note_31"><span>Note</span></div><p class="">For example, some implementations may not allow removal during playback.</p></div>
                    </li>
                    <li><p>Stop using the CDM instance represented by the <code><a href="#widl-HTMLMediaElement-mediaKeys">mediaKeys</a></code> attribute to decrypt <a href="http://www.w3.org/TR/html5/embedded-content-0.html#media-data">media data</a> and remove the association with the media element.</p></li>
                    <li><p>If the preceding step failed, let this object's <var title="true">attaching media keys</var> value be false and reject <var>promise</var> with a new <code><a href="http://heycam.github.io/webidl/#dfn-DOMException">DOMException</a></code> whose name is the appropriate <a href="#error-names">error name</a>.</p></li>
                  </ol>
                </li>
                <li><p>If <var>mediaKeys</var> is not null, run the following steps:</p>
                  <ol>
                    <li><p>Associate the CDM instance represented by <var>mediaKeys</var> with the media element for decrypting <a href="http://www.w3.org/TR/html5/embedded-content-0.html#media-data">media data</a>.</p></li>
                    <li><p>If the preceding step failed, run the following steps:</p>
                      <ol>
                        <li><p>Set the <code><a href="#widl-HTMLMediaElement-mediaKeys">mediaKeys</a></code> attribute to null.</p></li><!-- In case it was previously not null since the previous association has been removed. -->
                        <li><p>Let this object's <var title="true">attaching media keys</var> value be false.</p></li>
                        <li><p>Reject <var>promise</var> with a new <code><a href="http://heycam.github.io/webidl/#dfn-DOMException">DOMException</a></code> whose name is the appropriate <a href="#error-names">error name</a>.</p></li>
                      </ol>
                    </li>
                    <li><p><a href="http://www.w3.org/TR/html5/webappapis.html#queue-a-task">Queue a task</a> to run the <a href="#algorithms-resume-playback">attempt to resume playback if necessary algorithm</a> on the media element.</p>
                      <p>The user agent <em class="rfc2119" title="MAY">MAY</em> choose to skip this step if it knows resuming will fail.</p><p>
                      </p><div class="note"><div class="note-title" aria-level="2" role="heading" id="h_note_32"><span>Note</span></div><p class="">For example, the user agent may skip this step if <var>mediaKeys</var> has no sessions.</p></div>
                    </li>
                  </ol>
                </li>
                <li><p>Set the <code><a href="#widl-HTMLMediaElement-mediaKeys">mediaKeys</a></code> attribute to <var>mediaKeys</var>.</p></li>
                <li><p>Let this object's <var title="true">attaching media keys</var> value be false.</p></li>
                <li><p>Resolve <var>promise</var>.</p></li>
              </ol>
            </li>
            <li><p>Return <var>promise</var>.</p></li>
          </ol></dd></dl></section>
  
      <section id="mediaencryptedevent">
        <h3 role="heading" id="h3_mediaencryptedevent"><span class="secno">6.3 </span><a href="#idl-def-MediaEncryptedEvent" class="idlType"><code>MediaEncryptedEvent</code></a></h3>
        <p>The MediaEncryptedEvent object is used for the <code><a href="#dom-evt-encrypted">encrypted</a></code> event.</p>
        <p>Events are constructed as defined in <a href="http://dom.spec.whatwg.org/#constructing-events">Constructing events</a> [<cite><a class="bibref" href="#bib-DOM">DOM</a></cite>].</p>
  
        <pre class="idl"><span class="idlInterface" id="idl-def-MediaEncryptedEvent">[<span class="idlCtor"> <span class="idlCtorKeyword"></span><span class="idlCtorName"><a href="#widl-ctor-MediaEncryptedEvent--DOMString-type-MediaEncryptedEventInit-eventInitDict">Constructor</a></span> (<span class="idlParam"><span class="idlParamType">DOMString</span> <span class="idlParamName">type</span></span>, <span class="idlParam">optional <span class="idlParamType"><a href="#idl-def-MediaEncryptedEventInit" class="idlType"><code>MediaEncryptedEventInit</code></a></span> <span class="idlParamName">eventInitDict</span></span>)</span>]
interface <span class="idlInterfaceID">MediaEncryptedEvent</span> : <span class="idlSuperclass">Event</span> {
<span class="idlAttribute">    readonly    attribute <span class="idlAttrType">DOMString</span>    <span class="idlAttrName"><a href="#widl-MediaEncryptedEvent-initDataType">initDataType</a></span>;</span>
<span class="idlAttribute">    readonly    attribute <span class="idlAttrType">ArrayBuffer?</span> <span class="idlAttrName"><a href="#widl-MediaEncryptedEvent-initData">initData</a></span>;</span>
};</span></pre><section id="constructors-1"><h4 role="heading" id="h4_constructors-1"><span class="secno">6.3.1 </span>Constructors</h4><dl class="constructors"><dt id="widl-ctor-MediaEncryptedEvent--DOMString-type-MediaEncryptedEventInit-eventInitDict"><code>MediaEncryptedEvent</code></dt><dd>
  
          <table class="parameters"><tbody><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">type</td><td class="prmType"><code>DOMString</code></td><td class="prmNullFalse"><span role="img" aria-label="False">✘</span></td><td class="prmOptFalse"><span role="img" aria-label="False">✘</span></td><td class="prmDesc"></td></tr><tr><td class="prmName">eventInitDict</td><td class="prmType"><code><a href="#idl-def-MediaEncryptedEventInit" class="idlType"><code>MediaEncryptedEventInit</code></a></code></td><td class="prmNullFalse"><span role="img" aria-label="False">✘</span></td><td class="prmOptTrue"><span role="img" aria-label="True">✔</span></td><td class="prmDesc"></td></tr></tbody></table></dd></dl></section><section id="attributes-4"><h4 role="heading" id="h4_attributes-4"><span class="secno">6.3.2 </span>Attributes</h4><dl class="attributes"><dt id="widl-MediaEncryptedEvent-initData"><code>initData</code> of type <span class="idlAttrType">ArrayBuffer</span>, readonly   , nullable</dt><dd>
            The <a href="#initialization-data">Initialization Data</a> for the event.
          </dd><dt id="widl-MediaEncryptedEvent-initDataType"><code>initDataType</code> of type <span class="idlAttrType">DOMString</span>, readonly   </dt><dd>
            Indicates the <a href="#initialization-data-type">Initialization Data Type</a> of the <a href="#initialization-data">Initialization Data</a> contained in the <code><a href="#widl-MediaEncryptedEventInit-initData">initData</a></code> attribute.
          </dd></dl></section>
  
        <section id="mediaencryptedeventinit">
          <h4 role="heading" id="h4_mediaencryptedeventinit"><span class="secno">6.3.3 </span><a href="#idl-def-MediaEncryptedEventInit" class="idlType"><code>MediaEncryptedEventInit</code></a></h4>
          <pre class="idl"><span class="idlDictionary" id="idl-def-MediaEncryptedEventInit">dictionary <span class="idlDictionaryID">MediaEncryptedEventInit</span> : <span class="idlSuperclass">EventInit</span> {
<span class="idlMember">    <span class="idlMemberType">DOMString</span>    <span class="idlMemberName"><a href="#widl-MediaEncryptedEventInit-initDataType">initDataType</a></span> = <span class="idlMemberValue">""</span>;</span>
<span class="idlMember">    <span class="idlMemberType">ArrayBuffer?</span> <span class="idlMemberName"><a href="#widl-MediaEncryptedEventInit-initData">initData</a></span> = <span class="idlMemberValue">null</span>;</span>
};</span></pre><section id="dictionary-mediaencryptedeventinit-members"><h5 role="heading" id="h5_dictionary-mediaencryptedeventinit-members"><span class="secno">6.3.3.1 </span>Dictionary <a class="idlType" href="#idl-def-MediaEncryptedEventInit"><code>MediaEncryptedEventInit</code></a> Members</h5><dl class="dictionary-members"><dt id="widl-MediaEncryptedEventInit-initData"><code>initData</code> of type <span class="idlMemberType">ArrayBuffer</span>, nullable, defaulting to <code>null</code></dt><dd>
              The <a href="#initialization-data">Initialization Data</a>.
            </dd><dt id="widl-MediaEncryptedEventInit-initDataType"><code>initDataType</code> of type <span class="idlMemberType">DOMString</span>, defaulting to <code>""</code></dt><dd>
              The <a href="#initialization-data-type">Initialization Data Type</a>.
            </dd></dl></section>
        </section>
      </section>
  
      <section id="htmlmediaelement-events" class="informative" typeof="bibo:Chapter" resource="#htmlmediaelement-events" rel="bibo:Chapter">
        <h3 role="heading" id="h3_htmlmediaelement-events"><span class="secno">6.4 </span>Event Summary</h3><p><em>This section is non-normative.</em></p>
    
        <table class="old-table">
          <thead>
            <tr>
              <th>Event name</th>
              <th>Interface</th>
              <th>Dispatched when...</th>
              <th>Preconditions</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><dfn id="dom-evt-encrypted"><code>encrypted</code></dfn></td>
              <td><a href="#idl-def-MediaEncryptedEvent" class="idlType"><code>MediaEncryptedEvent</code></a></td>
              <td>The user agent encounters <a href="#initialization-data">Initialization Data</a> in the <a href="http://www.w3.org/TR/html5/embedded-content-0.html#media-data">media data</a>.</td>
              <td><code><a href="http://www.w3.org/TR/html5/embedded-content-0.html#dom-media-readystate">readyState</a></code> is equal to <code><a href="http://www.w3.org/TR/html5/embedded-content-0.html#dom-media-have_metadata">HAVE_METADATA</a></code> or greater.
              <div class="note"><div class="note-title" aria-level="2" role="heading" id="h_note_35"><span>Note</span></div><p class="">It is possible that the element is playing or has played.</p></div>
              </td>
            </tr>
          </tbody>
        </table>
      </section>
  
      <section id="htmlmediaelement-algorithms" typeof="bibo:Chapter" resource="#htmlmediaelement-algorithms" rel="bibo:Chapter">
        <h3 role="heading" id="h3_htmlmediaelement-algorithms"><span class="secno">6.5 </span>Algorithms</h3>
    
        <section id="algorithms-initdata-encountered" typeof="bibo:Chapter" resource="#algorithms-initdata-encountered" rel="bibo:Chapter">
          <h4 role="heading" id="h4_algorithms-initdata-encountered"><span class="secno">6.5.1 </span>Initialization Data Encountered</h4>
          <p>The following steps are run when the media element encounters <a href="#initialization-data">Initialization Data</a> in the <a href="http://www.w3.org/TR/html5/embedded-content-0.html#media-data">media data</a> during the <a href="http://www.w3.org/TR/html5/embedded-content-0.html#concept-media-load-resource">resource fetch algorithm</a>:</p>
      
          <ol>
            <li><p>Let <var title="">initDataType</var> be the empty string.</p></li>
            <li><p>Let <var title="">initData</var> be null.</p></li>
            <li>
              <p>If the <a href="http://www.w3.org/TR/html5/embedded-content-0.html#media-data">media data</a> is <a href="http://www.w3.org/TR/html5/infrastructure.html#cors-same-origin">CORS-same-origin</a> and <em>not</em> <a href="#mixed-content">mixed content</a>, run the following steps:</p>
              <ol>
                <li><p>Let <var title="">initDataType</var> be the string representing the <a href="#initialization-data-type">Initialization Data Type</a> of the Initialization Data.</p></li>
                <li><p>Let <var title="">initData</var> be the Initialization Data.</p></li>
              </ol>
              <div class="note"><div class="note-title" aria-level="3" role="heading" id="h_note_36"><span>Note</span></div><p class="">While the media element may allow loading of "Optionally-blockable Content" [<cite><a class="bibref" href="#bib-MIXED-CONTENT">MIXED-CONTENT</a></cite>], the user agent <em class="rfc2119" title="MUST NOT">MUST NOT</em> expose Initialization Data from such media data to the application.</p></div>
            </li>
            <li>
              <p><a href="http://www.w3.org/TR/html5/webappapis.html#queue-a-task">Queue a task</a> to <a href="http://www.w3.org/TR/html5/webappapis.html#fire-a-simple-event">fire a simple event</a> named <code><a href="#dom-evt-encrypted">encrypted</a></code> at the media element.</p>
              <p>The event is of type <code><a href="#idl-def-MediaEncryptedEvent">MediaEncryptedEvent</a></code> and has:</p>
              <ul style="list-style-type:none"><li>
                <code><a href="#widl-MediaEncryptedEventInit-initDataType">initDataType</a></code> = <var title="">initDataType</var><br><br>
                <code><a href="#widl-MediaEncryptedEventInit-initData">initData</a></code> = <var title="">initData</var>
              </li></ul>
              <div class="note"><div class="note-title" aria-level="3" role="heading" id="h_note_37"><span>Note</span></div><p class=""><code><a href="http://www.w3.org/TR/html5/embedded-content-0.html#dom-media-readystate">readyState</a></code> is <em>not</em> changed and no algorithms are aborted. This event merely provides information.</p></div>
              <div class="note"><div class="note-title" aria-level="3" role="heading" id="h_note_38"><span>Note</span></div><p class="">The <code><a href="#widl-MediaEncryptedEventInit-initData">initData</a></code> attribute will be null if the media data is <em>not</em> <a href="http://www.w3.org/TR/html5/infrastructure.html#cors-same-origin">CORS-same-origin</a> or is <a href="#mixed-content">mixed content</a>.
                Applications may retrieve the Initialization Data from an alternate source.
              </p></div>
            </li>
      
            <li><p><i>Continue Normal Flow</i>: Continue with the existing media element's <a href="http://www.w3.org/TR/html5/embedded-content-0.html#concept-media-load-resource">resource fetch algorithm</a>.</p></li>
          </ol>
        </section>
    
        <section id="algorithms-encrypted-block" typeof="bibo:Chapter" resource="#algorithms-encrypted-block" rel="bibo:Chapter">
          <h4 role="heading" id="h4_algorithms-encrypted-block"><span class="secno">6.5.2 </span>Encrypted Block Encountered</h4>
          <p>The following steps are run when the media element encounters a block of encrypted <a href="http://www.w3.org/TR/html5/embedded-content-0.html#media-data">media data</a> during the <a href="http://www.w3.org/TR/html5/embedded-content-0.html#concept-media-load-resource">resource fetch algorithm</a>:</p>
      
          <ol>
            <li><p>If the media element's <code><a href="#widl-HTMLMediaElement-mediaKeys">mediaKeys</a></code> attribute is not null, run the following steps:</p>
              <ol>
                <li><p>Let <var title="true">media keys</var> be the <code><a href="#idl-def-MediaKeys">MediaKeys</a></code> object referenced by that atribute.</p></li>
                <li><p>Let <var title="true">cdm</var> be the CDM loaded during the <a href="#widl-MediaKeySystemAccess-createMediaKeys-Promise-MediaKeys">initialization</a> of the <var title="true">media keys</var>.</p></li>
                <li><p>If there is at least one <code><a href="#idl-def-MediaKeySession">MediaKeySession</a></code> created by the <var title="true">media keys</var> on which the <a href="#algorithms-session-close">session close algorithm</a> has not been run, run the following steps:</p>
                  <div class="note"><div class="note-title" aria-level="3" role="heading" id="h_note_39"><span>Note</span></div><p class="">This check ensures the <var title="true">cdm</var> has finished loading and is a prequisite for a matching key being available.</p></div>
                  <ol>
                    <li><p>Let the <var title="true">block key ID</var> be the key ID of the current block.</p>
                      <div class="note"><div class="note-title" aria-level="3" role="heading" id="h_note_40"><span>Note</span></div><p class="">The key ID is generally specified by the container.</p></div>
                    </li>
                    <li><p>Use the <var title="true">cdm</var> to execute the following steps:</p>
                      <ol>
                        <li><p>Let <var title="true">available keys</var> be the union of keys in sessions that were created by the <var title="true">media keys</var>.</p></li>
                        <li><p>Follow the steps for the first matching condition from the following list:</p>
                          <dl class="switch">
                          <dt>If any of the <var title="true">available keys</var> corresponds to the <var title="">block key ID</var> and is usable</dt>
                          <dd>Run the following steps:
                            <ol>
                              <li><p>Let <var title="">block key</var> be the matching key.</p>
                                <div class="note"><div class="note-title" aria-level="3" role="heading" id="h_note_41"><span>Note</span></div><p class="">If multiple sessions contain a <em>usable</em> key for the <var title="">block key ID</var>, which key to use is <a href="#key-system">Key System</a>-dependent.</p></div>
                              </li>
                              <li><p>Use the <var title="true">cdm</var> to decrypt the block using <var title="">block key</var>.</p></li>
                              <li><p>Follow the steps for the first matching condition from the following list:</p>
                                <dl class="switch">
                                  <dt>If decryption fails</dt>
                                  <dd>Abort the media element's <a href="http://www.w3.org/TR/html5/embedded-content-0.html#concept-media-load-resource">resource fetch algorithm</a>, run the steps to report a <a href="http://www.w3.org/TR/html5/embedded-content-0.html#dom-mediaerror-media_err_decode">MEDIA_ERR_DECODE</a> error, and abort these steps.</dd>
                                  <dt>Otherwise</dt>
                                  <dd>Run the following steps:
                                    <ol>
                                      <li><p>If the <code><a href="#widl-HTMLMediaElement-waitingFor">waitingFor</a></code> attribute on the media element is <code><a href="#idl-def-MediaWaitingFor.key">"key"</a></code>, set the <code><a href="#widl-HTMLMediaElement-waitingFor">waitingFor</a></code> attribute on the media element to <code><a href="#idl-def-MediaWaitingFor.none">"none"</a></code>.</p></li>
                                      <li><p>Abort these steps and process the decrypted block as normal.</p>
                                        <div class="note"><div class="note-title" aria-level="3" role="heading" id="h_note_42"><span>Note</span></div><p class="">In other words, decode the block.</p></div>
                                      </li>
                                    </ol>
                                  </dd>
                                </dl>
                                <div class="note"><div class="note-title" aria-level="3" role="heading" id="h_note_43"><span>Note</span></div><p class="">Not all decryption problems (i.e. using the wrong key) will result in a decryption failure. In such cases, no error is fired here but one may be fired during decode.</p></div>
                              </li>
                            </ol>
                          </dd>
                          <dt>If any of the <var title="true">available keys</var> corresponds to the <var title="">block key ID</var> and is unusable</dt>
                          <dd>
                            <div class="issue"><div class="issue-title" aria-level="3" role="heading" id="h_issue_7"><span>Issue 7</span></div><p class=""><a href="https://www.w3.org/Bugs/Public/show_bug.cgi?id=26372">Bug 26372</a> - It is TBD whether anything should happen in this case.</p></div>
                          </dd>
                          </dl>
                          <div class="note"><div class="note-title" aria-level="3" role="heading" id="h_note_44"><span>Note</span></div><p class="">Otherwise, there is no key for the <var title="true">block key ID</var> in any session so continue.</p></div>
                        </li>
                      </ol>
                    </li>
                  </ol>
                </li>
              </ol>
            </li>
            <li>
              <p>Run the following steps:</p>
              <div class="note"><div class="note-title" aria-level="3" role="heading" id="h_note_45"><span>Note</span></div><p class="">These steps are reached when there is no usable key for the block.</p></div>
              <ol>
                <li><p>Run the <a href="#algorithms-queue-waiting">queue a "waiting" event algorithm</a> on the media element.</p></li>
                <li><p>Wait for a signal to resume playback.</p></li>
              </ol>
            </li>
          </ol>
      
          <div class="note"><div class="note-title" aria-level="3" role="heading" id="h_note_46"><span>Note</span></div><div class="">
            <p>For frame-based encryption, this may be implemented as follows when the media element attempts to decode a frame as part of the <a href="http://www.w3.org/TR/html5/embedded-content-0.html#concept-media-load-resource">resource fetch algorithm</a>:</p>
            <ol>
              <li><p>Let <var title="">encrypted</var> be false.</p></li>
              <li><p>Detect whether the frame is encrypted.</p>
                <dl class="switch">
                  <dt>If the frame is encrypted</dt>
                  <dd>Run the steps above.</dd>
                  <dt>Otherwise</dt>
                  <dd>Continue.</dd>
                </dl>
              </li>
              <li><p>Decode the frame.</p></li>
              <li><p>Provide the frame for rendering.</p></li>
            </ol>
          </div></div>
        </section>
    
        <section id="algorithms-queue-waiting" typeof="bibo:Chapter" resource="#algorithms-queue-waiting" rel="bibo:Chapter">
          <h4 role="heading" id="h4_algorithms-queue-waiting"><span class="secno">6.5.3 </span>Queue a "waiting" Event</h4>
          <p>The Queue a "waiting" Event algorithm is run when the CDM needs to queue a waiting event to a <code><a href="http://www.w3.org/TR/html5/embedded-content-0.html#htmlmediaelement">HTMLMediaElement</a></code> object.
          Requests to run this algorithm include a target <code><a href="http://www.w3.org/TR/html5/embedded-content-0.html#htmlmediaelement">HTMLMediaElement</a></code> object.
          </p>
          <p>The following steps are run:</p>
          <ol>
            <li><p>Let the <var title="true">media element</var> be the specified <code><a href="http://www.w3.org/TR/html5/embedded-content-0.html#htmlmediaelement">HTMLMediaElement</a></code> object.</p></li>
            <li><p>If the <code><a href="#widl-HTMLMediaElement-waitingFor">waitingFor</a></code> attribute on the <var title="true">media element</var> is not <code><a href="#idl-def-MediaWaitingFor.key">"key"</a></code>, run the following steps:</p>
              <ol>
                <li><p>Set the <code><a href="#widl-HTMLMediaElement-waitingFor">waitingFor</a></code> attribute on the <var title="true">media element</var> to <code><a href="#idl-def-MediaWaitingFor.key">"key"</a></code>.</p></li>
                <li><p><a href="http://www.w3.org/TR/html5/webappapis.html#queue-a-task">Queue a task</a> to <a href="http://www.w3.org/TR/html5/webappapis.html#fire-a-simple-event">fire a simple event</a> named <code><a href="http://www.w3.org/TR/html5/embedded-content-0.html#event-media-waiting">waiting</a></code> at the <var title="true">media element</var>.</p></li>
              </ol>
            </li>
            <li><p>Suspend playback.</p></li>
          </ol>
        </section>
    
        <section id="algorithms-resume-playback" typeof="bibo:Chapter" resource="#algorithms-resume-playback" rel="bibo:Chapter">
          <h4 role="heading" id="h4_algorithms-resume-playback"><span class="secno">6.5.4 </span>Attempt to Resume Playback If Necessary</h4>
          <p>The Attempt to Resume Playback If Necessary algorithm is run when one or more keys becomes available.
          If playback is blocked waiting for a key, it resumes playback if a necessary key has been provided.
          Requests to run this algorithm include a target <code><a href="http://www.w3.org/TR/html5/embedded-content-0.html#htmlmediaelement">HTMLMediaElement</a></code> object.
          </p>
      
          <p>The following steps are run:</p>
          <ol>
            <li><p>Let the <var title="true">media element</var> be the specified <code><a href="http://www.w3.org/TR/html5/embedded-content-0.html#htmlmediaelement">HTMLMediaElement</a></code> object.</p></li>
            <li><p>If the <code><a href="#widl-HTMLMediaElement-waitingFor">waitingFor</a></code> attribute on the <var title="true">media element</var> is not <code><a href="#idl-def-MediaWaitingFor.key">"key"</a></code>, abort these steps.</p></li>
            <li><p>Attempt to resume the <a href="http://www.w3.org/TR/html5/embedded-content-0.html#concept-media-load-resource">resource fetch algorithm</a> by running the <a href="#algorithms-encrypted-block">encrypted block encountered algorithm</a>.</p></li>
            <li><p>If the user agent can advance the <a href="http://www.w3.org/TR/html5/embedded-content-0.html#current-playback-position">current playback position</a> in the <a href="http://www.w3.org/TR/html5/embedded-content-0.html#direction-of-playback">direction of playback</a>, run the following steps:</p>
              <ol>
                <li><p><a href="http://www.w3.org/TR/html5/webappapis.html#queue-a-task">Queue a task</a> to <a href="http://www.w3.org/TR/html5/webappapis.html#fire-a-simple-event">fire a simple event</a> named <code><a href="http://www.w3.org/TR/html5/embedded-content-0.html#event-media-canplay">canplay</a></code> at the <var title="true">media element</var>.</p></li>
                <li><p>If the <code><a href="http://www.w3.org/TR/html5/embedded-content-0.html#dom-media-paused">paused</a></code> attribute on the <var title="true">media element</var> is false, <a href="http://www.w3.org/TR/html5/webappapis.html#queue-a-task">queue a task</a> to <a href="http://www.w3.org/TR/html5/webappapis.html#fire-a-simple-event">fire a simple event</a> named <code><a href="http://www.w3.org/TR/html5/embedded-content-0.html#dom-media-playing">playing</a></code> at the <var title="true">media element</var>.</p></li>
             </ol>
              <p>Otherwise, the <code><a href="#widl-HTMLMediaElement-waitingFor">waitingFor</a></code> attribute on the <var title="true">media element</var> <em class="rfc2119" title="MUST NOT">MUST NOT</em> be <code><a href="#idl-def-MediaWaitingFor.none">"none"</a></code>.</p>
            </li>
          </ol>
        </section>
    
        <section id="htmlmediaelement-playing-the-media-resource" typeof="bibo:Chapter" resource="#htmlmediaelement-playing-the-media-resource" rel="bibo:Chapter">
          <h4 role="heading" id="h4_htmlmediaelement-playing-the-media-resource"><span class="secno">6.5.5 </span>Playing the Media Resource Algorithm Modifications</h4>
          <p>The following steps are added to <code><a href="http://www.w3.org/TR/html5/embedded-content-0.html#dom-media-readystate">readyState</a></code> change algorithms in <a href="http://www.w3.org/TR/html5/embedded-content-0.html#playing-the-media-resource">Playing the media resource</a>:</p>
          <ul>
            <li>If a <code><a href="http://www.w3.org/TR/html5/embedded-content-0.html#dom-media-readystate">readyState</a></code> change queues a task to fire a <code><a href="http://www.w3.org/TR/html5/embedded-content-0.html#event-media-waiting">waiting</a></code> event, the user agent <em class="rfc2119" title="MUST">MUST</em> also set the <code><a href="#widl-HTMLMediaElement-waitingFor">waitingFor</a></code> attribute on the Media Element to <code><a href="#idl-def-MediaWaitingFor.data">"data"</a></code>.</li>
            <li>If a <code><a href="http://www.w3.org/TR/html5/embedded-content-0.html#dom-media-readystate">readyState</a></code> change queues a task to fire a <code><a href="http://www.w3.org/TR/html5/embedded-content-0.html#event-media-canplay">canplay</a></code> event, the user agent <em class="rfc2119" title="MUST">MUST</em> also set the <code><a href="#widl-HTMLMediaElement-waitingFor">waitingFor</a></code> attribute on the Media Element to <code><a href="#idl-def-MediaWaitingFor.none">"none"</a></code>.</li>
          </ul>
        </section>
      </section>

      <section id="media-element-restictions" class="informative" typeof="bibo:Chapter" resource="#media-element-restictions" rel="bibo:Chapter">
        <h3 role="heading" id="h3_media-element-restictions"><span class="secno">6.6 </span>Media Element Restrictions</h3><p><em>This section is non-normative.</em></p>
        <p>Media data processed by a CDM <em class="rfc2119" title="MAY">MAY</em> be unavailable through Javascript APIs in the usual way (for example using the CanvasRenderingContext2D drawImage() method and the AudioContext MediaElementAudioSourceNode).
        This specification does not define conditions for such non-availability of media data, however, if media data is not available to Javascript APIs then these APIs <em class="rfc2119" title="MAY">MAY</em> behave as if no media data was present at all.</p>
        <p>Where media rendering is not performed by the UA, for example in the case of a hardware protected media pipeline, then the full set of HTML rendering capabilities, for example CSS Transforms, <em class="rfc2119" title="MAY">MAY</em> be unavailable. One likely restriction is that
        video media <em class="rfc2119" title="MAY">MAY</em> be constrained to appear only in rectangular regions with sides parallel to the edges of the window and with normal orientation.</p>
      </section>
    </section>


    <section id="common-key-systems" typeof="bibo:Chapter" resource="#common-key-systems" rel="bibo:Chapter">
      <!--OddPage--><h2 role="heading" id="h2_common-key-systems"><span class="secno">7. </span>Common Key Systems</h2>
      <p>All user agents <em class="rfc2119" title="MUST">MUST</em> support the common key systems described in this section.</p><p>
      </p><div class="note"><div class="note-title" aria-level="1" role="heading" id="h_note_47"><span>Note</span></div><p class="">This ensures that there is a common baseline level of protection that is guaranteed to be supported in all user agents, including those that are entirely open source.
        Thus, content providers that need only basic protection can build simple applications that will work on all platforms without needing to work with any content protection providers.
      </p></div>
  
      <span id="simple-decryption-clear-key"></span> <!-- Legacy anchor name. -->
      <section id="clear-key" typeof="bibo:Chapter" resource="#clear-key" rel="bibo:Chapter">
        <h3 role="heading" id="h3_clear-key"><span class="secno">7.1 </span>Clear Key</h3>
        <p>The <code>"org.w3.clearkey"</code> <a href="#key-system">Key System</a> uses plain-text clear (unencrypted) key(s) to decrypt the source.
        No additional client-side content protection is required.
        This Key System is described below.
        </p>
        
        <section id="clear-key-capabilities" typeof="bibo:Chapter" resource="#clear-key-capabilities" rel="bibo:Chapter">
          <h4 role="heading" id="h4_clear-key-capabilities"><span class="secno">7.1.1 </span>Capabilities</h4>
          <p>The following describe how Clear Key supports key system-specific capabilities:</p>
          <ul>
            <li><p>The <code><a href="#widl-HTMLMediaElement-setMediaKeys-Promise-void--MediaKeys-mediaKeys">setMediaKeys()</a></code> method: Implementations <em class="rfc2119" title="MAY">MAY</em> support associating the <code><a href="#idl-def-MediaKeys">MediaKeys</a></code> object with more than one <code><a href="http://www.w3.org/TR/html5/embedded-content-0.html#htmlmediaelement">HTMLMediaElement</a></code>.</p></li>
            <li><p>The <code><a href="#widl-MediaKeys-setServerCertificate-Promise-void--BufferSource-serverCertificate">setServerCertificate()</a></code> method: Not supported.</p></li>
            <li><p>The <a href="#idl-def-MediaKeySystemOptions" class="idlType"><code>MediaKeySystemOptions</code></a>: There are no supported capability values.</p></li>
            <li><p>The <code><a href="#idl-def-SessionType.persistent">"persistent"</a></code> <code><a href="#idl-def-SessionType">SessionType</a></code>: Implementations <em class="rfc2119" title="MAY">MAY</em> support this type.</p></li>
          </ul>
        </section>
    
        <section id="clear-key-behavior" typeof="bibo:Chapter" resource="#clear-key-behavior" rel="bibo:Chapter">
          <h4 role="heading" id="h4_clear-key-behavior"><span class="secno">7.1.2 </span>Behavior</h4>
          <p>The following describe how Clear Key implements key system-specific behaviors:</p>
          <ul>
            <li><p>In the <code><a href="#widl-MediaKeySession-generateRequest-Promise-void--DOMString-initDataType-BufferSource-initData">generateRequest()</a></code> algorithm:</p>
              <ul>
                <li><p>The generated <var title="true">message</var> is a JSON object encoded in UTF-8 as described in <a href="#clear-key-request-format">License Request Format</a>.</p></li>
                <li><p>The request is generated by extracting the key IDs from the <var>init data</var>.</p></li>
                <li><p>The "type" member value is the value of the <var title="true">sessionType</var> parameter.</p></li>
              </ul>
            </li>
            <li><p>The <code><a href="#widl-MediaKeySession-sessionId">sessionId</a></code> attribute is a numerical value representable by a 32-bit integer.</p></li>
            <li><p>The <code><a href="#widl-MediaKeySession-expiration">expiration</a></code> attribute is always <code>NaN</code>.</p></li>
            <li><p>In the <code><a href="#widl-MediaKeySession-update-Promise-void--BufferSource-response">update()</a></code> algorithm:</p>
              <ul>
                <li><p>The <var title="true">response</var> parameter is a JWK Set as described in <a href="#clear-key-license-format">License Format</a>.</p></li>
                <li><p><var>sanitized response</var> is considered invalid if it is not a valid JWK Set with at least one valid JWK key of a valid length for the media type.</p></li>
              </ul>
            </li>
            <li><p>The <code><a href="#widl-MediaKeySession-getUsableKeyIds-Promise-sequence-ArrayBuffer">getUsableKeyIds()</a></code> method always returns all key IDs that have been provided via <code><a href="#widl-MediaKeySession-update-Promise-void--BufferSource-response">update()</a></code>.</p></li>
            <li><p><a href="#initialization-data">Initialization Data</a>: Implementations <em class="rfc2119" title="MAY">MAY</em> support any combination of registered Initialization Data Types [<cite><a class="bibref" href="#bib-EME-REGISTRY">EME-REGISTRY</a></cite>].
              Implementations <em class="rfc2119" title="SHOULD">SHOULD</em> support the <code><a href="keyids-format.html">"keyids"</a></code> type and other types appropriate for content types supported by the user agent.
            </p></li>
          </ul>
        </section>
    
        <section id="clear-key-request-format" typeof="bibo:Chapter" resource="#clear-key-request-format" rel="bibo:Chapter">
          <h4 role="heading" id="h4_clear-key-request-format"><span class="secno">7.1.3 </span>License Request Format</h4>
          <p>This section describes the format of the license request provided to the application via the <code><a href="#widl-MediaKeyMessageEvent-message">message</a></code> attribute of the <code><a href="#dom-evt-message">message</a></code> event.</p>
          
          <p>The format is a JSON object containing the following members:</p>
          <dl>
            <dt>"kids"</dt>
            <dd>An array of <a href="#decryption-key-id">key IDs</a>. Each element of the array is the base64url encoding of the octet sequence containing the key ID value.</dd>
            <dt>"type"</dt>
            <dd>The requested <code><a href="#idl-def-SessionType">SessionType</a></code></dd>
          </dl>
      
          <p>When contained in the ArrayBuffer <code><a href="#widl-MediaKeyMessageEvent-message">message</a></code> attribute of a <code><a href="#idl-def-MediaKeyMessageEvent">MediaKeyMessageEvent</a></code> object, the JSON string is encoded in UTF-8 as specified in the Encoding specification [<cite><a class="bibref" href="#bib-ENCODING">ENCODING</a></cite>].
            Applications <em class="rfc2119" title="MAY">MAY</em> decode the contents of the ArrayBuffer to a JSON string using the <a href="http://www.w3.org/TR/encoding/#interface-textdecoder">TextDecoder interface</a> [<cite><a class="bibref" href="#bib-ENCODING">ENCODING</a></cite>].
          </p>
      
          <section id="clear-key-request-format-example" class="informative" typeof="bibo:Chapter" resource="#clear-key-request-format-example" rel="bibo:Chapter">
            <h5 role="heading" id="h5_clear-key-request-format-example"><span class="secno">7.1.3.1 </span>Example</h5><p><em>This section is non-normative.</em></p>
            <p>The following example is a license request for a temporary license for two key IDs. (Line breaks are for readability only.)</p>
            <div class="example"><div class="example-title"><span>Example 1</span></div><pre class="example highlight prettyprint prettyprinted"><span class="pun">{</span><span class="pln">
  </span><span class="str">"kids"</span><span class="pun">:</span><span class="pln"> 
    </span><span class="pun">[</span><span class="pln">
     </span><span class="str">"67ef0gd8pvfd0"</span><span class="pun">,</span><span class="pln">
     </span><span class="str">"77ef0gd8pvfd0"</span><span class="pln">
    </span><span class="pun">],</span><span class="pln">
  </span><span class="str">"type"</span><span class="pun">:</span><code><a href="#idl-def-SessionType.temporary">"temporary"</a></code><span class="pln">
</span><span class="pun">}</span></pre></div>
          </section>
        </section>
    
        <section id="clear-key-license-format" typeof="bibo:Chapter" resource="#clear-key-license-format" rel="bibo:Chapter">
          <h4 role="heading" id="h4_clear-key-license-format"><span class="secno">7.1.4 </span>License Format</h4>
          <p>This section describes the format of the license to be provided via the <var title="true">response</var> parameter of the <code><a href="#widl-MediaKeySession-update-Promise-void--BufferSource-response">update()</a></code> method.</p>
      
          <p>The format is a JSON Web Key (JWK) Set containing representation of the symmetric key to be used for decryption, as defined in the JSON Web Key (JWK) specification [<cite><a class="bibref" href="#bib-JWK">JWK</a></cite>].</p>
      
          <p>For each JWK in the set, the parameter values are as follows:</p>
          <dl>
            <dt>"kty" (key type)</dt>
            <dd>"oct" (octet sequence)</dd>
            <dt>"alg" (algorithm)</dt>
            <dd>"A128KW" (AES key wrap using a 128-bit key)</dd>
            <dt>"k" (key value)</dt>
            <dd>The base64url encoding of the octet sequence containing the symmetric <a href="#decryption-key">key</a> value</dd>
            <dt>"kid" (key ID)</dt>
            <dd>The base64url encoding of the octet sequence containing the <a href="#decryption-key-id">key ID</a> value</dd>
          </dl>
      
          <p>The JSON object <em class="rfc2119" title="MAY">MAY</em> have an optional "type" member value, which <em class="rfc2119" title="MUST">MUST</em> be one of the <code><a href="#idl-def-SessionType">SessionType</a></code> values.
            If not specified, the default value of <code><a href="#idl-def-SessionType.temporary">"temporary"</a></code> is used.
            The <code><a href="#widl-MediaKeySession-update-Promise-void--BufferSource-response">update()</a></code> algorithm compares this value to the <var title="true">sessionType</var>.
          </p>
      
          <p>When passed to the <code><a href="#widl-MediaKeySession-update-Promise-void--BufferSource-response">update()</a></code> method as the ArrayBuffer <var title="true">response</var> parameter, the JSON string <em class="rfc2119" title="MUST">MUST</em> be encoded in UTF-8 as specified in the Encoding specification [<cite><a class="bibref" href="#bib-ENCODING">ENCODING</a></cite>].
            Applications <em class="rfc2119" title="MAY">MAY</em> encode the JSON string using the <a href="http://www.w3.org/TR/encoding/#interface-textencoder">TextEncoder interface</a> [<cite><a class="bibref" href="#bib-ENCODING">ENCODING</a></cite>].
          </p>
      
          <section id="clear-key-license-format-example" class="informative" typeof="bibo:Chapter" resource="#clear-key-license-format-example" rel="bibo:Chapter">
            <h5 role="heading" id="h5_clear-key-license-format-example"><span class="secno">7.1.4.1 </span>Example</h5><p><em>This section is non-normative.</em></p>
            <p>The following example is a JWK Set containing a single symmetric key. (Line breaks are for readability only.)</p>
            <div class="example"><div class="example-title"><span>Example 2</span></div><pre class="example highlight prettyprint prettyprinted"><span class="pun">{</span><span class="pln">
  </span><span class="str">"keys"</span><span class="pun">:</span><span class="pln"> 
    </span><span class="pun">[{</span><span class="pln">
      </span><span class="str">"kty"</span><span class="pun">:</span><span class="str">"oct"</span><span class="pun">,</span><span class="pln">
      </span><span class="str">"alg"</span><span class="pun">:</span><span class="str">"A128KW"</span><span class="pun">,</span><span class="pln">
      </span><span class="str">"k"</span><span class="pun">:</span><span class="str">"GawgguFyGrWKav7AX4VKUg"</span><span class="pln">
      </span><span class="str">"kid"</span><span class="pun">:</span><span class="str">"67ef0gd8pvfd0"</span><span class="pun">,</span><span class="pln">
    </span><span class="pun">}],</span><span class="pln">
  </span><span class="str">"type"</span><span class="pun">:</span><code><a href="#idl-def-SessionType.temporary">"temporary"</a></code><span class="pln">
</span><span class="pun">}</span></pre></div>
          </section>
        </section>
    
        <section id="using-base64url" class="informative" typeof="bibo:Chapter" resource="#using-base64url" rel="bibo:Chapter">
          <h4 role="heading" id="h4_using-base64url"><span class="secno">7.1.5 </span>Using base64url</h4><p><em>This section is non-normative.</em></p>
          <p>For more information on base64url and working with it, see the "Base64url Encoding" terminology definition and "Notes on implementing base64url encoding without padding" in [<cite><a class="bibref" href="#bib-JWS">JWS</a></cite>].
            Specifically, there is no '=' padding, and the characters '-' and '_' <em class="rfc2119" title="MUST">MUST</em> be used instead of '+' and '/', respectively.
          </p>
        </section>
      </section>
    </section>


    <section id="security" class="informative" typeof="bibo:Chapter" resource="#security" rel="bibo:Chapter">
      <!--OddPage--><h2 role="heading" id="h2_security"><span class="secno">8. </span>Security Considerations</h2><p><em>This section is non-normative.</em></p>
  
      <p>User Agent and Key System implementations must consider <a href="http://www.w3.org/TR/html5/embedded-content-0.html#media-data">media data</a>, <a href="#initialization-data">Initialization Data</a>, responses (i.e. data passed to <code><a href="#widl-MediaKeySession-update-Promise-void--BufferSource-response">update()</a></code>), licenses, key data, and all other data provided by the application as untrusted content and potential attack vectors.
      They must use appropriate safeguards to mitigate any associated threats and take care to safely parse, decrypt, etc. such data.
      User Agents <em class="rfc2119" title="SHOULD">SHOULD</em> validate data before passing it to the CDM, especially if the CDM does not run in the same (sandboxed) context as the DOM (i.e. rendering).
      </p>
      <p>Implementations <em class="rfc2119" title="MUST NOT">MUST NOT</em> return active content or passive content that affects program control flow to the application.
      For example, it is not safe to expose URLs or other information that may have come from media data, such as is the case for the <a href="#initialization-data">Initialization Data</a> passed to <code><a href="#widl-MediaKeySession-generateRequest-Promise-void--DOMString-initDataType-BufferSource-initData">generateRequest()</a></code>.
      Applications must determine the URLs to use. The <code><a href="#widl-MediaKeyMessageEvent-messageType">messageType</a></code> attribute of the <code><a href="#dom-evt-message">message</a></code> event can be used by the application to select among a set of URLs if applicable.
      </p>
      <p>User Agents are responsible for providing users with a secure way to browse the web. Since User Agents may integrate with third party CDM implementations, CDM implementers must provide sufficient information and controls to user agent implementers to enable them to properly asses the security implications of integrating with the Key System.</p>
      <p>Unsandboxed CDMs (or CDMs that use platform features) and UAs that use them must be especially careful in all areas of security, including parsing of key and media data, etc. due to the potential for compromises to provide access to OS/platform features, interact with or run as root, access drivers, kernel, firmware, hardware, etc., all of which may not be written to be robust against hostile software or web-based attacks. Additionally, CDMs may not be updated with security fixes as frequently, especially when part of the OS, platform or hardware.</p>
  
      <p>User agents may choose to only support the EME APIs and/or specific Key Systems (i.e. based on privacy and security risks) on secure origins.
      This is especially important if a user agent chooses to support a Key System implementation that cannot be sufficiently sandboxed or otherwise secured.
      Such user agents should also properly handle Mixed Content [<cite><a class="bibref" href="#bib-MIXED-CONTENT">MIXED-CONTENT</a></cite>] to avoid potential exposure to insecure content.
      See also <a href="#privacy-secureorigin">Use Secure Origin and Transport</a>.
      </p>
      
      <p>If a user agent chooses to support a Key System implementation that cannot be sufficiently sandboxed or otherwise secured, the user agent should ensure that users are fully informed and/or give explicit consent before loading or invoking it.
      See also <a href="#privacy-prompts">User Alerts / Prompts</a>.
      </p>
    </section>


    <section id="privacy" class="informative" typeof="bibo:Chapter" resource="#privacy" rel="bibo:Chapter">
      <!--OddPage--><h2 role="heading" id="h2_privacy"><span class="secno">9. </span>Privacy Considerations</h2><p><em>This section is non-normative.</em></p>
  
      <p>The presence or use of Key Systems on a user's device raises a number of privacy issues, falling into two categories: (a) user-specific information that may be disclosed by the EME interface itself, or within messages from Key Systems and (b) user-specific information that may be persistently stored on the users device.</p>
      <p>User Agents should take responsibility for providing users with adequate control over their own privacy. Since User Agents may integrate with third party CDM implementations, CDM implementers must provide sufficient information and controls to user agent implementers to enable them to implement appropriate techniques to ensure users have control over their privacy, including but not limited to the techniques described below.</p>
  
      <section id="privacy-disclosure" typeof="bibo:Chapter" resource="#privacy-disclosure" rel="bibo:Chapter">
        <h3 role="heading" id="h3_privacy-disclosure"><span class="secno">9.1 </span>Information Disclosed by EME and Key Systems</h3>
        <p>Concerns regarding information disclosed by EME and Key Systems fall into two categories, concerns about non-specific information that may nevertheless contribute to the possibility of fingerprinting a user agent or device and user-specific information that may be used directly for user tracking.</p>
      </section>
  
      <section id="privacy-fingerprinting" typeof="bibo:Chapter" resource="#privacy-fingerprinting" rel="bibo:Chapter">
        <h3 role="heading" id="h3_privacy-fingerprinting"><span class="secno">9.2 </span>Fingerprinting</h3>
        <p>Malicious applications may be able to fingerprint users or user agents by detecting or enumerating the list of Key Systems that are supported and related information. If proper origin protections are not provided this could include detection of sites that have been visited and information stored for those sites. In particular, Key Systems <em class="rfc2119" title="MUST">MUST</em> not share key or other data between origins.</p>
      </section>
  
      <section id="privacy-leakage" typeof="bibo:Chapter" resource="#privacy-leakage" rel="bibo:Chapter">
        <h3 role="heading" id="h3_privacy-leakage"><span class="secno">9.3 </span>Information Leakage</h3>
        <p>CDMs, especially those implemented outside the user agent, may not have the same fundamental isolations as the web platform.
        It is important that steps be taken to avoid information leakage, especially across origins.
        This includes both in-memory and stored data.
        Failure to do so could lead to information leakage to/from Incognito/Private Browsing sessions, across profiles, and even across different browsers, applications, and operating system user accounts.
        </p>
        
        <p>To avoid such issues, user agent and CDM implementations <em class="rfc2119" title="MUST">MUST</em> ensure that:</p>
        <ul>
          <li>CDMs have a concept of a CDM instance that is associated 1:1 with a MediaKeys object.</li>
          <li>Keys, licenses, other session data, and the presence of sessions are restricted to the CDM instance associated with the MediaKeys object that created the session.</li>
          <li>Session data is not shared between MediaKeys objects or CDM instances.</li>
          <li>Session data is not shared with media elements not associated with the MediaKeys object that created the session. Among other things, this means a session's keys <em class="rfc2119" title="MUST">MUST</em> not be used to decrypt content loaded by a media element whose <code><a href="#widl-HTMLMediaElement-mediaKeys">mediaKeys</a></code> attribute is not that MediaKeys object.</li>
          <li>MediaKeys objects and the underlying implementation do not expose information outside the origin.</li>
          <li>Persisted session data, if applicable, is stored on a per-origin basis.</li>
          <li>Only data stored by the requesting origin may be loaded.</li>
        </ul>
      </section>
  
      <section id="privacy-tracking" typeof="bibo:Chapter" resource="#privacy-tracking" rel="bibo:Chapter">
        <h3 role="heading" id="h3_privacy-tracking"><span class="secno">9.4 </span>Tracking</h3>
        <p>User-specific information may be obtained over the EME API in two ways: through detection of stored keys and through Key System messages.</p>
    
        <p>Key Systems may access or create persistent or semi-persistent identifiers for a device or user of a device. In some cases these identifiers may be bound to a specific device in a secure manner. If these identifiers are present in Key System messages, then devices and/or users may be tracked. If the mitigations below are not applied this could include both tracking of users / devices over time and associating multiple users of a given device. If not mitigated, such tracking may take three forms depending on the design of the Key System:</p>
        <ul>
          <li>In all cases, such identifiers are expected to be available to sites and/or servers that fully support the Key System (and thus can interpret Key System messages) enabling tracking by such sites.</li>
          <li>If identifiers exposed by Key Systems are not origin-specific, then two sites and/or servers that fully support the Key System may collude to track the user</li>
          <li>If a Key System messages contains information derived from a user identifier in a consistent manner, for example such that a portion of the initial Key System message for a specific content item does not change over time and is dependent on the user identifier, then this information could be used by any application to track the device or user over time.</li>
        </ul>
    
        <p>If a Key System permits keys to be stored and to be re-used between origins, then it may be possible for two origins to collude and track a unique user by recording their ability to access a common key.</p>
        <p>Finally, if any user interface for user control of Key Systems presents data separately from data in HTTP session cookies or persistent storage, then users are likely to modify site authorization or delete data in one and not the others. This would allow sites to use the various features as redundant backup for each other, defeating a user's attempts to protect his privacy.</p>
        <p>There are a number of techniques that can be used to mitigate these risks of tracking without user consent:</p>
    
        <dl>
          <dt>User deletion of persistent identifiers</dt>
          <dd>User agents could provide users with the ability to clear any persistent identifiers maintained by Key Systems.</dd>
    
          <dt>Use of (non-reversible) per-origin identifiers</dt>
          <dd>The user / device identifier exposed by a Key System may be different for each origin, either by allocation of different identifiers for different origins or by use of a non-reversible origin-specific mapping from an origin-independent identifier.</dd>
    
          <dt id="identifier-encryption">Encryption of user identifiers</dt>
          <dd>User identifiers in Key System messages could be encrypted, together with a timestamp or nonce, such that the Key System messages are always different. This would prevent the use of Key System messages for tracking except by applications fully supporting the Key System.
          This <em class="rfc2119" title="MAY">MAY</em> be implemented using a <a href="#server-certificate">server certificate</a>.
          </dd>
    
          <dt>Site-specific white-listing of access to each Key System</dt>
          <dd>User agents could require the user to explicitly authorize access by each site to each Key System. User agents should enable users to revoke this authorization either temporarily or permanently.</dd>
    
          <dt>Treating Key System persistent identifiers as cookies</dt>
          <dd>User agents should present the presence of persistent identifiers stored by Key Systems to the user in a way that associates them strongly with HTTP session cookies. This might encourage users to view such identifiers with healthy suspicion.</dd>
    
          <dt>Shared blacklists</dt>
          <dd>User agents may allow users to share their Key System domain blacklists. This would allow communities to act together to protect their privacy.</dd>
    
          <dt id="privacy-prompts">User Alerts / Prompts</dt>
          <dd>User Agents should ensure that users are fully informed and/or give explicit consent before identifiers are exposed in messages from Key Systems.
            Such alerts and consent should be per origin to avoid valid uses enabling subsequent malicious access.
            User agents that consider such alerts or consent appropriate should only support such Key Systems on secure origins (see <a href="#privacy-secureorigin">Use Secure Origin and Transport</a>), especially if they allow such consent to be persisted.
            (Granting permissions to unauthenticated origins is equivalent to granting the permissions to any origin in the presence of a network attacker.)
          </dd>
    
          <dt>User controls to disable Key Systems or Key System use of identifiers</dt>
          <dd>User Agents could provide users with a global control of whether a Key System is enabled / disabled and/or whether Key System use of user / device identifiers is enabled or disabled (if supported by the Key System).</dd>
        </dl>
    
        <p>While these suggestions prevent trivial use of this feature for user tracking, they do not block it altogether. Within a single domain, a site can continue to track the user during a session, and can then pass all this information to a third party along with any identifying information (names, credit card numbers, addresses) obtained by the site. If a third party cooperates with multiple sites to obtain such information, and if identifiers are not per-origin, then a profile can still be created.</p>
        <p>It is important to note that identifiers that are non-clearable, non-origin-specific or hardware-bound exceed the tracking impact of existing techniques such as cookies or session identifiers embedded in URLs.</p>
        <p>Thus, in addition to the various mitigations described above, if a browser supports a mode of operation intended to preserve user anonymity, then User Agent implementers should carefully consider whether access to Key Systems should be disabled in this mode.
          For example, such modes <em class="rfc2119" title="MAY">MAY</em> prohibit creation of <a href="#idl-def-MediaKeySystemAccess" class="idlType"><code>MediaKeySystemAccess</code></a> objects that are <code><a href="#widl-MediaKeySystemOptions-stateful">stateful</a></code> or use a <code><a href="#widl-MediaKeySystemOptions-uniqueidentifier">uniqueidentifier</a></code> (either as part of the CDM implementation or because the application <code><a href="#idl-def-MediaKeysRequirement.required">"required"</a></code> them).
        </p>

        <section id="privacy-individualization" typeof="bibo:Chapter" resource="#privacy-individualization" rel="bibo:Chapter">
          <h4 role="heading" id="h4_privacy-individualization"><span class="secno">9.4.1 </span>Individualization</h4>
          <p>Identifiers are sometimes obtained via a process called individualization or provisioning.
            In all cases, implementations should avoid sending per-origin information to centralized servers since this could create a central record of all origins visited by a user or device.
          </p>
          <p>Per-origin individualization (resulting in a per-origin identifier) can - with appropriate precautions - provide better privacy than other individualization models. 
            To preserve the benefits of such a design and to avoid introducing other privacy concerns:
          </p>
          <ul>
            <li><p>Such implementations should not use identifiers for a device or user of a device in the individualization process.</p></li>
            <li><p>Such implementations and the applications that support them should also avoid deferring or forwarding the individualization process to a central server or other server not controlled by the application author.</p></li>
          </ul>
        </section>
      </section>
  
      <section id="privacy-storedinfo" typeof="bibo:Chapter" resource="#privacy-storedinfo" rel="bibo:Chapter">
        <h3 role="heading" id="h3_privacy-storedinfo"><span class="secno">9.5 </span>Information Stored on User Devices</h3>
        <p>Key Systems may store information on a user's device, or user agents may store information on behalf of Key Systems. Potentially, this could reveal information about a user to another user of the same device, including potentially the origins that have used a particular Key System (i.e. sites visited) or even the content that has been decrypted using a Key System.</p>
        <p>If information stored by one origin affects the operation of the Key System for another origin, then potentially the sites visited or content viewed by a user on one site may be revealed to another, potentially malicious, site.</p>
        <p>There are a number of techniques that can be used to mitigate these privacy risk to users:</p>
    
        <dl>
          <dt>Origin-specific Key System storage</dt>
          <dd>
            Any data persistently stored by the CDM that might impact messages or behavior in an application- or license server-visible way <em class="rfc2119" title="MUST">MUST</em> be stored in an origin-specific way.
            Session data, licenses, and keys that are persistently stored <em class="rfc2119" title="MUST">MUST</em> be stored per-origin.
            See <a href="#session-storage">Session Storage and Persistence</a>.
          </dd>
    
          <dt>User deletion of Key System storage</dt>
          <dd>User agents should present the user with a way to delete Key System storage for a specific origin or all origins.</dd>
    
          <dt>Treating Key System stored data like cookies / Web Storage</dt>
          <dd>User agents should present the presence of persistent data stored by Key Systems to the user in a way that associates it strongly with HTTP session cookies and/or Web Storage. This might encourage users to view such data with healthy suspicion.</dd>
    
          <dt>Encryption or obfuscation of Key System stored data</dt>
          <dd>User agents should treat data stored by Key Systems as potentially sensitive; it is quite possible for user privacy to be compromised by the release of this information. To this end, user agents should ensure that such data is securely stored and when deleting data, it is promptly deleted from the underlying storage.</dd>
        </dl>
        
        <p>User agent and CDM implementations that allow the CDM to persist data:</p>
        <ul>
          <li><em class="rfc2119" title="MUST">MUST</em> ensure it is restricted to the origin for which it was created.</li>
          <li><em class="rfc2119" title="MUST">MUST</em> ensure it is restricted to the current profile and does not leak to or from Incognito/Private Browsing sessions.</li>
          <li>Should Allow the user to clear it, preferably by origin.</li>
          <li>Should treat it like other site data, including presenting it along with cookies, including it in "remove all data", and presenting it in the same UI locations.</li>
        </ul>
      </section>
  
      <section id="privacy-secureorigin" typeof="bibo:Chapter" resource="#privacy-secureorigin" rel="bibo:Chapter">
        <h3 role="heading" id="h3_privacy-secureorigin"><span class="secno">9.6 </span>Use Secure Origin and Transport</h3>
        <p>In order to protect identifiers and other information discussed in previous sections, user agents <em class="rfc2119" title="MAY">MAY</em> choose to only support the EME APIs and/or specific Key Systems (i.e. based on privacy and security risks) on secure origins.
        This is especially important if a user agent chooses to support a Key System implementation that exposes identifiers or other such information without effectively anonymizing it in transit (i.e. without <a href="#identifier-encryption">encrypting identifiers</a>).
        </p>
        <p>Regardless of user agent limitations, applications should use secure transport (e.g. HTTPS) for all traffic containing messages from the CDM (i.e. all data passed from <code><a href="#dom-evt-message">message</a></code> events and to <code><a href="#widl-MediaKeySession-update-Promise-void--BufferSource-response">update()</a></code>).</p>
        <p>All user agents should properly handle Mixed Content [<cite><a class="bibref" href="#bib-MIXED-CONTENT">MIXED-CONTENT</a></cite>] to avoid exposure to insecure content or transport when the user agent or application wish to enforce secure origin and transport.</p>
      </section>

    </section>

    <section id="examples" class="informative" typeof="bibo:Chapter" resource="#examples" rel="bibo:Chapter">
      <!--OddPage--><h2 role="heading" id="h2_examples"><span class="secno">10. </span>Examples</h2><p><em>This section is non-normative.</em></p>
      <p>This section contains example solutions for various use cases using the proposed extensions.
      These are not the only solutions to these use cases.
      Video elements are used in the examples, but the same would apply to all media elements.
      In some cases, such as using synchronous XHR, the examples are simplified to keep the focus on the extensions.
      </p>
  
      <section id="example-source-and-key-known" typeof="bibo:Chapter" resource="#example-source-and-key-known" rel="bibo:Chapter">
        <h3 role="heading" id="h3_example-source-and-key-known"><span class="secno">10.1 </span>Source and Key Known at Page Load (Clear Key)</h3>
        <p class="exampledescription">In this simple example, the source file and <a href="#clear-key">clear-text license</a> are hard-coded in the page.
        Only one session will ever be created.</p>
    
        <div class="example"><div class="example-title"><span>Example 3</span></div><pre class="example highlight prettyprint prettyprinted"><span class="tag">&lt;script&gt;</span><span class="pln">
  </span><span class="kwd">function</span><span class="pln"> load</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">var</span><span class="pln"> video </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">getElementById</span><span class="pun">(</span><span class="str">"video"</span><span class="pun">);</span><span class="pln">

    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">video</span><span class="pun">.</span><code><a href="#widl-HTMLMediaElement-mediaKeys">mediaKeys</a></code><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      navigator</span><span class="pun">.</span><code><a href="#widl-Navigator-requestMediaKeySystemAccess-Promise-MediaKeySystemAccess--DOMString-keySystem-sequence-MediaKeySystemOptions--supportedConfigurations">requestMediaKeySystemAccess</a></code><span class="pun">(</span><span class="str">"org.w3.clearkey"</span><span class="pun">).</span><span class="pln">then</span><span class="pun">(</span><span class="pln">
        </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">keySystemAccess</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
          </span><span class="kwd">var</span><span class="pln"> promise </span><span class="pun">=</span><span class="pln">  keySystemAccess</span><span class="pun">.</span><code><a href="#widl-MediaKeySystemAccess-createMediaKeys-Promise-MediaKeys">createMediaKeys</a></code><span class="pun">();</span><span class="pln">
          promise</span><span class="pun">.</span><span class="kwd">catch</span><span class="pun">(</span><span class="pln">
            console</span><span class="pun">.</span><span class="pln">error</span><span class="pun">.</span><span class="pln">bind</span><span class="pun">(</span><span class="pln">console</span><span class="pun">,</span><span class="pln"> </span><span class="str">"Unable to create MediaKeys"</span><span class="pun">)</span><span class="pln">
          </span><span class="pun">);</span><span class="pln">
          promise</span><span class="pun">.</span><span class="pln">then</span><span class="pun">(</span><span class="pln">
            </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">createdMediaKeys</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
              </span><span class="kwd">return</span><span class="pln"> video</span><span class="pun">.</span><code><a href="#widl-HTMLMediaElement-setMediaKeys-Promise-void--MediaKeys-mediaKeys">setMediaKeys</a></code><span class="pun">(</span><span class="pln">createdMediaKeys</span><span class="pun">);</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
          </span><span class="pun">).</span><span class="kwd">catch</span><span class="pun">(</span><span class="pln">
            console</span><span class="pun">.</span><span class="pln">error</span><span class="pun">.</span><span class="pln">bind</span><span class="pun">(</span><span class="pln">console</span><span class="pun">,</span><span class="pln"> </span><span class="str">"Unable to set MediaKeys"</span><span class="pun">)</span><span class="pln">
          </span><span class="pun">);</span><span class="pln">
          promise</span><span class="pun">.</span><span class="pln">then</span><span class="pun">(</span><span class="pln">
            </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">createdMediaKeys</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
              </span><span class="kwd">var</span><span class="pln"> initData </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Uint8Array</span><span class="pun">([</span><span class="pln"> </span><span class="pun">...</span><span class="pln"> </span><span class="pun">]);</span><span class="pln">
              </span><span class="kwd">var</span><span class="pln"> keySession </span><span class="pun">=</span><span class="pln"> createdMediaKeys</span><span class="pun">.</span><code><a href="#widl-MediaKeys-createSession-MediaKeySession-SessionType-sessionType">createSession</a></code><span class="pun">();</span><span class="pln">
              keySession</span><span class="pun">.</span><span class="pln">addEventListener</span><span class="pun">(</span><span class="str">"</span><code><a href="#dom-evt-message">message</a></code><span class="str">"</span><span class="pun">,</span><span class="pln"> handleMessage</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">);</span><span class="pln">
              </span><span class="kwd">return</span><span class="pln"> keySession</span><span class="pun">.</span><code><a href="#widl-MediaKeySession-generateRequest-Promise-void--DOMString-initDataType-BufferSource-initData">generateRequest</a></code><span class="pun">(</span><span class="str">"webm"</span><span class="pun">,</span><span class="pln"> initData</span><span class="pun">);</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
          </span><span class="pun">).</span><span class="kwd">catch</span><span class="pun">(</span><span class="pln">
            console</span><span class="pun">.</span><span class="pln">error</span><span class="pun">.</span><span class="pln">bind</span><span class="pun">(</span><span class="pln">console</span><span class="pun">,</span><span class="pln"> </span><span class="str">"Unable to create or initialize key session"</span><span class="pun">)</span><span class="pln">
          </span><span class="pun">);</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
      </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">);</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">

  </span><span class="kwd">function</span><span class="pln"> handleMessage</span><span class="pun">(</span><span class="pln">event</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">var</span><span class="pln"> keySession </span><span class="pun">=</span><span class="pln"> event</span><span class="pun">.</span><span class="pln">target</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">var</span><span class="pln"> license </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Uint8Array</span><span class="pun">([</span><span class="pln"> </span><span class="pun">...</span><span class="pln"> </span><span class="pun">]);</span><span class="pln">
    keySession</span><span class="pun">.</span><code><a href="#widl-MediaKeySession-update-Promise-void--BufferSource-response">update</a></code><span class="pun">(</span><span class="pln">license</span><span class="pun">).</span><span class="kwd">catch</span><span class="pun">(</span><span class="pln">
      console</span><span class="pun">.</span><span class="pln">error</span><span class="pun">.</span><span class="pln">bind</span><span class="pun">(</span><span class="pln">console</span><span class="pun">,</span><span class="pln"> </span><span class="str">"update() failed"</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">);</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
</span><span class="tag">&lt;/script&gt;</span><span class="pln">

</span><span class="tag">&lt;body</span><span class="pln"> </span><span class="atn">onload</span><span class="pun">=</span><span class="atv">"</span><span class="pln">load</span><span class="pun">()</span><span class="atv">"</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;video</span><span class="pln"> </span><span class="atn">src</span><span class="pun">=</span><span class="atv">"foo.webm"</span><span class="pln"> </span><span class="atn">autoplay</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"video"</span><span class="tag">&gt;&lt;/video&gt;</span><span class="pln">
</span><span class="tag">&lt;/body&gt;</span></pre></div>
      </section>
  
      <section id="example-selecting-key-system" typeof="bibo:Chapter" resource="#example-selecting-key-system" rel="bibo:Chapter">
        <h3 role="heading" id="h3_example-selecting-key-system"><span class="secno">10.2 </span>Selecting a Supported Key System and Using Initialization Data from the "encrypted" Event</h3>
        <p class="exampledescription">This example selects a supported <a href="#key-system">Key System</a> using the <code><a href="#widl-Navigator-requestMediaKeySystemAccess-Promise-MediaKeySystemAccess--DOMString-keySystem-sequence-MediaKeySystemOptions--supportedConfigurations">requestMediaKeySystemAccess()</a></code> method then uses
        the <a href="#initialization-data">Initialization Data</a> from the <a href="http://www.w3.org/TR/html5/embedded-content-0.html#media-data">media data</a> to generate the license request and send it to the appropriate license server.
        One of the supported key systems uses a serverCertificate, which is provided proactively.
        </p>
    
        <div class="example"><div class="example-title"><span>Example 4</span></div><pre class="example highlight prettyprint prettyprinted"><span class="tag">&lt;script&gt;</span><span class="pln">
  </span><span class="kwd">var</span><span class="pln"> licenseUrl</span><span class="pun">;</span><span class="pln">
  </span><span class="kwd">var</span><span class="pln"> serverCertificate</span><span class="pun">;</span><span class="pln">

  </span><span class="com">// Returns a Promise&lt;</span><a href="#idl-def-MediaKeys" class="idlType"><code>MediaKeys</code></a><span class="com">&gt;.</span><span class="pln">
  </span><span class="kwd">function</span><span class="pln"> createSupportedKeySystem</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    someSystemOptions </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln">
     </span><span class="pun">{</span><span class="pln"> </span><code><a href="#widl-MediaKeySystemOptions-initDataType">initDataType</a></code><span class="pun">:</span><span class="pln"> </span><span class="str">"webm"</span><span class="pun">,</span><span class="pln">
       </span><code><a href="#widl-MediaKeySystemOptions-videoType">videoType</a></code><span class="pun">:</span><span class="pln"> </span><span class="str">"video/webm; codecs='vp8, vorbis'"</span><span class="pln">
     </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">];</span><span class="pln">
    clearKeyOptions </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln">
     </span><span class="pun">{</span><span class="pln"> </span><code><a href="#widl-MediaKeySystemOptions-initDataType">initDataType</a></code><span class="pun">:</span><span class="pln"> </span><span class="str">"webm"</span><span class="pun">,</span><span class="pln">
       </span><code><a href="#widl-MediaKeySystemOptions-videoType">videoType</a></code><span class="pun">:</span><span class="pln"> </span><span class="str">"video/webm; codecs='vp8, vorbis'"</span><span class="pln">
     </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">];</span><span class="pln">
  
    navigator</span><span class="pun">.</span><code><a href="#widl-Navigator-requestMediaKeySystemAccess-Promise-MediaKeySystemAccess--DOMString-keySystem-sequence-MediaKeySystemOptions--supportedConfigurations">requestMediaKeySystemAccess</a></code><span class="pun">(</span><span class="str">"com.example.somesystem"</span><span class="pun">,</span><span class="pln"> someSystemOptions</span><span class="pun">).</span><span class="pln">then</span><span class="pun">(</span><span class="pln">
      </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">keySystemAccess</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        licenseUrl </span><span class="pun">=</span><span class="pln"> </span><span class="str">"https://license.example.com/getkey"</span><span class="pun">;</span><span class="pln">
        serverCertificate </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Uint8Array</span><span class="pun">([</span><span class="pln"> </span><span class="pun">...</span><span class="pln"> </span><span class="pun">]);</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> keySystemAccess</span><span class="pun">.</span><code><a href="#widl-MediaKeySystemAccess-createMediaKeys-Promise-MediaKeys">createMediaKeys</a></code><span class="pun">();</span><span class="pln">
      </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">).</span><span class="kwd">catch</span><span class="pun">(</span><span class="pln">
      </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">error</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="com">// Try the next key system.</span><span class="pln">
        navigator</span><span class="pun">.</span><code><a href="#widl-Navigator-requestMediaKeySystemAccess-Promise-MediaKeySystemAccess--DOMString-keySystem-sequence-MediaKeySystemOptions--supportedConfigurations">requestMediaKeySystemAccess</a></code><span class="pun">(</span><span class="str">"org.w3.clearkey"</span><span class="pun">,</span><span class="pln"> clearKeyOptions</span><span class="pun">).</span><span class="pln">then</span><span class="pun">(</span><span class="pln">
          </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">keySystemAccess</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            licenseUrl </span><span class="pun">=</span><span class="pln"> </span><span class="str">"https://license.example.com/clearkey/request"</span><span class="pun">;</span><span class="pln">
            </span><span class="kwd">return</span><span class="pln"> keySystemAccess</span><span class="pun">.</span><code><a href="#widl-MediaKeySystemAccess-createMediaKeys-Promise-MediaKeys">createMediaKeys</a></code><span class="pun">();</span><span class="pln">
          </span><span class="pun">}</span><span class="pln">
        </span><span class="pun">);</span><span class="pln">
      </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">).</span><span class="kwd">catch</span><span class="pun">(</span><span class="pln">
      console</span><span class="pun">.</span><span class="pln">error</span><span class="pun">.</span><span class="pln">bind</span><span class="pun">(</span><span class="pln">console</span><span class="pun">,</span><span class="pln"> </span><span class="str">"Unable to instantiate a key system supporting the required combinations"</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">);</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">

  </span><span class="kwd">function</span><span class="pln"> handleInitData</span><span class="pun">(</span><span class="pln">event</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">var</span><span class="pln"> video </span><span class="pun">=</span><span class="pln"> event</span><span class="pun">.</span><span class="pln">target</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">video</span><span class="pun">.</span><span class="pln">mediaKeysObject </span><span class="pun">===</span><span class="pln"> </span><span class="kwd">undefined</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      video</span><span class="pun">.</span><span class="pln">mediaKeysObject </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span><span class="pln"> </span><span class="com">// Prevent entering this path again.</span><span class="pln">
      video</span><span class="pun">.</span><span class="pln">pendingSessionData </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[];</span><span class="pln"> </span><span class="com">// Will store all initData until the MediaKeys is ready.</span><span class="pln">
      createSupportedKeySystem</span><span class="pun">().</span><span class="pln">then</span><span class="pun">(</span><span class="pln">
        </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">createdMediaKeys</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
          video</span><span class="pun">.</span><span class="pln">mediaKeysObject </span><span class="pun">=</span><span class="pln"> createdMediaKeys</span><span class="pun">;</span><span class="pln">

          </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">serverCertificate</span><span class="pun">)</span><span class="pln">
            createdMediaKeys</span><span class="pun">.</span><code><a href="#widl-MediaKeys-setServerCertificate-Promise-void--BufferSource-serverCertificate">setServerCertificate</a></code><span class="pun">(</span><span class="pln">serverCertificate</span><span class="pun">);</span><span class="pln">

          </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">var</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> video</span><span class="pun">.</span><span class="pln">pendingSessionData</span><span class="pun">.</span><span class="pln">length</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">var</span><span class="pln"> data </span><span class="pun">=</span><span class="pln"> video</span><span class="pun">.</span><span class="pln">pendingSessionData</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
            makeNewRequest</span><span class="pun">(</span><span class="pln">video</span><span class="pun">.</span><span class="pln">mediaKeysObject</span><span class="pun">,</span><span class="pln"> data</span><span class="pun">.</span><span class="pln">initDataType</span><span class="pun">,</span><span class="pln"> data</span><span class="pun">.</span><span class="pln">initData</span><span class="pun">);</span><span class="pln">
          </span><span class="pun">}</span><span class="pln">
          video</span><span class="pun">.</span><span class="pln">pendingSessionData </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[];</span><span class="pln">

          </span><span class="kwd">return</span><span class="pln"> video</span><span class="pun">.</span><code><a href="#widl-HTMLMediaElement-setMediaKeys-Promise-void--MediaKeys-mediaKeys">setMediaKeys</a></code><span class="pun">(</span><span class="pln">createdMediaKeys</span><span class="pun">);</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
      </span><span class="pun">).</span><span class="kwd">catch</span><span class="pun">(</span><span class="pln">
        console</span><span class="pun">.</span><span class="pln">error</span><span class="pun">.</span><span class="pln">bind</span><span class="pun">(</span><span class="pln">console</span><span class="pun">,</span><span class="pln"> </span><span class="str">"Failed to create and initialize a MediaKeys object"</span><span class="pun">)</span><span class="pln">
      </span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    addSession</span><span class="pun">(</span><span class="pln">video</span><span class="pun">,</span><span class="pln"> event</span><span class="pun">.</span><code><a href="#widl-MediaEncryptedEventInit-initDataType">initDataType</a></code><span class="pun">,</span><span class="pln"> event</span><span class="pun">.</span><code><a href="#widl-MediaEncryptedEventInit-initData">initData</a></code><span class="pun">);</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">

  </span><span class="kwd">function</span><span class="pln"> addSession</span><span class="pun">(</span><span class="pln">video</span><span class="pun">,</span><span class="pln"> initDataType</span><span class="pun">,</span><span class="pln"> initData</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">video</span><span class="pun">.</span><span class="pln">mediaKeysObject</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      makeNewRequest</span><span class="pun">(</span><span class="pln">video</span><span class="pun">.</span><span class="pln">mediaKeysObject</span><span class="pun">,</span><span class="pln"> initDataType</span><span class="pun">,</span><span class="pln"> initData</span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      video</span><span class="pun">.</span><span class="pln">pendingSessionData</span><span class="pun">.</span><span class="pln">push</span><span class="pun">({</span><span class="pln">initDataType</span><span class="pun">:</span><span class="pln"> initDataType</span><span class="pun">,</span><span class="pln"> initData</span><span class="pun">:</span><span class="pln"> initData</span><span class="pun">});</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">

  </span><span class="kwd">function</span><span class="pln"> makeNewRequest</span><span class="pun">(</span><span class="pln">mediaKeys</span><span class="pun">,</span><span class="pln"> initDataType</span><span class="pun">,</span><span class="pln"> initData</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">var</span><span class="pln"> keySession </span><span class="pun">=</span><span class="pln"> mediaKeys</span><span class="pun">.</span><code><a href="#widl-MediaKeys-createSession-MediaKeySession-SessionType-sessionType">createSession</a></code><span class="pun">();</span><span class="pln">
    keySession</span><span class="pun">.</span><span class="pln">addEventListener</span><span class="pun">(</span><span class="str">"</span><code><a href="#dom-evt-message">message</a></code><span class="str">"</span><span class="pun">,</span><span class="pln"> licenseRequestReady</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">);</span><span class="pln">
    keySession</span><span class="pun">.</span><code><a href="#widl-MediaKeySession-generateRequest-Promise-void--DOMString-initDataType-BufferSource-initData">generateRequest</a></code><span class="pun">(</span><span class="pln">initDataType</span><span class="pun">,</span><span class="pln"> initData</span><span class="pun">).</span><span class="kwd">catch</span><span class="pun">(</span><span class="pln">
      console</span><span class="pun">.</span><span class="pln">error</span><span class="pun">.</span><span class="pln">bind</span><span class="pun">(</span><span class="pln">console</span><span class="pun">,</span><span class="pln"> </span><span class="str">"Unable to create or initialize key session"</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">);</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">

  </span><span class="kwd">function</span><span class="pln"> licenseRequestReady</span><span class="pun">(</span><span class="pln">event</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">var</span><span class="pln"> request </span><span class="pun">=</span><span class="pln"> event</span><span class="pun">.</span><code><a href="#widl-MediaKeyMessageEvent-message">message</a></code><span class="pun">;</span><span class="pln">

    </span><span class="kwd">var</span><span class="pln"> xmlhttp </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">XMLHttpRequest</span><span class="pun">();</span><span class="pln">
    xmlhttp</span><span class="pun">.</span><span class="pln">keySession </span><span class="pun">=</span><span class="pln"> event</span><span class="pun">.</span><span class="pln">target</span><span class="pun">;</span><span class="pln">
    xmlhttp</span><span class="pun">.</span><span class="pln">open</span><span class="pun">(</span><span class="str">"POST"</span><span class="pun">,</span><span class="pln"> licenseUrl</span><span class="pun">);</span><span class="pln">
    xmlhttp</span><span class="pun">.</span><span class="pln">onreadystatechange </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">xmlhttp</span><span class="pun">.</span><span class="pln">readyState </span><span class="pun">==</span><span class="pln"> </span><span class="lit">4</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">var</span><span class="pln"> license </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Uint8Array</span><span class="pun">(</span><span class="pln">xmlhttp</span><span class="pun">.</span><span class="pln">response</span><span class="pun">);</span><span class="pln">
        xmlhttp</span><span class="pun">.</span><span class="pln">keySession</span><span class="pun">.</span><code><a href="#widl-MediaKeySession-update-Promise-void--BufferSource-response">update</a></code><span class="pun">(</span><span class="pln">license</span><span class="pun">).</span><span class="kwd">catch</span><span class="pun">(</span><span class="pln">
          console</span><span class="pun">.</span><span class="pln">error</span><span class="pun">.</span><span class="pln">bind</span><span class="pun">(</span><span class="pln">console</span><span class="pun">,</span><span class="pln"> </span><span class="str">"update() failed"</span><span class="pun">)</span><span class="pln">
        </span><span class="pun">);</span><span class="pln">
      </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    xmlhttp</span><span class="pun">.</span><span class="pln">send</span><span class="pun">(</span><span class="pln">request</span><span class="pun">);</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
</span><span class="tag">&lt;/script&gt;</span><span class="pln">

</span><span class="tag">&lt;video</span><span class="pln"> </span><span class="atn">src</span><span class="pun">=</span><span class="atv">"foo.webm"</span><span class="pln"> </span><span class="atn">autoplay</span><span class="pln"> </span><code><a href="#widl-HTMLMediaElement-onencrypted">onencrypted</a></code><span class="pun">=</span><span class="atv">"handleInitData(event)"</span><span class="tag">&gt;&lt;/video&gt;</span></pre></div>
      </section>
  
      <section id="example-mediakeys-before-source" typeof="bibo:Chapter" resource="#example-mediakeys-before-source" rel="bibo:Chapter">
        <h3 role="heading" id="h3_example-mediakeys-before-source"><span class="secno">10.3 </span>Create MediaKeys Before Loading Media</h3>
        <p class="exampledescription">Initialization is much simpler if encrypted events do not need to be handled during MediaKeys initialization.
        This can be accomplished either by providing the <a href="#initialization-data">Initialization Data</a> in other ways or setting the source after the MediaKeys object has been created.
        This example does the latter.
        </p>
    
        <div class="example"><div class="example-title"><span>Example 5</span></div><pre class="example highlight prettyprint prettyprinted"><span class="tag">&lt;script&gt;</span><span class="pln">
  </span><span class="kwd">var</span><span class="pln"> licenseUrl</span><span class="pun">;</span><span class="pln">
  </span><span class="kwd">var</span><span class="pln"> serverCertificate</span><span class="pun">;</span><span class="pln">
  </span><span class="kwd">var</span><span class="pln"> mediaKeys</span><span class="pun">;</span><span class="pln">

  </span><span class="com">// See the previous example for implementations of these functions.</span><span class="pln">
  </span><span class="kwd">function</span><span class="pln"> createSupportedKeySystem</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">...</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
  </span><span class="kwd">function</span><span class="pln"> makeNewRequest</span><span class="pun">(</span><span class="pln">mediaKeys</span><span class="pun">,</span><span class="pln"> initDataType</span><span class="pun">,</span><span class="pln"> initData</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">...</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
  </span><span class="kwd">function</span><span class="pln"> licenseRequestReady</span><span class="pun">(</span><span class="pln">event</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">...</span><span class="pln"> </span><span class="pun">}</span><span class="pln">

  </span><span class="kwd">function</span><span class="pln"> handleInitData</span><span class="pun">(</span><span class="pln">event</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    makeNewRequest</span><span class="pun">(</span><span class="pln">mediaKeys</span><span class="pun">,</span><span class="pln"> event</span><span class="pun">.</span><code><a href="#widl-MediaEncryptedEventInit-initDataType">initDataType</a></code><span class="pun">,</span><span class="pln"> event</span><span class="pun">.</span><code><a href="#widl-MediaEncryptedEventInit-initData">initData</a></code><span class="pun">);</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">

  createSupportedKeySystem</span><span class="pun">().</span><span class="pln">then</span><span class="pun">(</span><span class="pln">
    </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">createdMediaKeys</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      mediaKeys </span><span class="pun">=</span><span class="pln"> createdMediaKeys</span><span class="pun">;</span><span class="pln">
      </span><span class="kwd">var</span><span class="pln"> video </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">getElementById</span><span class="pun">(</span><span class="str">"v"</span><span class="pun">);</span><span class="pln">
      video</span><span class="pun">.</span><span class="pln">src </span><span class="pun">=</span><span class="pln"> </span><span class="str">"foo.webm"</span><span class="pun">;</span><span class="pln">
      </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">serverCertificate</span><span class="pun">)</span><span class="pln">
        mediaKeys</span><span class="pun">.</span><code><a href="#widl-MediaKeys-setServerCertificate-Promise-void--BufferSource-serverCertificate">setServerCertificate</a></code><span class="pun">(</span><span class="pln">serverCertificate</span><span class="pun">);</span><span class="pln">
      </span><span class="kwd">return</span><span class="pln"> video</span><span class="pun">.</span><code><a href="#widl-HTMLMediaElement-setMediaKeys-Promise-void--MediaKeys-mediaKeys">setMediaKeys</a></code><span class="pun">(</span><span class="pln">mediaKeys</span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
  </span><span class="pun">).</span><span class="kwd">catch</span><span class="pun">(</span><span class="pln">
    console</span><span class="pun">.</span><span class="pln">error</span><span class="pun">.</span><span class="pln">bind</span><span class="pun">(</span><span class="pln">console</span><span class="pun">,</span><span class="pln"> </span><span class="str">"Failed to create and initialize a MediaKeys object"</span><span class="pun">)</span><span class="pln">
  </span><span class="pun">);</span><span class="pln">
</span><span class="tag">&lt;/script&gt;</span><span class="pln">

</span><span class="tag">&lt;video</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"v"</span><span class="pln"> </span><span class="atn">autoplay</span><span class="pln"> </span><code><a href="#widl-HTMLMediaElement-onencrypted">onencrypted</a></code><span class="pun">=</span><span class="atv">"handleInitData(event)"</span><span class="tag">&gt;&lt;/video&gt;</span></pre></div>
      </section>
  
      <section id="example-using-all-events" typeof="bibo:Chapter" resource="#example-using-all-events" rel="bibo:Chapter">
        <h3 role="heading" id="h3_example-using-all-events"><span class="secno">10.4 </span>Using All Events</h3>
        <p class="exampledescription">This is a more complete example showing all events being used.</p>
        <p class="exampledescription">Note that <code>handleMessage()</code> could be called multiple times, including in response to the <code><a href="#widl-MediaKeySession-update-Promise-void--BufferSource-response">update()</a></code> call if multiple round trips are required and for any other reason the Key System might need to send a message.</p>
    
        <div class="example"><div class="example-title"><span>Example 6</span></div><pre class="example highlight prettyprint prettyprinted"><span class="tag">&lt;script&gt;</span><span class="pln">
  </span><span class="kwd">var</span><span class="pln"> licenseUrl</span><span class="pun">;</span><span class="pln">
  </span><span class="kwd">var</span><span class="pln"> serverCertificate</span><span class="pun">;</span><span class="pln">
  </span><span class="kwd">var</span><span class="pln"> mediaKeys</span><span class="pun">;</span><span class="pln">

  </span><span class="com">// See previous examples for implementations of these functions.</span><span class="pln">
  </span><span class="com">// createSupportedKeySystem() additionally sets renewalUrl.</span><span class="pln">
  </span><span class="kwd">function</span><span class="pln"> createSupportedKeySystem</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">...</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
  </span><span class="kwd">function</span><span class="pln"> handleInitData</span><span class="pun">(</span><span class="pln">event</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">...</span><span class="pln"> </span><span class="pun">}</span><span class="pln">

  </span><span class="com">// This replaces the implementation in the previous example.</span><span class="pln">
  </span><span class="kwd">function</span><span class="pln"> makeNewRequest</span><span class="pun">(</span><span class="pln">mediaKeys</span><span class="pun">,</span><span class="pln"> initDataType</span><span class="pun">,</span><span class="pln"> initData</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">var</span><span class="pln"> keySession </span><span class="pun">=</span><span class="pln"> mediaKeys</span><span class="pun">.</span><code><a href="#widl-MediaKeys-createSession-MediaKeySession-SessionType-sessionType">createSession</a></code><span class="pun">();</span><span class="pln">
    keySession</span><span class="pun">.</span><span class="pln">addEventListener</span><span class="pun">(</span><span class="str">"</span><code><a href="#dom-evt-message">message</a></code><span class="str">"</span><span class="pun">,</span><span class="pln"> handleMessage</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">);</span><span class="pln">
    keySession</span><span class="pun">.</span><span class="pln">addEventListener</span><span class="pun">(</span><span class="str">"</span><code><a href="#dom-evt-keyschange">keyschange</a></code><span class="str">"</span><span class="pun">,</span><span class="pln"> handleKeysChange</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">);</span><span class="pln">
    keySession</span><span class="pun">.</span><code><a href="#widl-MediaKeySession-closed">closed</a></code><span class="pun">.</span><span class="pln">then</span><span class="pun">(</span><span class="pln">
      console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">.</span><span class="pln">bind</span><span class="pun">(</span><span class="pln">console</span><span class="pun">,</span><span class="pln"> </span><span class="str">"Session closed"</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">);</span><span class="pln">
    keySession</span><span class="pun">.</span><code><a href="#widl-MediaKeySession-generateRequest-Promise-void--DOMString-initDataType-BufferSource-initData">generateRequest</a></code><span class="pun">(</span><span class="pln">initDataType</span><span class="pun">,</span><span class="pln"> initData</span><span class="pun">).</span><span class="kwd">catch</span><span class="pun">(</span><span class="pln">
      console</span><span class="pun">.</span><span class="pln">error</span><span class="pun">.</span><span class="pln">bind</span><span class="pun">(</span><span class="pln">console</span><span class="pun">,</span><span class="pln"> </span><span class="str">"Unable to create or initialize key session"</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">);</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">

  </span><span class="kwd">function</span><span class="pln"> handleMessageResponse</span><span class="pun">(</span><span class="pln">keySession</span><span class="pun">,</span><span class="pln"> response</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">var</span><span class="pln"> license </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Uint8Array</span><span class="pun">(</span><span class="pln">response</span><span class="pun">);</span><span class="pln">
    keySession</span><span class="pun">.</span><code><a href="#widl-MediaKeySession-update-Promise-void--BufferSource-response">update</a></code><span class="pun">(</span><span class="pln">license</span><span class="pun">).</span><span class="kwd">catch</span><span class="pun">(</span><span class="pln">
      </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">err</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        console</span><span class="pun">.</span><span class="pln">error</span><span class="pun">(</span><span class="str">"update() failed: "</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> err</span><span class="pun">);</span><span class="pln">
      </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">);</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">

  </span><span class="kwd">function</span><span class="pln"> sendMessage</span><span class="pun">(</span><span class="pln">type</span><span class="pun">,</span><span class="pln"> message</span><span class="pun">,</span><span class="pln"> keySession</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">var</span><span class="pln"> url </span><span class="pun">=</span><span class="pln"> licenseUrl</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">type </span><span class="pun">==</span><span class="pln"> </span><code><a href="#idl-def-MediaKeyMessageType.licenserenewal">"licenserenewal"</a></code><span class="pun">)</span><span class="pln">
      url </span><span class="pun">=</span><span class="pln"> renewalUrl</span><span class="pun">;</span><span class="pln">
    xmlhttp </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">XMLHttpRequest</span><span class="pun">();</span><span class="pln">
    xmlhttp</span><span class="pun">.</span><span class="pln">keySession </span><span class="pun">=</span><span class="pln"> keySession</span><span class="pun">;</span><span class="pln">
    xmlhttp</span><span class="pun">.</span><span class="pln">open</span><span class="pun">(</span><span class="str">"POST"</span><span class="pun">,</span><span class="pln"> url</span><span class="pun">);</span><span class="pln">
    xmlhttp</span><span class="pun">.</span><span class="pln">onreadystatechange </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">xmlhttp</span><span class="pun">.</span><span class="pln">readyState </span><span class="pun">==</span><span class="pln"> </span><span class="lit">4</span><span class="pun">)</span><span class="pln">
        handleMessageResponse</span><span class="pun">(</span><span class="pln">xmlhttp</span><span class="pun">.</span><span class="pln">keySession</span><span class="pun">,</span><span class="pln"> xmlhttp</span><span class="pun">.</span><span class="pln">response</span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    xmlhttp</span><span class="pun">.</span><span class="pln">send</span><span class="pun">(</span><span class="pln">message</span><span class="pun">);</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">

  </span><span class="kwd">function</span><span class="pln"> handleMessage</span><span class="pun">(</span><span class="pln">event</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    sendMessage</span><span class="pun">(</span><span class="pln">event</span><span class="pun">.</span><code><a href="#widl-MediaKeyMessageEvent-messageType">messageType</a></code><span class="pun">,</span><span class="pln"> event</span><span class="pun">.</span><code><a href="#widl-MediaKeyMessageEvent-message">message</a></code><span class="pun">,</span><span class="pln"> event</span><span class="pun">.</span><span class="pln">target</span><span class="pun">);</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">

  </span><span class="kwd">function</span><span class="pln"> handleKeysChange</span><span class="pun">(</span><span class="pln">event</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    event</span><span class="pun">.</span><span class="pln">target</span><span class="pun">.</span><code><a href="#widl-MediaKeySession-getUsableKeyIds-Promise-sequence-ArrayBuffer">getUsableKeyIds</a></code><span class="pun">().</span><span class="pln">then</span><span class="pun">(</span><span class="pln">
      </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">keyIdSequence</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="com">// Process keyIdSequence and respond appropriately.</span><span class="pln">
      </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">).</span><span class="kwd">catch</span><span class="pun">(</span><span class="pln">
      console</span><span class="pun">.</span><span class="pln">error</span><span class="pun">.</span><span class="pln">bind</span><span class="pun">(</span><span class="pln">console</span><span class="pun">,</span><span class="pln"> </span><span class="str">"Failed handling usable keys change"</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">);</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">

  </span><span class="kwd">function</span><span class="pln"> handleError</span><span class="pun">(</span><span class="pln">event</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="com">// Report </span><!-- TODO: Remove or fix when bug 26372 is addressed.
    event.target.error.name and event.target.error.<a def-id="systemCode"></a>,
    //  --><span class="com">and do some bookkeeping with event.target.</span><code><a href="#widl-MediaKeySession-sessionId">sessionId</a></code><span class="com"> if necessary.</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">

  createSupportedKeySystem</span><span class="pun">().</span><span class="pln">then</span><span class="pun">(</span><span class="pln">
    </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">createdMediaKeys</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      mediaKeys </span><span class="pun">=</span><span class="pln"> createdMediaKeys</span><span class="pun">;</span><span class="pln">
      </span><span class="kwd">var</span><span class="pln"> video </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">getElementById</span><span class="pun">(</span><span class="str">"v"</span><span class="pun">);</span><span class="pln">
      video</span><span class="pun">.</span><span class="pln">src </span><span class="pun">=</span><span class="pln"> </span><span class="str">"foo.webm"</span><span class="pun">;</span><span class="pln">
      </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">serverCertificate</span><span class="pun">)</span><span class="pln">
        mediaKeys</span><span class="pun">.</span><code><a href="#widl-MediaKeys-setServerCertificate-Promise-void--BufferSource-serverCertificate">setServerCertificate</a></code><span class="pun">(</span><span class="pln">serverCertificate</span><span class="pun">);</span><span class="pln">
      </span><span class="kwd">return</span><span class="pln"> video</span><span class="pun">.</span><code><a href="#widl-HTMLMediaElement-setMediaKeys-Promise-void--MediaKeys-mediaKeys">setMediaKeys</a></code><span class="pun">(</span><span class="pln">mediaKeys</span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
  </span><span class="pun">).</span><span class="kwd">catch</span><span class="pun">(</span><span class="pln">
    console</span><span class="pun">.</span><span class="pln">error</span><span class="pun">.</span><span class="pln">bind</span><span class="pun">(</span><span class="pln">console</span><span class="pun">,</span><span class="pln"> </span><span class="str">"Failed to create and initialize a MediaKeys object"</span><span class="pun">)</span><span class="pln">
  </span><span class="pun">);</span><span class="pln">
</span><span class="tag">&lt;/script&gt;</span><span class="pln">

</span><span class="tag">&lt;video</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"v"</span><span class="pln"> </span><span class="atn">autoplay</span><span class="pln"> </span><code><a href="#widl-HTMLMediaElement-onencrypted">onencrypted</a></code><span class="pun">=</span><span class="atv">"handleInitData(event)"</span><span class="tag">&gt;&lt;/video&gt;</span></pre></div>
      </section>
  
      <section id="example-stored-license" typeof="bibo:Chapter" resource="#example-stored-license" rel="bibo:Chapter">
        <h3 role="heading" id="h3_example-stored-license"><span class="secno">10.5 </span>Stored License</h3>
        <p class="exampledescription">This example requests a persistent license for future use and stores it. It also provides functions for later retrieving the license and for destroying it.</p>
    
        <div class="example"><div class="example-title"><span>Example 7</span></div><pre class="example highlight prettyprint prettyprinted"><span class="tag">&lt;script&gt;</span><span class="pln">
  </span><span class="kwd">var</span><span class="pln"> licenseUrl</span><span class="pun">;</span><span class="pln">
  </span><span class="kwd">var</span><span class="pln"> serverCertificate</span><span class="pun">;</span><span class="pln">
  </span><span class="kwd">var</span><span class="pln"> mediaKeys</span><span class="pun">;</span><span class="pln">

  </span><span class="com">// See the previous examples for implementations of these functions.</span><span class="pln">
  </span><span class="com">// createSupportedKeySystem() additionally sets </span><code><a href="#widl-MediaKeySystemOptions-stateful">stateful</a></code><span class="com">: </span><code><a href="#idl-def-MediaKeysRequirement.required">"required"</a></code><span class="com"> in each options dictionary.</span><span class="pln">
  </span><span class="kwd">function</span><span class="pln"> createSupportedKeySystem</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">...</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
  </span><span class="kwd">function</span><span class="pln"> sendMessage</span><span class="pun">(</span><span class="pln">message</span><span class="pun">,</span><span class="pln"> keySession</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">...</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
  </span><span class="kwd">function</span><span class="pln"> handleMessage</span><span class="pun">(</span><span class="pln">event</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">...</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
  </span><span class="kwd">function</span><span class="pln"> handleError</span><span class="pun">(</span><span class="pln">event</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">...</span><span class="pln"> </span><span class="pun">}</span><span class="pln">

  </span><span class="com">// Called if the application does not have a stored sessionId for the media resource.</span><span class="pln">
  </span><span class="kwd">function</span><span class="pln"> makeNewRequest</span><span class="pun">(</span><span class="pln">mediaKeys</span><span class="pun">,</span><span class="pln"> initDataType</span><span class="pun">,</span><span class="pln"> initData</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">var</span><span class="pln"> keySession </span><span class="pun">=</span><span class="pln"> mediaKeys</span><span class="pun">.</span><code><a href="#widl-MediaKeys-createSession-MediaKeySession-SessionType-sessionType">createSession</a></code><span class="pun">(</span><code><a href="#idl-def-SessionType.persistent">"persistent"</a></code><span class="pun">);</span><span class="pln">
    keySession</span><span class="pun">.</span><span class="pln">addEventListener</span><span class="pun">(</span><span class="str">"</span><code><a href="#dom-evt-message">message</a></code><span class="str">"</span><span class="pun">,</span><span class="pln"> handleMessage</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">);</span><span class="pln">
    keySession</span><span class="pun">.</span><code><a href="#widl-MediaKeySession-closed">closed</a></code><span class="pun">.</span><span class="pln">then</span><span class="pun">(</span><span class="pln">
      </span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="str">"Session "</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><code><a href="#widl-MediaKeySession-sessionId">sessionId</a></code><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="str">" closed"</span><span class="pun">);</span><span class="pln">
      </span><span class="pun">}.</span><span class="pln">bind</span><span class="pun">(</span><span class="pln">keySession</span><span class="pun">)</span><span class="pln">        
    </span><span class="pun">);</span><span class="pln">
    keySession</span><span class="pun">.</span><code><a href="#widl-MediaKeySession-generateRequest-Promise-void--DOMString-initDataType-BufferSource-initData">generateRequest</a></code><span class="pun">(</span><span class="pln">initDataType</span><span class="pun">,</span><span class="pln"> initData</span><span class="pun">).</span><span class="pln">then</span><span class="pun">(</span><span class="pln">
      </span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="com">// Store this.</span><code><a href="#widl-MediaKeySession-sessionId">sessionId</a></code><span class="com"> in the application.</span><span class="pln">
      </span><span class="pun">}.</span><span class="pln">bind</span><span class="pun">(</span><span class="pln">keySession</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">).</span><span class="kwd">catch</span><span class="pun">(</span><span class="pln">
      console</span><span class="pun">.</span><span class="pln">error</span><span class="pun">.</span><span class="pln">bind</span><span class="pun">(</span><span class="pln">console</span><span class="pun">,</span><span class="pln"> </span><span class="str">"Unable to create or initialize a persistable key session"</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">);</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">

  </span><span class="com">// Called if the application has a stored sessionId for the media resource.</span><span class="pln">
  </span><span class="kwd">function</span><span class="pln"> loadStoredSession</span><span class="pun">(</span><span class="pln">mediaKeys</span><span class="pun">,</span><span class="pln"> sessionId</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">var</span><span class="pln"> keySession </span><span class="pun">=</span><span class="pln"> mediaKeys</span><span class="pun">.</span><code><a href="#widl-MediaKeys-createSession-MediaKeySession-SessionType-sessionType">createSession</a></code><span class="pun">(</span><code><a href="#idl-def-SessionType.persistent">"persistent"</a></code><span class="pun">);</span><span class="pln">
    keySession</span><span class="pun">.</span><span class="pln">addEventListener</span><span class="pun">(</span><span class="str">"</span><code><a href="#dom-evt-message">message</a></code><span class="str">"</span><span class="pun">,</span><span class="pln"> handleMessage</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">);</span><span class="pln">
    keySession</span><span class="pun">.</span><code><a href="#widl-MediaKeySession-closed">closed</a></code><span class="pun">.</span><span class="pln">then</span><span class="pun">(</span><span class="pln">
      console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">.</span><span class="pln">bind</span><span class="pun">(</span><span class="pln">console</span><span class="pun">,</span><span class="pln"> </span><span class="str">"Session closed"</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">);</span><span class="pln">
    keySession</span><span class="pun">.</span><code><a href="#widl-MediaKeySession-load-Promise-boolean--DOMString-sessionId">load</a></code><span class="pun">(</span><span class="pln">sessionId</span><span class="pun">).</span><span class="pln">then</span><span class="pun">(</span><span class="pln">
      </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">loaded</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">loaded</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
          console</span><span class="pun">.</span><span class="pln">error</span><span class="pun">(</span><span class="str">"No stored session with the ID "</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> sessionId </span><span class="pun">+</span><span class="pln"> </span><span class="str">" was found."</span><span class="pun">);</span><span class="pln">
          </span><span class="com">// The application should remove its record of |sessionId|.</span><span class="pln">
          </span><span class="kwd">return</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
      </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">).</span><span class="kwd">catch</span><span class="pun">(</span><span class="pln">
      console</span><span class="pun">.</span><span class="pln">error</span><span class="pun">.</span><span class="pln">bind</span><span class="pun">(</span><span class="pln">console</span><span class="pun">,</span><span class="pln"> </span><span class="str">"Unable to load or initialize the stored session with the ID "</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> sessionId</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">);</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">

  </span><span class="com">// Called when the application wants to stop using the session without removing the stored license.</span><span class="pln">
  </span><span class="kwd">function</span><span class="pln"> closeSession</span><span class="pun">(</span><span class="pln">keySession</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    keySession</span><span class="pun">.</span><code><a href="#widl-MediaKeySession-close-Promise-void">close</a></code><span class="pun">();</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">

  </span><span class="com">// Called when the application wants to remove the stored license.</span><span class="pln">
  </span><span class="com">// The stored session data has not been completely removed until the promise returned by remove() is fulfilled.</span><span class="pln">
  </span><span class="com">// The remove() call may initiate a series of messages to/from the server that must be completed before this occurs.</span><span class="pln">
  </span><span class="kwd">function</span><span class="pln"> removeStoredSession</span><span class="pun">(</span><span class="pln">keySession</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    keySession</span><span class="pun">.</span><code><a href="#widl-MediaKeySession-remove-Promise-void">remove</a></code><span class="pun">().</span><span class="pln">then</span><span class="pun">(</span><span class="pln">
      </span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="str">"Session "</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><code><a href="#widl-MediaKeySession-sessionId">sessionId</a></code><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="str">" removed"</span><span class="pun">);</span><span class="pln">
        </span><span class="com">// The application should remove its record of this.</span><code><a href="#widl-MediaKeySession-sessionId">sessionId</a></code><span class="com">.</span><span class="pln">
      </span><span class="pun">}.</span><span class="pln">bind</span><span class="pun">(</span><span class="pln">keySession</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">).</span><span class="kwd">catch</span><span class="pun">(</span><span class="pln">
      console</span><span class="pun">.</span><span class="pln">error</span><span class="pun">.</span><span class="pln">bind</span><span class="pun">(</span><span class="pln">console</span><span class="pun">,</span><span class="pln"> </span><span class="str">"Failed to remove the session"</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">);</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">

  </span><span class="com">// This replaces the implementation in the previous example.</span><span class="pln">
  </span><span class="kwd">function</span><span class="pln"> handleMessageResponse</span><span class="pun">(</span><span class="pln">keySession</span><span class="pun">,</span><span class="pln"> response</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">var</span><span class="pln"> license </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Uint8Array</span><span class="pun">(</span><span class="pln">response</span><span class="pun">);</span><span class="pln">
    keySession</span><span class="pun">.</span><code><a href="#widl-MediaKeySession-update-Promise-void--BufferSource-response">update</a></code><span class="pun">(</span><span class="pln">license</span><span class="pun">).</span><span class="pln">then</span><span class="pun">(</span><span class="pln">
      </span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="com">// If this was the last required message from the server, the license is</span><span class="pln">
        </span><span class="com">// now stored. Update the application state as appropriate.</span><span class="pln">
      </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">).</span><span class="kwd">catch</span><span class="pun">(</span><span class="pln">
      console</span><span class="pun">.</span><span class="pln">error</span><span class="pun">.</span><span class="pln">bind</span><span class="pun">(</span><span class="pln">console</span><span class="pun">,</span><span class="pln"> </span><span class="str">"update() failed"</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">);</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">

  createSupportedKeySystem</span><span class="pun">().</span><span class="pln">then</span><span class="pun">(</span><span class="pln">
    </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">createdMediaKeys</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      mediaKeys </span><span class="pun">=</span><span class="pln"> createdMediaKeys</span><span class="pun">;</span><span class="pln">
      </span><span class="kwd">var</span><span class="pln"> video </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">getElementById</span><span class="pun">(</span><span class="str">"v"</span><span class="pun">);</span><span class="pln">
      </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">serverCertificate</span><span class="pun">)</span><span class="pln">
        mediaKeys</span><span class="pun">.</span><code><a href="#widl-MediaKeys-setServerCertificate-Promise-void--BufferSource-serverCertificate">setServerCertificate</a></code><span class="pun">(</span><span class="pln">serverCertificate</span><span class="pun">);</span><span class="pln">
      </span><span class="kwd">return</span><span class="pln"> video</span><span class="pun">.</span><code><a href="#widl-HTMLMediaElement-setMediaKeys-Promise-void--MediaKeys-mediaKeys">setMediaKeys</a></code><span class="pun">(</span><span class="pln">mediaKeys</span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
  </span><span class="pun">).</span><span class="kwd">catch</span><span class="pun">(</span><span class="pln">
    console</span><span class="pun">.</span><span class="pln">error</span><span class="pun">.</span><span class="pln">bind</span><span class="pun">(</span><span class="pln">console</span><span class="pun">,</span><span class="pln"> </span><span class="str">"Failed to create and initialize a MediaKeys object"</span><span class="pun">)</span><span class="pln">
  </span><span class="pun">);</span><span class="pln">
</span><span class="tag">&lt;/script&gt;</span><span class="pln">

</span><span class="tag">&lt;video</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"v"</span><span class="pln"> </span><span class="atn">src</span><span class="pun">=</span><span class="atv">"foo.webm"</span><span class="pln"> </span><span class="atn">autoplay</span><span class="tag">&gt;&lt;/video&gt;</span></pre></div>
      </section>
    </section>


    <section id="revision-history" typeof="bibo:Chapter" resource="#revision-history" rel="bibo:Chapter">
      <!--OddPage--><h2 role="heading" id="h2_revision-history"><span class="secno">11. </span>Revision History</h2>
      <table class="old-table">
        <thead>
          <tr>
            <th>Version</th>
            <th>Comment</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><a href="http://dvcs.w3.org/hg/html-media/raw-file/1130aeb43e71/encrypted-media/encrypted-media.html">10 October 2014</a></td>
            <td>Converted to <a href="https://www.w3.org/respec/">ReSpec</a>.</td>
          </tr>
          <tr>
            <td><a href="http://dvcs.w3.org/hg/html-media/raw-file/a291ac57bad3/encrypted-media/encrypted-media.html">3 September 2014</a></td>
            <td>Reorganized by object.</td>
          </tr>
          <tr>
            <td><a href="http://dvcs.w3.org/hg/html-media/raw-file/3a5e8f5332a2/encrypted-media/encrypted-media.html">27 August 2014</a></td>
            <td>Moved license request generation and session loading to MediaKeySession.</td>
          </tr>
          <tr>
            <td><a href="http://dvcs.w3.org/hg/html-media/raw-file/9a94854a5999/encrypted-media/encrypted-media.html">18 August 2014</a></td>
            <td>Produced candidate WD.</td>
          </tr>
          <tr>
            <td><a href="https://dvcs.w3.org/hg/html-media/raw-file/9842af174b80/encrypted-media/encrypted-media.html">14 April 2014</a></td>
            <td>Use promises.</td>
          </tr>
          <tr>
            <td><a href="http://dvcs.w3.org/hg/html-media/raw-file/ef65c237d053/encrypted-media/encrypted-media.html">1 April 2014</a></td>
            <td>Moved Container Guidelines to the <a href="initdata-format-registry.html">Encrypted Media Extensions Stream Format and Initialization Data Format Registry</a>.</td>
          </tr>
          <tr>
            <td><a href="http://dvcs.w3.org/hg/html-media/raw-file/11245f9516cf/encrypted-media/encrypted-media.html">3 February 2014</a></td>
            <td>Produced candidate WD.</td>
          </tr>
          <tr>
            <td>17 September 2013</td>
            <td>Produced candidate WD.</td>
          </tr>
          <tr>
            <td>6 May 2013</td>
            <td>Produced updated candidate FPWD.</td>
          </tr>
          <tr>
            <td>14 January 2013</td>
            <td>Produced candidate FPWD.</td>
          </tr>
          <tr>
            <td>16 August 2012</td>
            <td>Converted to the object-oriented API.</td>
          </tr>
          <tr>
            <td><a href="http://dvcs.w3.org/hg/html-media/raw-file/eme-v0.1b/encrypted-media/encrypted-media.html">0.1b</a></td>
            <td>Last non-object-oriented revision.</td>
          </tr>
          <tr>
            <td><a href="http://dvcs.w3.org/hg/html-media/raw-file/eme-v0.1a/encrypted-media/encrypted-media.html">0.1a</a></td>
            <td>Corrects minor mistakes in 0.1.</td>
          </tr>
          <tr>
            <td><a href="http://dvcs.w3.org/hg/html-media/raw-file/eme-v0.1/encrypted-media/encrypted-media.html">0.1</a></td>
            <td>Initial Proposal</td>
          </tr>
        </tbody>
      </table>
    </section>

  

<form id="bug-assist-form" action="//www.w3.org/Bugs/Public/enter_bug.cgi" target="_blank">See a problem? Select text and <input type="submit" accesskey="f" value="file a bug" style="font-family: Tahoma, sans-serif; font-size: 10px;"><input type="hidden" name="comment" value=""><input type="hidden" name="product" value="HTML WG"><input type="hidden" name="component" value="Encrypted Media Extensions">.</form><section id="references" class="appendix" typeof="bibo:Chapter" resource="#references" rel="bibo:Chapter"><!--OddPage--><h2 role="heading" id="h2_references"><span class="secno">A. </span>References</h2><section id="normative-references" typeof="bibo:Chapter" resource="#normative-references" rel="bibo:Chapter"><h3 role="heading" id="h3_normative-references"><span class="secno">A.1 </span>Normative references</h3><dl class="bibliography" about=""><dt id="bib-DOM">[DOM]</dt><dd rel="dcterms:requires">Anne van Kesteren; Aryeh Gregor; Ms2ger; Alex Russell; Robin Berjon. <a href="http://www.w3.org/TR/dom/"><cite>W3C DOM4</cite></a>. 10 July 2014. W3C Last Call Working Draft. URL: <a href="http://www.w3.org/TR/dom/">http://www.w3.org/TR/dom/</a>
</dd><dt id="bib-ENCODING">[ENCODING]</dt><dd rel="dcterms:requires">Anne van Kesteren; Joshua Bell; Addison Phillips. <a href="http://www.w3.org/TR/encoding/"><cite>Encoding</cite></a>. 16 September 2014. W3C Candidate Recommendation. URL: <a href="http://www.w3.org/TR/encoding/">http://www.w3.org/TR/encoding/</a>
</dd><dt id="bib-HTML5">[HTML5]</dt><dd rel="dcterms:requires">Robin Berjon; Steve Faulkner; Travis Leithead; Erika Doyle Navara; Edward O'Connor; Silvia Pfeiffer. <a href="http://www.w3.org/TR/html5/"><cite>HTML5</cite></a>. 28 October 2014. W3C Recommendation. URL: <a href="http://www.w3.org/TR/html5/">http://www.w3.org/TR/html5/</a>
</dd><dt id="bib-JWK">[JWK]</dt><dd rel="dcterms:requires">Mike Jones. <a href="http://tools.ietf.org/html/draft-ietf-jose-json-web-key-11"><cite>JSON Web Key (JWK)</cite></a>. 28 May 2013. Internet Draft. URL: <a href="http://tools.ietf.org/html/draft-ietf-jose-json-web-key-11">http://tools.ietf.org/html/draft-ietf-jose-json-web-key-11</a>
</dd><dt id="bib-MIXED-CONTENT">[MIXED-CONTENT]</dt><dd rel="dcterms:requires">Mike West. <a href="http://www.w3.org/TR/mixed-content/"><cite>Mixed Content</cite></a>. 16 September 2014. W3C Working Draft. URL: <a href="http://www.w3.org/TR/mixed-content/">http://www.w3.org/TR/mixed-content/</a>
</dd><dt id="bib-WebIDL">[WebIDL]</dt><dd rel="dcterms:requires">Cameron McCormack. <a href="http://www.w3.org/TR/WebIDL/"><cite>Web IDL</cite></a>. 19 April 2012. W3C Candidate Recommendation. URL: <a href="http://www.w3.org/TR/WebIDL/">http://www.w3.org/TR/WebIDL/</a>
</dd></dl></section><section id="informative-references" typeof="bibo:Chapter" resource="#informative-references" rel="bibo:Chapter"><h3 role="heading" id="h3_informative-references"><span class="secno">A.2 </span>Informative references</h3><dl class="bibliography" about=""><dt id="bib-EME-REGISTRY">[EME-REGISTRY]</dt><dd rel="dcterms:references">David Dorwin; Adrian Bateman; Mark Watson. <a href="initdata-format-registry.html"><cite>Encrypted Media Extensions Stream Format and Initialization Data Format Registry</cite></a>. URL: <a href="initdata-format-registry.html">initdata-format-registry.html</a>
</dd><dt id="bib-JWS">[JWS]</dt><dd rel="dcterms:references">M. Jones; J. Bradley; N. Sakimura. <a href="https://tools.ietf.org/html/draft-ietf-jose-json-web-signature-33"><cite>JSON Web Signature (JWS)</cite></a>. 25 September 2014. Internet Draft. URL: <a href="https://tools.ietf.org/html/draft-ietf-jose-json-web-signature-33">https://tools.ietf.org/html/draft-ietf-jose-json-web-signature-33</a>
</dd></dl></section></section></body></html>