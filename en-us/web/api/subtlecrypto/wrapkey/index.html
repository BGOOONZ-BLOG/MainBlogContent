<p>{{APIRef(“Web Crypto API”)}}{{SecureContext_header}}</p>
<p>The <strong><code>wrapKey()</code></strong> method of the {{domxref(“SubtleCrypto”)}} interface “wraps” a key. This means that it exports the key in an external, portable format, then encrypts the exported key. Wrapping a key helps protect it in untrusted environments, such as inside an otherwise unprotected data store or in transmission over an unprotected network.</p>
<p>As with {{DOMxRef(“SubtleCrypto.exportKey()”)}}, you specify an <a href="/en-US/docs/Web/API/SubtleCrypto/importKey#supported_formats">export format</a> for the key. To export a key, it must have {{DOMxRef(“CryptoKey.extractable”)}} set to <code>true</code>.</p>
<p>But because <code>wrapKey()</code> also encrypts the key to be imported, you also need to pass in the key that must be used to encrypt it. This is sometimes called the “wrapping key”.</p>
<p>The inverse of <code>wrapKey()</code> is {{domxref(“SubtleCrypto.unwrapKey()”)}}: while <code>wrapKey</code> is composed of export + encrypt, <code>unwrapKey</code> is composed of import + decrypt.</p>
<h2 id="syntax">Syntax</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">const</span> result <span class="op">=</span> <span class="va">crypto</span>.<span class="va">subtle</span>.<span class="at">wrapKey</span>(</a>
<a class="sourceLine" id="cb1-2" title="2">    format<span class="op">,</span></a>
<a class="sourceLine" id="cb1-3" title="3">    key<span class="op">,</span></a>
<a class="sourceLine" id="cb1-4" title="4">    wrappingKey<span class="op">,</span></a>
<a class="sourceLine" id="cb1-5" title="5">    wrapAlgo</a>
<a class="sourceLine" id="cb1-6" title="6">)<span class="op">;</span></a></code></pre></div>
<h3 id="parameters">Parameters</h3>
<ul>
<li><p><em><code>format</code></em> is a string describing the data format in which the key will be exported before it is encrypted. It can be one of the following:</p>
<ul>
<li><code>raw</code>: <a href="/en-US/docs/Web/API/SubtleCrypto/importKey#raw">Raw</a> format.</li>
<li><code>pkcs8</code>: <a href="/en-US/docs/Web/API/SubtleCrypto/importKey#pkcs_8">PKCS #8</a> format.</li>
<li><code>spki</code>: <a href="/en-US/docs/Web/API/SubtleCrypto/importKey#subjectpublickeyinfo">SubjectPublicKeyInfo</a> format.</li>
<li><code>jwk</code>: <a href="/en-US/docs/Web/API/SubtleCrypto/importKey#json_web_key">JSON Web Key</a> format.</li>
</ul></li>
<li><code>key</code> is the {{domxref(“CryptoKey”)}} to wrap.</li>
<li><code>wrappingkey</code> is the {{domxref(“CryptoKey”)}} used to encrypt the exported key. The key must have the <code>wrapKey</code> usage set.</li>
<li><p><code>wrapAlgo</code> is an object specifying the <a href="/en-US/docs/Web/API/SubtleCrypto/encrypt#supported_algorithms">algorithm</a> to be used to encrypt the exported key, and any required extra parameters:</p>
<ul>
<li>To use <a href="/en-US/docs/Web/API/SubtleCrypto/encrypt#rsa-oaep">RSA-OAEP</a>, pass an <a href="/en-US/docs/Web/API/RsaOaepParams" title="This dictionary represents the object that should be passed as the algorithm parameter into SubtleCrypto.encrypt(), SubtleCrypto.decrypt(), SubtleCrypto.wrapKey(), or SubtleCrypto.unwrapKey(), when using the RSA_OAEP algorithm."><code>RsaOaepParams</code></a> object.</li>
<li>To use <a href="/en-US/docs/Web/API/SubtleCrypto/encrypt#aes-ctr">AES-CTR</a>, pass an <a href="/en-US/docs/Web/API/AesCtrParams" title="This dictionary represents the object that should be passed as the algorithm parameter into SubtleCrypto.encrypt(), SubtleCrypto.decrypt(), SubtleCrypto.wrapKey(), or SubtleCrypto.unwrapKey(), when using the AES-CTR algorithm."><code>AesCtrParams</code></a> object.</li>
<li>To use <a href="/en-US/docs/Web/API/SubtleCrypto/encrypt#aes-cbc">AES-CBC</a>, pass an <a href="/en-US/docs/Web/API/AesCbcParams" title="This dictionary represents the object that should be passed as the algorithm parameter into SubtleCrypto.encrypt(), SubtleCrypto.decrypt(), SubtleCrypto.wrapKey(), or SubtleCrypto.unwrapKey(), when using the AES-CBC algorithm."><code>AesCbcParams</code></a> object.</li>
<li>To use <a href="/en-US/docs/Web/API/SubtleCrypto/encrypt#aes-gcm">AES-GCM</a>, pass an <a href="/en-US/docs/Web/API/AesGcmParams" title="This dictionary represents the object that should be passed as the algorithm parameter into SubtleCrypto.encrypt(), SubtleCrypto.decrypt(), SubtleCrypto.wrapKey(), or SubtleCrypto.unwrapKey(), when using the AES-GCM algorithm."><code>AesGcmParams</code></a> object.</li>
<li>To use <a href="#aes-kw">AES-KW</a>, pass the string <code>"AES-KW"</code>, or an object of the form <code>{ "name": "AES-KW }</code>.</li>
</ul></li>
</ul>
<h3 id="return-value">Return value</h3>
<ul>
<li><code>result</code> is a <a href="/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise" title="The Promise object represents the eventual completion (or failure) of an asynchronous operation, and its resulting value."><code>Promise</code></a> that fulfills with an <a href="/en-US/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer"><code>ArrayBuffer</code></a> containing the encrypted exported key.</li>
</ul>
<h3 id="exceptions">Exceptions</h3>
<p>The promise is rejected when one of the following exceptions is encountered:</p>
<ul>
<li>{{exception(“InvalidAccessError”)}}
<ul>
<li>: Raised when the wrapping key is not a key for the requested wrap algorithm.</li>
</ul></li>
<li>{{exception(“NotSupported”)}}
<ul>
<li>: Raised when trying to use an algorithm that is either unknown or isn’t suitable for encryption or wrapping.</li>
</ul></li>
<li>{{jsxref(“TypeError”)}}
<ul>
<li>: Raised when trying to use an invalid format.</li>
</ul></li>
</ul>
<h2 id="supported-algorithms">Supported algorithms</h2>
<p>All <a href="/en-US/docs/Web/API/SubtleCrypto/encrypt#supported_algorithms">algorithms that are usable for encryption</a> are also usable for key wrapping, as long as the key has the “wrapKey” usage set. For key wrapping you have the additional option of AES-KW.</p>
<h3 id="aes-kw">AES-KW</h3>
<p>AES-KW is a way to use the AES cipher for key wrapping.</p>
<p>One advantage of using AES-KW over another AES mode such as AES-GCM is that AES-KW does not require an initialization vector. To use AES-KW, the input must be a multiple of 64 bits.</p>
<p>AES-KW is specified in <a href="https://datatracker.ietf.org/doc/html/rfc3394">RFC 3394</a>.</p>
<h2 id="examples">Examples</h2>
<blockquote>
<p><strong>Note:</strong> You can <a href="https://mdn.github.io/dom-examples/web-crypto/wrap-key/index.html">try the working examples</a> out on GitHub.</p>
</blockquote>
<h3 id="raw-wrap">Raw wrap</h3>
<p>This example wraps an AES key. It uses “raw” as the export format and AES-KW, with a password-derived key, to encrypt it. <a href="https://github.com/mdn/dom-examples/blob/master/web-crypto/wrap-key/raw.js">See the complete code on GitHub.</a></p>
<div class="sourceCode" id="cb2"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">let</span> salt<span class="op">;</span></a>
<a class="sourceLine" id="cb2-2" title="2"></a>
<a class="sourceLine" id="cb2-3" title="3"><span class="co">/*</span></a>
<a class="sourceLine" id="cb2-4" title="4"><span class="co">Get some key material to use as input to the deriveKey method.</span></a>
<a class="sourceLine" id="cb2-5" title="5"><span class="co">The key material is a password supplied by the user.</span></a>
<a class="sourceLine" id="cb2-6" title="6"><span class="co">*/</span></a>
<a class="sourceLine" id="cb2-7" title="7"><span class="kw">function</span> <span class="at">getKeyMaterial</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb2-8" title="8">  <span class="kw">const</span> password <span class="op">=</span> <span class="va">window</span>.<span class="at">prompt</span>(<span class="st">&quot;Enter your password&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-9" title="9">  <span class="kw">const</span> enc <span class="op">=</span> <span class="kw">new</span> <span class="at">TextEncoder</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb2-10" title="10">  <span class="cf">return</span> <span class="va">window</span>.<span class="va">crypto</span>.<span class="va">subtle</span>.<span class="at">importKey</span>(</a>
<a class="sourceLine" id="cb2-11" title="11">    <span class="st">&quot;raw&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb2-12" title="12">    <span class="va">enc</span>.<span class="at">encode</span>(password)<span class="op">,</span></a>
<a class="sourceLine" id="cb2-13" title="13">    <span class="op">{</span><span class="dt">name</span><span class="op">:</span> <span class="st">&quot;PBKDF2&quot;</span><span class="op">},</span></a>
<a class="sourceLine" id="cb2-14" title="14">    <span class="kw">false</span><span class="op">,</span></a>
<a class="sourceLine" id="cb2-15" title="15">    [<span class="st">&quot;deriveBits&quot;</span><span class="op">,</span> <span class="st">&quot;deriveKey&quot;</span>]</a>
<a class="sourceLine" id="cb2-16" title="16">  )<span class="op">;</span></a>
<a class="sourceLine" id="cb2-17" title="17"><span class="op">}</span></a>
<a class="sourceLine" id="cb2-18" title="18"></a>
<a class="sourceLine" id="cb2-19" title="19"><span class="co">/*</span></a>
<a class="sourceLine" id="cb2-20" title="20"><span class="co">Given some key material and some random salt</span></a>
<a class="sourceLine" id="cb2-21" title="21"><span class="co">derive an AES-KW key using PBKDF2.</span></a>
<a class="sourceLine" id="cb2-22" title="22"><span class="co">*/</span></a>
<a class="sourceLine" id="cb2-23" title="23"><span class="kw">function</span> <span class="at">getKey</span>(keyMaterial<span class="op">,</span> salt) <span class="op">{</span></a>
<a class="sourceLine" id="cb2-24" title="24">  <span class="cf">return</span> <span class="va">window</span>.<span class="va">crypto</span>.<span class="va">subtle</span>.<span class="at">deriveKey</span>(</a>
<a class="sourceLine" id="cb2-25" title="25">    <span class="op">{</span></a>
<a class="sourceLine" id="cb2-26" title="26">      <span class="st">&quot;name&quot;</span><span class="op">:</span> <span class="st">&quot;PBKDF2&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb2-27" title="27">      <span class="dt">salt</span><span class="op">:</span> salt<span class="op">,</span></a>
<a class="sourceLine" id="cb2-28" title="28">      <span class="st">&quot;iterations&quot;</span><span class="op">:</span> <span class="dv">100000</span><span class="op">,</span></a>
<a class="sourceLine" id="cb2-29" title="29">      <span class="st">&quot;hash&quot;</span><span class="op">:</span> <span class="st">&quot;SHA-256&quot;</span></a>
<a class="sourceLine" id="cb2-30" title="30">    <span class="op">},</span></a>
<a class="sourceLine" id="cb2-31" title="31">    keyMaterial<span class="op">,</span></a>
<a class="sourceLine" id="cb2-32" title="32">    <span class="op">{</span> <span class="st">&quot;name&quot;</span><span class="op">:</span> <span class="st">&quot;AES-KW&quot;</span><span class="op">,</span> <span class="st">&quot;length&quot;</span><span class="op">:</span> <span class="dv">256</span><span class="op">},</span></a>
<a class="sourceLine" id="cb2-33" title="33">    <span class="kw">true</span><span class="op">,</span></a>
<a class="sourceLine" id="cb2-34" title="34">    [ <span class="st">&quot;wrapKey&quot;</span><span class="op">,</span> <span class="st">&quot;unwrapKey&quot;</span> ]</a>
<a class="sourceLine" id="cb2-35" title="35">  )<span class="op">;</span></a>
<a class="sourceLine" id="cb2-36" title="36"><span class="op">}</span></a>
<a class="sourceLine" id="cb2-37" title="37"></a>
<a class="sourceLine" id="cb2-38" title="38"><span class="co">/*</span></a>
<a class="sourceLine" id="cb2-39" title="39"><span class="co">Wrap the given key.</span></a>
<a class="sourceLine" id="cb2-40" title="40"><span class="co">*/</span></a>
<a class="sourceLine" id="cb2-41" title="41"><span class="kw">async</span> <span class="kw">function</span> <span class="at">wrapCryptoKey</span>(keyToWrap) <span class="op">{</span></a>
<a class="sourceLine" id="cb2-42" title="42">  <span class="co">// get the key encryption key</span></a>
<a class="sourceLine" id="cb2-43" title="43">  <span class="kw">const</span> keyMaterial <span class="op">=</span> <span class="cf">await</span> <span class="at">getKeyMaterial</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb2-44" title="44">  salt <span class="op">=</span> <span class="va">window</span>.<span class="va">crypto</span>.<span class="at">getRandomValues</span>(<span class="kw">new</span> <span class="at">Uint8Array</span>(<span class="dv">16</span>))<span class="op">;</span></a>
<a class="sourceLine" id="cb2-45" title="45">  <span class="kw">const</span> wrappingKey <span class="op">=</span> <span class="cf">await</span> <span class="at">getKey</span>(keyMaterial<span class="op">,</span> salt)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-46" title="46"></a>
<a class="sourceLine" id="cb2-47" title="47">  <span class="cf">return</span> <span class="va">window</span>.<span class="va">crypto</span>.<span class="va">subtle</span>.<span class="at">wrapKey</span>(</a>
<a class="sourceLine" id="cb2-48" title="48">    <span class="st">&quot;raw&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb2-49" title="49">    keyToWrap<span class="op">,</span></a>
<a class="sourceLine" id="cb2-50" title="50">    wrappingKey<span class="op">,</span></a>
<a class="sourceLine" id="cb2-51" title="51">    <span class="st">&quot;AES-KW&quot;</span></a>
<a class="sourceLine" id="cb2-52" title="52">  )<span class="op">;</span></a>
<a class="sourceLine" id="cb2-53" title="53"></a>
<a class="sourceLine" id="cb2-54" title="54"><span class="op">}</span></a>
<a class="sourceLine" id="cb2-55" title="55"></a>
<a class="sourceLine" id="cb2-56" title="56"><span class="co">/*</span></a>
<a class="sourceLine" id="cb2-57" title="57"><span class="co">Generate an encrypt/decrypt secret key,</span></a>
<a class="sourceLine" id="cb2-58" title="58"><span class="co">then wrap it.</span></a>
<a class="sourceLine" id="cb2-59" title="59"><span class="co">*/</span></a>
<a class="sourceLine" id="cb2-60" title="60"><span class="va">window</span>.<span class="va">crypto</span>.<span class="va">subtle</span>.<span class="at">generateKey</span>(</a>
<a class="sourceLine" id="cb2-61" title="61">  <span class="op">{</span></a>
<a class="sourceLine" id="cb2-62" title="62">    <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;AES-GCM&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb2-63" title="63">    <span class="dt">length</span><span class="op">:</span> <span class="dv">256</span><span class="op">,</span></a>
<a class="sourceLine" id="cb2-64" title="64">  <span class="op">},</span></a>
<a class="sourceLine" id="cb2-65" title="65">  <span class="kw">true</span><span class="op">,</span></a>
<a class="sourceLine" id="cb2-66" title="66">  [<span class="st">&quot;encrypt&quot;</span><span class="op">,</span> <span class="st">&quot;decrypt&quot;</span>]</a>
<a class="sourceLine" id="cb2-67" title="67">)</a>
<a class="sourceLine" id="cb2-68" title="68">.<span class="at">then</span>((secretKey) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb2-69" title="69">  <span class="cf">return</span> <span class="at">wrapCryptoKey</span>(secretKey)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-70" title="70"><span class="op">}</span>)</a>
<a class="sourceLine" id="cb2-71" title="71">.<span class="at">then</span>((wrappedKey) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb2-72" title="72">  <span class="va">console</span>.<span class="at">log</span>(wrappedKey)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-73" title="73"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<h3 id="pkcs-8-wrap">PKCS #8 wrap</h3>
<p>This example wraps an RSA private signing key. It uses “pkcs8” as the export format and AES-GCM, with a password-derived key, to encrypt it. <a href="https://github.com/mdn/dom-examples/blob/master/web-crypto/wrap-key/pkcs8.js">See the complete code on GitHub.</a></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">let</span> salt<span class="op">;</span></a>
<a class="sourceLine" id="cb3-2" title="2"><span class="kw">let</span> iv<span class="op">;</span></a>
<a class="sourceLine" id="cb3-3" title="3"></a>
<a class="sourceLine" id="cb3-4" title="4"><span class="co">/*</span></a>
<a class="sourceLine" id="cb3-5" title="5"><span class="co">Get some key material to use as input to the deriveKey method.</span></a>
<a class="sourceLine" id="cb3-6" title="6"><span class="co">The key material is a password supplied by the user.</span></a>
<a class="sourceLine" id="cb3-7" title="7"><span class="co">*/</span></a>
<a class="sourceLine" id="cb3-8" title="8"><span class="kw">function</span> <span class="at">getKeyMaterial</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb3-9" title="9">  <span class="kw">const</span> password <span class="op">=</span> <span class="va">window</span>.<span class="at">prompt</span>(<span class="st">&quot;Enter your password&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-10" title="10">  <span class="kw">const</span> enc <span class="op">=</span> <span class="kw">new</span> <span class="at">TextEncoder</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb3-11" title="11">  <span class="cf">return</span> <span class="va">window</span>.<span class="va">crypto</span>.<span class="va">subtle</span>.<span class="at">importKey</span>(</a>
<a class="sourceLine" id="cb3-12" title="12">    <span class="st">&quot;raw&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb3-13" title="13">    <span class="va">enc</span>.<span class="at">encode</span>(password)<span class="op">,</span></a>
<a class="sourceLine" id="cb3-14" title="14">    <span class="op">{</span><span class="dt">name</span><span class="op">:</span> <span class="st">&quot;PBKDF2&quot;</span><span class="op">},</span></a>
<a class="sourceLine" id="cb3-15" title="15">    <span class="kw">false</span><span class="op">,</span></a>
<a class="sourceLine" id="cb3-16" title="16">    [<span class="st">&quot;deriveBits&quot;</span><span class="op">,</span> <span class="st">&quot;deriveKey&quot;</span>]</a>
<a class="sourceLine" id="cb3-17" title="17">  )<span class="op">;</span></a>
<a class="sourceLine" id="cb3-18" title="18"><span class="op">}</span></a>
<a class="sourceLine" id="cb3-19" title="19"></a>
<a class="sourceLine" id="cb3-20" title="20"><span class="co">/*</span></a>
<a class="sourceLine" id="cb3-21" title="21"><span class="co">Given some key material and some random salt</span></a>
<a class="sourceLine" id="cb3-22" title="22"><span class="co">derive an AES-GCM key using PBKDF2.</span></a>
<a class="sourceLine" id="cb3-23" title="23"><span class="co">*/</span></a>
<a class="sourceLine" id="cb3-24" title="24"><span class="kw">function</span> <span class="at">getKey</span>(keyMaterial<span class="op">,</span> salt) <span class="op">{</span></a>
<a class="sourceLine" id="cb3-25" title="25">  <span class="cf">return</span> <span class="va">window</span>.<span class="va">crypto</span>.<span class="va">subtle</span>.<span class="at">deriveKey</span>(</a>
<a class="sourceLine" id="cb3-26" title="26">    <span class="op">{</span></a>
<a class="sourceLine" id="cb3-27" title="27">      <span class="st">&quot;name&quot;</span><span class="op">:</span> <span class="st">&quot;PBKDF2&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb3-28" title="28">      <span class="dt">salt</span><span class="op">:</span> salt<span class="op">,</span></a>
<a class="sourceLine" id="cb3-29" title="29">      <span class="st">&quot;iterations&quot;</span><span class="op">:</span> <span class="dv">100000</span><span class="op">,</span></a>
<a class="sourceLine" id="cb3-30" title="30">      <span class="st">&quot;hash&quot;</span><span class="op">:</span> <span class="st">&quot;SHA-256&quot;</span></a>
<a class="sourceLine" id="cb3-31" title="31">    <span class="op">},</span></a>
<a class="sourceLine" id="cb3-32" title="32">    keyMaterial<span class="op">,</span></a>
<a class="sourceLine" id="cb3-33" title="33">    <span class="op">{</span> <span class="st">&quot;name&quot;</span><span class="op">:</span> <span class="st">&quot;AES-GCM&quot;</span><span class="op">,</span> <span class="st">&quot;length&quot;</span><span class="op">:</span> <span class="dv">256</span><span class="op">},</span></a>
<a class="sourceLine" id="cb3-34" title="34">    <span class="kw">true</span><span class="op">,</span></a>
<a class="sourceLine" id="cb3-35" title="35">    [ <span class="st">&quot;wrapKey&quot;</span><span class="op">,</span> <span class="st">&quot;unwrapKey&quot;</span> ]</a>
<a class="sourceLine" id="cb3-36" title="36">  )<span class="op">;</span></a>
<a class="sourceLine" id="cb3-37" title="37"><span class="op">}</span></a>
<a class="sourceLine" id="cb3-38" title="38"></a>
<a class="sourceLine" id="cb3-39" title="39"><span class="co">/*</span></a>
<a class="sourceLine" id="cb3-40" title="40"><span class="co">Wrap the given key.</span></a>
<a class="sourceLine" id="cb3-41" title="41"><span class="co">*/</span></a>
<a class="sourceLine" id="cb3-42" title="42"><span class="kw">async</span> <span class="kw">function</span> <span class="at">wrapCryptoKey</span>(keyToWrap) <span class="op">{</span></a>
<a class="sourceLine" id="cb3-43" title="43">  <span class="co">// get the key encryption key</span></a>
<a class="sourceLine" id="cb3-44" title="44">  <span class="kw">const</span> keyMaterial <span class="op">=</span> <span class="cf">await</span> <span class="at">getKeyMaterial</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb3-45" title="45">  salt <span class="op">=</span> <span class="va">window</span>.<span class="va">crypto</span>.<span class="at">getRandomValues</span>(<span class="kw">new</span> <span class="at">Uint8Array</span>(<span class="dv">16</span>))<span class="op">;</span></a>
<a class="sourceLine" id="cb3-46" title="46">  <span class="kw">const</span> wrappingKey <span class="op">=</span> <span class="cf">await</span> <span class="at">getKey</span>(keyMaterial<span class="op">,</span> salt)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-47" title="47">  iv <span class="op">=</span> <span class="va">window</span>.<span class="va">crypto</span>.<span class="at">getRandomValues</span>(<span class="kw">new</span> <span class="at">Uint8Array</span>(<span class="dv">12</span>))<span class="op">;</span></a>
<a class="sourceLine" id="cb3-48" title="48"></a>
<a class="sourceLine" id="cb3-49" title="49">  <span class="cf">return</span> <span class="va">window</span>.<span class="va">crypto</span>.<span class="va">subtle</span>.<span class="at">wrapKey</span>(</a>
<a class="sourceLine" id="cb3-50" title="50">    <span class="st">&quot;pkcs8&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb3-51" title="51">    keyToWrap<span class="op">,</span></a>
<a class="sourceLine" id="cb3-52" title="52">    wrappingKey<span class="op">,</span></a>
<a class="sourceLine" id="cb3-53" title="53">    <span class="op">{</span></a>
<a class="sourceLine" id="cb3-54" title="54">      <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;AES-GCM&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb3-55" title="55">      <span class="dt">iv</span><span class="op">:</span> iv</a>
<a class="sourceLine" id="cb3-56" title="56">    <span class="op">}</span></a>
<a class="sourceLine" id="cb3-57" title="57">  )<span class="op">;</span></a>
<a class="sourceLine" id="cb3-58" title="58"></a>
<a class="sourceLine" id="cb3-59" title="59"><span class="op">}</span></a>
<a class="sourceLine" id="cb3-60" title="60"></a>
<a class="sourceLine" id="cb3-61" title="61"><span class="co">/*</span></a>
<a class="sourceLine" id="cb3-62" title="62"><span class="co">Generate a sign/verify key pair,</span></a>
<a class="sourceLine" id="cb3-63" title="63"><span class="co">then wrap the private key.</span></a>
<a class="sourceLine" id="cb3-64" title="64"><span class="co">*/</span></a>
<a class="sourceLine" id="cb3-65" title="65"><span class="va">window</span>.<span class="va">crypto</span>.<span class="va">subtle</span>.<span class="at">generateKey</span>(</a>
<a class="sourceLine" id="cb3-66" title="66">  <span class="op">{</span></a>
<a class="sourceLine" id="cb3-67" title="67">    <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;RSA-PSS&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb3-68" title="68">    <span class="co">// Consider using a 4096-bit key for systems that require long-term security</span></a>
<a class="sourceLine" id="cb3-69" title="69">    <span class="dt">modulusLength</span><span class="op">:</span> <span class="dv">2048</span><span class="op">,</span></a>
<a class="sourceLine" id="cb3-70" title="70">    <span class="dt">publicExponent</span><span class="op">:</span> <span class="kw">new</span> <span class="at">Uint8Array</span>([<span class="dv">1</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>])<span class="op">,</span></a>
<a class="sourceLine" id="cb3-71" title="71">    <span class="dt">hash</span><span class="op">:</span> <span class="st">&quot;SHA-256&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb3-72" title="72">  <span class="op">},</span></a>
<a class="sourceLine" id="cb3-73" title="73">  <span class="kw">true</span><span class="op">,</span></a>
<a class="sourceLine" id="cb3-74" title="74">  [<span class="st">&quot;sign&quot;</span><span class="op">,</span> <span class="st">&quot;verify&quot;</span>]</a>
<a class="sourceLine" id="cb3-75" title="75">)</a>
<a class="sourceLine" id="cb3-76" title="76">.<span class="at">then</span>((keyPair) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb3-77" title="77">  <span class="cf">return</span> <span class="at">wrapCryptoKey</span>(<span class="va">keyPair</span>.<span class="at">privateKey</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-78" title="78"><span class="op">}</span>)</a>
<a class="sourceLine" id="cb3-79" title="79">.<span class="at">then</span>((wrappedKey) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb3-80" title="80">  <span class="va">console</span>.<span class="at">log</span>(wrappedKey)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-81" title="81"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<h3 id="subjectpublickeyinfo-wrap">SubjectPublicKeyInfo wrap</h3>
<p>This example wraps an RSA public encryption key. It uses “spki” as the export format and AES-CBC, with a password-derived key, to encrypt it. <a href="https://github.com/mdn/dom-examples/blob/master/web-crypto/wrap-key/spki.js">See the complete code on GitHub.</a></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb4-1" title="1"><span class="kw">let</span> salt<span class="op">;</span></a>
<a class="sourceLine" id="cb4-2" title="2"><span class="kw">let</span> iv<span class="op">;</span></a>
<a class="sourceLine" id="cb4-3" title="3"></a>
<a class="sourceLine" id="cb4-4" title="4"><span class="co">/*</span></a>
<a class="sourceLine" id="cb4-5" title="5"><span class="co">Get some key material to use as input to the deriveKey method.</span></a>
<a class="sourceLine" id="cb4-6" title="6"><span class="co">The key material is a password supplied by the user.</span></a>
<a class="sourceLine" id="cb4-7" title="7"><span class="co">*/</span></a>
<a class="sourceLine" id="cb4-8" title="8"><span class="kw">function</span> <span class="at">getKeyMaterial</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb4-9" title="9">  <span class="kw">const</span> password <span class="op">=</span> <span class="va">window</span>.<span class="at">prompt</span>(<span class="st">&quot;Enter your password&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-10" title="10">  <span class="kw">const</span> enc <span class="op">=</span> <span class="kw">new</span> <span class="at">TextEncoder</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb4-11" title="11">  <span class="cf">return</span> <span class="va">window</span>.<span class="va">crypto</span>.<span class="va">subtle</span>.<span class="at">importKey</span>(</a>
<a class="sourceLine" id="cb4-12" title="12">    <span class="st">&quot;raw&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb4-13" title="13">    <span class="va">enc</span>.<span class="at">encode</span>(password)<span class="op">,</span></a>
<a class="sourceLine" id="cb4-14" title="14">    <span class="op">{</span><span class="dt">name</span><span class="op">:</span> <span class="st">&quot;PBKDF2&quot;</span><span class="op">},</span></a>
<a class="sourceLine" id="cb4-15" title="15">    <span class="kw">false</span><span class="op">,</span></a>
<a class="sourceLine" id="cb4-16" title="16">    [<span class="st">&quot;deriveBits&quot;</span><span class="op">,</span> <span class="st">&quot;deriveKey&quot;</span>]</a>
<a class="sourceLine" id="cb4-17" title="17">  )<span class="op">;</span></a>
<a class="sourceLine" id="cb4-18" title="18"><span class="op">}</span></a>
<a class="sourceLine" id="cb4-19" title="19"></a>
<a class="sourceLine" id="cb4-20" title="20"><span class="co">/*</span></a>
<a class="sourceLine" id="cb4-21" title="21"><span class="co">Given some key material and some random salt</span></a>
<a class="sourceLine" id="cb4-22" title="22"><span class="co">derive an AES-CBC key using PBKDF2.</span></a>
<a class="sourceLine" id="cb4-23" title="23"><span class="co">*/</span></a>
<a class="sourceLine" id="cb4-24" title="24"><span class="kw">function</span> <span class="at">getKey</span>(keyMaterial<span class="op">,</span> salt) <span class="op">{</span></a>
<a class="sourceLine" id="cb4-25" title="25">  <span class="cf">return</span> <span class="va">window</span>.<span class="va">crypto</span>.<span class="va">subtle</span>.<span class="at">deriveKey</span>(</a>
<a class="sourceLine" id="cb4-26" title="26">    <span class="op">{</span></a>
<a class="sourceLine" id="cb4-27" title="27">      <span class="st">&quot;name&quot;</span><span class="op">:</span> <span class="st">&quot;PBKDF2&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb4-28" title="28">      <span class="dt">salt</span><span class="op">:</span> salt<span class="op">,</span></a>
<a class="sourceLine" id="cb4-29" title="29">      <span class="st">&quot;iterations&quot;</span><span class="op">:</span> <span class="dv">100000</span><span class="op">,</span></a>
<a class="sourceLine" id="cb4-30" title="30">      <span class="st">&quot;hash&quot;</span><span class="op">:</span> <span class="st">&quot;SHA-256&quot;</span></a>
<a class="sourceLine" id="cb4-31" title="31">    <span class="op">},</span></a>
<a class="sourceLine" id="cb4-32" title="32">    keyMaterial<span class="op">,</span></a>
<a class="sourceLine" id="cb4-33" title="33">    <span class="op">{</span> <span class="st">&quot;name&quot;</span><span class="op">:</span> <span class="st">&quot;AES-CBC&quot;</span><span class="op">,</span> <span class="st">&quot;length&quot;</span><span class="op">:</span> <span class="dv">256</span><span class="op">},</span></a>
<a class="sourceLine" id="cb4-34" title="34">    <span class="kw">true</span><span class="op">,</span></a>
<a class="sourceLine" id="cb4-35" title="35">    [ <span class="st">&quot;wrapKey&quot;</span><span class="op">,</span> <span class="st">&quot;unwrapKey&quot;</span> ]</a>
<a class="sourceLine" id="cb4-36" title="36">  )<span class="op">;</span></a>
<a class="sourceLine" id="cb4-37" title="37"><span class="op">}</span></a>
<a class="sourceLine" id="cb4-38" title="38"></a>
<a class="sourceLine" id="cb4-39" title="39"><span class="co">/*</span></a>
<a class="sourceLine" id="cb4-40" title="40"><span class="co">Wrap the given key.</span></a>
<a class="sourceLine" id="cb4-41" title="41"><span class="co">*/</span></a>
<a class="sourceLine" id="cb4-42" title="42"><span class="kw">async</span> <span class="kw">function</span> <span class="at">wrapCryptoKey</span>(keyToWrap) <span class="op">{</span></a>
<a class="sourceLine" id="cb4-43" title="43">  <span class="co">// get the key encryption key</span></a>
<a class="sourceLine" id="cb4-44" title="44">  <span class="kw">const</span> keyMaterial <span class="op">=</span> <span class="cf">await</span> <span class="at">getKeyMaterial</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb4-45" title="45">  salt <span class="op">=</span> <span class="va">window</span>.<span class="va">crypto</span>.<span class="at">getRandomValues</span>(<span class="kw">new</span> <span class="at">Uint8Array</span>(<span class="dv">16</span>))<span class="op">;</span></a>
<a class="sourceLine" id="cb4-46" title="46">  <span class="kw">const</span> wrappingKey <span class="op">=</span> <span class="cf">await</span> <span class="at">getKey</span>(keyMaterial<span class="op">,</span> salt)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-47" title="47">  iv <span class="op">=</span> <span class="va">window</span>.<span class="va">crypto</span>.<span class="at">getRandomValues</span>(<span class="kw">new</span> <span class="at">Uint8Array</span>(<span class="dv">16</span>))<span class="op">;</span></a>
<a class="sourceLine" id="cb4-48" title="48"></a>
<a class="sourceLine" id="cb4-49" title="49">  <span class="cf">return</span> <span class="va">window</span>.<span class="va">crypto</span>.<span class="va">subtle</span>.<span class="at">wrapKey</span>(</a>
<a class="sourceLine" id="cb4-50" title="50">    <span class="st">&quot;spki&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb4-51" title="51">    keyToWrap<span class="op">,</span></a>
<a class="sourceLine" id="cb4-52" title="52">    wrappingKey<span class="op">,</span></a>
<a class="sourceLine" id="cb4-53" title="53">    <span class="op">{</span></a>
<a class="sourceLine" id="cb4-54" title="54">      <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;AES-CBC&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb4-55" title="55">      <span class="dt">iv</span><span class="op">:</span> iv</a>
<a class="sourceLine" id="cb4-56" title="56">    <span class="op">}</span></a>
<a class="sourceLine" id="cb4-57" title="57">  )<span class="op">;</span></a>
<a class="sourceLine" id="cb4-58" title="58"></a>
<a class="sourceLine" id="cb4-59" title="59"><span class="op">}</span></a>
<a class="sourceLine" id="cb4-60" title="60"></a>
<a class="sourceLine" id="cb4-61" title="61"><span class="co">/*</span></a>
<a class="sourceLine" id="cb4-62" title="62"><span class="co">Generate an encrypt/decrypt key pair,</span></a>
<a class="sourceLine" id="cb4-63" title="63"><span class="co">then wrap it.</span></a>
<a class="sourceLine" id="cb4-64" title="64"><span class="co">*/</span></a>
<a class="sourceLine" id="cb4-65" title="65"><span class="va">window</span>.<span class="va">crypto</span>.<span class="va">subtle</span>.<span class="at">generateKey</span>(</a>
<a class="sourceLine" id="cb4-66" title="66">  <span class="op">{</span></a>
<a class="sourceLine" id="cb4-67" title="67">    <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;RSA-OAEP&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb4-68" title="68">    <span class="co">// Consider using a 4096-bit key for systems that require long-term security</span></a>
<a class="sourceLine" id="cb4-69" title="69">    <span class="dt">modulusLength</span><span class="op">:</span> <span class="dv">2048</span><span class="op">,</span></a>
<a class="sourceLine" id="cb4-70" title="70">    <span class="dt">publicExponent</span><span class="op">:</span> <span class="kw">new</span> <span class="at">Uint8Array</span>([<span class="dv">1</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>])<span class="op">,</span></a>
<a class="sourceLine" id="cb4-71" title="71">    <span class="dt">hash</span><span class="op">:</span> <span class="st">&quot;SHA-256&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb4-72" title="72">  <span class="op">},</span></a>
<a class="sourceLine" id="cb4-73" title="73">  <span class="kw">true</span><span class="op">,</span></a>
<a class="sourceLine" id="cb4-74" title="74">  [<span class="st">&quot;encrypt&quot;</span><span class="op">,</span> <span class="st">&quot;decrypt&quot;</span>]</a>
<a class="sourceLine" id="cb4-75" title="75">)</a>
<a class="sourceLine" id="cb4-76" title="76">.<span class="at">then</span>((keyPair) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb4-77" title="77">  <span class="cf">return</span> <span class="at">wrapCryptoKey</span>(<span class="va">keyPair</span>.<span class="at">publicKey</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-78" title="78"><span class="op">}</span>)</a>
<a class="sourceLine" id="cb4-79" title="79">.<span class="at">then</span>((wrappedKey) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb4-80" title="80">  <span class="va">console</span>.<span class="at">log</span>(wrappedKey)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-81" title="81"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<h3 id="json-web-key-import">JSON Web Key import</h3>
<p>This code wraps an ECDSA private signing key. It uses “jwk” as the export format and AES-GCM, with a password-derived key, to encrypt it. <a href="https://github.com/mdn/dom-examples/blob/master/web-crypto/wrap-key/jwk.js">See the complete code on GitHub.</a></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb5-1" title="1"><span class="kw">let</span> salt<span class="op">;</span></a>
<a class="sourceLine" id="cb5-2" title="2"><span class="kw">let</span> iv<span class="op">;</span></a>
<a class="sourceLine" id="cb5-3" title="3"></a>
<a class="sourceLine" id="cb5-4" title="4"><span class="co">/*</span></a>
<a class="sourceLine" id="cb5-5" title="5"><span class="co">Get some key material to use as input to the deriveKey method.</span></a>
<a class="sourceLine" id="cb5-6" title="6"><span class="co">The key material is a password supplied by the user.</span></a>
<a class="sourceLine" id="cb5-7" title="7"><span class="co">*/</span></a>
<a class="sourceLine" id="cb5-8" title="8"><span class="kw">function</span> <span class="at">getKeyMaterial</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb5-9" title="9">  <span class="kw">const</span> password <span class="op">=</span> <span class="va">window</span>.<span class="at">prompt</span>(<span class="st">&quot;Enter your password&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb5-10" title="10">  <span class="kw">const</span> enc <span class="op">=</span> <span class="kw">new</span> <span class="at">TextEncoder</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb5-11" title="11">  <span class="cf">return</span> <span class="va">window</span>.<span class="va">crypto</span>.<span class="va">subtle</span>.<span class="at">importKey</span>(</a>
<a class="sourceLine" id="cb5-12" title="12">    <span class="st">&quot;raw&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb5-13" title="13">    <span class="va">enc</span>.<span class="at">encode</span>(password)<span class="op">,</span></a>
<a class="sourceLine" id="cb5-14" title="14">    <span class="op">{</span><span class="dt">name</span><span class="op">:</span> <span class="st">&quot;PBKDF2&quot;</span><span class="op">},</span></a>
<a class="sourceLine" id="cb5-15" title="15">    <span class="kw">false</span><span class="op">,</span></a>
<a class="sourceLine" id="cb5-16" title="16">    [<span class="st">&quot;deriveBits&quot;</span><span class="op">,</span> <span class="st">&quot;deriveKey&quot;</span>]</a>
<a class="sourceLine" id="cb5-17" title="17">  )<span class="op">;</span></a>
<a class="sourceLine" id="cb5-18" title="18"><span class="op">}</span></a>
<a class="sourceLine" id="cb5-19" title="19"></a>
<a class="sourceLine" id="cb5-20" title="20"><span class="co">/*</span></a>
<a class="sourceLine" id="cb5-21" title="21"><span class="co">Given some key material and some random salt</span></a>
<a class="sourceLine" id="cb5-22" title="22"><span class="co">derive an AES-GCM key using PBKDF2.</span></a>
<a class="sourceLine" id="cb5-23" title="23"><span class="co">*/</span></a>
<a class="sourceLine" id="cb5-24" title="24"><span class="kw">function</span> <span class="at">getKey</span>(keyMaterial<span class="op">,</span> salt) <span class="op">{</span></a>
<a class="sourceLine" id="cb5-25" title="25">  <span class="cf">return</span> <span class="va">window</span>.<span class="va">crypto</span>.<span class="va">subtle</span>.<span class="at">deriveKey</span>(</a>
<a class="sourceLine" id="cb5-26" title="26">    <span class="op">{</span></a>
<a class="sourceLine" id="cb5-27" title="27">      <span class="st">&quot;name&quot;</span><span class="op">:</span> <span class="st">&quot;PBKDF2&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb5-28" title="28">      <span class="dt">salt</span><span class="op">:</span> salt<span class="op">,</span></a>
<a class="sourceLine" id="cb5-29" title="29">      <span class="st">&quot;iterations&quot;</span><span class="op">:</span> <span class="dv">100000</span><span class="op">,</span></a>
<a class="sourceLine" id="cb5-30" title="30">      <span class="st">&quot;hash&quot;</span><span class="op">:</span> <span class="st">&quot;SHA-256&quot;</span></a>
<a class="sourceLine" id="cb5-31" title="31">    <span class="op">},</span></a>
<a class="sourceLine" id="cb5-32" title="32">    keyMaterial<span class="op">,</span></a>
<a class="sourceLine" id="cb5-33" title="33">    <span class="op">{</span> <span class="st">&quot;name&quot;</span><span class="op">:</span> <span class="st">&quot;AES-GCM&quot;</span><span class="op">,</span> <span class="st">&quot;length&quot;</span><span class="op">:</span> <span class="dv">256</span><span class="op">},</span></a>
<a class="sourceLine" id="cb5-34" title="34">    <span class="kw">true</span><span class="op">,</span></a>
<a class="sourceLine" id="cb5-35" title="35">    [ <span class="st">&quot;wrapKey&quot;</span><span class="op">,</span> <span class="st">&quot;unwrapKey&quot;</span> ]</a>
<a class="sourceLine" id="cb5-36" title="36">  )<span class="op">;</span></a>
<a class="sourceLine" id="cb5-37" title="37"><span class="op">}</span></a>
<a class="sourceLine" id="cb5-38" title="38"></a>
<a class="sourceLine" id="cb5-39" title="39"><span class="co">/*</span></a>
<a class="sourceLine" id="cb5-40" title="40"><span class="co">Wrap the given key.</span></a>
<a class="sourceLine" id="cb5-41" title="41"><span class="co">*/</span></a>
<a class="sourceLine" id="cb5-42" title="42"><span class="kw">async</span> <span class="kw">function</span> <span class="at">wrapCryptoKey</span>(keyToWrap) <span class="op">{</span></a>
<a class="sourceLine" id="cb5-43" title="43">  <span class="co">// get the key encryption key</span></a>
<a class="sourceLine" id="cb5-44" title="44">  <span class="kw">const</span> keyMaterial <span class="op">=</span> <span class="cf">await</span> <span class="at">getKeyMaterial</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb5-45" title="45">  salt <span class="op">=</span> <span class="va">window</span>.<span class="va">crypto</span>.<span class="at">getRandomValues</span>(<span class="kw">new</span> <span class="at">Uint8Array</span>(<span class="dv">16</span>))<span class="op">;</span></a>
<a class="sourceLine" id="cb5-46" title="46">  <span class="kw">const</span> wrappingKey <span class="op">=</span> <span class="cf">await</span> <span class="at">getKey</span>(keyMaterial<span class="op">,</span> salt)<span class="op">;</span></a>
<a class="sourceLine" id="cb5-47" title="47">  iv <span class="op">=</span> <span class="va">window</span>.<span class="va">crypto</span>.<span class="at">getRandomValues</span>(<span class="kw">new</span> <span class="at">Uint8Array</span>(<span class="dv">12</span>))<span class="op">;</span></a>
<a class="sourceLine" id="cb5-48" title="48"></a>
<a class="sourceLine" id="cb5-49" title="49">  <span class="cf">return</span> <span class="va">window</span>.<span class="va">crypto</span>.<span class="va">subtle</span>.<span class="at">wrapKey</span>(</a>
<a class="sourceLine" id="cb5-50" title="50">    <span class="st">&quot;jwk&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb5-51" title="51">    keyToWrap<span class="op">,</span></a>
<a class="sourceLine" id="cb5-52" title="52">    wrappingKey<span class="op">,</span></a>
<a class="sourceLine" id="cb5-53" title="53">    <span class="op">{</span></a>
<a class="sourceLine" id="cb5-54" title="54">      <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;AES-GCM&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb5-55" title="55">      <span class="dt">iv</span><span class="op">:</span> iv</a>
<a class="sourceLine" id="cb5-56" title="56">    <span class="op">}</span></a>
<a class="sourceLine" id="cb5-57" title="57">  )<span class="op">;</span></a>
<a class="sourceLine" id="cb5-58" title="58"><span class="op">}</span></a>
<a class="sourceLine" id="cb5-59" title="59"></a>
<a class="sourceLine" id="cb5-60" title="60"><span class="co">/*</span></a>
<a class="sourceLine" id="cb5-61" title="61"><span class="co">Generate a sign/verify key pair,</span></a>
<a class="sourceLine" id="cb5-62" title="62"><span class="co">then wrap the private key</span></a>
<a class="sourceLine" id="cb5-63" title="63"><span class="co">*/</span></a>
<a class="sourceLine" id="cb5-64" title="64"><span class="va">window</span>.<span class="va">crypto</span>.<span class="va">subtle</span>.<span class="at">generateKey</span>(</a>
<a class="sourceLine" id="cb5-65" title="65">  <span class="op">{</span></a>
<a class="sourceLine" id="cb5-66" title="66">    <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;ECDSA&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb5-67" title="67">    <span class="dt">namedCurve</span><span class="op">:</span> <span class="st">&quot;P-384&quot;</span></a>
<a class="sourceLine" id="cb5-68" title="68">  <span class="op">},</span></a>
<a class="sourceLine" id="cb5-69" title="69">  <span class="kw">true</span><span class="op">,</span></a>
<a class="sourceLine" id="cb5-70" title="70">  [<span class="st">&quot;sign&quot;</span><span class="op">,</span> <span class="st">&quot;verify&quot;</span>]</a>
<a class="sourceLine" id="cb5-71" title="71">)</a>
<a class="sourceLine" id="cb5-72" title="72">.<span class="at">then</span>((keyPair) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb5-73" title="73">  <span class="cf">return</span> <span class="at">wrapCryptoKey</span>(<span class="va">keyPair</span>.<span class="at">privateKey</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb5-74" title="74"><span class="op">}</span>)</a>
<a class="sourceLine" id="cb5-75" title="75">.<span class="at">then</span>((wrappedKey) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb5-76" title="76">  <span class="va">console</span>.<span class="at">log</span>(wrappedKey)<span class="op">;</span></a>
<a class="sourceLine" id="cb5-77" title="77"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<h2 id="specifications">Specifications</h2>
<p>{{Specifications}}</p>
<h2 id="browser-compatibility">Browser compatibility</h2>
<p>{{Compat}}</p>
<h2 id="see-also">See also</h2>
<ul>
<li><a href="/en-US/docs/Web/API/SubtleCrypto/exportKey"><code>SubtleCrypto.exportKey()</code></a></li>
<li><a href="https://datatracker.ietf.org/doc/html/rfc5208">PKCS #8 format</a>.</li>
<li><a href="https://datatracker.ietf.org/doc/html/rfc5280#section-4.1">SubjectPublicKeyInfo format</a>.</li>
<li><a href="https://datatracker.ietf.org/doc/html/rfc7517">JSON Web Key format</a>.</li>
<li><a href="https://datatracker.ietf.org/doc/html/rfc3394">AES-KW specification</a>.</li>
</ul>
