<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="utf-8">
    <title>设备适配</title>
  </head>
  <body>
    <header>
      <h1>设备适配</h1>
      <p>移动设备不仅与传统计算机有很大的不同，而且移动设备本身在屏幕尺寸、分辨率、键盘类型、媒体录制能力等方面也存在很大差异。用户界面需要适应用户的设备以提供良好的用户体验，并且考虑到市场上可用的设备的异构性，静态自适应（匹配主流设备的有限数量的用户界面分别单独维护）不是可行的选择。Web开发人员需要创建<b>响应式布局</b>，其中用户界面自动根据用户设备进行调整。</p>
    </header>
    <main>
      <section class="featureset well-deployed">
        <h2 id="well-deployed-technologies">广泛部署的技术</h2>
        <div data-feature="基于 CSS 的适配">
          <p><a data-featureid="mediaqueries">CSS 媒体查询</a>定义了一种机制，允许根据设备的一些特性（尤其是屏幕分辨率）调整网页的布局和行为。</p>
          <p><a data-featureid="viewport-units">与视口（viewport）相关的CSS单位 <code>vw</code>、<code>vh</code>、<code>vmin</code> 和 <code>vmax</code></a> 表示当前视口尺寸的百分比，并允许开发者设计自动适应视口尺寸变化的布局。</p>
        </div>
        <div data-feature="响应式图像">
        <p><a href="https://www.w3.org/community/respimg/">响应式图像社区组（RICG）</a>开发了对HTML的扩展（<a data-featureid="picture"><code>picture元素</code></a>），允许作者根据设备功能和/或其他媒体特性定义要加载的图像。</p>
        <p>作为补充，<a href="https://whatwg.org/">WHATWG</a>指定的<a data-featureid="srcset"><code>srcset属性</code></a>也可作为HTML的扩展，让Web开发者定义图像的设备像素比，让浏览器选择最适合屏幕像素密度的图片。</p>
        <p><a data-featureid="svg11">SVG</a>可以定义可缩放的图像，而不会造成任何质量损失，这是开发适应多种设备分辨率的Web应用的另一个重要工具。</p>
        </div>

        <div data-feature="基于 JS 的适配">
          <p><dfn id="web-components">Web 组件</dfn>是一系列将应用逻辑封装在可重用的组件中的技术，其中主要技术包括：</p>
          <ul>
            <li><a data-featureid="html/template"><code>&lt;template&gt;</code> 元素</a>允许声明可以通过脚本克隆并插入文档中的 HTML 片段。</li>
            <li><a data-featureid="html/custom-elements">自定义元素</a>为 Web 开发者提供了一种构建自己的功能齐全的 DOM 元素的方法。</li>
            <li><a data-featureid="html/js-module">与 JavaScript 模块系统的集成</a>使 Web 开发者可以利用组件中的 JavaScript 模块。</li>
            <li><a data-featureid="dom/shadow">影子 DOM</a> 允许浏览器渲染不包含在主 DOM 文档树中的 DOM 元素。</li>
          </ul>
        </div>
      </section>

      <section class="featureset in-progress">
        <h2 id="technologies-in-progress">开发中的技术</h2>
        <div data-feature="基于 CSS 的适配">
          <p><a data-featureid="css-device-adapt">CSS设备适配</a>定义了一组CSS指令来定义该布局应该基于的尺寸，相对于底层设备的大小——指定<code>&lt;meta name="viewport"&gt;</code>元素实现的内容。</p>
          <p><a data-featureid="css-size-adjust">CSS 移动文本大小调整</a>让文本适应页面的缩放部分。</p>
          <p>媒体查询第四版和第五版添加了一些适应移动环境中的用户界面的相关的特性，包括：</p>
          <ul>
            <li>通过 <a data-featureid="mediaqueries5/pointer"><code>pointer</code></a>（及其配套的 <code>any-pointer</code>）的查询指针设备的存在与否及其类型。</li>
            <li>通过 <a data-featureid="mediaqueries5/hover"><code>hover</code></a> 查询设备是否支持<em>悬停</em>功能。</li>
            <li>通过 <a data-featureid="mediaqueries5/prefers-contrast"><code>prefers-contrast</code></a> 和 <a data-featureid="mediaqueries5/prefers-color-scheme"><code>prefers-color-scheme</code></a> 对环境亮度变化做出反应或遵循用户对亮或暗主题的偏好的能力。</li>
            <li>通过 <a data-featureid="mediaqueries5/prefers-reduced-motion"><code>prefers-reduced-motion</code></a> 来减少页面中的动画数量，节省电池。</li>
            <li>对<a href="https://drafts.csswg.org/mediaqueries-5/#script-custom-mq">脚本定义的变量</a>做出反应，从而更容易满足应用整体逻辑中更复杂的适配规则。</li>
          </ul>
        </div>

        <div data-feature="基于 JS 的适配">
          <p>以下是可以为 <a href="#web-components">Web 组件</a>设置样式的技术：</p>
            <ul>
              <li><a data-featureid="css-scoping">CSS 域</a>使 Web 开发者可以为自定义元素定义默认样式。</li>
              <li><a data-featureid="css-shadow-parts">CSS 影子部件</a>允许在影子树中标记元素并在外部页面中修改其样式，从而提供了一种易于使用的机制来根据需要自定义自定义元素的样式。</li>
              <li><a data-featureid="construct-stylesheets">可构造样式表对象</a>提供了一个 API，用于从 JavaScript 脚本创建样式表对象，使向 Web 组件添加样式更加方便和高效。</li>
            </ul>

          <p>如<a href="https://wicg.github.io/cq-usecases/">元素查询的用例和要求</a>中所述，开发人员需要控制相对于其容器大小的单个元素的布局，以创建适应各种设备和情景的复杂响应式应用。<code>window</code> 上的媒体查询和 <code>resize</code> 事件只允许开发者相对于视口大小调整组件的布局，而<a data-featureid="resize-observer">元素大小变化观察器</a>定义了一个接口，用于观察元素大小的变化并响应这些变化，允许设计可跨应用和设备的响应式 <a href="#web-components">Web 组件</a>。</p>
        </div>

        <div data-feature="服务器端适配" id="server-side-adaptation">
          <p>在移动设备上进行内容适配的常用方法是让服务器提供适合用户设备的内容。这种方法避免了向客户端发送客户端不需要的内容，节约了网络带宽，避免了在客户端上运行适配逻辑，保留了CPU和内存。<strong>服务器端适配</strong>用于依赖<em>嗅探</em> <code>User-Agent</code> 字符串并将其映射到设备数据库以适配相关功能。这种机制很容易出错，需要对设备数据库进行持续维护。通过由IETF HTTP工作组开发的<a href="http://httpwg.org/http-extensions/client-hints.html">HTTP客户端提示</a>机制，客户端和服务器现在可以选择交换相关功能以实现高效的内容自适应。<a href="https://www.w3.org/webperf/">Web性能工作组</a>已经开始使用<a data-featureid="device-memory">设备内存</a>规范来扩展这些提示，以表示设备上可用的内存。该规范还定义了一个API来将该信息显示给运行在客户端上的Web应用。</p>
        </div>

        <p data-feature="媒体捕获功能"><a data-featureid="getusermedia/capabilities">媒体捕捉与媒体流</a> API 开放了一些有关摄像头和麦克风功能的信息，以便利用手机上提供的各种媒体捕获设备。</p>
      </section>

      <section class="featureset exploratory-work">
        <h2 id="exploratory-work">探索性工作</h2>
        <div data-feature="基于 JS 的适配">
          <p>大多数移动设备都具有屏幕键盘，也通常让用户能够缩放页面。这两个功能都保留了<em>布局视口</em>（网页在布局其用户界面使用的视口），以免被 <code>position: fixed</code> 的元素弄乱屏幕。<a data-featureid="viewportapi">Visual Viewport API</a> 为开发人员提供了一种查看<em>可视视口</em>属性（用户当前可见的内容）并与之交互的方法，并在这些属性发生变化时得到通知。</p>
        </div>

        <div data-feature="服务器端适配">
          <p><a data-featureid="ua-client-hints">User-Agent Client Hints</a> 提案定义了一组客户端提示，这些提示为开发者提供了在必要时执行基于用户代理的内容协商（content negotiation）的能力，同时避免了 <code>User-Agent</code> HTTP头的历史包袱并减少了网站追踪用户的可能性，这也是<a href="#server-side-adaptation">服务器端适配</a>的基础。</p>
        </div>
      </section>
    </main>
    <script src="../js/generate.js"></script>
  </body>
</html>
