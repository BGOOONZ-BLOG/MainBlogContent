## What this proposal covers ##

Cross-cutting concerns around handling scripting in EPUB3 (see related wiki page)

## Proposal 1 ##

  1. OPS 3.0 will not define a specific processing model for scripting or otherwise talk about scripting at all - no definitions of DOM APIs, events, etc. The assumption is that Reading Systems will process OPS 3.0 documents as pure data.
  1. The definition of Core Media Types will move from OPS specification to OPF specification, and will add HTML5 as an (optional) core media type, using a newly chosen type specific to OPF 3 schema, distinct from "application/xhtml+xml", which for backwards compatibility with OPF & OPS 2.0.1 will remain reserved for OPS content. (NOTE: if it turns out that existing EPUB 2.x Reading Systems are insensitive to the content type for .html content, we can instead create a new content type for OPS 3.0, which would be cleaner. Or, we could use the same content type for both, and add metadata to OPF to distinguish them, which could also serve as a means for content authors to disable scripting even if content includes it. Lastly, we could require Reading Systems to probe for scripting. These options, not necessarily mutually exclusive, are details relative to the gist of this proposal).
  1. OPF 3.0 will define that Reading Systems should, on capable devices, process such HTML5 content according to the HTML5 processing model. But the OPF3 spec will not otherwise delve into the details of this processing, simply referring to the HTML5 specification in whatever state of completeness it is in. The OPS 3.0 grammar will not have the script element, nor the event handler attr collection, but it can still include for example the audio and video elements from HTMl5, as they are usable without scripting (have enough native behavior).
  1. OPS 3.0 can still legally contain an iframe or object element whose srcdoc is HTMl5(likely with restrictions about parent browsing context for such nested contexts that differ from browser User Agents).
  1. OPF 3.0 will further define that a fallback suitable for non-script-enabled Reading Systems MUST be provided  for any HTML5 content. It will be recommended to restrict the use of HTML5 markup in such content to the OPS 3.0 subset of elements (an "intrinsic fallback"), and ensure that scripting is only of a "progressive enhancement" nature. In this case separate fallback content is not necessary. Since scripting may interfere with dynamic pagination, HTML5 content, where supported, may be presented to users in a non-paginated or otherwise distinct manner (regardless of whether it uses only the OPS 3.0 subset of elements), so HTML5 content is recommended to be restricted to an embedded browsing context (iframe or object element). However, new functionality in OPS3 (beyond HTML5) may not be supported in a script-enabled browsing context.
  1. epubcheck3 will validate, from a content conformance perspective, both OPS3 and HTML5 content against respective schemas, and in the case of HTML5 content warn if a) the content is not restricted to the OPS3 subset and/or b) the content appears at the root level.
  1. IDPF will not get into the business of testing Reading System conformance when HTML5 content is processed. That will be defined as out of scope.

See [ImplementationProposalDataAndCodeSeparation](ImplementationProposalDataAndCodeSeparation.md) for a ways to lessen the probability of interference between scripting and dynamic pagination.