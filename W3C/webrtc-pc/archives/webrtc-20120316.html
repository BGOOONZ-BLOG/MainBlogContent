<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.0 Transitional//EN' 'http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd'>
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr">
<head>
  <meta content="HTML Tidy for Linux/x86 (vers 11 February 2007), see www.w3.org" name="generator" />
  <link type="text/css" rel="stylesheet" href="webrtc.css" />

  <title>WebRTC 1.0: Real-time Communication Between Browsers</title>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type" />
<!-- 
     === NOTA BENE ===
      For the three scripts below, if your spec resides on dev.w3 you can check them
      out in the same tree and use relative links so that they'll work offline.

      To tag a new releas in git hub

          Once the version is checked in and ready to go, you tag it with (need
          to chance the 20110823 to correct date )

               git tag -a v20110823 -m "This is release 20110823"

         Tags are not transferred by default with the push so you have to
         add a - -tags parameter to the push so it looks like. Note you need to
         remoce the space between the - and -tag to make a double dash. 

              git push - -tags 

         or alternatively you can push just the new tag with 

              git push origin v20110823


      To generate the dated version of the specification:

           Open this doc in Mozilla. 

           Do a CTRL-ALT-SHIFT-S

           Select "XHMTL( source)" from dialog box. This will pop a new tab with
           genreated version of the document.

           This will open a new tab with generated html. Copy and paste this to
           a new file. Note if you use Chrome or Safari, this step will not
           work. What will happen is the paste will have the original document,
           not what was displayed in the window that you did the copy on.

           Rename the new file to the correct day such as
           webrtc-broken-20111003.html then search for and edit the links for
           "This version" and "Previos version". Add the new file into CVS and
           check in. 

           Once everyone is happy, the webrtc-broken.html and
           webrtc-broken-20111003.html files can be coppied to
           webrtc.html and webrtc-20111003.html
           respectively in the ../editor/. directory. 
     -->


  

  
<style type="text/css">
/*****************************************************************
 * ReSpec CSS
 * Robin Berjon (robin at berjon dot com)
 * v0.05 - 2009-07-31
 *****************************************************************/


/* --- INLINES --- */
em.rfc2119 { 
    text-transform:     lowercase;
    font-variant:       small-caps;
    font-style:         normal;
    color:              #900;
}

h1 acronym, h2 acronym, h3 acronym, h4 acronym, h5 acronym, h6 acronym, a acronym,
h1 abbr, h2 abbr, h3 abbr, h4 abbr, h5 abbr, h6 abbr, a abbr {
    border: none;
}

dfn {
    font-weight:    bold;
}

a.internalDFN {
    color:  inherit;
    border-bottom:  1px solid #99c;
    text-decoration:    none;
}

a.externalDFN {
    color:  inherit;
    border-bottom:  1px dotted #ccc;
    text-decoration:    none;
}

a.bibref {
    text-decoration:    none;
}

code {
    color:  #ff4500;
}


/* --- WEB IDL --- */
pre.idl {
    border-top: 1px solid #90b8de;
    border-bottom: 1px solid #90b8de;
    padding:    1em;
    line-height:    120%;
}

pre.idl::before {
    content:    "WebIDL";
    display:    block;
    width:      150px;
    background: #90b8de;
    color:  #fff;
    font-family:    initial;
    padding:    3px;
    font-weight:    bold;
    margin: -1em 0 1em -1em;
}

.idlType {
    color:  #ff4500;
    font-weight:    bold;
    text-decoration:    none;
}

/*.idlModule*/
/*.idlModuleID*/
/*.idlInterface*/
.idlInterfaceID, .idlDictionaryID {
    font-weight:    bold;
    color:  #005a9c;
}

.idlSuperclass {
    font-style: italic;
    color:  #005a9c;
}

/*.idlAttribute*/
.idlAttrType, .idlFieldType, .idlMemberType {
    color:  #005a9c;
}
.idlAttrName, .idlFieldName, .idlMemberName {
    color:  #ff4500;
}
.idlAttrName a, .idlFieldName a, .idlMemberName a {
    color:  #ff4500;
    border-bottom:  1px dotted #ff4500;
    text-decoration: none;
}

/*.idlMethod*/
.idlMethType {
    color:  #005a9c;
}
.idlMethName {
    color:  #ff4500;
}
.idlMethName a {
    color:  #ff4500;
    border-bottom:  1px dotted #ff4500;
    text-decoration: none;
}

/*.idlParam*/
.idlParamType {
    color:  #005a9c;
}
.idlParamName {
    font-style: italic;
}

.extAttr {
    color:  #666;
}

/*.idlConst*/
.idlConstType {
    color:  #005a9c;
}
.idlConstName {
    color:  #ff4500;
}
.idlConstName a {
    color:  #ff4500;
    border-bottom:  1px dotted #ff4500;
    text-decoration: none;
}

/*.idlException*/
.idlExceptionID {
    font-weight:    bold;
    color:  #c00;
}

.idlTypedefID, .idlTypedefType {
    color:  #005a9c;
}

.idlRaises, .idlRaises a.idlType, .idlRaises a.idlType code, .excName a, .excName a code {
    color:  #c00;
    font-weight:    normal;
}

.excName a {
    font-family:    monospace;
}

.idlRaises a.idlType, .excName a.idlType {
    border-bottom:  1px dotted #c00;
}

.excGetSetTrue, .excGetSetFalse, .prmNullTrue, .prmNullFalse, .prmOptTrue, .prmOptFalse {
    width:  45px;
    text-align: center;
}
.excGetSetTrue, .prmNullTrue, .prmOptTrue { color:  #0c0; }
.excGetSetFalse, .prmNullFalse, .prmOptFalse { color:  #c00; }

.idlImplements a {
    font-weight:    bold;
}

dl.attributes, dl.methods, dl.constants, dl.fields, dl.dictionary-members {
    margin-left:    2em;
}

.attributes dt, .methods dt, .constants dt, .fields dt, .dictionary-members dt {
    font-weight:    normal;
}

.attributes dt code, .methods dt code, .constants dt code, .fields dt code, .dictionary-members dt code {
    font-weight:    bold;
    color:  #000;
    font-family:    monospace;
}

.attributes dt code, .fields dt code, .dictionary-members dt code {
    background:  #ffffd2;
}

.attributes dt .idlAttrType code, .fields dt .idlFieldType code, .dictionary-members dt .idlMemberType code {
    color:  #005a9c;
    background:  transparent;
    font-family:    inherit;
    font-weight:    normal;
    font-style: italic;
}

.methods dt code {
    background:  #d9e6f8;
}

.constants dt code {
    background:  #ddffd2;
}

.attributes dd, .methods dd, .constants dd, .fields dd, .dictionary-members dd {
    margin-bottom:  1em;
}

table.parameters, table.exceptions {
    border-spacing: 0;
    border-collapse:    collapse;
    margin: 0.5em 0;
    width:  100%;
}
table.parameters { border-bottom:  1px solid #90b8de; }
table.exceptions { border-bottom:  1px solid #deb890; }

.parameters th, .exceptions th {
    color:  #fff;
    padding:    3px 5px;
    text-align: left;
    font-family:    initial;
    font-weight:    normal;
    text-shadow:    #666 1px 1px 0;
}
.parameters th { background: #90b8de; }
.exceptions th { background: #deb890; }

.parameters td, .exceptions td {
    padding:    3px 10px;
    border-top: 1px solid #ddd;
    vertical-align: top;
}

.parameters tr:first-child td, .exceptions tr:first-child td {
    border-top: none;
}

.parameters td.prmName, .exceptions td.excName, .exceptions td.excCodeName {
    width:  100px;
}

.parameters td.prmType {
    width:  120px;
}

table.exceptions table {
    border-spacing: 0;
    border-collapse:    collapse;
    width:  100%;
}

/* --- TOC --- */
.toc a {
    text-decoration:    none;
}

a .secno {
    color:  #000;
}

/* --- TABLE --- */
table.simple {
    border-spacing: 0;
    border-collapse:    collapse;
    border-bottom:  3px solid #005a9c;
}

.simple th {
    background: #005a9c;
    color:  #fff;
    padding:    3px 5px;
    text-align: left;
}

.simple th[scope="row"] {
    background: inherit;
    color:  inherit;
    border-top: 1px solid #ddd;
}

.simple td {
    padding:    3px 10px;
    border-top: 1px solid #ddd;
}

.simple tr:nth-child(even) {
    background: #f0f6ff;
}

/* --- DL --- */
.section dd > p:first-child {
    margin-top: 0;
}

.section dd > p:last-child {
    margin-bottom: 0;
}

.section dd {
    margin-bottom:  1em;
}

.section dl.attrs dd, .section dl.eldef dd {
    margin-bottom:  0;
}

/* --- EXAMPLES --- */
pre.example {
    border-top: 1px solid #ff4500;
    border-bottom: 1px solid #ff4500;
    padding:    1em;
    margin-top: 1em;
}

pre.example::before {
    content:    "Example";
    display:    block;
    width:      150px;
    background: #ff4500;
    color:  #fff;
    font-family:    initial;
    padding:    3px;
    font-weight:    bold;
    margin: -1em 0 1em -1em;
}

/* --- EDITORIAL NOTES --- */
.issue {
    padding:    1em;
    margin: 1em 0em 0em;
    border: 1px solid #f00;
    background: #ffc;
}

.issue::before {
    content:    "Issue";
    display:    block;
    width:  150px;
    margin: -1.5em 0 0.5em 0;
    font-weight:    bold;
    border: 1px solid #f00;
    background: #fff;
    padding:    3px 1em;
}

.note {
    margin: 1em 0em 0em;
    padding:    1em;
    border: 2px solid #cff6d9;
    background: #e2fff0;
}

.note::before {
    content:    "Note";
    display:    block;
    width:  150px;
    margin: -1.5em 0 0.5em 0;
    font-weight:    bold;
    border: 1px solid #cff6d9;
    background: #fff;
    padding:    3px 1em;
}

/* --- Best Practices --- */
div.practice {
    border: solid #bebebe 1px;
    margin: 2em 1em 1em 2em;
}

span.practicelab {
    margin: 1.5em 0.5em 1em 1em;
    font-weight: bold;
    font-style: italic;
}

span.practicelab   { background: #dfffff; }

span.practicelab {
    position: relative;
    padding: 0 0.5em;
    top: -1.5em;
}

p.practicedesc {
    margin: 1.5em 0.5em 1em 1em;
}

@media screen {
    p.practicedesc {
        position: relative;
        top: -2em;
        padding: 0;
        margin: 1.5em 0.5em -1em 1em;
    }
}

/* --- SYNTAX HIGHLIGHTING --- */
pre.sh_sourceCode {
  background-color: white;
  color: black;
  font-style: normal;
  font-weight: normal;
}

pre.sh_sourceCode .sh_keyword { color: #005a9c; font-weight: bold; }           /* language keywords */
pre.sh_sourceCode .sh_type { color: #666; }                            /* basic types */
pre.sh_sourceCode .sh_usertype { color: teal; }                             /* user defined types */
pre.sh_sourceCode .sh_string { color: red; font-family: monospace; }        /* strings and chars */
pre.sh_sourceCode .sh_regexp { color: orange; font-family: monospace; }     /* regular expressions */
pre.sh_sourceCode .sh_specialchar { color: 	#ffc0cb; font-family: monospace; }  /* e.g., \n, \t, \\ */
pre.sh_sourceCode .sh_comment { color: #A52A2A; font-style: italic; }         /* comments */
pre.sh_sourceCode .sh_number { color: purple; }                             /* literal numbers */
pre.sh_sourceCode .sh_preproc { color: #00008B; font-weight: bold; }       /* e.g., #include, import */
pre.sh_sourceCode .sh_symbol { color: blue; }                            /* e.g., *, + */
pre.sh_sourceCode .sh_function { color: black; font-weight: bold; }         /* function calls and declarations */
pre.sh_sourceCode .sh_cbracket { color: red; }                              /* block brackets (e.g., {, }) */
pre.sh_sourceCode .sh_todo { font-weight: bold; background-color: #00FFFF; }   /* TODO and FIXME */

/* Predefined variables and functions (for instance glsl) */
pre.sh_sourceCode .sh_predef_var { color: #00008B; }
pre.sh_sourceCode .sh_predef_func { color: #00008B; font-weight: bold; }

/* for OOP */
pre.sh_sourceCode .sh_classname { color: teal; }

/* line numbers (not yet implemented) */
pre.sh_sourceCode .sh_linenum { display: none; }

/* Internet related */
pre.sh_sourceCode .sh_url { color: blue; text-decoration: underline; font-family: monospace; }

/* for ChangeLog and Log files */
pre.sh_sourceCode .sh_date { color: blue; font-weight: bold; }
pre.sh_sourceCode .sh_time, pre.sh_sourceCode .sh_file { color: #00008B; font-weight: bold; }
pre.sh_sourceCode .sh_ip, pre.sh_sourceCode .sh_name { color: #006400; }

/* for Prolog, Perl... */
pre.sh_sourceCode .sh_variable { color: #006400; }

/* for LaTeX */
pre.sh_sourceCode .sh_italics { color: #006400; font-style: italic; }
pre.sh_sourceCode .sh_bold { color: #006400; font-weight: bold; }
pre.sh_sourceCode .sh_underline { color: #006400; text-decoration: underline; }
pre.sh_sourceCode .sh_fixed { color: green; font-family: monospace; }
pre.sh_sourceCode .sh_argument { color: #006400; }
pre.sh_sourceCode .sh_optionalargument { color: purple; }
pre.sh_sourceCode .sh_math { color: orange; }
pre.sh_sourceCode .sh_bibtex { color: blue; }

/* for diffs */
pre.sh_sourceCode .sh_oldfile { color: orange; }
pre.sh_sourceCode .sh_newfile { color: #006400; }
pre.sh_sourceCode .sh_difflines { color: blue; }

/* for css */
pre.sh_sourceCode .sh_selector { color: purple; }
pre.sh_sourceCode .sh_property { color: blue; }
pre.sh_sourceCode .sh_value { color: #006400; font-style: italic; }

/* other */
pre.sh_sourceCode .sh_section { color: black; font-weight: bold; }
pre.sh_sourceCode .sh_paren { color: red; }
pre.sh_sourceCode .sh_attribute { color: #006400; }

</style><link href="http://www.w3.org/StyleSheets/TR/W3C-ED" rel="stylesheet" type="text/css" charset="utf-8" /></head>

<body style="display: inherit;"><div class="head"><p><a href="http://www.w3.org/"><img width="72" height="48" alt="W3C" src="http://www.w3.org/Icons/w3c_home" /></a></p><h1 id="title" class="title">WebRTC 1.0: Real-time Communication Between Browsers</h1><h2 id="w3c-editor-s-draft-16-march-2012"><acronym title="World Wide Web Consortium">W3C</acronym> Editor's Draft 16 March 2012</h2><dl><dt>This version:</dt><dd><a href="http://dev.w3.org/2011/webrtc/editor/webrtc-20120316.html">http://dev.w3.org/2011/webrtc/editor/webrtc-20120316.html</a></dd><dt>Latest published version:</dt><dd><a href="http://www.w3.org/TR/webrtc/">http://www.w3.org/TR/webrtc/</a></dd><dt>Latest editor's draft:</dt><dd><a href="http://dev.w3.org/2011/webrtc/editor/webrtc.html">http://dev.w3.org/2011/webrtc/editor/webrtc.html</a></dd><dt>Previous version:</dt><dd><a href="http://dev.w3.org/2011/webrtc/editor/webrtc-20120128.html">http://dev.w3.org/2011/webrtc/editor/webrtc-20120128.html</a></dd><dt>Editors:</dt><dd><span>Adam Bergkvist</span>, Ericsson</dd>
<dd><span>Daniel C. Burnett</span>, Voxeo</dd>
<dd><span>Cullen Jennings</span>, Cisco</dd>
<dd><span>Anant Narayanan</span>, Mozilla</dd>
</dl><p class="copyright">Initial Author of this Specification was Ian Hickson, Google Inc., with the following copyright statement:<br /> © Copyright 2004-2011 Apple Computer, Inc., Mozilla Foundation, and Opera Software ASA. You are granted a license to use, reproduce and create derivative works of this document.</p> <p class="copyright">All subsequent changes since 26 July 2011 done by the <acronym title="World Wide Web Consortium">W3C</acronym> WebRTC Working Group are under the following <a href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a>:<br />© 2011-2012 <a href="http://www.w3.org/"><acronym title="World Wide Web Consortium">W3C</acronym></a><sup>®</sup> (<a href="http://www.csail.mit.edu/"><acronym title="Massachusetts Institute of Technology">MIT</acronym></a>, <a href="http://www.ercim.eu/"><acronym title="European Research Consortium for Informatics and Mathematics">ERCIM</acronym></a>, <a href="http://www.keio.ac.jp/">Keio</a>), All Rights Reserved. <a href="http://www.w3.org/Consortium/Legal/copyright-documents">Document use</a>  rules apply.</p> <p class="copyright">For the entire publication on the <acronym title="World Wide Web Consortium">W3C</acronym> site the <a href="http://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a> and <a href="http://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a> rules apply.</p><hr /></div>
  <div id="abstract" class="introductory section"><h2>Abstract</h2>

    <p>This document defines a set of APIs to represent streaming media, including audio
    and video, in JavaScript, to allow media to be sent over the network to another browser
    or device implementing the appropriate set of real-time protocols, and
    media received from another browser or device to be processed
    and displayed locally.  This specification is being developed
     in conjunction with a protocol specification developed by the IETF
    RTCWEB group and an API specification to get access to local media
    devices developed by the Media Capture Task Force.
    </p>

  </div><div class="introductory section" id="sotd"><h2>Status of This Document</h2><p><em>This section describes the status of this document at the time of its publication. Other documents may supersede this document. A list of current <acronym title="World Wide Web Consortium">W3C</acronym> publications and the latest revision of this technical report can be found in the <a href="http://www.w3.org/TR/"><acronym title="World Wide Web Consortium">W3C</acronym> technical reports index</a> at http://www.w3.org/TR/.</em></p>
   <p>This document is not complete.
   It is subject to major changes and, while early experimentations are
   encouraged, it is therefore not intended for implementation. The API
   is based on preliminary work done in the WHATWG. The Web Real-Time
   Communications Working Group expects this specification to evolve
   significantly based on:</p>
  <ul>
    <li>The outcomes of ongoing exchanges in the companion RTCWEB group
    at IETF to define the set of protocols that, together with this
    document, will enable real-time communications in Web browsers.</li>
    <li>Privacy issues that arise when exposing local capabilities and
    local streams.</li>
    <li>Technical discussions within the group, on the data channel in
    particular.</li>
    <li>Experience gained through early experimentations.</li>
    <li>Feedback received from other groups and individuals.</li>
  </ul>
  <p>As the specification matures, the group hopes to strike the right
  balance between a low-level API that would enable interested parties
  to tweak potentially complex system parameters, and a more high-level
  API that Web developers can use without <em>a priori</em> technical
  knowledge about real-time communications.</p>
<p>This document was published by the <a href="http://www.w3.org/2011/04/webrtc/">Web Real-Time Communications Working Group</a> as an Editor's Draft. If you wish to make comments regarding this document, please send them to <a href="mailto:public-webrtc@w3.org">public-webrtc@w3.org</a> (<a href="mailto:public-webrtc-request@w3.org?subject=subscribe">subscribe</a>, <a href="http://lists.w3.org/Archives/Public/public-webrtc/">archives</a>). All feedback is welcome.</p><p>Publication as an Editor's Draft does not imply endorsement by the <acronym title="World Wide Web Consortium">W3C</acronym> Membership. This is a draft document and may be updated, replaced or obsoleted by other documents at any time. It is inappropriate to cite this document as other than work in progress.</p><p>This document was produced by a group operating under the <a href="http://www.w3.org/Consortium/Patent-Policy-20040205/">5 February 2004 <acronym title="World Wide Web Consortium">W3C</acronym> Patent Policy</a>. <acronym title="World Wide Web Consortium">W3C</acronym> maintains a <a rel="disclosure" href="http://www.w3.org/2004/01/pp-impl/47318/status">public list of any patent disclosures</a> made in connection with the deliverables of the group; that page also includes instructions for disclosing a patent. An individual who has actual knowledge of a patent which the individual believes contains <a href="http://www.w3.org/Consortium/Patent-Policy-20040205/#def-essential">Essential Claim(s)</a> must disclose the information in accordance with <a href="http://www.w3.org/Consortium/Patent-Policy-20040205/#sec-Disclosure">section 6 of the <acronym title="World Wide Web Consortium">W3C</acronym> Patent Policy</a>.</p></div><div id="toc" class="section"><h2 class="introductory">Table of Contents</h2><ul class="toc"><li class="tocline"><a href="#conformance" class="tocxref"><span class="secno">1. </span>Conformance</a></li><li class="tocline"><a href="#intro" class="tocxref"><span class="secno">2. </span>Introduction</a></li><li class="tocline"><a href="#stream-api" class="tocxref"><span class="secno">3. </span>Stream API</a><ul class="toc"><li class="tocline"><a href="#introduction" class="tocxref"><span class="secno">3.1 </span>Introduction</a></li><li class="tocline"><a href="#interface-definitions" class="tocxref"><span class="secno">3.2 </span>Interface definitions</a><ul class="toc"><li class="tocline"><a href="#mediastream" class="tocxref"><span class="secno">3.2.1 </span>MediaStream</a><ul class="toc"><li class="tocline"><a href="#attributes" class="tocxref"><span class="secno">3.2.1.1 </span>Attributes</a></li><li class="tocline"><a href="#methods" class="tocxref"><span class="secno">3.2.1.2 </span>Methods</a></li></ul></li><li class="tocline"><a href="#localmediastream" class="tocxref"><span class="secno">3.2.2 </span>LocalMediaStream</a><ul class="toc"><li class="tocline"><a href="#methods-1" class="tocxref"><span class="secno">3.2.2.1 </span>Methods</a></li></ul></li><li class="tocline"><a href="#mediastreamtrack" class="tocxref"><span class="secno">3.2.3 </span>MediaStreamTrack</a><ul class="toc"><li class="tocline"><a href="#attributes-1" class="tocxref"><span class="secno">3.2.3.1 </span>Attributes</a></li><li class="tocline"><a href="#constants" class="tocxref"><span class="secno">3.2.3.2 </span>Constants</a></li></ul></li><li class="tocline"><a href="#audiomediastreamtrack" class="tocxref"><span class="secno">3.2.4 </span>AudioMediaStreamTrack</a><ul class="toc"><li class="tocline"><a href="#attributes-2" class="tocxref"><span class="secno">3.2.4.1 </span>Attributes</a></li><li class="tocline"><a href="#methods-2" class="tocxref"><span class="secno">3.2.4.2 </span>Methods</a></li></ul></li><li class="tocline"><a href="#mediastreamtracklist" class="tocxref"><span class="secno">3.2.5 </span>MediaStreamTrackList</a><ul class="toc"><li class="tocline"><a href="#attributes-3" class="tocxref"><span class="secno">3.2.5.1 </span>Attributes</a></li><li class="tocline"><a href="#methods-3" class="tocxref"><span class="secno">3.2.5.2 </span>Methods</a></li></ul></li><li class="tocline"><a href="#mediastreamrecorder" class="tocxref"><span class="secno">3.2.6 </span>MediaStreamRecorder</a><ul class="toc"><li class="tocline"><a href="#methods-4" class="tocxref"><span class="secno">3.2.6.1 </span>Methods</a></li></ul></li><li class="tocline"><a href="#blobcallback" class="tocxref"><span class="secno">3.2.7 </span>BlobCallback</a><ul class="toc"><li class="tocline"><a href="#methods-5" class="tocxref"><span class="secno">3.2.7.1 </span>Methods</a></li></ul></li><li class="tocline"><a href="#url" class="tocxref"><span class="secno">3.2.8 </span>URL</a><ul class="toc"><li class="tocline"><a href="#methods-6" class="tocxref"><span class="secno">3.2.8.1 </span>Methods</a></li></ul></li></ul></li><li class="tocline"><a href="#examples" class="tocxref"><span class="secno">3.3 </span>Examples</a></li></ul></li><li class="tocline"><a href="#peer-to-peer-connections" class="tocxref"><span class="secno">4. </span>Peer-to-peer connections</a><ul class="toc"><li class="tocline"><a href="#peerconnection" class="tocxref"><span class="secno">4.1 </span>PeerConnection</a><ul class="toc"><li class="tocline"><a href="#attributes-4" class="tocxref"><span class="secno">4.1.1 </span>Attributes</a></li><li class="tocline"><a href="#methods-7" class="tocxref"><span class="secno">4.1.2 </span>Methods</a></li><li class="tocline"><a href="#constants-1" class="tocxref"><span class="secno">4.1.3 </span>Constants</a></li></ul></li><li class="tocline"><a href="#signalingcallback" class="tocxref"><span class="secno">4.2 </span>SignalingCallback</a><ul class="toc"><li class="tocline"><a href="#methods-8" class="tocxref"><span class="secno">4.2.1 </span>Methods</a></li></ul></li><li class="tocline"><a href="#examples-1" class="tocxref"><span class="secno">4.3 </span>Examples</a></li></ul></li><li class="tocline"><a href="#peer-to-peer-data-api" class="tocxref"><span class="secno">5. </span>Peer-to-peer Data API</a><ul class="toc"><li class="tocline"><a href="#datachannel" class="tocxref"><span class="secno">5.1 </span>DataChannel</a><ul class="toc"><li class="tocline"><a href="#attributes-5" class="tocxref"><span class="secno">5.1.1 </span>Attributes</a></li><li class="tocline"><a href="#methods-9" class="tocxref"><span class="secno">5.1.2 </span>Methods</a></li><li class="tocline"><a href="#constants-2" class="tocxref"><span class="secno">5.1.3 </span>Constants</a></li><li class="tocline"><a href="#dictionary-datachannelinit-members" class="tocxref"><span class="secno">5.1.4 </span>Dictionary <span class="idlType formerLink idlType"><code>DataChannelInit</code></span> Members</a></li></ul></li><li class="tocline"><a href="#examples-2" class="tocxref"><span class="secno">5.2 </span>Examples</a></li></ul></li><li class="tocline"><a href="#garbage-collection" class="tocxref"><span class="secno">6. </span>Garbage collection</a></li><li class="tocline"><a href="#event-definitions" class="tocxref"><span class="secno">7. </span>Event definitions</a><ul class="toc"><li class="tocline"><a href="#mediastreamtrackevent" class="tocxref"><span class="secno">7.1 </span>MediaStreamTrackEvent</a><ul class="toc"><li class="tocline"><a href="#attributes-6" class="tocxref"><span class="secno">7.1.1 </span>Attributes</a></li><li class="tocline"><a href="#dictionary-mediastreamtrackeventinit-members" class="tocxref"><span class="secno">7.1.2 </span>Dictionary <span class="idlType formerLink idlType"><code>MediaStreamTrackEventInit</code></span> Members</a></li></ul></li><li class="tocline"><a href="#mediastreamevent" class="tocxref"><span class="secno">7.2 </span>MediaStreamEvent</a><ul class="toc"><li class="tocline"><a href="#attributes-7" class="tocxref"><span class="secno">7.2.1 </span>Attributes</a></li><li class="tocline"><a href="#dictionary-mediastreameventinit-members" class="tocxref"><span class="secno">7.2.2 </span>Dictionary <span class="idlType formerLink idlType"><code>MediaStreamEventInit</code></span> Members</a></li></ul></li><li class="tocline"><a href="#datachannelevent" class="tocxref"><span class="secno">7.3 </span>DataChannelEvent</a><ul class="toc"><li class="tocline"><a href="#attributes-8" class="tocxref"><span class="secno">7.3.1 </span>Attributes</a></li><li class="tocline"><a href="#dictionary-datachanneleventinit-members" class="tocxref"><span class="secno">7.3.2 </span>Dictionary <span class="idlType formerLink idlType"><code>DataChannelEventInit</code></span> Members</a></li></ul></li></ul></li><li class="tocline"><a href="#event-summary" class="tocxref"><span class="secno">8. </span>Event summary</a></li><li class="tocline"><a href="#application-html-peer-connection-data" class="tocxref"><span class="secno">9. </span>application/html-peer-connection-data</a></li><li class="tocline"><a href="#change-log" class="tocxref"><span class="secno">10. </span>Change Log</a></li><li class="tocline"><a href="#acknowledgements" class="tocxref"><span class="secno">A. </span>Acknowledgements</a></li><li class="tocline"><a href="#references" class="tocxref"><span class="secno">B. </span>References</a><ul class="toc"><li class="tocline"><a href="#normative-references" class="tocxref"><span class="secno">B.1 </span>Normative references</a></li><li class="tocline"><a href="#informative-references" class="tocxref"><span class="secno">B.2 </span>Informative references</a></li></ul></li></ul></div>

  <div id="conformance" class="section">
<!-- OddPage -->
<h2><span class="secno">1. </span>Conformance</h2><p>As well as sections marked as non-normative, all authoring guidelines, diagrams, examples, and notes in this specification are non-normative. Everything else in this specification is normative.</p>
<p>The key words <em class="rfc2119" title="must">must</em>, <em class="rfc2119" title="must not">must not</em>, <em class="rfc2119" title="required">required</em>, <em class="rfc2119" title="should">should</em>, <em class="rfc2119" title="should not">should not</em>, <em class="rfc2119" title="recommended">recommended</em>, <em class="rfc2119" title="may">may</em>, and <em class="rfc2119" title="optional">optional</em> in this specification are to be interpreted as described in [<cite><a class="bibref" rel="biblioentry" href="#bib-RFC2119">RFC2119</a></cite>].</p>

      <p>
        Implementations that use ECMAScript to implement the APIs defined in this specification must implement
        them in a manner consistent with the ECMAScript Bindings defined in the Web IDL specification
        [<cite><a class="bibref" rel="biblioentry" href="#bib-WEBIDL">WEBIDL</a></cite>], as this specification uses that specification and terminology.
      </p>


  </div>

   

  <div class="informative section" id="intro">
  
<!-- OddPage -->
<h2><span class="secno">2. </span>Introduction</h2><p><em>This section is non-normative.</em></p>

  <p>There are a number of facets to video-conferencing in HTML covered by this specification:</p>

  <ul>
    <li>Representing a multimedia stream (video, audio, or both) from local devices (video
    cameras, microphones, Web cams) or from prerecorded files provided by the user.</li>

    <li>Recording such streams locally.</li>

    <li>Connecting to remote peers using NAT-traversal technologies such as ICE, STUN,
    and TURN.</li>

    <li>Sending the locally-produced streams to remote peers and receiving streams from
    remote peers.</li>

    <li>Displaying such streams (both the locally-produced ones and the remotely-obtained
    ones) locally using the <code>video</code> or <code>audio</code> elements.</li>

    <li>Sending arbitrary data to remote peers.</li>
  </ul>

  <p>This document defines the APIs used for these features.  This specification
  is being developed in conjunction with a protocol specification developed by
  the <a href="http://datatracker.ietf.org/wg/rtcweb/">IETF RTCWEB group</a> and
  an API specification to get access to local media devices developed by the
  <a href="http://www.w3.org/2011/04/webrtc/">Media Capture Task Force</a>.</p>
  </div>

  <div id="stream-api" class="section">
  
<!-- OddPage -->
<h2><span class="secno">3. </span>Stream API</h2>

  <div id="introduction" class="section">
  <h3><span class="secno">3.1 </span>Introduction</h3>

  <p>The <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> interface is used to
  represent streams of media data, typically (but not necessarily) of audio and/or video
  content, e.g. from a local camera or a remote site. The data from a <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code>
  object does not necessarily have a canonical binary form; for example, it could just be
  &quot;the video currently coming from the user’s video camera&quot;. This allows user agents to manipulate
  media streams in whatever fashion is most suitable on the user’s platform.</p>

  <p>Each <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> object can contain zero
  or more tracks, in particular audio and video tracks.
  All tracks in a MediaStream are
  intended to be synchronized when rendered.
  Different MediaStreams do not need to be synchronized.</p>

  <p>Each track in a MediaStream object has a corresponding <code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code> object.</p>

  <p>A <code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code> represents content comprising one or more channels, where
  the channels have a defined well known relationship to each other (such as a stereo or 5.1 audio signal),
  and are intended to be encoded together for transmission as, for instance, an RTP payload type. One
  <code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code> sent to another peer <em class="rfc2119" title="must">must</em> appear as one and only one
  <code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code> to the recipient. All of the channels
  that a codec needs to encode the media <em class="rfc2119" title="must">must</em> be in the same  <code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code> and the
  codecs <em class="rfc2119" title="should">should</em> be able to encode, or discard, all the channels in the track. </p>

  <p>A channel is the smallest unit considered in this API specification.</p>

  <p>A <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> object has an input and an
  output. The input depends on how the object was created: a <code><a href="#idl-def-LocalMediaStream" class="idlType"><code>LocalMediaStream</code></a></code> object generated by a
  <code>getUserMedia()</code> [<cite><a class="bibref" rel="biblioentry" href="#bib-GETUSERMEDIA">GETUSERMEDIA</a></cite>]
  call, for instance, might take
  its input from the user’s local camera, while a <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> created by a <code><a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a></code> object will take as input the data received
  from a remote peer. The output of the object controls how the object is used, e.g. what
  is saved if the object is written to a file, what is displayed if the object is used in
  a <code>video</code> element, or indeed what is transmitted to a remote peer if the
  object is used with a <code><a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a></code>
  object.</p>

  <p>Each track in a <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> object can be
  disabled, meaning that it is muted in the object’s output. All tracks are initially
  enabled.</p>

  <p>A <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> can be <a href="#dfn-finished" class="internalDFN">finished</a>, indicating that its inputs have
  forever stopped providing data.</p>

  <p>The output of a <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> object <em class="rfc2119" title="must">must</em>
  correspond to the tracks in its input. Muted audio tracks <em class="rfc2119" title="must">must</em> be replaced with
  silence. Muted video tracks <em class="rfc2119" title="must">must</em> be replaced with blackness.</p>

  <p>A new <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> object can be created from existing
  <code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code> objects using the <code>
  <a href="#dom-mediastream">MediaStream()</a></code> constructor. The constructor takes two
  lists of <code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code> objects as arguments; one for audio tracks and
  one for video tracks. The lists can either be the track lists of another stream, subsets of
  such lists, or compositions of <code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code> objects from different
  <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> objects. </p>

  <p><img src="images/media-stream-1.png" alt="" /></p>
<!--  no alt since
  it's all described in the previous paragraphs: this is just a
  summary  -->

  
<!-- 
c.clearRect(0, 0, 640, 480);
c.save();
try {
  with (c) {
    save();
    strokeStyle = '#AA0000';
    lineWidth = 20;
    beginPath();
    moveTo(50,98);
    lineTo(550, 98);
    stroke();
  }
  mediaStream(c,50,10, true);

} finally {
  c.restore();
}

function cameraIcon(c,x,y) {
  with (c) { save(); try {
    translate(x,y);
    fillRect(-10,-10,20,20);
    beginPath();
    moveTo(7,0);
    lineTo(20,-10);
    lineTo(20,10);
    fill();
    font = '100 8px "Press Start 2P", sans-serif';
    textAlign = 'center';
    textBaseline = 'top';
    fillText('Camera', 4, 15);
  } finally { restore(); } }
}

function mediaStream(c,x,y,vid) {
  with (c) {
    save();
    translate(x-10,y-97);

    // cable
    fillStyle = 'black';
    font = '100 10px "Press Start 2P", sans-serif';
    textAlign = 'right';
    fillText('Input', 95, 170);
    textAlign = 'left';
    fillText('Output', 407, 170);

    // media stream
    fillStyle = '#EE8800';
    strokeStyle = '#FFCC00';
    lineWidth = 6;
    fillRect(100,100,300,170);
    strokeRect(100,100,300,170);
    fillStyle = 'black';
    font = '900 12px "Press Start 2P", sans-serif';
    textAlign = 'left';
    fillText('MediaStream', 110, 123);

    // tracks
    textAlign = 'left';
    strokeStyle = '#CC3300';
    fillStyle = '#FFFF00';
    lineWidth = 4;
    globalAlpha = vid ? 1 : 0.4;
    fillRect(120,140,100,110);
    strokeRect(120,140,100,110);
    globalAlpha = 1;
    fillRect(238,140,100,110);
    strokeRect(238,140,100,110);
    fillStyle = 'black';
    font = '900 10px "Press Start 2P", sans-serif';
    globalAlpha = vid ? 1 : 0.4;
    fillText('Track', 123, 155);
    fillText('(video)', 123, 170);
    globalAlpha = 1;
    fillText('Track', 241, 155);
    fillText('(stereo', 241, 170);
    fillText(' audio)', 241, 185);

    // channels
    strokeStyle = '#999999';
    fillStyle = '#FFFFFF';
    lineWidth = 2;
    fillRect(245,191,86,23);
    strokeRect(245,191,86,23);
    fillRect(245,220,86,23);
    strokeRect(245,220,86,23);
    fillStyle = 'black';
    font = '100 8px "Press Start 2P", sans-serif';
    textAlign = 'left';
    textBaseline = 'alphabetic';
    fillText('left', 249, 202);
    fillText('channel', 249, 211);
    fillText('right', 249, 231);
    fillText('channel', 249, 240);

    // track check marks
    fillStyle = 'black';
    font = '900 35px "Lucida Grande", sans-serif';
    textAlign = 'center';
    textBaseline = 'middle';
    fillText(vid ? '\u2713' : '\u2716', 220, 245);
    fillText('\u2713', 338, 245);

    restore();
  }
}
 -->


  <p>The ability to duplicate a <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code>, i.e.
  create a new <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> object from the track lists of an existing stream,
  allows for greater control since separate <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> instances can be
  manipulated and <a title="consumer" href="#dfn-consumer" class="internalDFN">consumed</a>
  individually. This can be used, for instance, in a video-conferencing scenario to display
  the local video from the user’s camera and microphone in a local monitor, while only
  transmitting the audio to the remote peer (e.g. in response to the user using a &quot;video
  mute&quot; feature). Combining tracks from different <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a>
  </code> objects into a new <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> makes it
  possible to, e.g., record selected tracks from a conversation involving several <code>
  <a href="#mediastream">MediaStream</a></code> objects with a single <code>
  <a href="#mediastreamrecorder">MediaStreamRecorder</a></code>.</p>

  
<!-- 
c.clearRect(0, 0, 640, 480);
c.save();
try {
  with (c) {
    save();
    strokeStyle = '#AA0000';
    lineWidth = 20;
    beginPath();
    moveTo(50,98);
    lineTo(550, 98);
    lineTo(550, 210);
    lineTo(50, 210);
    lineTo(50, 320);
    lineTo(550, 320);
    lineTo(550,420);
    stroke();
    beginPath();
    moveTo(50,320);
    lineTo(50,420);
    stroke();
    restore();
    fillStyle = 'black';
    font = '100 10px "Press Start 2P", sans-serif';
    textAlign = 'center';
    fillText('<video>', 50, 440);
    fillText('PeerConnection', 550, 440);
    font = '100 8px "Press Start 2P", sans-serif';
  }
  cameraIcon(c,25,98)
  mediaStream(c,50,10, true);
  mediaStream(c,50,233, false);

  with (c) {
    font = '100 8px "Press Start 2P", sans-serif';
    textAlign = 'left';
    textBaseline = 'middle';
    fillStyle = 'gray';

    fillText('from', 4, 130);
    fillText('getUserMedia()', 4, 140);

    fillText('via URL.createObjectURL()', 4, 450);

    textAlign = 'center';
    fillText('via addStream()', 550, 450);
  }
} finally {
  c.restore();
}

function cameraIcon(c,x,y) {
  with (c) { save(); try {
    translate(x,y);
    fillRect(-10,-10,20,20);
    beginPath();
    moveTo(7,0);
    lineTo(20,-10);
    lineTo(20,10);
    fill();
    font = '100 8px "Press Start 2P", sans-serif';
    textAlign = 'center';
    textBaseline = 'top';
    fillText('Camera', 4, 15);
  } finally { restore(); } }
}

function mediaStream(c,x,y,vid) {
  with (c) {
    save();
    translate(x-10,y-97);

    // cable
    fillStyle = 'black';
    font = '100 10px "Press Start 2P", sans-serif';
    textAlign = 'right';
    fillText('Input', 95, 170);
    textAlign = 'left';
    fillText('Output', 407, 170);

    // media stream
    fillStyle = '#EE8800';
    strokeStyle = '#FFCC00';
    lineWidth = 6;
    fillRect(100,100,300,170);
    strokeRect(100,100,300,170);
    fillStyle = 'black';
    font = '900 12px "Press Start 2P", sans-serif';
    textAlign = 'left';
    fillText(!vid ? 'MediaStream' : 'LocalMediaStream', 110, 123);

    // tracks
    textAlign = 'left';
    strokeStyle = '#CC3300';
    fillStyle = '#FFFF00';
    lineWidth = 4;
    globalAlpha = vid ? 1 : 0.4;
    fillRect(120,140,100,110);
    strokeRect(120,140,100,110);
    globalAlpha = 1;
    fillRect(238,140,100,110);
    strokeRect(238,140,100,110);
    fillStyle = 'black';
    font = '900 10px "Press Start 2P", sans-serif';
    globalAlpha = vid ? 1 : 0.4;
    fillText('Track', 123, 155);
    fillText('(video)', 123, 170);
    globalAlpha = 1;
    fillText('Track', 241, 155);
    fillText('(stereo', 241, 170);
    fillText(' audio)', 241, 185);

    // channels
    strokeStyle = '#999999';
    fillStyle = '#FFFFFF';
    lineWidth = 2;
    fillRect(245,191,86,23);
    strokeRect(245,191,86,23);
    fillRect(245,220,86,23);
    strokeRect(245,220,86,23);
    fillStyle = 'black';
    font = '100 8px "Press Start 2P", sans-serif';
    textAlign = 'left';
    textBaseline = 'alphabetic';
    fillText('left', 249, 202);
    fillText('channel', 249, 211);
    fillText('right', 249, 231);
    fillText('channel', 249, 240);

    // track check marks
    fillStyle = 'black';
    font = '900 35px "Lucida Grande", sans-serif';
    textAlign = 'center';
    textBaseline = 'middle';
    fillText(vid ? '\u2713' : '\u2716', 220, 245);
    fillText('\u2713', 338, 245);

    restore();
  }
}
 -->


  <p>The <code><a href="#idl-def-LocalMediaStream" class="idlType"><code>LocalMediaStream</code></a></code> interface is used
  when the user agent is generating the stream’s data (e.g. from a camera or streaming it
  from a local video file).</p>

  <p>When a <code><a href="#idl-def-LocalMediaStream" class="idlType"><code>LocalMediaStream</code></a></code> object is being
  generated from a local file (as opposed to a live audio/video source), the user agent
  <em class="rfc2119" title="should">should</em> stream the data from the file in real time, not all at once. This reduces the
  ease with which pages can distinguish live video from pre-recorded video, which can
  help protect the user’s privacy.</p>

  </div>
  <div id="interface-definitions" class="section">
  <h3><span class="secno">3.2 </span>Interface definitions</h3>

  <div id="mediastream" class="section">
  <h4><span class="secno">3.2.1 </span>MediaStream</h4>

  <p>The <dfn id="dom-mediastream"><code>MediaStream()</code></dfn>
  constructor takes two arguments. The arguments are two lists with <code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a>
  </code> objects which will be used to construct the audio and video track lists of the new
  <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> object. When the constructor is invoked, the UA must run the
  following steps:</p>

  <ol>
    <li>
        <p>Let <var>audioTracks</var> be the constructor’s first argument.</p>
    </li>
    <li>
        <p>Let <var>videoTracks</var> be the constructor’s second argument.</p>
    </li>
    <li>
        <p>Let <var>stream</var> be a newly constructed <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> object.</p>
    </li>
    <li>
        <p>Set <var>stream’s</var> label attribute to a newly generated value.</p>
    </li>
    <li>
      <p>If <var>audioTracks</var> is not null, then run the following sub steps for each element
      <var>track</var> in <var>audioTracks</var>:</p>

      <ol>
        <li>
          <p>If <var>track</var> is of any other kind than &quot;<code>audio</code>&quot;, then throw
          a <code>SyntaxError</code> exception.</p>
        </li>
        <li>
          <p>If <var>track</var> has the same underlying source as another element in
          <var>stream’s</var> audio track list, then abort these steps.</p>
        </li>
        <li>
          <p>Add <var>track</var> to <var>stream’s</var> audio track list.</p>
        </li>
      </ol>
    </li>
    <li>
      <p>If <var>videoTracks</var> is not null, then run the following sub steps for each element
      <var>track</var> in <var>videoTracks</var>:</p>

      <ol>
        <li>
          <p>If <var>track</var> is of any other kind than &quot;<code>video</code>&quot;, then throw
          a <code>SyntaxError</code> exception.</p>
        </li>
        <li>
          <p>If <var>track</var> has the same underlying source as another element in
          <var>stream’s</var> video track list, then abort these steps.</p>
        </li>
        <li>
          <p>Add <var>track</var> to <var>stream’s</var> video track list.</p>
        </li>
      </ol>
    </li>
  </ol>

  <p>A <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> can have multiple audio
  and video sources (e.g. because the user has multiple microphones, or because the
  real source of the stream is a media resource with
  many media tracks). The stream represented by a <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code>
  thus has zero or more tracks.</p>

  <p>The tracks of a <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> are stored in two track lists represented
  by <code><a href="#idl-def-MediaStreamTrackList" class="idlType"><code>MediaStreamTrackList</code></a></code> objects; one for audio tracks and one
  for video tracks. The two track lists <em class="rfc2119" title="must">must</em> contain the <code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code> objects
  that correspond to the tracks of the stream. The relative order of all tracks in a user agent
  <em class="rfc2119" title="must">must</em> be stable. Tracks that come from a media resource whose format
  defines an order <em class="rfc2119" title="must">must</em> be in the order defined by the format; tracks that come from a media resource whose format does not define an order <em class="rfc2119" title="must">must</em> be
  in the relative order in which the tracks are declared in that 
  media resource. Within these constraints, the order is
  user-agent defined.</p>

  <p>An object that reads data from the output of a <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> is referred
  to as a <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> <dfn id="dfn-consumer">consumer</dfn>. The list of <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code>
  consumers currently include the media elements, <code><a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a></code> and
  <code><a href="#idl-def-MediaStreamRecorder" class="idlType"><code>MediaStreamRecorder</code></a></code>.</p>

  <p class="note"><code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> consumers be able to handle tracks being
  added and removed. This behavior is specifier per consumer.</p>

  <p>A new media component may be associated with an existing <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code>.
  This happens, e.g., on the A-side when the B-side adds a new <code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code>
  object to one of the track lists of a <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> that is being sent over a
  <code><a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a></code>. If this happens for the reason exemplified, or for any other
  reason than the <code>
  <a href="#dom-mediastreamtracklist-add">add()</a></code> method being invoked locally on a
  <code><a href="#idl-def-MediaStreamTrackList" class="idlType"><code>MediaStreamTrackList</code></a></code> or tracks are being added as the stream is created
  (i.e. the stream is initialized with tracks), the user agent <em class="rfc2119" title="must">must</em> run the following steps:</p>

  <ol>
    <li>
      <p>Create a <code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code> object <var>track</var> to represent
      the new media component.</p>
    </li>

    <li>
      <p>If <var>track’s</var> <code>
      <a href="#dom-mediastreamtrack-kind">kind</a></code> attribute equals &quot;<code>audio</code>&quot;,
      add it to the <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> object’s
      <code>
      <a href="#dom-mediastream-audiotracks">audioTracks</a></code>
      <code><a href="#idl-def-MediaStreamTrackList" class="idlType"><code>MediaStreamTrackList</code></a></code> object.</p>
    </li>

    <li>
      <p>If <var>track’s</var> <code>
      <a href="#dom-mediastreamtrack-kind">kind</a></code> attribute equals &quot;<code>video</code>&quot;,
      add it to the <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> object’s
      <code>
      <a href="#dom-mediastream-videotracks">videoTracks</a></code>
      <code><a href="#idl-def-MediaStreamTrackList" class="idlType"><code>MediaStreamTrackList</code></a></code> object.</p>
    </li>

    <li>
      <p><a href="#dfn-fire-a-track-event" class="internalDFN">Fire a track event</a> named
      <code>
      <a href="#event-mediastreamtracklist-addtrack">addtrack</a></code> with the newly created
      <var>track</var> at the <code><a href="#idl-def-MediaStreamTrackList" class="idlType"><code>MediaStreamTrackList</code></a></code> object.</p>
    </li>
  </ol>

  <p>An existing media component may also be disassociated from a <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code>.
  If this happens for any other reason than the <code>
  <a href="#dom-mediastreamtracklist-remove">remove()</a></code> method being invoked locally on a
  <code><a href="#idl-def-MediaStreamTrackList" class="idlType"><code>MediaStreamTrackList</code></a></code> or the stream is being destroyed, the user agent <em class="rfc2119" title="must">must</em>
  run the following steps:</p>

  <ol>
    <li>
      <p>Let <var>track</var> be the <code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code> object representing
      the media component about to be removed.</p>
    </li>

    <li>
      <p>Remove <var>track</var> from the <code><a href="#idl-def-MediaStreamTrackList" class="idlType"><code>MediaStreamTrackList</code></a></code> object.</p>
    </li>

    <li>
      <p><a href="#dfn-fire-a-track-event" class="internalDFN">Fire a track event</a> named
      <code>
      <a href="#event-mediastreamtracklist-removetrack">removetrack</a></code> with
      <var>track</var> at the <code><a href="#idl-def-MediaStreamTrackList" class="idlType"><code>MediaStreamTrackList</code></a></code> object.</p>
    </li>
  </ol>

  <p>A <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> object is said to be <dfn id="dfn-finished">finished</dfn> when all tracks belonging to the stream
  have <a href="#event-mediastreamtrack-ended" class="internalDFN">ended</a>. When this
  happens for any reason other than the <code>
  <a href="#dom-mediastream-stop">stop()</a></code> method being invoked, the user agent
  <em class="rfc2119" title="must">must</em> queue a task that runs the following steps:</p>

  <ol>
    <li>
      <p>If the object’s <code><a href="#dom-mediastream-ended">ended</a></code> attribute
      has the value true already, then abort these steps. (The <code>
      <a href="#dom-mediastream-stop">stop()</a></code> method was probably called just
      before the stream stopped for other reasons, e.g. the user clicked an in-page stop
      button and then the user-agent-provided stop button.)</p>
    </li>

    <li>
      <p>Set the object’s <code><a href="#dom-mediastream-ended">ended</a></code> attribute
      to true.</p>
    </li>

    <li>
      <p>Fire a simple event named <code title="event-MediaStream-ended"><a href="#event-mediastream-ended">ended</a></code> at
      the object.</p>
    </li>
  </ol>

  <p>If the end of the stream was reached due to a user request, the task
  source for this <span title="concept-task">task</span> is the user
  interaction task source. Otherwise the task source for this
  <span title="concept-task">task</span> is the networking task source.</p>

  <pre class="idl"><span id="idl-def-MediaStream" class="idlInterface">[<span class="extAttr">Constructor (MediaStreamTrackList? audioTracks, MediaStreamTrackList? videoTracks)</span>]
interface <span class="idlInterfaceID">MediaStream</span> {
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a>DOMString</a></span>            <span class="idlAttrName"><a href="#widl-MediaStream-label">label</a></span>;</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a href="#idl-def-MediaStreamTrackList" class="idlType"><code>MediaStreamTrackList</code></a></span> <span class="idlAttrName"><a href="#widl-MediaStream-audioTracks">audioTracks</a></span>;</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a href="#idl-def-MediaStreamTrackList" class="idlType"><code>MediaStreamTrackList</code></a></span> <span class="idlAttrName"><a href="#widl-MediaStream-videoTracks">videoTracks</a></span>;</span>
<span class="idlMethod">    <span class="idlMethType"><a href="#idl-def-MediaStreamRecorder" class="idlType"><code>MediaStreamRecorder</code></a></span> <span class="idlMethName"><a href="#widl-MediaStream-record-MediaStreamRecorder">record</a></span> ();</span>
<span class="idlAttribute">             attribute <span class="idlAttrType"><a>boolean</a></span>              <span class="idlAttrName"><a href="#widl-MediaStream-ended">ended</a></span>;</span>
<span class="idlAttribute">             attribute <span class="idlAttrType"><a>Function</a>?</span>            <span class="idlAttrName"><a href="#widl-MediaStream-onended">onended</a></span>;</span>
};</span>
</pre><div id="attributes" class="section"><h5><span class="secno">3.2.1.1 </span>Attributes</h5><dl class="attributes"><dt id="widl-MediaStream-audioTracks"><code>audioTracks</code> of type <span class="idlAttrType"><a href="#idl-def-MediaStreamTrackList" class="idlType"><code>MediaStreamTrackList</code></a></span>, readonly</dt><dd>
      <p>Returns a <code><a href="#idl-def-MediaStreamTrackList" class="idlType"><code>MediaStreamTrackList</code></a></code>
      object representing the audio tracks that can be enabled and disabled.</p>

      <p>The <dfn id="dom-mediastream-audiotracks"><code>audioTracks</code></dfn> attribute <em class="rfc2119" title="must">must</em> return an
      <span title="array host objects">array host object</span> for objects of type
      <code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code> that is <em>fixed
      length</em> and <em>read only</em>. The same object <em class="rfc2119" title="must">must</em> be returned each time the
      attribute is accessed.</p>
    </dd><dt id="widl-MediaStream-ended"><code>ended</code> of type <span class="idlAttrType"><a>boolean</a></span></dt><dd>
      <p>The <dfn id="dom-mediastream-ended">
      <code>MediaStream.ended</code></dfn> attribute <em class="rfc2119" title="must">must</em> return true if the <code>
      <a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> has <a href="#dfn-finished" class="internalDFN">finished</a>, and false otherwise.</p>

      <p>When a <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> object is created, its <code>
      <a href="#dom-mediastream-ended">ended</a></code> attribute <em class="rfc2119" title="must">must</em> be set to false,
      unless it is being created using the <code><a href="#dom-mediastream">MediaStream()</a>
      </code> constructor whose arguments are lists of <code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code>
      objects that are all <a href="#event-mediastreamtrack-ended" class="internalDFN">ended</a>,
      in which case the <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> object <em class="rfc2119" title="must">must</em> be created with its
      <code><a href="#dom-mediastream-ended">ended</a></code> attribute set to true.</p>
    </dd><dt id="widl-MediaStream-label"><code>label</code> of type <span class="idlAttrType"><a>DOMString</a></span>, readonly</dt><dd>
      <p>Returns a label that is unique to this stream, so that streams can be recognized
      after they are sent through the <code><a href="#peerconnection">PeerConnection</a></code> API.</p>

      <p>When a <code><a href="#localmediastream">LocalMediaStream</a></code> object is
      created, the user agent <em class="rfc2119" title="must">must</em> generate a globally unique identifier string, and <em class="rfc2119" title="must">must</em>
      initialize the object’s <code><a href="#dom-mediastream-label">label</a></code> attribute to that string. Such strings
      <em class="rfc2119" title="must">must</em> only use characters in the ranges U+0021, U+0023 to U+0027, U+002A to U+002B,
      U+002D to U+002E, U+0030 to U+0039, U+0041 to U+005A, U+005E to U+007E, and <em class="rfc2119" title="must">must</em> be
      36 characters long.</p>
<!--  UUIDs have 36 characters
      including hyphens; the ranges above comes from RFC4574 (the a=label:
      thing in SDP)  -->


      <p>When a <code><a href="#mediastream">MediaStream</a></code> is created to
      represent a stream obtained from a remote peer, the <code title="dom-MediaStream-label"><a href="#dom-mediastream-label">label</a></code> attribute
      is initialized from information provided by the remote source.</p>
      
<!--  described below  -->


      <p>When a <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> is created from
      another using the <code><a href="#dom-mediastream">MediaStream()</a></code> constructor, the <code title="dom-MediaStream-label"><a href="#dom-mediastream-label">label</a></code> attribute
      is initialized to a newly generated value.</p>
<!--  described above  -->


      <p>The <dfn id="dom-mediastream-label"><code>label</code></dfn> attribute <em class="rfc2119" title="must">must</em> return the value to
      which it was initialized when the object was created.</p>

      <p class="note">The label of a <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code>
      object is unique to the source of the stream, but that does not mean it is not
      possible to end up with duplicates. For example, a locally
      generated stream could be sent from one user to a remote peer using <code><a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a></code>, and then sent back to the original
      user in the same manner, in which case the original user will have multiple streams
      with the same label (the locally-generated one and the one received from the remote
      peer).</p>
    </dd><dt id="widl-MediaStream-onended"><code>onended</code> of type <span class="idlAttrType"><a>Function</a></span>, nullable</dt><dd>This event handler, of type <code><a href="#event-mediastream-ended">ended</a></code>, <em class="rfc2119" title="must">must</em> be supported by all objects
    implementing the <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> interface.</dd><dt id="widl-MediaStream-videoTracks"><code>videoTracks</code> of type <span class="idlAttrType"><a href="#idl-def-MediaStreamTrackList" class="idlType"><code>MediaStreamTrackList</code></a></span>, readonly</dt><dd>
      <p>Returns a <code><a href="#idl-def-MediaStreamTrackList" class="idlType"><code>MediaStreamTrackList</code></a></code>
      object representing the video tracks that can be enabled and disabled.</p>

      <p>The <dfn id="dom-mediastream-videotracks"><code>videoTracks</code></dfn> attribute <em class="rfc2119" title="must">must</em> return an
      <span title="array host objects">array host object</span> for objects of type
      <code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code> that is <em>fixed
      length</em> and <em>read only</em>. The same object <em class="rfc2119" title="must">must</em> be returned each time the
      attribute is accessed. </p>
    </dd></dl></div><div id="methods" class="section"><h5><span class="secno">3.2.1.2 </span>Methods</h5><dl class="methods"><dt id="widl-MediaStream-record-MediaStreamRecorder"><code>record</code></dt><dd>
      <p>Begins recording the stream. The returned <code><a href="#idl-def-MediaStreamRecorder" class="idlType"><code>MediaStreamRecorder</code></a></code> object provides access to the
      recorded data.</p>

      <p>When the <dfn id="dom-mediastream-record"><code>record()</code></dfn> method is invoked, the user
      agent <em class="rfc2119" title="must">must</em> return a new <code><a href="#idl-def-MediaStreamRecorder" class="idlType"><code>MediaStreamRecorder</code></a></code> object associated with the
      stream.</p>
    <div><em>No parameters.</em></div><div><em>Return type: </em><code><a href="#idl-def-MediaStreamRecorder" class="idlType"><code>MediaStreamRecorder</code></a></code></div></dd></dl></div>

  <pre class="idl"><span class="idlImplements"><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a> implements <a>EventTarget</a>;</span></pre><div class="idlImplementsDesc"><p>All instances of the <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> type are defined to also implement the <a>EventTarget</a> interface.</p></div>
  </div>

  <div id="localmediastream" class="section">
 <h4><span class="secno">3.2.2 </span>LocalMediaStream</h4>

 <p>Before the web application can access the users media input devices it must let
 <code>getUserMedia()</code> [<cite><a class="bibref" rel="biblioentry" href="#bib-GETUSERMEDIA">GETUSERMEDIA</a></cite>]
 create a <code><a href="#idl-def-LocalMediaStream" class="idlType"><code>LocalMediaStream</code></a></code>. Once the application is done using, e.g.,
 a webcam and a microphone, it may revoke its own access by calling <code>
 <a href="#dom-mediastream-stop">stop()</a></code> on the <code><a href="#idl-def-LocalMediaStream" class="idlType"><code>LocalMediaStream</code></a>
 </code>. 
<!-- If the web application no longer has access to any media input devices, any
 "on air" indicators in the browser UI MUST be turned off. -->
</p>

 <p>A web application may, once it has access to a <code><a href="#idl-def-LocalMediaStream" class="idlType"><code>LocalMediaStream</code></a></code>,
 use the <code><a href="#dom-mediastream">MediaStream()</a></code> constructor to construct
 additional <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> objects. Since a derived <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a>
 </code> object is created from the tracks of an existing stream, it cannot use any media
 input devices that have not been approved by the user.</p>

 <pre class="idl"><span id="idl-def-LocalMediaStream" class="idlInterface">interface <span class="idlInterfaceID">LocalMediaStream</span> : <span class="idlSuperclass"><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></span> {
<span class="idlMethod">    <span class="idlMethType"><a>void</a></span> <span class="idlMethName"><a href="#widl-LocalMediaStream-stop-void">stop</a></span> ();</span>
};</span>
</pre><div id="methods-1" class="section"><h5><span class="secno">3.2.2.1 </span>Methods</h5><dl class="methods"><dt id="widl-LocalMediaStream-stop-void"><code>stop</code></dt><dd>
     <p>When a <code><a href="#idl-def-LocalMediaStream" class="idlType"><code>LocalMediaStream</code></a></code> object’s
     <dfn id="dom-mediastream-stop"><code>stop()</code></dfn> method is invoked, the user agent
     <em class="rfc2119" title="must">must</em> queue a task that runs the following steps on every track:</p>

     <ol>
       <li>
         <p>Let <var>track</var> be the current <code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code>
         object.</p>
       </li>
       <li>
         <p><a title="ended" href="#event-mediastreamtrack-ended" class="internalDFN">End</a>
         <var>track</var>. The track start outputting only silence and/or blackness,
         as appropriate.</p>
       </li>
       <li>
         <p>Dereference <var>track’s</var> underlying media source.</p>
       </li>
       <li>
         <p>If the reference count of <var>track’s</var> underlying media source is
         greater than zero, then abort these steps.</p>
       </li>
       <li>
         <p>Permanently stop the generation of data for <var>track’s</var> source. If the
         data is being generated from a live source (e.g. a microphone or camera), then the
         user agent <em class="rfc2119" title="should">should</em> remove any active &quot;on-air&quot; indicator for that source. If the
         data is being generated from a prerecorded source (e.g. a video file), any
         remaining content in the file is ignored.</p>
       </li>
     </ol>

     <p>The task source for the <span title="concept-task">tasks</span>
     queued for the <code><a href="#dom-mediastream-stop">stop()</a></code> method is the DOM manipulation task
     source.</p>
   <div><em>No parameters.</em></div><div><em>Return type: </em><code><a>void</a></code></div></dd></dl></div>
 </div>


 <div id="mediastreamtrack" class="section">
  <h4><span class="secno">3.2.3 </span>MediaStreamTrack</h4>

  <p>A <code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code> object represents a media source in the user
  agent. Several <code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code> objects can represent the same media
  source, e.g., when the user chooses the same camera in the UI shown by two consecutive calls
  to <code>getUserMedia()</code> [<cite><a class="bibref" rel="biblioentry" href="#bib-GETUSERMEDIA">GETUSERMEDIA</a></cite>].</p>

  <p>A <code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code> object can reference its media source in two
  ways, either with a strong or a weak reference, depending on how the track was created.
  For example, a track in a <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code>, derived from a
  <code><a href="#idl-def-LocalMediaStream" class="idlType"><code>LocalMediaStream</code></a></code> with the <code><a href="#dom-mediastream">MediaStream()</a></code> constructor, has a weak reference to
  a local media source, while a track in a <code><a href="#idl-def-LocalMediaStream" class="idlType"><code>LocalMediaStream</code></a></code> has a
  strong reference. This means that a track in a <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code>, derived
  from a <code><a href="#idl-def-LocalMediaStream" class="idlType"><code>LocalMediaStream</code></a></code>, will end if there is no non-<a href="#event-mediastreamtrack-ended" class="internalDFN">ended</a> track in a
  <code><a href="#idl-def-LocalMediaStream" class="idlType"><code>LocalMediaStream</code></a></code> which references the same local media source.
  A reference to a non-local media source as, e.g., an RTP source, is always strong.</p>

  <p class="note">The concept with strong and weak references to media sources allows the
  web application to derive new <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> objects from
  <code><a href="#idl-def-LocalMediaStream" class="idlType"><code>LocalMediaStream</code></a></code> objects (created via <code>getUserMedia()</code> [<cite><a class="bibref" rel="biblioentry" href="#bib-GETUSERMEDIA">GETUSERMEDIA</a></cite>]),
  and still be able to revoke all given permissions with <code><a href="#dom-mediastream-stop">LocalMediaStream.stop()</a></code>.</p>

  <p>A <code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code> object is said to <em>end</em>
  when the user agent learns that no more data will ever be forthcoming for this
  track.</p>

  <p>When a <code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code> object ends for any reason (e.g.
  because the user rescinds the permission for the page to use the local camera,
  or because the data comes from a finite file and the file’s end has been reached
  and the user has not requested that it be looped, or because the track belongs
  to a <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> that comes from a remote peer and the remote
  peer has permanently stopped sending data, or because the UA has instructed the
  track to end for any reason, or because the reference count of the track’s underlying
  media source has reached zero, it is said to be
  <dfn id="dfn-ended">ended</dfn>.
  When track instance <var>track</var> ends for any reason other than <code>
  <a href="#dom-mediastream-stop">stop()</a></code> method being invoked on the
  <code><a href="#idl-def-LocalMediaStream" class="idlType"><code>LocalMediaStream</code></a></code> object that represents <var>track</var>,
  the user agent <em class="rfc2119" title="must">must</em> queue a task that runs the following steps:</p>

  <ol>
    <li>
      <p>If the track’s <code><a href="#dom-mediastreamtrack-readystate">readyState</a>
      </code> attribute has the value <code><a href="#widl-MediaStreamTrack-ENDED">ENDED</a>
      </code> (2) already, then abort these steps.</p>
    </li>
    <li>
      <p>Set <var>track’s</var> <code><a href="#dom-mediastreamtrack-readystate">readyState</a>
      </code> attribute to <code><a href="#widl-MediaStreamTrack-ENDED">ENDED</a></code> (2).</p>
    </li>
    <li>
      <p>Fire a simple event named <code><a href="#event-mediastreamtrack-ended">ended</a>
      </code> at the object.</p>
    </li>
  </ol>



  <pre class="idl"><span id="idl-def-MediaStreamTrack" class="idlInterface">interface <span class="idlInterfaceID">MediaStreamTrack</span> {
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a>DOMString</a></span>      <span class="idlAttrName"><a href="#widl-MediaStreamTrack-kind">kind</a></span>;</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a>DOMString</a></span>      <span class="idlAttrName"><a href="#widl-MediaStreamTrack-label">label</a></span>;</span>
<span class="idlAttribute">             attribute <span class="idlAttrType"><a>boolean</a></span>        <span class="idlAttrName"><a href="#widl-MediaStreamTrack-enabled">enabled</a></span>;</span>
<span class="idlConst">    const <span class="idlConstType"><a>unsigned short</a></span> <span class="idlConstName"><a href="#widl-MediaStreamTrack-LIVE">LIVE</a></span> = <span class="idlConstValue">0</span>;</span>
<span class="idlConst">    const <span class="idlConstType"><a>unsigned short</a></span> <span class="idlConstName"><a href="#widl-MediaStreamTrack-MUTED">MUTED</a></span> = <span class="idlConstValue">1</span>;</span>
<span class="idlConst">    const <span class="idlConstType"><a>unsigned short</a></span> <span class="idlConstName"><a href="#widl-MediaStreamTrack-ENDED">ENDED</a></span> = <span class="idlConstValue">2</span>;</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a>unsigned short</a></span> <span class="idlAttrName"><a href="#widl-MediaStreamTrack-readyState">readyState</a></span>;</span>
<span class="idlAttribute">             attribute <span class="idlAttrType"><a>Function</a>?</span>      <span class="idlAttrName"><a href="#widl-MediaStreamTrack-onmute">onmute</a></span>;</span>
<span class="idlAttribute">             attribute <span class="idlAttrType"><a>Function</a>?</span>      <span class="idlAttrName"><a href="#widl-MediaStreamTrack-onunmute">onunmute</a></span>;</span>
<span class="idlAttribute">             attribute <span class="idlAttrType"><a>Function</a>?</span>      <span class="idlAttrName"><a href="#widl-MediaStreamTrack-onended">onended</a></span>;</span>
};</span>
</pre><div id="attributes-1" class="section"><h5><span class="secno">3.2.3.1 </span>Attributes</h5><dl class="attributes"><dt id="widl-MediaStreamTrack-enabled"><code>enabled</code> of type <span class="idlAttrType"><a>boolean</a></span></dt><dd>
      <p>The <dfn id="dom-mediastreamtrack-enabled"><code>MediaStreamTrack.enabled</code></dfn>
      attribute, on getting, <em class="rfc2119" title="must">must</em> return the last value to which it was set. On setting,
      it <em class="rfc2119" title="must">must</em> be set to the new value, and then, if the <code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code> object is still associated with a
      track, <em class="rfc2119" title="must">must</em> enable the track if the new value is true, and disable it
      otherwise.</p>

      <p class="note">Thus, after a <code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code> is disassociated from its track,
      its <code><a href="#dom-mediastreamtrack-enabled">enabled</a></code> attribute still changes value
      when set, it just doesn’t do anything with that new value.</p>
    </dd><dt id="widl-MediaStreamTrack-kind"><code>kind</code> of type <span class="idlAttrType"><a>DOMString</a></span>, readonly</dt><dd>
      <p>The <dfn id="dom-mediastreamtrack-kind"><code>MediaStreamTrack.kind</code></dfn> attribute <em class="rfc2119" title="must">must</em>
      return the string &quot;<code>audio</code>&quot; if the object’s corresponding
      track is or was an audio track, &quot;<code>video</code>&quot; if the
      corresponding track is or was a video track, and a user-agent defined string
      otherwise.</p>
    </dd><dt id="widl-MediaStreamTrack-label"><code>label</code> of type <span class="idlAttrType"><a>DOMString</a></span>, readonly</dt><dd>
      <p>User agents <em class="rfc2119" title="may">may</em> label audio and video sources (e.g. &quot;Internal microphone&quot; or
      &quot;External USB Webcam&quot;). The <dfn id="dom-mediastreamtrack-label"><code>MediaStreamTrack.label</code></dfn> attribute
      <em class="rfc2119" title="must">must</em> return the label of the object’s corresponding track, if any. If the
      corresponding track has or had no label, the attribute <em class="rfc2119" title="must">must</em> instead return the
      empty string.</p>

      <p class="note">Thus the <code><a href="#dom-mediastreamtrack-kind">kind</a></code> and <code title="dom-MediaStreamTrack-label"><a href="#dom-mediastreamtrack-label">label</a></code>
      attributes do not change value, even if the <code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code> object is disassociated from its
      corresponding track.</p>
    </dd><dt id="widl-MediaStreamTrack-onended"><code>onended</code> of type <span class="idlAttrType"><a>Function</a></span>, nullable</dt><dd>This event handler, of type <code><a href="#event-mediastreamtrack-ended">ended</a></code>, <em class="rfc2119" title="must">must</em> be supported by all objects
    implementing the <code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code> interface.</dd><dt id="widl-MediaStreamTrack-onmute"><code>onmute</code> of type <span class="idlAttrType"><a>Function</a></span>, nullable</dt><dd>This event handler, of type <code><a href="#event-mediastreamtrack-muted">muted</a></code>, <em class="rfc2119" title="must">must</em> be supported by all objects
    implementing the <code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code> interface.</dd><dt id="widl-MediaStreamTrack-onunmute"><code>onunmute</code> of type <span class="idlAttrType"><a>Function</a></span>, nullable</dt><dd>This event handler, of type <code><a href="#event-mediastreamtrack-unmuted">unmuted</a></code>, <em class="rfc2119" title="must">must</em> be supported by all objects
    implementing the <code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code> interface.</dd><dt id="widl-MediaStreamTrack-readyState"><code>readyState</code> of type <span class="idlAttrType"><a>unsigned short</a></span>, readonly</dt><dd>
      <p>The <dfn id="dom-mediastreamtrack-readystate"><code>readyState</code></dfn> attribute represents the
      state of the track. It <em class="rfc2119" title="must">must</em> return the value to which the user agent last set it
      (as defined below). It can have the following values: <dfn id="dfn-live">LIVE</dfn>, <dfn id="dfn-muted">MUTED</dfn> or
      <dfn id="dfn-ended-1">ENDED</dfn>.</p>

      <p>When a <code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code> object is created, its <code>
      <a href="#dom-mediastreamtrack-readystate">readyState</a></code> is either
      <code><a href="#widl-MediaStreamTrack-LIVE">LIVE</a></code> (0) or <code>
      <a href="#widl-MediaStreamTrack-MUTED">MUTED</a></code> (1), depending on the state
      of the track’s underlying media source. For example, a track in a <code>
      <a href="#idl-def-LocalMediaStream" class="idlType"><code>LocalMediaStream</code></a></code>, created with
      <code>getUserMedia()</code> [<cite><a class="bibref" rel="biblioentry" href="#bib-GETUSERMEDIA">GETUSERMEDIA</a></cite>]
      , <em class="rfc2119" title="must">must</em> initially have its <code><a href="#dom-mediastreamtrack-readystate">readyState</a>
      </code>attribute set to <code><a href="#widl-MediaStreamTrack-LIVE">LIVE</a></code>
      (1), while a track in a <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code>, received with a <code>
      <a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a></code>, <em class="rfc2119" title="must">must</em> have its <code>
      <a href="#dom-mediastreamtrack-readystate">readyState</a></code> attribute set to
      <code><a href="#widl-MediaStreamTrack-MUTED">MUTED</a></code> (1) until media
      data arrives.</p>
    </dd></dl></div><div id="constants" class="section"><h5><span class="secno">3.2.3.2 </span>Constants</h5><dl class="constants"><dt id="widl-MediaStreamTrack-ENDED"><code>ENDED</code> of type <span class="idlConstType"><a>unsigned short</a></span></dt><dd>
      <p>The track has <a href="#event-mediastreamtrack-ended" class="internalDFN">ended</a>
      (the track’s underlying media source is no longer providing data, and will never
      provide more data for this track).</p>

      <p>For example, a video track in a <code><a href="#idl-def-LocalMediaStream" class="idlType"><code>LocalMediaStream</code></a></code> finishes if
      the user unplugs the USB web camera that acts as the track’s media source.</p>
    </dd><dt id="widl-MediaStreamTrack-LIVE"><code>LIVE</code> of type <span class="idlConstType"><a>unsigned short</a></span></dt><dd>
      <p>The track is active (the track’s underlying media source is making a best-effort
      attempt to provide data in real time).</p>

      <p>The output of a track in the <code><a href="#widl-MediaStreamTrack-LIVE">LIVE</a>
      </code> state can be switched on and off with the <code>
      <a href="#dom-mediastreamtrack-enabled">enabled</a></code> attribute.</p>
    </dd><dt id="widl-MediaStreamTrack-MUTED"><code>MUTED</code> of type <span class="idlConstType"><a>unsigned short</a></span></dt><dd>
      <p>The track is muted (the track’s underlying media source is temporarily unable
      to provide data).</p>

      <p>For example, a track is muted on the B-side if the A-side disables the corresponding
      <code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code> in the <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> that is
      being sent. A <code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code> in a <code><a href="#idl-def-LocalMediaStream" class="idlType"><code>LocalMediaStream</code></a>
      </code> may be muted if the user temporarily revokes the web application’s permission
      to use a media input device.</p>

      <p>When the addstream event triggers on a <code><a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a></code>, all
      <code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code> objects in the resulting <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a>
      </code> are muted until media data can be read from the RTP source.</p>
    </dd></dl></div>
  </div>


    <div id="audiomediastreamtrack" class="section">
 <h4><span class="secno">3.2.4 </span>AudioMediaStreamTrack</h4>

 <p>The <code><a href="#idl-def-AudioMediaStreamTrack" class="idlType"><code>AudioMediaStreamTrack</code></a></code> is a specialization of of a
 normal <code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code> that only carries audio and is
 extended to have the capability to send and/or receive DTMF codes.</p>

 
 <pre class="idl"><span id="idl-def-AudioMediaStreamTrack" class="idlInterface">interface <span class="idlInterfaceID">AudioMediaStreamTrack</span> : <span class="idlSuperclass"><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></span> {
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a>boolean</a></span> <span class="idlAttrName"><a href="#widl-AudioMediaStreamTrack-canInsertDTMF">canInsertDTMF</a></span>;</span>
<span class="idlMethod">    <span class="idlMethType"><a>void</a></span> <span class="idlMethName"><a href="#widl-AudioMediaStreamTrack-insertDTMF-void-DOMString-tones-long-duration">insertDTMF</a></span> (<span class="idlParam"><span class="idlParamType"><a>DOMString</a></span> <span class="idlParamName">tones</span></span>, <span class="idlParam">optional <span class="idlParamType"><a>long</a></span> <span class="idlParamName">duration</span></span>);</span>
};</span>
</pre><div id="attributes-2" class="section"><h5><span class="secno">3.2.4.1 </span>Attributes</h5><dl class="attributes"><dt id="widl-AudioMediaStreamTrack-canInsertDTMF"><code>canInsertDTMF</code> of type <span class="idlAttrType"><a>boolean</a></span>, readonly</dt><dd>
     <p>The <dfn id="dom-audiomediastreamtrack-caninsertdtmf"><code>canInsertDTMF</code></dfn> attribute <em class="rfc2119" title="must">must</em>
      indicate if the <code><a href="#idl-def-AudioMediaStreamTrack" class="idlType"><code>AudioMediaStreamTrack</code></a></code> is capable of
      sending DTMF. </p>
    </dd></dl></div><div id="methods-2" class="section"><h5><span class="secno">3.2.4.2 </span>Methods</h5><dl class="methods"><dt id="widl-AudioMediaStreamTrack-insertDTMF-void-DOMString-tones-long-duration"><code>insertDTMF</code></dt><dd>

     <p> When a <code><a href="#idl-def-AudioMediaStreamTrack" class="idlType"><code>AudioMediaStreamTrack</code></a></code> object’s <dfn id="dom-AudioMediaStreamTrack-insertDTMF"><code>insertDTMF()</code></dfn>
     method is invoked, the user agent <em class="rfc2119" title="must">must</em> queue a task that that sends the
     DTMF tones. </p>

     <p> The tone parameters is treated as a series of characters. The
     characters 0 to 9, A to D, #, and * generated the associated DTMF
     tones. The characters a to d are equivalent to A to D. The character ,
     indicates a an delay of 2 seconds before processing the next
     character in the tones parameter. Unrecognized characters are ignored.  </p>

     <p> The duration parameters indicates the duration in ms to play the each DTMF
     passed in the tones parameters. The duration can not be more than 6000 or
     less than 70. The default duration is 100 ms for each
     tone.  The gap between tones <em class="rfc2119" title="must">must</em> be at least 50 ms but should be as short
     as possible.   </p>

     <p> If insertDTMF is called on the same object while an existing task for
     this object is generate DTMF is still running, the previous task is
     canceled. Calling insertDTMF with an empty tones parameter can be used to
     cancel any tones currently being send. </p>

     <p class="note"> Editor Note: We need to add a callback that is set on the
     object that is called after the tones are sent. This is needed to allow the
     application to know when it can send new tones without canceling the tones
     that are currently being sent.  </p>

     <p class="note"> Editor Note: It seems we would want a callback or event
     for incoming tones. The proposal sent to the list had them played as audio to the
     speaker but I don’t see how that is useful. </p>

   <table class="parameters"><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">tones</td><td class="prmType"><code><a>DOMString</a></code></td><td class="prmNullFalse">✘</td><td class="prmOptFalse">✘</td><td class="prmDesc"></td></tr><tr><td class="prmName">duration</td><td class="prmType"><code><a>long</a></code></td><td class="prmNullFalse">✘</td><td class="prmOptTrue">✔</td><td class="prmDesc"></td></tr></table><div><em>Return type: </em><code><a>void</a></code></div></dd></dl></div>
 </div>


 
  
  <div id="mediastreamtracklist" class="section">
  <h4><span class="secno">3.2.5 </span>MediaStreamTrackList</h4>

  <p>A <code><a href="#idl-def-MediaStreamTrackList" class="idlType"><code>MediaStreamTrackList</code></a></code> object’s <dfn id="concept-track-list-corresponding-stream">corresponding</dfn>
  <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> refers to the <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> object
  which the current <code><a href="#idl-def-MediaStreamTrackList" class="idlType"><code>MediaStreamTrackList</code></a></code> object is a property of.</p>

  <pre class="idl"><span id="idl-def-MediaStreamTrackList" class="idlInterface">interface <span class="idlInterfaceID">MediaStreamTrackList</span> {
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a>unsigned long</a></span> <span class="idlAttrName"><a href="#widl-MediaStreamTrackList-length">length</a></span>;</span>
<span class="idlMethod">    <span class="idlMethType"><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></span> <span class="idlMethName"><a href="#widl-MediaStreamTrackList-item-MediaStreamTrack-unsigned-long-index">item</a></span> (<span class="idlParam"><span class="idlParamType"><a>unsigned long</a></span> <span class="idlParamName">index</span></span>);</span>
<span class="idlMethod">    <span class="idlMethType"><a>void</a></span>             <span class="idlMethName"><a href="#widl-MediaStreamTrackList-add-void-MediaStreamTrack-track">add</a></span> (<span class="idlParam"><span class="idlParamType"><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></span> <span class="idlParamName">track</span></span>);</span>
<span class="idlMethod">    <span class="idlMethType"><a>void</a></span>             <span class="idlMethName"><a href="#widl-MediaStreamTrackList-remove-void-MediaStreamTrack-track">remove</a></span> (<span class="idlParam"><span class="idlParamType"><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></span> <span class="idlParamName">track</span></span>);</span>
<span class="idlAttribute">             attribute <span class="idlAttrType"><a>Function</a>?</span>     <span class="idlAttrName"><a href="#widl-MediaStreamTrackList-onaddtrack">onaddtrack</a></span>;</span>
<span class="idlAttribute">             attribute <span class="idlAttrType"><a>Function</a>?</span>     <span class="idlAttrName"><a href="#widl-MediaStreamTrackList-onremovetrack">onremovetrack</a></span>;</span>
};</span>
</pre><div id="attributes-3" class="section"><h5><span class="secno">3.2.5.1 </span>Attributes</h5><dl class="attributes"><dt id="widl-MediaStreamTrackList-length"><code>length</code> of type <span class="idlAttrType"><a>unsigned long</a></span>, readonly</dt><dd>Returns the number of tracks in the list.</dd><dt id="widl-MediaStreamTrackList-onaddtrack"><code>onaddtrack</code> of type <span class="idlAttrType"><a>Function</a></span>, nullable</dt><dd>This event handler, of type <code><a href="#event-mediastreamtracklist-addtrack">addtrack</a></code>, <em class="rfc2119" title="must">must</em> be supported by all objects
    implementing the <code><a href="#idl-def-MediaStreamTrackList" class="idlType"><code>MediaStreamTrackList</code></a></code> interface.</dd><dt id="widl-MediaStreamTrackList-onremovetrack"><code>onremovetrack</code> of type <span class="idlAttrType"><a>Function</a></span>, nullable</dt><dd>This event handler, of type <code><a href="#event-mediastreamtracklist-removetrack">removetrack</a></code>, <em class="rfc2119" title="must">must</em> be supported by all
    objects implementing the <code><a href="#idl-def-MediaStreamTrackList" class="idlType"><code>MediaStreamTrackList</code></a></code> interface.</dd></dl></div><div id="methods-3" class="section"><h5><span class="secno">3.2.5.2 </span>Methods</h5><dl class="methods"><dt id="widl-MediaStreamTrackList-add-void-MediaStreamTrack-track"><code>add</code></dt><dd>
      <p>Adds the given <code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code> to this
      <code><a href="#idl-def-MediaStreamTrackList" class="idlType"><code>MediaStreamTrackList</code></a></code> according to the ordering rules for tracks.</p>

      <p>When the <dfn id="dom-mediastreamtracklist-add"><code>add()</code></dfn> method is invoked, the
      user agent <em class="rfc2119" title="must">must</em> run the following steps:</p>

      <ol>
        <li>
          <p>Let <var>track</var> be the <code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code> argument.</p>
        </li>

        <li>
          <p>Let <var>stream</var> be the <code><a href="#idl-def-MediaStreamTrackList" class="idlType"><code>MediaStreamTrackList</code></a></code> object’s
          <a title="concept-track-list-corresponding-stream" href="#concept-track-list-corresponding-stream">corresponding</a>
          <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> object.</p>
        </li>

        <li>
          <p>If <var>stream</var> is <a href="#dfn-finished" class="internalDFN">finished</a>, throw an <code>INVALID_STATE_ERR</code>
          exception.</p>
        </li>

        <li>
          <p>If <var>track</var> is already in the <code><a href="#idl-def-MediaStreamTrackList" class="idlType"><code>MediaStreamTrackList</code></a></code>,
          object’s internal list, then abort these steps.</p>
        </li>

        <li>
          <p>Add <var>track</var> to the end of the <code><a href="#idl-def-MediaStreamTrackList" class="idlType"><code>MediaStreamTrackList</code></a></code>
          object’s internal list.</p>
        </li>
      </ol>
    <table class="parameters"><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">track</td><td class="prmType"><code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code></td><td class="prmNullFalse">✘</td><td class="prmOptFalse">✘</td><td class="prmDesc"></td></tr></table><div><em>Return type: </em><code><a>void</a></code></div></dd><dt id="widl-MediaStreamTrackList-item-MediaStreamTrack-unsigned-long-index"><code>item</code></dt><dd>Returns the <code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code> object at the specified index.<table class="parameters"><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">index</td><td class="prmType"><code><a>unsigned long</a></code></td><td class="prmNullFalse">✘</td><td class="prmOptFalse">✘</td><td class="prmDesc"></td></tr></table><div><em>Return type: </em><code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code></div></dd><dt id="widl-MediaStreamTrackList-remove-void-MediaStreamTrack-track"><code>remove</code></dt><dd>
      <p>Removes the given <code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code> from this
      <code><a href="#idl-def-MediaStreamTrackList" class="idlType"><code>MediaStreamTrackList</code></a></code>.</p>

      <p>When the <dfn id="dom-mediastreamtracklist-remove"><code>remove()</code></dfn> method is invoked, the
      user agent <em class="rfc2119" title="must">must</em> run the following steps:</p>

      <ol>
        <li>
          <p>Let <var>track</var> be the <code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code> argument.</p>
        </li>

        <li>
          <p>Let <var>stream</var> be the <code><a href="#idl-def-MediaStreamTrackList" class="idlType"><code>MediaStreamTrackList</code></a></code> object’s
          <a title="concept-track-list-corresponding-stream" href="#concept-track-list-corresponding-stream">corresponding</a>
          <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> object.</p>
        </li>

        <li>
          <p>If <var>stream</var> is <a href="#dfn-finished" class="internalDFN">finished</a>, throw an <code>INVALID_STATE_ERR</code>
          exception.</p>
        </li>

        <li>
          <p>If <var>track</var> is not in the <code><a href="#idl-def-MediaStreamTrackList" class="idlType"><code>MediaStreamTrackList</code></a></code>,
          object’s internal list, then abort these steps.</p>
        </li>

        <li>
          <p>Remove <var>track</var> from the <code><a href="#idl-def-MediaStreamTrackList" class="idlType"><code>MediaStreamTrackList</code></a></code>
          object’s internal list.</p>
        </li>
      </ol>
    <table class="parameters"><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">track</td><td class="prmType"><code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code></td><td class="prmNullFalse">✘</td><td class="prmOptFalse">✘</td><td class="prmDesc"></td></tr></table><div><em>Return type: </em><code><a>void</a></code></div></dd></dl></div>

  </div>

  <div id="mediastreamrecorder" class="section">
  <h4><span class="secno">3.2.6 </span>MediaStreamRecorder</h4>

  <p class="note">The <code><a href="#idl-def-MediaStreamRecorder" class="idlType"><code>MediaStreamRecorder</code></a></code> needs to be able to handle the case
  that arises when changes are made to the <code><a href="#idl-def-MediaStreamTrackList" class="idlType"><code>MediaStreamTrackList</code></a></code> objects of the
  <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> being recorded; e.g., a new track is added as a result of the
  <code>
  <a href="#dom-mediastreamtracklist-add">add()</a></code> method being invoked.</p>

  <pre class="idl"><span id="idl-def-MediaStreamRecorder" class="idlInterface">interface <span class="idlInterfaceID">MediaStreamRecorder</span> {
<span class="idlMethod">    <span class="idlMethType"><a>voice</a></span> <span class="idlMethName"><a href="#widl-MediaStreamRecorder-getRecordedData-voice-BlobCallback-callBack">getRecordedData</a></span> (<span class="idlParam"><span class="idlParamType"><a href="#idl-def-BlobCallback" class="idlType"><code>BlobCallback</code></a>?</span> <span class="idlParamName">callBack</span></span>);</span>
};</span>
</pre><div id="methods-4" class="section"><h5><span class="secno">3.2.6.1 </span>Methods</h5><dl class="methods"><dt id="widl-MediaStreamRecorder-getRecordedData-voice-BlobCallback-callBack"><code>getRecordedData</code></dt><dd>
      <p>Creates a <code>Blob</code> of the recorded data, and invokes the provided
      callback with that <code>Blob</code>.</p>

      <p>When the <dfn id="dom-mediastreamrecorder-getrecordeddata"><code>getRecordedData()</code></dfn>
      method is called, the user agent <em class="rfc2119" title="must">must</em> run the following steps:</p>

      <ol>
        <li>
          <p>Let <var>callBack</var> be the callback indicated by the method’s
          first argument.</p>
        </li>

        <li>
          <p>If <var>callBack</var> is null, abort these steps.</p>
        </li>
<!--  we could throw an exception instead (that's
   why the method doesn't return until later: so that we can add an
   exception here without changing the algorithm)  -->


        <li>
          <p>Let <var>data</var> be the data that was streamed by the
          <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> object from which the
          <code><a href="#idl-def-MediaStreamRecorder" class="idlType"><code>MediaStreamRecorder</code></a></code> was created
          since the creation of the <code><a href="#idl-def-MediaStreamRecorder" class="idlType"><code>MediaStreamRecorder</code></a></code> object.</p>
        </li>

        <li>
          <p>Return, and run the remaining steps asynchronously.</p>
        </li>

        <li>
          <p>Generate a file that containing <var>data</var> in a format
          supported by the user agent for use in <code>audio</code> and
          <code>video</code> elements.</p>
        </li>

        <li>
          <p>Let <var>blob</var> be a <code>Blob</code> object representing the
          contents of the file generated in the previous step. [<cite><a class="bibref" rel="biblioentry" href="#bib-FILE-API">FILE-API</a></cite>]</p>
        </li>

        <li>
          <p>Queue a task to invoke <var>callBack</var> with
          <var>blob</var> as its argument.</p>
        </li>
      </ol>

      <p class="note">The <code><a href="#dom-mediastreamrecorder-getrecordeddata">getRecordedData()</a></code> method can
      be called multiple times on one <code><a href="#idl-def-MediaStreamRecorder" class="idlType"><code>MediaStreamRecorder</code></a></code> object; each time, it will
      create a new file as if this was the first time the method was being called. In
      particular, the method does not stop or reset the recording when the method is
      called.</p>
    <table class="parameters"><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">callBack</td><td class="prmType"><code><a href="#idl-def-BlobCallback" class="idlType"><code>BlobCallback</code></a></code></td><td class="prmNullTrue">✔</td><td class="prmOptFalse">✘</td><td class="prmDesc"></td></tr></table><div><em>Return type: </em><code><a>voice</a></code></div></dd></dl></div>
  </div>

  <div id="blobcallback" class="section">
  <h4><span class="secno">3.2.7 </span>BlobCallback</h4>

  <pre class="idl"><span id="idl-def-BlobCallback" class="idlInterface">[<span class="extAttr">Callback, NoInterfaceObject</span>]
interface <span class="idlInterfaceID">BlobCallback</span> {
<span class="idlMethod">    <span class="idlMethType"><a>void</a></span> <span class="idlMethName"><a href="#widl-BlobCallback-handleEvent-void-Blob-blob">handleEvent</a></span> (<span class="idlParam"><span class="idlParamType"><a>Blob</a></span> <span class="idlParamName">blob</span></span>);</span>
};</span>
</pre><div id="methods-5" class="section"><h5><span class="secno">3.2.7.1 </span>Methods</h5><dl class="methods"><dt id="widl-BlobCallback-handleEvent-void-Blob-blob"><code>handleEvent</code></dt><dd>Def TBD<table class="parameters"><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">blob</td><td class="prmType"><code><a>Blob</a></code></td><td class="prmNullFalse">✘</td><td class="prmOptFalse">✘</td><td class="prmDesc"></td></tr></table><div><em>Return type: </em><code><a>void</a></code></div></dd></dl></div>
  </div>

  <div id="url" class="section">
  <h4><span class="secno">3.2.8 </span>URL</h4>

  <pre class="idl"><span id="idl-def-URL" class="idlInterface">partial interface <span class="idlInterfaceID">URL</span> {
<span class="idlMethod">    <span class="idlMethType"><a>static DOMString</a></span> <span class="idlMethName"><a href="#widl-URL-createObjectURL-static-DOMString-MediaStream-stream">createObjectURL</a></span> (<span class="idlParam"><span class="idlParamType"><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></span> <span class="idlParamName">stream</span></span>);</span>
};</span>
</pre><div id="methods-6" class="section"><h5><span class="secno">3.2.8.1 </span>Methods</h5><dl class="methods"><dt id="widl-URL-createObjectURL-static-DOMString-MediaStream-stream"><code>createObjectURL</code></dt><dd>
      <p>Mints a <a href="#blob-url">Blob URL</a> to refer to the given <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code>.</p>

      <p>When the <dfn id="dom-url-createobjecturl"><code>createObjectURL()</code></dfn> method is called
      with a <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> argument, the user agent
      <em class="rfc2119" title="must">must</em> return a unique <a href="#blob-url">Blob URL</a> for the given <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code>. [<cite><a class="bibref" rel="biblioentry" href="#bib-FILE-API">FILE-API</a></cite>]</p>

      <p>For audio and video streams, the data exposed on that stream <em class="rfc2119" title="must">must</em> be in a format
      supported by the user agent for use in <code>audio</code> and <code>video</code>
      elements.</p>

      <p class="bookkeeping">A <dfn id="blob-url">Blob URL</dfn> is the same as what the
      File API specification calls a Blob URI, except that anything in the
      definition of that feature that refers to <code>File</code> and <code>Blob</code>
      objects is hereby extended to also apply to <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> and <code><a href="#idl-def-LocalMediaStream" class="idlType"><code>LocalMediaStream</code></a></code> objects.</p>
    <table class="parameters"><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">stream</td><td class="prmType"><code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code></td><td class="prmNullFalse">✘</td><td class="prmOptFalse">✘</td><td class="prmDesc"></td></tr></table><div><em>Return type: </em><code><a>static DOMString</a></code></div></dd></dl></div>
  </div>
  </div>

  <div id="examples" class="section">
  <h3><span class="secno">3.3 </span>Examples</h3>

  <div>
    <p>This sample code exposes a button. When clicked, the button is disabled and the
    user is prompted to offer a stream. The user can cause the button to be re-enabled by
    providing a stream (e.g. giving the page access to the local camera) and then
    disabling the stream (e.g. revoking that access).</p>
    <pre class="example sh_javascript sh_sourceCode">&lt;input type=&quot;button&quot; value=&quot;Start&quot; onclick=&quot;start()&quot; id=&quot;startBtn&quot;&gt;
&lt;script&gt;
 var startBtn = document.getElementById('startBtn');
 function start() {
   navigator.getUserMedia({audio:true, video:true}, gotStream);
   startBtn.disabled = true;
 }
 function gotStream(stream) {
   stream.onended = function () {
     startBtn.disabled = false;
   }
 }
&lt;/script&gt;</pre>
  </div>

  <div>
    <p>This example allows people to record a short audio message and upload it to the
    server. This example even shows rudimentary error handling.</p>
    <pre class="example sh_javascript">&lt;input type=&quot;button&quot; value=&quot;⚫&quot; onclick=&quot;msgRecord()&quot; id=&quot;recBtn&quot;&gt;
&lt;input type=&quot;button&quot; value=&quot;◼&quot; onclick=&quot;msgStop()&quot; id=&quot;stopBtn&quot; disabled&gt;
&lt;p id=&quot;status&quot;&gt;To start recording, press the ⚫ button.&lt;/p&gt;
&lt;script&gt;
 var recBtn = document.getElementById('recBtn');
 var stopBtn = document.getElementById('stopBtn');
 function report(s) {
   document.getElementById('status').textContent = s;
 }
 function msgRecord() {
   report('Attempting to access microphone...');
   navigator.getUserMedia({audio:true}, gotStream, noStream);
   recBtn.disabled = true;
 }
 var msgStream, msgStreamRecorder;
 function gotStream(stream) {
   report('Recording... To stop, press to ◼ button.');
   msgStream = stream;
   msgStreamRecorder = stream.record();
   stopBtn.disabled = false;
   stream.onended = function () {
     msgStop();     
   }
 }
 function msgStop() {
   report('Creating file...');
   stopBtn.disabled = true;
   msgStream.onended = null;
   msgStream.stop();
   msgStreamRecorder.getRecordedData(msgSave);
 }
 function msgSave(blob) {
   report('Uploading file...');
   var x = new XMLHttpRequest();
   x.open('POST', 'uploadMessage');
   x.send(blob);
   x.onload = function () {
     report('Done! To record a new message, press the ⚫ button.');
     recBtn.disabled = false;
   };
   x.onerror = function () {
     report('Failed to upload message. To try recording a message again, press the ⚫ button.');
     recBtn.disabled = false;
   };
 }
 function noStream() {
   report('Could not obtain access to your microphone. To try again, press the ⚫ button.');
   recBtn.disabled = false;
 }
&lt;/script&gt;</pre>
  </div>

  <div>
    <p>This example allows people to take photos of themselves from the local video
    camera.</p>
    <pre class="example sh_javascript">&lt;article&gt;
 &lt;style scoped&gt;
  video { transform: scaleX(-1); }
  p { text-align: center; }
 &lt;/style&gt;
 &lt;h1&gt;Snapshot Kiosk&lt;/h1&gt;
 &lt;section id=&quot;splash&quot;&gt;
  &lt;p id=&quot;errorMessage&quot;&gt;Loading...&lt;/p&gt;
 &lt;/section&gt;
 &lt;section id=&quot;app&quot; hidden&gt;
  &lt;p&gt;&lt;video id=&quot;monitor&quot; autoplay&gt;&lt;/video&gt; &lt;canvas id=&quot;photo&quot;&gt;&lt;/canvas&gt;
  &lt;p&gt;&lt;input type=button value=&quot;&amp;#x1F4F7;&quot; onclick=&quot;snapshot()&quot;&gt;
 &lt;/section&gt;
 &lt;script&gt;
  navigator.getUserMedia({video:true}, gotStream, noStream);
  var video = document.getElementById('monitor');
  var canvas = document.getElementById('photo');
  function gotStream(stream) {
    video.src = URL.createObjectURL(stream);
    video.onerror = function () {
      stream.stop();
    };
    stream.onended = noStream;
    video.onloadedmetadata = function () {
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      document.getElementById('splash').hidden = true;
      document.getElementById('app').hidden = false;
    };
  }
  function noStream() {
    document.getElementById('errorMessage').textContent = 'No camera available.';
  }
  function snapshot() {
    canvas.getContext('2d').drawImage(video, 0, 0);
  }
 &lt;/script&gt;
&lt;/article&gt;</pre>
  </div>
  </div>
  </div>

  <div id="peer-to-peer-connections" class="section">
  
<!-- OddPage -->
<h2><span class="secno">4. </span>Peer-to-peer connections</h2>

  <p>A <code><a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a></code> allows two users to
  communicate directly, browser-to-browser. Communications are coordinated via a
  signaling channel provided by script in the page via the server, e.g. using
  <code>XMLHttpRequest</code>.</p>

  <p>Calling <code>new <a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a>(<var>configuration</var>,
  <var>signalingCallback</var>)</code> creates a <code><a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a></code> object.</p>

  <p>The <var>configuration</var> string gives the address of a STUN or TURN
  server to use to establish the connection. [<cite><a class="bibref" rel="biblioentry" href="#bib-STUN">STUN</a></cite>] [<cite><a class="bibref" rel="biblioentry" href="#bib-TURN">TURN</a></cite>]</p>

  <p>The allowed formats for this string are:</p>

  <dl>
    <dt>&quot;<code><var>TYPE</var> 203.0.113.2:3478</code>&quot;</dt>

    <dd>
      <p>Indicates a specific IP address and port for the server.</p>
    </dd>

    <dt>&quot;<code><var>TYPE</var> relay.example.net:3478</code>&quot;</dt>

    <dd>
      <p>Indicates a specific host and port for the server; the user agent will look up
      the IP address in DNS.</p>
    </dd>

    <dt>&quot;<code><var>TYPE</var> example.net</code>&quot;</dt>

    <dd>
      <p>Indicates a specific domain for the server; the user agent will look up the IP
      address and port in DNS.</p>
    </dd>
  </dl>

  <p>The &quot;<code><var>TYPE</var></code>&quot; is one of:</p>

  <dl>
    <dt><code>STUN</code></dt>

    <dd>Indicates a STUN server</dd>

    <dt><code>STUNS</code></dt>

    <dd>Indicates a STUN server that is to be contacted using a TLS session.</dd>

    <dt><code>TURN</code></dt>

    <dd>Indicates a TURN server</dd>

    <dt><code>TURNS</code></dt>

    <dd>Indicates a TURN server that is to be contacted using a TLS session.</dd>
  </dl>

  <p>The <var>signalingCallback</var> argument is a method that will be invoked
  when the user agent needs to send a message to the other host over the signaling
  channel. When the callback is invoked, convey its first argument (a string) to the
  other peer using whatever method is being used by the Web application to relay
  signaling messages. (Messages returned from the other peer are provided back to the
  user agent using the <code><a href="#dom-peerconnection-processsignalingmessage">processSignalingMessage()</a></code>
  method.)</p>

  <p>A <code><a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a></code> object has an associated
  <dfn id="peerconnection-signaling-callback"><code>PeerConnection</code> signaling
  callback</dfn>, a <dfn id="peerconnection-ice-agent"><code>PeerConnection</code> ICE
  Agent</dfn>,
  
<!-- a <dfn id=
  'peerconnection-data-udp-media-stream'><code>PeerConnection</code> data UDP media
  stream</dfn>,  -->

  a <dfn id="peerconnection-readiness-state"><code>PeerConnection</code>
  readiness state</dfn> and an <dfn id="ice-started-flag">SDP Agent</dfn>. These
  are initialized when the object is created.</p>

  <p>When the <dfn id="dom-peerconnection"><code>PeerConnection()</code></dfn> constructor is invoked, the
  user agent <em class="rfc2119" title="must">must</em> run the following steps. This algorithm has a synchronous
  section (which is triggered as part of the event loop algorithm).
  Steps in the synchronous section are marked with ⌛.</p>

  <ol>
    <li>
      <p>Let <var>serverConfiguration</var> be the constructor’s first
      argument.</p>
    </li>

    <li>
      <p>Let <var>signalingCallback</var> be the constructor’s second
      argument.</p>
    </li>

    <li>
      <p>Let <var>connection</var> be a newly created <code><a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a></code> object.</p>
    </li>

    <li>
      <p>Create an ICE Agent and let <var>connection</var>’s <a href="#peerconnection-ice-agent"><code>PeerConnection</code> ICE Agent</a> be that ICE
      Agent. [<cite><a class="bibref" rel="biblioentry" href="#bib-ICE">ICE</a></cite>]</p>
    </li>

    <li>
      <p>If <var>serverConfiguration</var> contains a U+000A LINE FEED (LF)
      character or a U+000D CARRIAGE RETURN (CR) character (or both), remove all
      characters from <var>serverConfiguration</var> after the first such
      character.</p>
    </li>

    <li>
      <p><span title="split a string on spaces">Split <var title="">serverConfiguration</var> on spaces</span> to obtain <var>configuration
      components</var>.</p>
    </li>

    <li>
      <p>If <var>configuration components</var> has two or more components, and
      the first component is a case-sensitive match for one of the following
      strings:</p>

      <ul class="breif">
        <li>&quot;<code>STUN</code>&quot;</li>

        <li>&quot;<code>STUNS</code>&quot;</li>

        <li>&quot;<code>TURN</code>&quot;</li>

        <li>&quot;<code>TURNS</code>&quot;</li>
      </ul>

      <p>...then run the following substeps:</p>

      <ol>
        <li>
          <p>Let <var>server type</var> be STUN if the first component of
          <var>configuration components</var> is '<code>STUN</code>' or
          '<code>STUNS</code>', and TURN otherwise (the first component of
          <var>configuration components</var> is &quot;<code>TURN</code>&quot; or
          &quot;<code>TURNS</code>&quot;).</p>
        </li>

        <li>
          <p>Let <var>secure</var> be true if the first component of <var title="">configuration components</var> is &quot;<code>STUNS</code>&quot; or
          &quot;<code>TURNS</code>&quot;, and false otherwise.</p>
        </li>

        <li>
          <p>Let <var>host</var> be the contents of the second component of
          <var>configuration components</var> up to the character before the
          first U+003A COLON character (:), if any, or the entire string otherwise.</p>
        </li>

        <li>
          <p>Let <var>port</var> be the contents of the second component of
          <var>configuration components</var> from the character after the first
          U+003A COLON character (:) up to the end, if any, or the empty string
          otherwise.</p>
        </li>

        <li>
          <p>Configure the <a href="#peerconnection-ice-agent"><code>PeerConnection</code> ICE Agent</a>’s STUN or
          TURN server as follows:</p>

          <ul>
            <li>If <var>server type</var> is STUN, the server is a STUN server.
            Otherwise, <var>server type</var> is TURN and the server is a TURN
            server.</li>

            <li>If <var>secure</var> is true, the server is to be contacted
            using TLS-over-TCP, otherwise, it is to be contacted using UDP.</li>

            <li>The IP address, host name, or domain name of the server is <var title="">host</var>.</li>

            <li>The port to use is <var>port</var>. If this is the empty string,
            then only a domain name is configured (and the ICE Agent will use DNS SRV
            requests to determine the IP address and port).</li>

            <li>The long-term username for the STUN or TURN server is the <span title="ASCII serialization of an origin">ASCII serialization</span> of the
            entry script’s origin; the long-term password is
            the empty string.</li>
          </ul>

          <p>If the given IP address, host name, domain name, or port are invalid, then
          the user agent <em class="rfc2119" title="must">must</em> act as if no STUN or TURN server is configured.</p>
        </li>
      </ol>
    </li>

    <li>
      <p>Let the <var>connection</var>’s <a href="#peerconnection-signaling-callback"><code>PeerConnection</code> signaling
      callback</a> be <var>signalingCallback</var>.</p>
    </li>

    <li>
      <p>Set <var>connection</var>’s <a href="#peerconnection-readiness-state"><code>PeerConnection</code> readiness state</a>
      to <code><a href="#widl-PeerConnection-NEW">NEW</a></code> (0).</p>
    </li>

    <li>
     <p>Set <var>connection</var>’s <a href="#peerconnection-readiness-state"><code>PeerConnection</code> ice state </a>
      to <code><a href="#widl-PeerConnection-NEW">NEW</a></code> (0).</p>
    </li>

        <li>
     <p>Set <var>connection</var>’s <a href="#peerconnection-readiness-state"><code>PeerConnection</code> sdp state </a>
      to <code><a href="#widl-PeerConnection-NEW">NEW</a></code> (0).</p>
    </li>

    
<!-- 
    <li>
      <p>Let <var>connection</var>’s <a href=
      "#peerconnection-data-udp-media-stream"><code>PeerConnection</code> data UDP media
      stream</a> be a new <a href="#data-udp-media-stream">data UDP media stream</a>.</p>
    </li>
 -->

    
    <li>
      <p>Let <var>connection</var>’s <code title="dom-PeerConnection-localStreams"><a href="#widl-PeerConnection-localStreams">localStreams</a></code> attribute be an empty
      read-only <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> array.
      </p>
    </li>

    <li>
      <p>Let <var>connection</var>’s <code title="dom-PeerConnection-remoteStreams"><a href="#widl-PeerConnection-remoteStreams">remoteStreams</a></code> attribute be an empty
      read-only <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> array.
      </p>
    </li>

    <li>
      <p>Return <var>connection</var>, but continue these steps
      asynchronously.</p>
    </li>

    <li>
      <p>Await a stable state. The synchronous section consists
      of the remaining steps of this algorithm. (Steps in <span title="synchronous section">synchronous sections</span> are marked with ⌛.)</p>
    </li>

    <li> <p>⌛ If the ice state is set to NEW, it <em class="rfc2119" title="must">must</em> queue a task to start
    gathering ICE address and set the ice state to ICE_GATHERING.</p> </li>
    
    <li> <p>⌛ Once the ICE address gathering is complete, if there are any streams in
    localStreams, the SDP Agent will send the initial the SDP offer. The 
    initial SDP offer <em class="rfc2119" title="must">must</em> contain both the ICE candidate information
    as well as the SDP to represent the media descriptions for all the
    streams in localStreams. </p> </li>
    
 </ol>

  <p> During the lifetime of the peerConnection object, the following
     procedures are followed: </p>

  <ol>
     <li> <p> If a local media stream has been added and an SDP offer needs to
    be sent, and the ICE state is not NEW or ICE_GATHERING, and the SDP Agent
    state is NEW or SDP_IDLE, then send and queue a task to send an SDP offer and
    change the SPD state to SDP Waiting.</p> </li>

    <li> <p> If an SDP offer has been received, and the SDP state is NEW or
    SDP_IDLE, pass the ICE candidates from the SDP offer to the ICE Agent and
    change it state to ICE_CHECKING. Construct an appropriate SDP answer, update the
    remote streams, queue a task to send the SDP offer, and set the SDPAgent
    state to SDP_IDLE. </p> </li>

    <li> <p> At the point the sdpState changes from NEW to some other
    state, the readyState changes to NEGOTIATING.  </p> </li>

     <li> <p> If the ICE Agent finds a candidates that froms a valid
    connection, the ICE state is changed to ICE_CONNECTED </p> </li>

     <li> <p> If the ICE Agent finishes checking all candidates, if a
    connection has been found, the ice state is changed to ICE_COMPLETED and if
    not connection has been found it is changed to ICE_FAILED. </p> </li>

     <li> <p> If the iceState is ICE_CONNECTED or ICE_COMPLETED and the
   SDP stat is SDP_IDLE, the readyState is set to ACTIVE. </p> </li>
   
    <li> <p> If the iceState is ICE_FAILED, a task is queued to calls the close method. </p> </li>
  
    <li> <p> The close method will cause the system to wait until the sdpStat
    is SDP_IDLE then it will send an SDP offer terminating all media and change
    the readyState to CLOSING as well as stop all ICE process and change the
    iceState to ICE_CLOSED. Once an SDP anser to this offer is received, the
    readyState will be changed to CLOSED.  </p> </li>
  
</ol>
    
  <p>User agents <em class="rfc2119" title="may">may</em> negotiate any codec and any resolution, bitrate, or other quality
  metric. User agents are encouraged to initially negotiate for the native resolution of
  the stream. For streams that are then rendered (using a <code>video</code> element),
  user agents are encouraged to renegotiate for a resolution that matches the rendered
  display size.</p>

  <p class="note">Starting with the native resolution means that if the Web application
  notifies its peer of the native resolution as it starts sending data, and the peer
  prepares its <code>video</code> element accordingly, there will be no need for a
  renegotiation once the stream is flowing.</p>

  <p>All SDP media descriptions for streams represented by <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> objects <em class="rfc2119" title="must">must</em> include a label attribute
  (&quot;<code title="">a=label:</code>&quot;) whose value is the value of the <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> object’s <code title="dom-MediaStream-label"><a href="#dom-mediastream-label">label</a></code> attribute.
  [<cite><a class="bibref" rel="biblioentry" href="#bib-SDP">SDP</a></cite>] [<cite><a class="bibref" rel="biblioentry" href="#bib-SDPLABEL">SDPLABEL</a></cite>]</p>

  <p><a href="#peerconnection"><code>PeerConnection</code>s</a> <em class="rfc2119" title="must">must</em> not generate any
  candidates for media streams whose media descriptions do not have a label attribute
  (&quot;<code>a=label:</code>&quot;). [<cite><a class="bibref" rel="biblioentry" href="#bib-ICE">ICE</a></cite>] [<cite><a class="bibref" rel="biblioentry" href="#bib-SDP">SDP</a></cite>] [<cite><a class="bibref" rel="biblioentry" href="#bib-SDPLABEL">SDPLABEL</a></cite>]</p>

  <p>When a user agent has reached the point in the media negotiation where a
  <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> can be created to represent incoming components, the user
  agent <em class="rfc2119" title="must">must</em> run the following steps:</p>

  <ol>
    <li>
      <p>Let <var>connection</var> be the <code><a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a></code> expecting this
      media.</p>
    </li>

    <li>
      <p>Create a <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> object to represent
      the media stream. Set its <code><a href="#dom-mediastream-label">label</a></code> attribute to the value of the SDP Label
      attribute for that component’s media stream.</p>
    </li>

    <li>
      <p>Run the following steps for each component in the media stream.</p>

    <ol>
      <li>
        <p>Create a <code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code> object <var>track</var> to represent
        the component.</p>
      </li>

      <li>
        <p>If <var>track’s</var> <code>
        <a href="#dom-mediastreamtrack-kind">kind</a></code> attribute equals &quot;<code>audio</code>&quot;,
        add it to the <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> object’s
        <code>
        <a href="#dom-mediastream-audiotracks">audioTracks</a></code>
        <code><a href="#idl-def-MediaStreamTrackList" class="idlType"><code>MediaStreamTrackList</code></a></code> object.</p>
      </li>

      <li>
        <p>If <var>track’s</var> <code>
        <a href="#dom-mediastreamtrack-kind">kind</a></code> attribute equals &quot;<code>video</code>&quot;,
        add it to the <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> object’s
        <code>
        <a href="#dom-mediastream-videotracks">videoTracks</a></code>
        <code><a href="#idl-def-MediaStreamTrackList" class="idlType"><code>MediaStreamTrackList</code></a></code> object.</p>
      </li>
    </ol>

    <p class="note">The internal order in the <code><a href="#idl-def-MediaStreamTrackList" class="idlType"><code>MediaStreamTrackList</code></a></code> objects
    on the receiving side should reflect the order on the sending side. One way to enforce this
    is to specify the order in the SDP.</p>
    </li>
    <li>
      <p>Queue a task to run the following substeps:</p>

      <ol>
        <li>
          <p>If the <var>connection</var>’s <a href="#peerconnection-readiness-state"><code>PeerConnection</code> readiness
          state</a> is <code><a href="#widl-PeerConnection-CLOSED">CLOSED</a></code> (3), abort these steps.</p>
        </li>
<!--  close() was probably called just before this
     task ran  -->


        <li>
          <p>Add the newly created <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code>
          object to the end of <var>connection</var>’s <code title="dom-PeerConnection-remoteStreams"><a href="#widl-PeerConnection-remoteStreams">remoteStreams</a></code> array.</p>
        </li>

        <li>
          <p><a href="#fire-a-stream-event">Fire a stream event</a> named <code title="event-MediaStream-addstream"><a href="#event-mediastream-addstream">addstream</a></code> with the newly created
          <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> object at the <var title="">connection</var> object.</p>
        </li>
      </ol>
    </li>
  </ol>

  <p>When a user agent has negotiated media for a component that belongs to a media stream
  thas is already represented by an existing <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> object, the
  user agent <em class="rfc2119" title="must">must</em> associate the component with that <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> object.</p>

  <p>When a <a href="#peerconnection"><code>PeerConnection</code></a> finds that a stream
  from the remote peer has been removed (its port has been set to zero in a media
  description sent on the signaling channel), the user agent <em class="rfc2119" title="must">must</em> follow these steps:</p>

  <ol>
    <li>
      <p>Let <var>connection</var> be the <code><a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a></code> associated with the stream being
      removed.</p>
    </li>

    <li>
      <p>Let <var>stream</var> be the <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> object that represents the media stream being
      removed, if any. If there isn’t one, then abort these steps.</p>
    </li>

    <li>
      <p>By definition, <var>stream</var> is now <a href="#dfn-finished" class="internalDFN">finished</a>.</p>

      <p class="note">A <span title="concept-task">task</span> is thus <span title="queue a task">queued</span> to update <var>stream</var> and fire an
      event.</p>
    </li>

    <li>
      <p>Queue a task to run the following substeps:</p>

      <ol>
        <li>
          <p>If the <var>connection</var>’s <a href="#peerconnection-readiness-state"><code>PeerConnection</code> readiness
          state</a> is <code><a href="#widl-PeerConnection-CLOSED">CLOSED</a></code> (3), abort these steps.</p>
        </li>
<!--  close() was probably called just before this
     task ran  -->


        <li>
          <p>Remove <var>stream</var> from <var>connection</var>’s
          <code><a href="#widl-PeerConnection-remoteStreams">remoteStreams</a></code> array.</p>
        </li>

        <li>
          <p><a href="#fire-a-stream-event">Fire a stream event</a> named <code title="event-MediaStream-removestream"><a href="#event-mediastream-removestream">removestream</a></code> with <var title="">stream</var> at the <var>connection</var> object.</p>
        </li>
      </ol>
    </li>
  </ol>

  <p>The task source for the <span title="concept-task">tasks</span> listed
  in this section is the networking task source.</p>

  <p>If a <code><a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a></code> object is <a title="consumer" href="#dfn-consumer" class="internalDFN">consuming</a> a <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> and a
  track is added to one of the stream’s <code><a>MediaStreaMtrackList</a></code> objects,
  by, e.g., the <code>
  <a href="#dom-mediastreamtracklist-add">add()</a></code> method being invoked, the
  <code><a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a></code> object <em class="rfc2119" title="must">must</em> add a media component for that track the
  next time the user agent <span title="provide a stable state">provides a stable state</span>.
  The user agent <em class="rfc2119" title="must">must</em> also remove a media component in same way.</p>

  <p class="warning">To prevent network sniffing from allowing a fourth party to
  establish a connection to a peer using the information sent out-of-band to the other
  peer and thus spoofing the client, the configuration information <em class="rfc2119" title="should">should</em> always be
  transmitted using an encrypted connection.</p>

  <div id="peerconnection" class="section">
  <h3><span class="secno">4.1 </span>PeerConnection</h3>

  <pre class="idl"><span id="idl-def-PeerConnection" class="idlInterface">[<span class="extAttr">Constructor (DOMString configuration, SignalingCallback signalingCallback)</span>]
interface <span class="idlInterfaceID">PeerConnection</span> {
<span class="idlMethod">    <span class="idlMethType"><a>void</a></span>        <span class="idlMethName"><a href="#widl-PeerConnection-processSignalingMessage-void-DOMString-message">processSignalingMessage</a></span> (<span class="idlParam"><span class="idlParamType"><a>DOMString</a></span> <span class="idlParamName">message</span></span>);</span>
<span class="idlConst">    const <span class="idlConstType"><a>unsigned short</a></span> <span class="idlConstName"><a href="#widl-PeerConnection-NEW">NEW</a></span> = <span class="idlConstValue">0</span>;</span>
<span class="idlConst">    const <span class="idlConstType"><a>unsigned short</a></span> <span class="idlConstName"><a href="#widl-PeerConnection-NEGOTIATING">NEGOTIATING</a></span> = <span class="idlConstValue">1</span>;</span>
<span class="idlConst">    const <span class="idlConstType"><a>unsigned short</a></span> <span class="idlConstName"><a href="#widl-PeerConnection-ACTIVE">ACTIVE</a></span> = <span class="idlConstValue">2</span>;</span>
<span class="idlConst">    const <span class="idlConstType"><a>unsigned short</a></span> <span class="idlConstName"><a href="#widl-PeerConnection-CLOSING">CLOSING</a></span> = <span class="idlConstValue">4</span>;</span>
<span class="idlConst">    const <span class="idlConstType"><a>unsigned short</a></span> <span class="idlConstName"><a href="#widl-PeerConnection-CLOSED">CLOSED</a></span> = <span class="idlConstValue">3</span>;</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a>unsigned short</a></span> <span class="idlAttrName"><a href="#widl-PeerConnection-readyState">readyState</a></span>;</span>
<span class="idlConst">    const <span class="idlConstType"><a>unsigned short</a></span> <span class="idlConstName"><a href="#widl-PeerConnection-ICE_GATHERING">ICE_GATHERING</a></span> = <span class="idlConstValue">0x100</span>;</span>
<span class="idlConst">    const <span class="idlConstType"><a>unsigned short</a></span> <span class="idlConstName"><a href="#widl-PeerConnection-ICE_WAITING">ICE_WAITING</a></span> = <span class="idlConstValue">0x200</span>;</span>
<span class="idlConst">    const <span class="idlConstType"><a>unsigned short</a></span> <span class="idlConstName"><a href="#widl-PeerConnection-ICE_CHECKING">ICE_CHECKING</a></span> = <span class="idlConstValue">0x300</span>;</span>
<span class="idlConst">    const <span class="idlConstType"><a>unsigned short</a></span> <span class="idlConstName"><a href="#widl-PeerConnection-ICE_CONNECTED">ICE_CONNECTED</a></span> = <span class="idlConstValue">0x400</span>;</span>
<span class="idlConst">    const <span class="idlConstType"><a>unsigned short</a></span> <span class="idlConstName"><a href="#widl-PeerConnection-ICE_COMPLETED">ICE_COMPLETED</a></span> = <span class="idlConstValue">0x500</span>;</span>
<span class="idlConst">    const <span class="idlConstType"><a>unsigned short</a></span> <span class="idlConstName"><a href="#widl-PeerConnection-ICE_FAILED">ICE_FAILED</a></span> = <span class="idlConstValue">0x600</span>;</span>
<span class="idlConst">    const <span class="idlConstType"><a>unsigned short</a></span> <span class="idlConstName"><a href="#widl-PeerConnection-ICE_CLOSED">ICE_CLOSED</a></span> = <span class="idlConstValue">0x700</span>;</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a>unsigned short</a></span> <span class="idlAttrName"><a href="#widl-PeerConnection-iceState">iceState</a></span>;</span>
<span class="idlConst">    const <span class="idlConstType"><a>unsigned short</a></span> <span class="idlConstName"><a href="#widl-PeerConnection-SDP_IDLE">SDP_IDLE</a></span> = <span class="idlConstValue">0x1000</span>;</span>
<span class="idlConst">    const <span class="idlConstType"><a>unsigned short</a></span> <span class="idlConstName"><a href="#widl-PeerConnection-SDP_WAITING">SDP_WAITING</a></span> = <span class="idlConstValue">0x2000</span>;</span>
<span class="idlConst">    const <span class="idlConstType"><a>unsigned short</a></span> <span class="idlConstName"><a href="#widl-PeerConnection-SDP_GLARE">SDP_GLARE</a></span> = <span class="idlConstValue">0x3000</span>;</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a>unsigned short</a></span> <span class="idlAttrName"><a href="#widl-PeerConnection-sdpState">sdpState</a></span>;</span>
<span class="idlMethod">    <span class="idlMethType"><a href="#idl-def-DataChannel" class="idlType"><code>DataChannel</code></a></span> <span class="idlMethName"><a href="#widl-PeerConnection-createDataChannel-DataChannel-DOMString-label-DataChannelInit-dataChannelDict">createDataChannel</a></span> (<span class="idlParam">[<span class="extAttr">TreatNullAs=EmptyString</span>] <span class="idlParamType"><a>DOMString</a>?</span> <span class="idlParamName">label</span></span>, <span class="idlParam">optional <span class="idlParamType"><a href="#idl-def-DataChannelInit" class="idlType"><code>DataChannelInit</code></a>?</span> <span class="idlParamName">dataChannelDict</span></span>);</span>
<span class="idlAttribute">             attribute <span class="idlAttrType"><a>Function</a>?</span>      <span class="idlAttrName"><a href="#widl-PeerConnection-ondatachannel">ondatachannel</a></span>;</span>
<span class="idlMethod">    <span class="idlMethType"><a>void</a></span>        <span class="idlMethName"><a href="#widl-PeerConnection-addStream-void-MediaStream-stream-MediaStreamHints-hints">addStream</a></span> (<span class="idlParam"><span class="idlParamType"><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></span> <span class="idlParamName">stream</span></span>, <span class="idlParam"><span class="idlParamType"><a>MediaStreamHints</a></span> <span class="idlParamName">hints</span></span>);</span>
<span class="idlMethod">    <span class="idlMethType"><a>void</a></span>        <span class="idlMethName"><a href="#widl-PeerConnection-removeStream-void-MediaStream-stream">removeStream</a></span> (<span class="idlParam"><span class="idlParamType"><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></span> <span class="idlParamName">stream</span></span>);</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a>[]</span>  <span class="idlAttrName"><a href="#widl-PeerConnection-localStreams">localStreams</a></span>;</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a>[]</span>  <span class="idlAttrName"><a href="#widl-PeerConnection-remoteStreams">remoteStreams</a></span>;</span>
<span class="idlMethod">    <span class="idlMethType"><a>void</a></span>        <span class="idlMethName"><a href="#widl-PeerConnection-close-void">close</a></span> ();</span>
<span class="idlAttribute">             attribute <span class="idlAttrType"><a>Function</a>?</span>      <span class="idlAttrName"><a href="#widl-PeerConnection-onconnecting">onconnecting</a></span>;</span>
<span class="idlAttribute">             attribute <span class="idlAttrType"><a>Function</a>?</span>      <span class="idlAttrName"><a href="#widl-PeerConnection-onopen">onopen</a></span>;</span>
<span class="idlAttribute">             attribute <span class="idlAttrType"><a>Function</a>?</span>      <span class="idlAttrName"><a href="#widl-PeerConnection-onstatechange">onstatechange</a></span>;</span>
<span class="idlAttribute">             attribute <span class="idlAttrType"><a>Function</a>?</span>      <span class="idlAttrName"><a href="#widl-PeerConnection-onaddstream">onaddstream</a></span>;</span>
<span class="idlAttribute">             attribute <span class="idlAttrType"><a>Function</a>?</span>      <span class="idlAttrName"><a href="#widl-PeerConnection-onremovestream">onremovestream</a></span>;</span>
};</span>
</pre><div id="attributes-4" class="section"><h4><span class="secno">4.1.1 </span>Attributes</h4><dl class="attributes"><dt id="widl-PeerConnection-iceState"><code>iceState</code> of type <span class="idlAttrType"><a>unsigned short</a></span>, readonly</dt><dd>
      <p>The <dfn id="dom-peerconnection-icestate"><code>iceState</code></dfn> attribute
      <em class="rfc2119" title="must">must</em> return the state of the <a href="#peerconnection-ice-agent"><code>PeerConnection</code> ICE Agent</a> ICE
      state, represented by a number from the following list:</p>

      <dl>
        <dt><code><a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a></code> . <code title="widl-PeerConnection-NEW"><a href="#widl-PeerConnection-NEW">NEW</a></code>
        (0)</dt>

        <dd>The object was just created, and no networking has yet occurred.</dd>

        <dt><code><a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a></code> . <code title="dom-PeerConnection-GATHERING"><a href="#widl-PeerConnection-ICE_GATHERING">ICE_GATHERING</a></code> (0x100)</dt>

        <dd>The ICE Agent is attempting to establish a gather addresses.</dd>

         <dt><code><a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a></code> . <code title="dom-PeerConnection-ICE_WAITING"><a href="#widl-PeerConnection-ICE_WAITING">ICE_WAITING</a></code> (0x200)</dt>

        <dd>The ICE Agent is waiting for candidates from the other side before it
        can start checking.</dd>

        <dt><code><a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a></code> . <code title="dom-PeerConnection-CHECKING"><a href="#widl-PeerConnection-ACTIVE">ICE_CHECKING</a></code> (0x300)</dt>
       <dd>The ICE Agent is checking candidates but has not yet found a connection.</dd>

        <dt><code><a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a></code> . <code title="dom-PeerConnection-CONNECTED"><a href="#widl-PeerConnection-CLOSED">ICE_CONNECTED</a></code> (0x400)</dt>
         <dd>The ICE Agent has found a connection but is still checking other
        candidates to see if there is a better connection.</dd>

        <dt><code><a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a></code> . <code title="dom-PeerConnection-COMPLETED"><a href="#widl-PeerConnection-CLOSED">ICE_COMPLETED</a></code> (0x500)</dt>
        <dd>The ICE Agent has finished checking and found a connection.</dd>

        <dt><code><a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a></code> . <code title="dom-PeerConnection-ICE_FAILED"><a href="#widl-PeerConnection-CLOSED">ICE_FAILED</a></code> (0x600)</dt>
        <dd>The ICE Agent is finished checking all candidates and failed to find a connection.</dd>

        <dt><code><a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a></code> . <code title="dom-PeerConnection-CLOSED"><a href="#widl-PeerConnection-CLOSED">ICE_CLOSED</a></code> (0x700)</dt>
        <dd>The ICE Agent has shut down and is no longer responding to STUN requests.</dd>
     </dl>
    </dd><dt id="widl-PeerConnection-localStreams"><code>localStreams</code> of type array of <span class="idlAttrType"><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></span>, readonly</dt><dd>
      <p>Returns a live array containing the streams that the user agent is currently
      attempting to transmit to the remote peer (those that were added with <code title="dom-PeerConnection-addStream"><a href="#dom-peerconnection-addstream">addStream()</a></code>).</p>

      <p>Specifically, it <em class="rfc2119" title="must">must</em> return the read-only <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> array that the attribute was set to when the
      <code><a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a></code>’s constructor ran.</p>
    </dd><dt id="widl-PeerConnection-onaddstream"><code>onaddstream</code> of type <span class="idlAttrType"><a>Function</a></span>, nullable</dt><dd>This event handler, of <span title="event handler event type">event handler event
    type</span> <code><a href="#event-mediastream-addstream">addstream</a></code>, <em class="rfc2119" title="must">must</em> be supported by all objects
    implementing the <code><a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a></code>
    interface.</dd><dt id="widl-PeerConnection-onconnecting"><code>onconnecting</code> of type <span class="idlAttrType"><a>Function</a></span>, nullable</dt><dd>This event handler, of <span title="event handler event type">event handler event
    type</span> <code><a href="#event-mediastream-connecting">connecting</a></code>, <em class="rfc2119" title="must">must</em> be supported by all
    objects implementing the <code><a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a></code>
    interface.</dd><dt id="widl-PeerConnection-ondatachannel"><code>ondatachannel</code> of type <span class="idlAttrType"><a>Function</a></span>, nullable</dt><dd>This event handler, of type <code><a href="#event-peerconnection-datachannel">datachannel</a></code>, <em class="rfc2119" title="must">must</em> be supported by all objects
    implementing the <code><a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a></code> interface.</dd><dt id="widl-PeerConnection-onopen"><code>onopen</code> of type <span class="idlAttrType"><a>Function</a></span>, nullable</dt><dd>This event handler, of <span title="event handler event type">event handler event
    type</span> <code><a href="#event-mediastream-open">open</a></code>, <em class="rfc2119" title="must">must</em> be supported by all objects
    implementing the <code><a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a></code>
    interface.</dd><dt id="widl-PeerConnection-onremovestream"><code>onremovestream</code> of type <span class="idlAttrType"><a>Function</a></span>, nullable</dt><dd>This event handler, of <span title="event handler event type">event handler event
    type</span> <code><a href="#event-mediastream-removestream">removestream</a></code>, <em class="rfc2119" title="must">must</em> be supported by all
    objects implementing the <code><a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a></code>
    interface.</dd><dt id="widl-PeerConnection-onstatechange"><code>onstatechange</code> of type <span class="idlAttrType"><a>Function</a></span>, nullable</dt><dd>This event handler, of <span title="event handler event type">event handler event
    type</span> <code><a href="#event-mediastream-open">open</a></code>, <em class="rfc2119" title="must">must</em> be supported by all objects
    implementing the <code><a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a></code>
    interface. It is called any time the readyState, iceState, or sdpState
    changes. </dd><dt id="widl-PeerConnection-readyState"><code>readyState</code> of type <span class="idlAttrType"><a>unsigned short</a></span>, readonly</dt><dd>
      <p>The <dfn id="dom-peerconnection-readystate"><code title="">readyState</code></dfn> attribute
      <em class="rfc2119" title="must">must</em> return the <code><a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a></code> object’s
      <a href="#peerconnection-readiness-state"><code>PeerConnection</code> readiness
      state</a>, represented by a number from the following list:</p>

      <dl>
        <dt><code><a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a></code> . <code title="widl-PeerConnection-NEW"><a href="#widl-PeerConnection-NEW">NEW</a></code>
        (0)</dt>

        <dd>The object was just created, and no networking has yet occurred.</dd>

        <dt><code><a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a></code> . <code title="dom-PeerConnection-NEGOTIATING"><a href="#widl-PeerConnection-NEGOTIATING">NEGOTIATING</a></code> (1)</dt>

        <dd>The user agent is attempting to establish an connection with the ICE
        Agent and to negotiate codecs with the SDP Agent.</dd>

        <dt><code><a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a></code> . <code title="dom-PeerConnection-ACTIVE"><a href="#widl-PeerConnection-ACTIVE">ACTIVE</a></code> (2)</dt>

        <dd>The ICE Agent has found a connection the SDP Agent has performed a
        round of codec negotiation. It is possible for whatever media was
        negotiated to flow.</dd>

        <dt><code><a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a></code> . <code title="dom-PeerConnection-CLOSING"><a href="#widl-PeerConnection-CLOSED">CLOSING</a></code> (4)</dt>

         <dd> The <code><a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a></code>
         object is terminating all media and is in the process of closing the
         Ice Agent and SDP Agent. </dd>
        
        <dt><code><a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a></code> . <code title="dom-PeerConnection-CLOSED"><a href="#widl-PeerConnection-CLOSED">CLOSED</a></code> (3)</dt>

       <dd>The connection is closed. </dd>
      </dl>
    </dd><dt id="widl-PeerConnection-remoteStreams"><code>remoteStreams</code> of type array of <span class="idlAttrType"><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></span>, readonly</dt><dd>
      <p>Returns a live array containing the streams that the user agent is currently
      receiving from the remote peer.</p>

      <p>Specifically, it <em class="rfc2119" title="must">must</em> return the read-only <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> array that the attribute was set to when the
      <code><a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a></code>’s constructor ran.</p>

      <p>This array is updated when <code><a href="#event-mediastream-addstream">addstream</a></code> and <code title="event-MediaStream-removestream"><a href="#event-mediastream-removestream">removestream</a></code> events are fired.</p>
    </dd><dt id="widl-PeerConnection-sdpState"><code>sdpState</code> of type <span class="idlAttrType"><a>unsigned short</a></span>, readonly</dt><dd> <p>The <dfn id="dom-peerconnection-sdpstate"><code>sdpState</code></dfn> attribute
   <em class="rfc2119" title="must">must</em> return the state of the <code><a href="#peerconnection">PeerConnection</a></code> SDP Agent , represented by
   a number from the following list:</p>

      <dl>
        <dt><code><a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a></code> . <code title="widl-PeerConnection-NEW"><a href="#widl-PeerConnection-NEW">NEW</a></code>
        (0)</dt>

        <dd>The object was just created, and no networking has yet occurred.</dd>

       <dt><code><a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a></code> . <code title="dom-PeerConnection-SDP_IDLE"><a href="#widl-PeerConnection-SDP_IDLE">SDP_IDLE</a></code> (0x1000)</dt>

        <dd>At least one SDP offer or answer has been exchange and the SDP Agent
        is ready to send an SDP offer or receive an SDP answer.</dd>

         <dt><code><a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a></code> . <code title="dom-PeerConnection-SDP_WAITING"><a href="#widl-PeerConnection-SDP_WAITING">SDP_WAITING</a></code> (0x2000)</dt>

        <dd>The SDP Agent has sent and offer and is waiting for a answer.</dd>

        <dt><code><a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a></code> . <code title="dom-PeerConnection-SDP_GLARE"><a href="#widl-PeerConnection-SDP_GLARE">SDP_GLARE</a></code> (0x3000)</dt>

        <dd>The SDP Agent received an offer while waiting for an answer and now
        much wait a random amount of time before retrying to send the offer.</dd>

      </dl>
    </dd></dl></div><div id="methods-7" class="section"><h4><span class="secno">4.1.2 </span>Methods</h4><dl class="methods"><dt id="widl-PeerConnection-addStream-void-MediaStream-stream-MediaStreamHints-hints"><code>addStream</code></dt><dd>
      <p>Attempts to starting sending the given stream to the remote peer.
      The format for the MediaStreamHints objects is currently undefined
      by the specification.</p>

      <p>When the other peer starts sending a stream in this manner, an <code title="event-MediaStream-addstream"><a href="#event-mediastream-addstream">addstream</a></code> event is fired at the
      <code><a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a></code> object.</p>
<!--  </ol>  -->


      <p>When the <dfn id="dom-peerconnection-addstream"><code title="">addStream()</code></dfn> method is
      invoked, the user agent <em class="rfc2119" title="must">must</em> run the following steps:</p>

      <ol>
        <li>
          <p>Let <var>stream</var> be the method’s first argument.</p>
        </li>

        <li>
          <p>Let <var>hints</var> be the method’s second argument.</p>
        </li>

        <li>
          <p>If the <code><a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a></code> object’s
          <a href="#peerconnection-readiness-state"><code>PeerConnection</code> readiness
          state</a> is <code><a href="#widl-PeerConnection-CLOSED">CLOSED</a></code> (3), throw an
          <code>INVALID_STATE_ERR</code> exception.</p>
        </li>

        <li>
          <p>If <var>stream</var> is already in the <code><a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a></code> object’s <code title="dom-PeerConnection-localStreams"><a href="#widl-PeerConnection-localStreams">localStreams</a></code> object, then abort
          these steps.</p>
        </li>

        <li>
          <p>Add <var>stream</var> to the end of the <code><a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a></code> object’s <code title="dom-PeerConnection-localStreams"><a href="#widl-PeerConnection-localStreams">localStreams</a></code> object.</p>
        </li>

        <li>
          <p>Return from the method.</p>
        </li>

        <li>
          <p>Parse the <var>hints</var> provided by the application
          and apply them to the MediaStream, if possible.
          </p>
        </li>
        <li>
          <p>Have the <code><a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a></code> add a
          media stream for <var>stream</var> the next time the user agent
          <span title="provide a stable state">provides a stable state</span>. Any other
          pending stream additions and removals <em class="rfc2119" title="must">must</em> be processed at the same time.</p>
        </li>
      </ol>
    <table class="parameters"><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">stream</td><td class="prmType"><code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code></td><td class="prmNullFalse">✘</td><td class="prmOptFalse">✘</td><td class="prmDesc"></td></tr><tr><td class="prmName">hints</td><td class="prmType"><code><a>MediaStreamHints</a></code></td><td class="prmNullFalse">✘</td><td class="prmOptFalse">✘</td><td class="prmDesc"></td></tr></table><div><em>Return type: </em><code><a>void</a></code></div></dd><dt id="widl-PeerConnection-close-void"><code>close</code></dt><dd>
      <p>When the <dfn id="dom-peerconnection-close"><code title="">close()</code></dfn> method is invoked,
      the user agent <em class="rfc2119" title="must">must</em> run the following steps:</p>

      <ol>
        <li>
          <p>If the <code><a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a></code> object’s
          <a href="#peerconnection-readiness-state"><code>PeerConnection</code> readiness
          state</a> is <code><a href="#widl-PeerConnection-CLOSED">CLOSED</a></code> (3), throw an
          <code>INVALID_STATE_ERR</code> exception.</p>
        </li>

        <li>
          <p>Destroy the <a href="#peerconnection-ice-agent"><code>PeerConnection</code>
          ICE Agent</a>, abruptly ending any active ICE processing and any active
          streaming, and releasing any relevant resources (e.g. TURN permissions).</p>
        </li>

        <li>
          <p>Set the object’s <a href="#peerconnection-readiness-state"><code>PeerConnection</code> readiness
          state</a> to <code><a href="#widl-PeerConnection-CLOSED">CLOSED</a></code> (3).</p>
        </li>
<!-- 
   <li><p>Queue a task to fire a simple
   event named <code title="event-MediaStream-close">close</code> at the
   <code>PeerConnection</code> object.</p></p></li>
 -->

      </ol>

      <p class="note">The <code><a href="#widl-PeerConnection-localStreams">localStreams</a></code> and <code title="dom-PeerConnection-remoteStreams"><a href="#widl-PeerConnection-remoteStreams">remoteStreams</a></code> objects remain in the
      state they were in when the object was closed.</p>
    <div><em>No parameters.</em></div><div><em>Return type: </em><code><a>void</a></code></div></dd><dt id="widl-PeerConnection-createDataChannel-DataChannel-DOMString-label-DataChannelInit-dataChannelDict"><code>createDataChannel</code></dt><dd>
      <p>Creates a new <code><a href="#idl-def-DataChannel" class="idlType"><code>DataChannel</code></a></code> object with the given label. The
      <code><a href="#idl-def-DataChannelInit" class="idlType"><code>DataChannelInit</code></a></code> dictionary can be used to configure properties
      of underlying channel such as 
<!-- priority and -->
 data reliability. A corresponding
      <code><a href="#idl-def-DataChannel" class="idlType"><code>DataChannel</code></a></code> object is dispatched at the other peer if the
      channel setup was successful.</p>

      <p>When the <dfn id="dom-peerconnection-createdatachannel"><code>createDataChannel()</code>
      </dfn> method is invoked, the user agent <em class="rfc2119" title="must">must</em> run the following steps.</p>

      <ol>
        <li>
          <p>If the <code><a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a></code> object’s
          <a href="#peerconnection-readiness-state"><code>PeerConnection</code> readiness
          state</a> is <code><a href="#widl-PeerConnection-CLOSED">CLOSED</a></code> (3),
          throw an <code>INVALID_STATE_ERR</code> exception.</p>
        </li>

        <li>
          <p>Let <var>channel</var> be a newly created <code><a href="#idl-def-DataChannel" class="idlType"><code>DataChannel</code></a></code>
          object.</p>
        </li>

        <li>
          <p>Initialize <var>channel</var>’s <code><a href="#dom-datachannel-label">label</a>
          </code> attribute to the value of the first argument.</p>
        </li>

        <li>
          <p>Initialize <var>channel</var>’s <code><a href="#dom-datachannel-reliable">reliable</a>
          </code> attribute to true.</p>
        </li>

        <li>
          <p>If the second argument is present and it contains a <code>
          <a href="#widl-DataChannelInit-reliable">reliable</a></code> dictionary member, then
          set <var>channel</var>’s <code><a href="#dom-datachannel-reliable">reliable</a></code>
          attribute to the dictionary member value.</p>
        </li>

        <li>
          <p>Return <var>channel</var> and continue these steps in the background.</p>
        </li>

        <li>
          <p>Create <var>channel</var>’s associated <a href="#dfn-underlying-data-transport" class="internalDFN">underlying data transport</a>.</p>
        </li>
      </ol>
    <table class="parameters"><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">label</td><td class="prmType"><code><a>DOMString</a></code></td><td class="prmNullTrue">✔</td><td class="prmOptFalse">✘</td><td class="prmDesc"></td></tr><tr><td class="prmName">dataChannelDict</td><td class="prmType"><code><a href="#idl-def-DataChannelInit" class="idlType"><code>DataChannelInit</code></a></code></td><td class="prmNullTrue">✔</td><td class="prmOptTrue">✔</td><td class="prmDesc"></td></tr></table><div><em>Return type: </em><code><a href="#idl-def-DataChannel" class="idlType"><code>DataChannel</code></a></code></div></dd><dt id="widl-PeerConnection-processSignalingMessage-void-DOMString-message"><code>processSignalingMessage</code></dt><dd>
      <p>When a message is relayed from the remote peer over the signaling channel is
      received by the Web application, pass it to the user agent by calling the
      <code><a href="#dom-peerconnection-processsignalingmessage">processSignalingMessage()</a></code>
      method.</p>

      <p>The order of messages is important. Passing messages to the user agent in a
      different order than they were generated by the remote peer’s user agent can
      prevent a successful connection from being established or degrade the connection’s
      quality if one is established.</p>

      <p>When the <dfn id="dom-peerconnection-processsignalingmessage"><code title="&quot;&quot;">processSignalingMessage()</code></dfn> method is invoked, the user agent <em class="rfc2119" title="must">must</em>
      run the following steps:</p>

      <ol>
        <li>
          <p>Let <var>message</var> be the method’s argument.</p>
        </li>

        <li>
          <p>Let <var>connection</var> be the <code><a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a></code> object on which the method was
          invoked.</p>
        </li>

        <li>
          <p>If <var>connection</var>’s <a href="#peerconnection-readiness-state"><code>PeerConnection</code> readiness
          state</a> is <code><a href="#widl-PeerConnection-CLOSED">CLOSED</a></code> (3), throw an
          <code>INVALID_STATE_ERR</code> exception.</p>
        </li>

        <li>
          <p>If the first four characters of <var>message</var> are not
          &quot;<code>SDP</code>&quot; followed by a U+000A LINE FEED (LF) character, then
          abort these steps. (This indicates an error in the signaling channel
          implementation. User agents <em class="rfc2119" title="may">may</em> report such errors to their developer consoles
          to aid debugging.)</p>

          <p class="note">Future extensions to the <code><a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a></code> interface might use other prefix
          values to implement additional features.</p>
        </li>

        <li>
          <p>Let <var>sdp</var> be the string consisting of all but the first
          four characters of <var>message</var>.</p>
        </li>

        <li>
          <p> Pass the <var>sdp</var> to the <a href="#peerconnection-ice-agent"><code>PeerConnection</code> SDP Agent</a>  as a
          subsequent offer or answer, to be interpreted as appropriate given the current
          state of the SDP Agent. [<cite><a class="bibref" rel="biblioentry" href="#bib-ICE">ICE</a></cite>]</p>
        </li>

<!-- 
        <li>
          <p>The <a href="#ice-started-flag">ICE started flag</a> is false. Start the
          <a href="#peerconnection-ice-agent"><code>PeerConnection</code> ICE Agent</a>
          and pass it <var>sdp</var> as the initial offer from the other peer;
          the ICE Agent will then (asynchronously) construct the initial answer and
          transmit it as described above.</p>

          <p>If there is a <a href=
          "#remotely-initiated-data-udp-media-stream">remotely-initiated data UDP media
          stream</a> in the initial offer, and it has an encryption key advertised in its
          media description that is 16 bytes long, then that is the <a href=
          "#peerconnection-data-udp-media-stream"><code>PeerConnection</code> data UDP
          media stream</a>.</p>

          <p>After the initial answer has been sent, the ICE Agent MUST add all the
          streams in <code><a href=
          "#widl-PeerConnection-localStreams">localStreams</a></code> to the session, as
          described above. [[!ICE]]</p>
        </li>

        <li>
          <p>Let <var>connection</var>’s <a href="#ice-started-flag">ICE started
          flag</a> be true.</p>
        </li>

        <li>
          <p>Queue a task that sets <var>connection</var>’s
          <a href="#peerconnection-readiness-state"><code>PeerConnection</code> readiness
          state</a> to <code><a href=
          "#widl-PeerConnection-NEGOTIATING">NEGOTIATING</a></code> (1) and then
          <span title="fire a simple event">fires a simple event</span> named
          <code><a href=
          "#event-mediastream-connecting">connecting</a></code> at the <code><a>PeerConnection</a></code> object.</p>
        </li>
         -->

        
      </ol>

      <p>When a <a href="#peerconnection-ice-agent"><code>PeerConnection</code> ICE
      Agent</a> forms a connection to the the far side and enters the state
      ICE_CONNECTED, the user
      agent <em class="rfc2119" title="must">must</em> queue a task that sets the <code><a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a></code> object’s <a href="#peerconnection-readiness-state"><code>PeerConnection</code> readiness state</a>
      to <code><a href="#widl-PeerConnection-ACTIVE">ACTIVE</a></code> (2) and then <span title="fire a simple event">fires a simple event</span> named <code title="event-MediaStream-open"><a href="#event-mediastream-open">open</a></code> at the
      <code><a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a></code> object.</p>

      
<!-- 
      <p>When a <a href="#peerconnection-ice-agent"><code>PeerConnection</code> ICE
      Agent</a> restarts ICE processing for any reason (e.g. because a peer is adding or
      removing a stream), the user agent MUST queue a task that sets the
      <code><a href="#peerconnection">PeerConnection</a></code> object’s <a href=
      "#peerconnection-readiness-state"><code>PeerConnection</code> readiness state</a>
      to <code><a href=
      "#widl-PeerConnection-NEGOTIATING">NEGOTIATING</a></code> (1) and then <span title=
      "fire a simple event">fires a simple event</span> named <code title=
      'event-MediaStream-connecting'><a href=
      "#event-mediastream-connecting">connecting</a></code> at the <code><a>PeerConnection</a></code> object.</p>
       -->

      
    <table class="parameters"><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">message</td><td class="prmType"><code><a>DOMString</a></code></td><td class="prmNullFalse">✘</td><td class="prmOptFalse">✘</td><td class="prmDesc"></td></tr></table><div><em>Return type: </em><code><a>void</a></code></div></dd><dt id="widl-PeerConnection-removeStream-void-MediaStream-stream"><code>removeStream</code></dt><dd>
      <p>Stops sending the given stream to the remote peer.</p>

      <p>When the other peer stops sending a stream in this manner, a <code title="event-MediaStream-removestream"><a href="#event-mediastream-removestream">removestream</a></code> event is fired at the
      <code><a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a></code> object.</p>

      <p>When the <dfn id="dom-peerconnection-removestream"><code title="">removeStream()</code></dfn> method
      is invoked, the user agent <em class="rfc2119" title="must">must</em> run the following steps:</p>

      <ol>
        <li>
          <p>Let <var>stream</var> be the method’s argument.</p>
        </li>

        <li>
          <p>If the <code><a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a></code> object’s
          <a href="#peerconnection-readiness-state"><code>PeerConnection</code> readiness
          state</a> is <code><a href="#widl-PeerConnection-CLOSED">CLOSED</a></code> (3), throw an
          <code>INVALID_STATE_ERR</code> exception.</p>
        </li>

        <li>
          <p>If <var>stream</var> is not in the <code><a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a></code> object’s <code title="dom-PeerConnection-localStreams"><a href="#widl-PeerConnection-localStreams">localStreams</a></code> object, then abort
          these steps.</p>
        </li>

        <li>
          <p>Remove <var>stream</var> from the <code><a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a></code> object’s <code title="dom-PeerConnection-localStreams"><a href="#widl-PeerConnection-localStreams">localStreams</a></code> object.</p>
        </li>

        <li>
          <p>Return from the method.</p>
        </li>

        <li>
          <p>Have the <code><a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a></code>remove the
          media stream for <var>stream</var> the next time the user agent
          <span title="provide a stable state">provides a stable state</span>. Any other
          pending stream additions and removals <em class="rfc2119" title="must">must</em> be processed at the same time.</p>
        </li>
<!--  section 9.1.1.2  -->

      </ol>
    <table class="parameters"><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">stream</td><td class="prmType"><code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code></td><td class="prmNullFalse">✘</td><td class="prmOptFalse">✘</td><td class="prmDesc"></td></tr></table><div><em>Return type: </em><code><a>void</a></code></div></dd></dl></div><div id="constants-1" class="section"><h4><span class="secno">4.1.3 </span>Constants</h4><dl class="constants"><dt id="widl-PeerConnection-ACTIVE"><code>ACTIVE</code> of type <span class="idlConstType"><a>unsigned short</a></span></dt><dd> A connection has been formed and if any media streams were
    successfully negotiated, any relevant media can be streaming.</dd><dt id="widl-PeerConnection-CLOSED"><code>CLOSED</code> of type <span class="idlConstType"><a>unsigned short</a></span></dt><dd>The <code><a href="#dom-peerconnection-close">close()</a></code> method has been invoked.</dd><dt id="widl-PeerConnection-CLOSING"><code>CLOSING</code> of type <span class="idlConstType"><a>unsigned short</a></span></dt><dd>The object is starting to shut down after the  <code><a href="#dom-peerconnection-close">close()</a></code> method has been invoked.</dd><dt id="widl-PeerConnection-ICE_CHECKING"><code>ICE_CHECKING</code> of type <span class="idlConstType"><a>unsigned short</a></span></dt><dd>The ICE Agent is checking candidates but has not yet found a connection
   that works.</dd><dt id="widl-PeerConnection-ICE_CLOSED"><code>ICE_CLOSED</code> of type <span class="idlConstType"><a>unsigned short</a></span></dt><dd>The ICE Agent is terminating and will no longer repined to STUN
 connectivity checks.</dd><dt id="widl-PeerConnection-ICE_COMPLETED"><code>ICE_COMPLETED</code> of type <span class="idlConstType"><a>unsigned short</a></span></dt><dd>The ICE Agent has finished checking all candidates and a connection has
     been formed.</dd><dt id="widl-PeerConnection-ICE_CONNECTED"><code>ICE_CONNECTED</code> of type <span class="idlConstType"><a>unsigned short</a></span></dt><dd>The ICE Agent has found at least one candidate that works but is still checking.</dd><dt id="widl-PeerConnection-ICE_FAILED"><code>ICE_FAILED</code> of type <span class="idlConstType"><a>unsigned short</a></span></dt><dd>The ICE Agent has finished checking all candidates and no connection
     was worked.</dd><dt id="widl-PeerConnection-ICE_GATHERING"><code>ICE_GATHERING</code> of type <span class="idlConstType"><a>unsigned short</a></span></dt><dd>The ICE Agent is gather addresses that can be used.</dd><dt id="widl-PeerConnection-ICE_WAITING"><code>ICE_WAITING</code> of type <span class="idlConstType"><a>unsigned short</a></span></dt><dd>THE ICE Agent has complete gathering addresses and is waiting for candidates
      to start checking. </dd><dt id="widl-PeerConnection-NEGOTIATING"><code>NEGOTIATING</code> of type <span class="idlConstType"><a>unsigned short</a></span></dt><dd>The peerConenction object is attempting to get to the point wehre media
    can flow.</dd><dt id="widl-PeerConnection-NEW"><code>NEW</code> of type <span class="idlConstType"><a>unsigned short</a></span></dt><dd>The object was just created and its ICE and SDP Agent have not yet been started.</dd><dt id="widl-PeerConnection-SDP_GLARE"><code>SDP_GLARE</code> of type <span class="idlConstType"><a>unsigned short</a></span></dt><dd>Both side sent SDP offers at the same time and the SDP Agent is waiting to
        be able to retransmit the SDP offer.</dd><dt id="widl-PeerConnection-SDP_IDLE"><code>SDP_IDLE</code> of type <span class="idlConstType"><a>unsigned short</a></span></dt><dd>A valid offer anser pair has been exchanged and the SDP Agent is waiting
      for the next SDP transaction.</dd><dt id="widl-PeerConnection-SDP_WAITING"><code>SDP_WAITING</code> of type <span class="idlConstType"><a>unsigned short</a></span></dt><dd> The SDP Agent has sent an SDP offer and is waiting for a response.</dd></dl></div>

  <pre class="idl"><span class="idlImplements"><a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a> implements <a>EventTarget</a>;</span></pre><div class="idlImplementsDesc"><p>All instances of the <code><a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a></code> type are defined to also implement the <a>EventTarget</a> interface.</p></div>
  </div>

  <div id="signalingcallback" class="section">
  <h3><span class="secno">4.2 </span>SignalingCallback</h3>

  <pre class="idl"><span id="idl-def-SignalingCallback" class="idlInterface">[<span class="extAttr">Callback, NoInterfaceObject</span>]
interface <span class="idlInterfaceID">SignalingCallback</span> {
<span class="idlMethod">    <span class="idlMethType"><a>void</a></span> <span class="idlMethName"><a href="#widl-SignalingCallback-handleEvent-void-DOMString-message-PeerConnection-source">handleEvent</a></span> (<span class="idlParam"><span class="idlParamType"><a>DOMString</a></span> <span class="idlParamName">message</span></span>, <span class="idlParam"><span class="idlParamType"><a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a></span> <span class="idlParamName">source</span></span>);</span>
};</span>
</pre><div id="methods-8" class="section"><h4><span class="secno">4.2.1 </span>Methods</h4><dl class="methods"><dt id="widl-SignalingCallback-handleEvent-void-DOMString-message-PeerConnection-source"><code>handleEvent</code></dt><dd>Def TBD<table class="parameters"><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">message</td><td class="prmType"><code><a>DOMString</a></code></td><td class="prmNullFalse">✘</td><td class="prmOptFalse">✘</td><td class="prmDesc"></td></tr><tr><td class="prmName">source</td><td class="prmType"><code><a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a></code></td><td class="prmNullFalse">✘</td><td class="prmOptFalse">✘</td><td class="prmDesc"></td></tr></table><div><em>Return type: </em><code><a>void</a></code></div></dd></dl></div>
  </div>

  <div id="examples-1" class="section">
  <h3><span class="secno">4.3 </span>Examples</h3>

  <div>
    <p>When two peers decide they are going to set up a connection to each other, they
    both go through these steps. The STUN/TURN server configuration describes a server
    they can use to get things like their public IP address or to set up NAT traversal.
    They also have to send data for the signaling channel to each other using the same
    out-of-band mechanism they used to establish that they were going to communicate in
    the first place.</p>
    <pre class="example sh_javascript">// the first argument describes the STUN/TURN server configuration
var local = new PeerConnection('TURNS example.net', sendSignalingChannel);
local.signalingChannel(...); // if we have a message from the other side, pass it along here

// (aLocalStream is some LocalMediaStream object)
local.addStream(aLocalStream); // start sending video

function sendSignalingChannel(message) {
  ... // send message to the other side via the signaling channel
}

function receiveSignalingChannel (message) {
  // call this whenever we get a message on the signaling channel
  local.signalingChannel(message);
}

local.onaddstream = function (event) {
  // (videoElement is some &lt;video&gt; element)
  videoElement.src = URL.createObjectURL(event.stream);
};</pre>
  </div>
  </div>
  </div>

  <div id="peer-to-peer-data-api" class="section">
  
<!-- OddPage -->
<h2><span class="secno">5. </span>Peer-to-peer Data API</h2>

  <p>The Peer-to-peer Data API lets a web application send and receive generic application
  data peer-to-peer.</p>

  <div title="hello" class="note">
    <p>Open issues (this should not be considered as a complete list of open issues)</p>

    <ul>
      <li>Data channel setup signaling (signaling via SDP and application specific
      signaling channel or first channel via SDP and consecutive channels via internal
      signalling).</li>

      <li>What can be shared with the WebSocket API specification regarding actual interfaces.</li>
    </ul>

  </div>

  <div id="datachannel" class="section">
  <h3><span class="secno">5.1 </span>DataChannel</h3>

  <p>The <code><a href="#idl-def-DataChannel" class="idlType"><code>DataChannel</code></a></code> interface represents a bi-directional data channel
  between two peers. A <code><a href="#idl-def-DataChannel" class="idlType"><code>DataChannel</code></a></code> is created via a factory method on a
  <code><a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a></code> object. The corresponding <code><a href="#idl-def-DataChannel" class="idlType"><code>DataChannel</code></a></code>
  object is then dispatched at the other peer if the channel setup was successful.</p>

  <p>Each <code><a href="#idl-def-DataChannel" class="idlType"><code>DataChannel</code></a></code> has an associated <dfn id="dfn-underlying-data-transport">underlying data transport</dfn>
  that is used to transport actual data to the other peer. The transport properties of the
  <a href="#dfn-underlying-data-transport" class="internalDFN">underlying data transport</a>, such as reliability mode, is configured by the peer taking
  the initiative to create the channel. The receiving peer cannot change any transport properties
  of a offered data channel. The actual wire protocol between the peers is out of the scope for
  this specification.</p>

  <p>A <code><a href="#idl-def-DataChannel" class="idlType"><code>DataChannel</code></a></code> created with
  <code><a href="#dom-peerconnection-createdatachannel">createDataChannel()</a></code> <em class="rfc2119" title="must">must</em>
  initially be in the <code><a href="#widl-DataChannel-CONNECTING">CONNECTING</a></code> (0) state.
  If the <code><a href="#idl-def-DataChannel" class="idlType"><code>DataChannel</code></a></code> object’s <a href="#dfn-underlying-data-transport" class="internalDFN">underlying data transport</a> is
  successfully set up, the user agent <em class="rfc2119" title="must">must</em> <a href="#announce-datachannel-open">announce the
  <code>DataChannel</code> as open</a>.</p>

  <p>When the user agent is to <dfn id="announce-datachannel-open">announce a
  <code>DataChannel</code> as open</dfn>, the user agent <em class="rfc2119" title="must">must</em> queue a task to run
  the following steps:</p>

  <ol>
    <li>
      <p>If the associated <code><a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a></code> object’s
      <a href="#peerconnection-readiness-state"><code>PeerConnection</code> readiness
      state</a> is <code><a href="#widl-PeerConnection-CLOSED">CLOSED</a></code> (3),
      abort these steps.</p>
    </li>

    <li>
      <p>Let <var>channel</var> be the <code><a href="#idl-def-DataChannel" class="idlType"><code>DataChannel</code></a></code> object to be announced.</p>
    </li>

    <li>
      <p>Set <var>channel</var>’s <code><a href="#dom-datachannel-readystate">readyState</a></code>
      attribute to <code><a href="#widl-DataChannel-OPEN">OPEN</a></code> (1).</p>
    </li>

    <li>
      <p><a>Fire a simple event</a> named <code>
      <a href="#event-datachannel-open">open</a></code> at <var>channel</var>.</p>
    </li>
  </ol>

  <p>When an <a href="#dfn-underlying-data-transport" class="internalDFN">underlying data transport</a> has been established, the user agent, of the
  peer that did not initiate the creation process <em class="rfc2119" title="must">must</em> queue a task to run the following steps:</p>

  <ol>
    <li>
      <p>If the associated <code><a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a></code> object’s
      <a href="#peerconnection-readiness-state"><code>PeerConnection</code> readiness
      state</a> is <code><a href="#widl-PeerConnection-CLOSED">CLOSED</a></code> (3),
      abort these steps.</p>
    </li>

    <li>
      <p>Let <var>configuration</var> be an information bundle with key-value pairs,
      received from the other peer as a part of the process to establish the <a>underlying
      data channel</a>.</p>
    </li>

    <li>
      <p>Let <var>channel</var> be a newly created <code><a href="#idl-def-DataChannel" class="idlType"><code>DataChannel</code></a></code>
      object.</p>
    </li>

    <li>
      <p>Initialize <var>channel</var>’s <code><a href="#dom-datachannel-label">label</a>
      </code> attribute to value that corresponds to the &quot;<code>label</code>&quot; key in
      <var>configuration</var>.</p>
    </li>

    <li>
      <p>Initialize <var>channel</var>’s <code><a href="#dom-datachannel-reliable">reliable</a>
      </code> attribute to true.</p>
    </li>

    <li>
      <p>If <var>configuration</var> contains a key named &quot;<code>reliable</code>&quot;, set
      <var>channel</var>’s <code><a href="#dom-datachannel-reliable">reliable</a></code>
      attribute to the corresponding value.</p>
    </li>

    
<!-- li>
      <p>Have the user agent <a href="#announce-datachannel-open">announce
      <var>connection</var> as open</a>.</p>
    </li -->


    <li>
      <p>Set <var>channel</var>’s <code><a href="#dom-datachannel-readystate">readyState</a></code>
      attribute to <code><a href="#widl-DataChannel-OPEN">OPEN</a></code> (1).</p>
    </li>

    <li>
      <p><a href="#fire-a-datachannel-event" class="internalDFN">Fire a datachannel event</a> named <code>
      <a href="#event-peerconnection-datachannel">datachannel</a></code> with <var>channel</var>
      at the <code><a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a></code> object.</p>
    </li>
  </ol>

  <p>When the <dfn id="tear-down-data-transport">process of tearing down a
  <code><a href="#idl-def-DataChannel" class="idlType"><code>DataChannel</code></a></code> object’s <a href="#dfn-underlying-data-transport" class="internalDFN">underlying data transport</a></dfn> is
  initiated, the user agent <em class="rfc2119" title="must">must</em> run the following steps:</p>

  <ol>
    <li>
      <p>If the associated <code><a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a></code> object’s
      <a href="#peerconnection-readiness-state"><code>PeerConnection</code> readiness
      state</a> is <code><a href="#widl-PeerConnection-CLOSED">CLOSED</a></code> (3),
      abort these steps.</p>
    </li>

    <li>
      <p>Let <var>channel</var> be the <code><a href="#idl-def-DataChannel" class="idlType"><code>DataChannel</code></a></code> object which is
      about to be closed.</p>
    </li>

    <li>
      <p>If <var>channel</var>’s <code><a href="#dom-datachannel-readystate">readyState</a></code>
      is <code><a href="#widl-DataChannel-CLOSED">CLOSING</a></code> (2) or
      <code><a href="#widl-DataChannel-CLOSED">CLOSED</a></code> (3), then abort these steps.</p>
    </li>

    <li>
      <p>Set <var>channel</var>’s <code><a href="#dom-datachannel-readystate">readyState</a></code>
      attribute to <code><a href="#widl-DataChannel-CLOSING">CLOSING</a></code> (2).</p>
    </li>

    <li>
      <p>Queue a task to run the following steps:</p>
    </li>

    <ol>
      <li>
        <p>Close <var>channel</var>’s <a href="#dfn-underlying-data-transport" class="internalDFN">underlying data transport</a>.</p>

        <div class="note">The data transport protocol will specify what happens to, e.g. buffered data,
        when the data transport is closed.</div>
      </li>

      <li>
        <p>Set <var>channel</var>’s <code><a href="#dom-datachannel-readystate">readyState</a></code>
        attribute to <code><a href="#widl-DataChannel-CLOSED">CLOSED</a></code> (3).</p>
      </li>

      <li>
        <p>Fire a simple event named <code title="event-DataChannel-close"><a href="#event-datachannel-close">close</a></code> at
        <var>channel</var>.</p>
      </li>
    </ol>
  </ol>

  <pre class="idl"><span id="idl-def-DataChannel" class="idlInterface">interface <span class="idlInterfaceID">DataChannel</span> {
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a>DOMString</a></span>      <span class="idlAttrName"><a href="#widl-DataChannel-label">label</a></span>;</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a>boolean</a></span>        <span class="idlAttrName"><a href="#widl-DataChannel-reliable">reliable</a></span>;</span>
<span class="idlConst">    const <span class="idlConstType"><a>unsigned short</a></span> <span class="idlConstName"><a href="#widl-DataChannel-CONNECTING">CONNECTING</a></span> = <span class="idlConstValue">0</span>;</span>
<span class="idlConst">    const <span class="idlConstType"><a>unsigned short</a></span> <span class="idlConstName"><a href="#widl-DataChannel-OPEN">OPEN</a></span> = <span class="idlConstValue">1</span>;</span>
<span class="idlConst">    const <span class="idlConstType"><a>unsigned short</a></span> <span class="idlConstName"><a href="#widl-DataChannel-CLOSING">CLOSING</a></span> = <span class="idlConstValue">2</span>;</span>
<span class="idlConst">    const <span class="idlConstType"><a>unsigned short</a></span> <span class="idlConstName"><a href="#widl-DataChannel-CLOSED">CLOSED</a></span> = <span class="idlConstValue">3</span>;</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a>unsigned short</a></span> <span class="idlAttrName"><a href="#widl-DataChannel-readyState">readyState</a></span>;</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a>unsigned long</a></span>  <span class="idlAttrName"><a href="#widl-DataChannel-bufferedAmount">bufferedAmount</a></span>;</span>
<span class="idlAttribute">    [<span class="extAttr">TreatNonCallableAsNull</span>]
             attribute <span class="idlAttrType"><a>Function</a>?</span>      <span class="idlAttrName"><a href="#widl-DataChannel-onopen">onopen</a></span>;</span>
<span class="idlAttribute">    [<span class="extAttr">TreatNonCallableAsNull</span>]
             attribute <span class="idlAttrType"><a>Function</a>?</span>      <span class="idlAttrName"><a href="#widl-DataChannel-onerror">onerror</a></span>;</span>
<span class="idlAttribute">    [<span class="extAttr">TreatNonCallableAsNull</span>]
             attribute <span class="idlAttrType"><a>Function</a>?</span>      <span class="idlAttrName"><a href="#widl-DataChannel-onclose">onclose</a></span>;</span>
<span class="idlMethod">    <span class="idlMethType"><a>void</a></span> <span class="idlMethName"><a href="#widl-DataChannel-close-void">close</a></span> ();</span>
<span class="idlAttribute">    [<span class="extAttr">TreatNonCallableAsNull</span>]
             attribute <span class="idlAttrType"><a>Function</a>?</span>      <span class="idlAttrName"><a href="#widl-DataChannel-onmessage">onmessage</a></span>;</span>
<span class="idlAttribute">             attribute <span class="idlAttrType"><a>DOMString</a></span>      <span class="idlAttrName"><a href="#widl-DataChannel-binaryType">binaryType</a></span>;</span>
<span class="idlMethod">    <span class="idlMethType"><a>void</a></span> <span class="idlMethName"><a href="#widl-DataChannel-send-void-DOMString-data">send</a></span> (<span class="idlParam"><span class="idlParamType"><a>DOMString</a></span> <span class="idlParamName">data</span></span>);</span>
<span class="idlMethod">    <span class="idlMethType"><a>void</a></span> <span class="idlMethName"><a href="#widl-DataChannel-send-void-ArrayBuffer-data">send</a></span> (<span class="idlParam"><span class="idlParamType"><a>ArrayBuffer</a></span> <span class="idlParamName">data</span></span>);</span>
<span class="idlMethod">    <span class="idlMethType"><a>void</a></span> <span class="idlMethName"><a href="#widl-DataChannel-send-void-Blob-data">send</a></span> (<span class="idlParam"><span class="idlParamType"><a>Blob</a></span> <span class="idlParamName">data</span></span>);</span>
};</span>
</pre><div id="attributes-5" class="section"><h4><span class="secno">5.1.1 </span>Attributes</h4><dl class="attributes"><dt id="widl-DataChannel-binaryType"><code>binaryType</code> of type <span class="idlAttrType"><a>DOMString</a></span></dt><dd>
      <p>
        </p><div class="note">FIXME: align behavior with WebSocket API</div>
      <p></p>
    </dd><dt id="widl-DataChannel-bufferedAmount"><code>bufferedAmount</code> of type <span class="idlAttrType"><a>unsigned long</a></span>, readonly</dt><dd>
      <p>
        </p><div class="note">FIXME: align behavior with WebSocket API</div>
      <p></p>
    </dd><dt id="widl-DataChannel-label"><code>label</code> of type <span class="idlAttrType"><a>DOMString</a></span>, readonly</dt><dd>
      <p>The <dfn id="dom-datachannel-label"><code>DataChannel.label</code></dfn> attribute
      represents a label that can be used to distinguish this <code><a href="#idl-def-DataChannel" class="idlType"><code>DataChannel</code></a></code>
      object from other <code><a href="#idl-def-DataChannel" class="idlType"><code>DataChannel</code></a></code> objects. The attribute <em class="rfc2119" title="must">must</em> return
      the value to which it was set when the <code><a href="#idl-def-DataChannel" class="idlType"><code>DataChannel</code></a></code> object was created.</p>
    </dd><dt id="widl-DataChannel-onclose"><code>onclose</code> of type <span class="idlAttrType"><a>Function</a></span>, nullable</dt><dd>This event handler, of type <code><a href="#event-datachannel-close">close</a></code>, <em class="rfc2119" title="must">must</em> be supported by all objects
    implementing the <code><a href="#idl-def-DataChannel" class="idlType"><code>DataChannel</code></a></code> interface.</dd><dt id="widl-DataChannel-onerror"><code>onerror</code> of type <span class="idlAttrType"><a>Function</a></span>, nullable</dt><dd>This event handler, of type <code><a href="#event-datachannel-error">error</a></code>, <em class="rfc2119" title="must">must</em> be supported by all objects
    implementing the <code><a href="#idl-def-DataChannel" class="idlType"><code>DataChannel</code></a></code> interface.</dd><dt id="widl-DataChannel-onmessage"><code>onmessage</code> of type <span class="idlAttrType"><a>Function</a></span>, nullable</dt><dd>This event handler, of type <code><a href="#event-datachannel-message">message</a></code>, <em class="rfc2119" title="must">must</em> be supported by all objects
    implementing the <code><a href="#idl-def-DataChannel" class="idlType"><code>DataChannel</code></a></code> interface.</dd><dt id="widl-DataChannel-onopen"><code>onopen</code> of type <span class="idlAttrType"><a>Function</a></span>, nullable</dt><dd>This event handler, of type <code><a href="#event-datachannel-open">open</a></code>, <em class="rfc2119" title="must">must</em> be supported by all objects
    implementing the <code><a href="#idl-def-DataChannel" class="idlType"><code>DataChannel</code></a></code> interface.</dd><dt id="widl-DataChannel-readyState"><code>readyState</code> of type <span class="idlAttrType"><a>unsigned short</a></span>, readonly</dt><dd>
      <p>The <dfn id="dom-datachannel-readystate"><code>DataChannel.readyState</code></dfn>
      attribute represents the state of the <code><a href="#idl-def-DataChannel" class="idlType"><code>DataChannel</code></a></code> object. It <em class="rfc2119" title="must">must</em>
      return the value to which the user agent last set it (as defined by the processing
      model algorithms). The attribute can have the following values: <dfn id="dfn-connecting">CONNECTING</dfn>,
      <dfn id="dfn-open">OPEN</dfn>, <dfn id="dfn-closing">CLOSING</dfn> or <dfn id="dfn-closed">CLOSED</dfn>.</p>
    </dd><dt id="widl-DataChannel-reliable"><code>reliable</code> of type <span class="idlAttrType"><a>boolean</a></span>, readonly</dt><dd>
      <p>The <dfn id="dom-datachannel-reliable"><code>DataChannel.reliable</code></dfn>
      attribute returns true if the <code><a href="#idl-def-DataChannel" class="idlType"><code>DataChannel</code></a></code> is reliable, and false
      otherwise. The attribute <em class="rfc2119" title="must">must</em> return the value to which it was set when the
      <code><a href="#idl-def-DataChannel" class="idlType"><code>DataChannel</code></a></code> was created.</p>
    </dd></dl></div><div id="methods-9" class="section"><h4><span class="secno">5.1.2 </span>Methods</h4><dl class="methods"><dt id="widl-DataChannel-close-void"><code>close</code></dt><dd>
      <p>Closes the <code><a href="#idl-def-DataChannel" class="idlType"><code>DataChannel</code></a></code>. It may be called regardless if the
      <code><a href="#idl-def-DataChannel" class="idlType"><code>DataChannel</code></a></code> object was created by this peer or the remote peer.</p>

      <p>When the <dfn id="dom-peerconnection-close"><code>close()</code></dfn> method is
      called, the user agent <em class="rfc2119" title="must">must</em> initiate <a href="#tear-down-data-transport">the process
      of tearing down the <code></code></a><code><a href="#idl-def-DataChannel" class="idlType"><code>DataChannel</code></a></code> object’s <a href="#dfn-underlying-data-transport" class="internalDFN">underlying data
      transport</a>.</p>
    <div><em>No parameters.</em></div><div><em>Return type: </em><code><a>void</a></code></div></dd><dt id="widl-DataChannel-send-void-DOMString-data"><code>send</code></dt><dd>
      <p>
        </p><div class="note">FIXME: align behavior with WebSocket API</div>
      <p></p>
    <table class="parameters"><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">data</td><td class="prmType"><code><a>DOMString</a></code></td><td class="prmNullFalse">✘</td><td class="prmOptFalse">✘</td><td class="prmDesc"></td></tr></table><div><em>Return type: </em><code><a>void</a></code></div></dd><dt id="widl-DataChannel-send-void-ArrayBuffer-data"><code>send</code></dt><dd>
      <p>
        </p><div class="note">FIXME: align behavior with WebSocket API</div>
      <p></p>
    <table class="parameters"><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">data</td><td class="prmType"><code><a>ArrayBuffer</a></code></td><td class="prmNullFalse">✘</td><td class="prmOptFalse">✘</td><td class="prmDesc"></td></tr></table><div><em>Return type: </em><code><a>void</a></code></div></dd><dt id="widl-DataChannel-send-void-Blob-data"><code>send</code></dt><dd>
      <p>
        </p><div class="note">FIXME: align behavior with WebSocket API</div>
      <p></p>
    <table class="parameters"><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">data</td><td class="prmType"><code><a>Blob</a></code></td><td class="prmNullFalse">✘</td><td class="prmOptFalse">✘</td><td class="prmDesc"></td></tr></table><div><em>Return type: </em><code><a>void</a></code></div></dd></dl></div><div id="constants-2" class="section"><h4><span class="secno">5.1.3 </span>Constants</h4><dl class="constants"><dt id="widl-DataChannel-CLOSED"><code>CLOSED</code> of type <span class="idlConstType"><a>unsigned short</a></span></dt><dd>
      <p>The <a href="#dfn-underlying-data-transport" class="internalDFN">underlying data transport</a> has been closed or could not be established.</p>
    </dd><dt id="widl-DataChannel-CLOSING"><code>CLOSING</code> of type <span class="idlConstType"><a>unsigned short</a></span></dt><dd>
      <p>The process of closing down the <a href="#dfn-underlying-data-transport" class="internalDFN">underlying data transport</a> has started.</p>
    </dd><dt id="widl-DataChannel-CONNECTING"><code>CONNECTING</code> of type <span class="idlConstType"><a>unsigned short</a></span></dt><dd>
      <p>The user agent is attempting to establish the <a href="#dfn-underlying-data-transport" class="internalDFN">underlying data transport</a>.
      This is the initial state of a <code><a href="#idl-def-DataChannel" class="idlType"><code>DataChannel</code></a></code> object created with
      <code><a href="#dom-peerconnection-createdatachannel">createDataChannel()</a></code>.</p>
    </dd><dt id="widl-DataChannel-OPEN"><code>OPEN</code> of type <span class="idlConstType"><a>unsigned short</a></span></dt><dd>
      <p>The <a href="#dfn-underlying-data-transport" class="internalDFN">underlying data transport</a> is established and communication is possible.
      This is the initial state of a <code><a href="#idl-def-DataChannel" class="idlType"><code>DataChannel</code></a></code> object dispatched as a
      part of a <code><a href="#idl-def-DataChannelEvent" class="idlType"><code>DataChannelEvent</code></a></code>.</p>
    </dd></dl></div>

  
  <pre class="idl"><span id="idl-def-DataChannelInit" class="idlDictionary">dictionary <span class="idlDictionaryID">DataChannelInit</span> {
<span class="idlMember">    <span class="idlMemberType"><a>boolean</a></span> <span class="idlMemberName"><a href="#widl-DataChannelInit-reliable">reliable</a></span>;</span>
};</span>
</pre><div id="dictionary-datachannelinit-members" class="section"><h4><span class="secno">5.1.4 </span>Dictionary <a class="idlType" href="#idl-def-DataChannelInit"><code>DataChannelInit</code></a> Members</h4><dl class="dictionary-members"><dt id="widl-DataChannelInit-reliable"><code>reliable</code> of type <span class="idlMemberType"><a>boolean</a></span></dt><dd>-</dd></dl></div>

  </div>

  <div id="examples-2" class="section">
  <h3><span class="secno">5.2 </span>Examples</h3>

  <div>
    <p>This simple example shows how to create a DataChannel, register an event listener
    to handle incoming data, and how to send a message.</p>

    <pre class="example sh_javascript">var chan = peerConn.createDataChannel(&quot;mylabel&quot;);

chan.onmessage = function (evt) {
    // use evt.data
};

chan.send(&quot;hello&quot;);</pre>
  </div>

  <div>
    <p>This simple example shows how to register an event listener to handle the case when
    a remote peer creates a new DataChannel.</p>

    <pre class="example sh_javascript">peerConn.ondatachannel = function (evt) {
    var chan = evt.channel;

    chan.onmessage = function (evt) {
        // use evt.data
    };

    chan.onclose = function () {
        // remote side closed the data channel
    };
};</pre>
  </div>

  
<!-- div>
    <p>This simple example shows how configure two DataChannel objects for different purposes.</p>
    <pre  class='example sh_javascript'>
// the chat channel is reliable and not as prioritized as game data
var chatChan = peerConn.createDataChannel("chat", { "priority": 1 });

// the game data channel is prioritized and unreliable low latency channel for high performance
var gameDataChan = peerConn.createDataChannel("data", { "reliable": false, "priority": 10 });
    </pre>
  </div -->


  </div>

  </div>

  <div id="garbage-collection" class="section">
  
<!-- OddPage -->
<h2><span class="secno">6. </span>Garbage collection</h2>

  <p>A <code>Window</code> object <dfn id="concept-peerconnection-owner">has a strong reference</dfn> to any <code><a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a></code> objects created from the constructor whose
  global object is that <code>Window</code> object.</p>
<!--  we
  could be less strict here, e.g. dropping the reference when there’s
  no way for an event to be fired because there’s no event handlers
  registered and there’s no way for the remote peer to notice anything
  because no media is streaming; or e.g. dropping the reference when
  the object reaches the CLOSED state. But as dropping the reference
  in those cases is black-box indistinguishable from keeping the
  reference, I haven't bothered to work out the exact rules. If you do
  change this, see the /unloading document cleanup steps/.  -->

  </div>

  <div id="event-definitions" class="section">
  
<!-- OddPage -->
<h2><span class="secno">7. </span>Event definitions</h2>

  <div id="mediastreamtrackevent" class="section">
  <h3><span class="secno">7.1 </span>MediaStreamTrackEvent</h3>

  <p>The <code><a href="#event-mediastreamtracklist-addtrack">addtrack</a></code> and <code title="event-MediaStreamTracklist-removetrack"><a href="#event-mediastreamtracklist-removetrack">removetrack</a></code> events use the
  <code><a href="#idl-def-MediaStreamTrackEvent" class="idlType"><code>MediaStreamTrackEvent</code></a></code> interface.</p>

  <p><dfn title="Fire a track event" id="dfn-fire-a-track-event">Firing a track event
  named <var>e</var></dfn> with a <code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code> <var>track</var>
  means that an event with the name <var>e</var>, which does not bubble (except where
  otherwise stated) and is not cancelable (except where otherwise stated), and which
  uses the <code><a href="#idl-def-MediaStreamTrackEvent" class="idlType"><code>MediaStreamTrackEvent</code></a></code> interface with the
  <code><a href="#dom-mediastreamtrackevent-track">track</a></code> attribute set to <var>track</var>,
  <em class="rfc2119" title="must">must</em> be created and dispatched at the given target.</p>

  <pre class="idl"><span id="idl-def-MediaStreamTrackEvent" class="idlInterface">[<span class="extAttr">Constructor(DOMString type, optional MediaStreamTrackEventInit eventInitDict)</span>]
interface <span class="idlInterfaceID">MediaStreamTrackEvent</span> : <span class="idlSuperclass"><a>Event</a></span> {
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a>?</span> <span class="idlAttrName"><a href="#widl-MediaStreamTrackEvent-track">track</a></span>;</span>
};<br /><span id="idl-def-MediaStreamTrackEventInit" class="idlDictionary">dictionary <span class="idlDictionaryID">MediaStreamTrackEventInit</span> : <span class="idlSuperclass"><a>EventInit</a></span> {
<span class="idlMember">    <span class="idlMemberType"><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a>?</span> <span class="idlMemberName"><a href="#widl-MediaStreamTrackEventInit-track">track</a></span>;</span>
};</span></span>
</pre><div id="attributes-6" class="section"><h4><span class="secno">7.1.1 </span>Attributes</h4><dl class="attributes"><dt id="widl-MediaStreamTrackEvent-track"><code>track</code> of type <span class="idlAttrType"><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></span>, readonly, nullable</dt><dd>
      <p>The <dfn id="dom-mediastreamtrackevent-track"><code>track</code></dfn> attribute represents the
      <code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code> object associated with the
      event.</p>
    </dd></dl></div>
  <div id="dictionary-mediastreamtrackeventinit-members" class="section"><h4><span class="secno">7.1.2 </span>Dictionary <a class="idlType" href="#idl-def-MediaStreamTrackEventInit"><code>MediaStreamTrackEventInit</code></a> Members</h4><dl class="dictionary-members"><dt id="widl-MediaStreamTrackEventInit-track"><code>track</code> of type <span class="idlMemberType"><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></span>, nullable</dt><dd>
      <p>-</p>
    </dd></dl></div>
  </div>

  <div id="mediastreamevent" class="section">
  <h3><span class="secno">7.2 </span>MediaStreamEvent</h3>

  <p>The <code><a href="#event-mediastream-addstream">addstream</a></code> and <code title="event-MediaStream-removestream"><a href="#event-mediastream-removestream">removestream</a></code> events use the
  <code><a href="#idl-def-MediaStreamEvent" class="idlType"><code>MediaStreamEvent</code></a></code> interface.</p>

  <p><dfn title="fire a stream event" id="fire-a-stream-event">Firing a stream event
  named <var>e</var></dfn> with a <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> <var>stream</var> means that an event
  with the name <var>e</var>, which does not bubble (except where otherwise
  stated) and is not cancelable (except where otherwise stated), and which uses the
  <code><a href="#idl-def-MediaStreamEvent" class="idlType"><code>MediaStreamEvent</code></a></code> interface with the
  <code><a href="#dom-mediastreamevent-stream">stream</a></code> attribute set to <var title="">stream</var>, <em class="rfc2119" title="must">must</em> be created and dispatched at the given target.</p>

  <pre class="idl"><span id="idl-def-MediaStreamEvent" class="idlInterface">[<span class="extAttr">Constructor(DOMString type, optional MediaStreamEventInit eventInitDict)</span>]
interface <span class="idlInterfaceID">MediaStreamEvent</span> : <span class="idlSuperclass"><a>Event</a></span> {
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a>?</span> <span class="idlAttrName"><a href="#widl-MediaStreamEvent-stream">stream</a></span>;</span>
};<br /><span id="idl-def-MediaStreamEventInit" class="idlDictionary">dictionary <span class="idlDictionaryID">MediaStreamEventInit</span> : <span class="idlSuperclass"><a>EventInit</a></span> {
<span class="idlMember">    <span class="idlMemberType"><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a>?</span> <span class="idlMemberName"><a href="#widl-MediaStreamEventInit-stream">stream</a></span>;</span>
};</span></span>
</pre><div id="attributes-7" class="section"><h4><span class="secno">7.2.1 </span>Attributes</h4><dl class="attributes"><dt id="widl-MediaStreamEvent-stream"><code>stream</code> of type <span class="idlAttrType"><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></span>, readonly, nullable</dt><dd>
      <p>The <dfn id="dom-mediastreamevent-stream"><code>stream</code></dfn> attribute represents the
      <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> object associated with the
      event.</p>
    </dd></dl></div>
  <div id="dictionary-mediastreameventinit-members" class="section"><h4><span class="secno">7.2.2 </span>Dictionary <a class="idlType" href="#idl-def-MediaStreamEventInit"><code>MediaStreamEventInit</code></a> Members</h4><dl class="dictionary-members"><dt id="widl-MediaStreamEventInit-stream"><code>stream</code> of type <span class="idlMemberType"><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></span>, nullable</dt><dd>
      <p>-</p>
    </dd></dl></div>
  </div>

<div id="datachannelevent" class="section">
  <h3><span class="secno">7.3 </span>DataChannelEvent</h3>

  <p>The <code><a href="#event-peerconnection-datachannel">datachannel</a></code> event use
  the <code><a href="#idl-def-DataChannelEvent" class="idlType"><code>DataChannelEvent</code></a></code> interface.</p>

  <p><dfn title="fire a datachannel event" id="fire-a-datachannel-event">Firing a datachannel
  event named <var>e</var></dfn> with a <code><a href="#idl-def-DataChannel" class="idlType"><code>DataChannel</code></a></code> <var>channel</var>
  means that an event with the name <var>e</var>, which does not bubble (except where
  otherwise stated) and is not cancelable (except where otherwise stated), and which uses the
  <code><a href="#idl-def-DataChannelEvent" class="idlType"><code>DataChannelEvent</code></a></code> interface with the
  <code><a href="#dom-datachannelevent-channel">channel</a></code> attribute set to
  <var>channel</var>, <em class="rfc2119" title="must">must</em> be created and dispatched at the given target.</p>

  <pre class="idl"><span id="idl-def-DataChannelEvent" class="idlInterface">[<span class="extAttr">Constructor(DOMString type, optional DataChannelEventInit eventInitDict)</span>]
interface <span class="idlInterfaceID">DataChannelEvent</span> : <span class="idlSuperclass"><a>Event</a></span> {
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a href="#idl-def-DataChannel" class="idlType"><code>DataChannel</code></a>?</span> <span class="idlAttrName"><a href="#widl-DataChannelEvent-channel">channel</a></span>;</span>
};<br /><span id="idl-def-DataChannelEventInit" class="idlDictionary">dictionary <span class="idlDictionaryID">DataChannelEventInit</span> : <span class="idlSuperclass"><a>EventInit</a></span> {
<span class="idlMember">    <span class="idlMemberType"><a href="#idl-def-DataChannel" class="idlType"><code>DataChannel</code></a>?</span> <span class="idlMemberName"><a href="#widl-DataChannelEventInit-channel">channel</a></span>;</span>
};</span></span>
</pre><div id="attributes-8" class="section"><h4><span class="secno">7.3.1 </span>Attributes</h4><dl class="attributes"><dt id="widl-DataChannelEvent-channel"><code>channel</code> of type <span class="idlAttrType"><a href="#idl-def-DataChannel" class="idlType"><code>DataChannel</code></a></span>, readonly, nullable</dt><dd>
      <p>The <dfn id="dom-datachannelevent-channel"><code>channel</code></dfn> attribute represents the
      <code><a href="#idl-def-DataChannel" class="idlType"><code>DataChannel</code></a></code> object associated with the
      event.</p>
    </dd></dl></div>
  <div id="dictionary-datachanneleventinit-members" class="section"><h4><span class="secno">7.3.2 </span>Dictionary <a class="idlType" href="#idl-def-DataChannelEventInit"><code>DataChannelEventInit</code></a> Members</h4><dl class="dictionary-members"><dt id="widl-DataChannelEventInit-channel"><code>channel</code> of type <span class="idlMemberType"><a href="#idl-def-DataChannel" class="idlType"><code>DataChannel</code></a></span>, nullable</dt><dd>-</dd></dl></div>
  </div>

  </div>

  <div class="informative section" id="event-summary">
  
<!-- OddPage -->
<h2><span class="secno">8. </span>Event summary</h2><p><em>This section is non-normative.</em></p>

  <p>The following event fires on <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code>
  objects:</p>

  <table>
    <tbody><tr>
      <th>Event name</th>

      <th>Interface</th>

      <th>Fired when...</th>
    </tr>

    </tbody><tbody>
      <tr>
        <td><dfn id="event-mediastream-ended"><code>ended</code></dfn></td>

        <td><code>Event</code></td>

        <td>The <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> <a href="#dfn-finished" class="internalDFN">finished</a> as a result of all tracks
        in the <code><a href="#idl-def-MediaStream" class="idlType"><code>MediaStream</code></a></code> <a title="ended" href="#event-mediastreamtrack-ended" class="internalDFN">ending</a>.</td>
      </tr>
    </tbody>
  </table>

  <p>The following event fires on <code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code>
  objects:</p>

  <table>
    <tbody><tr>
      <th>Event name</th>

      <th>Interface</th>

      <th>Fired when...</th>
    </tr>

    </tbody><tbody>
      <tr>
        <td><dfn id="event-mediastreamtrack-muted"><code>muted</code></dfn></td>

        <td><code>Event</code></td>

        <td>The <code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code> object’s source is temporarily
        unable to provide data.</td>
      </tr>
      <tr>
        <td><dfn id="event-mediastreamtrack-unmuted"><code>unmuted</code></dfn></td>

        <td><code>Event</code></td>

        <td>The <code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code> object’s source is live again
        after having been temporarily unable to provide data.</td>
      </tr>
      <tr>
        <td><dfn id="event-mediastreamtrack-ended"><code>ended</code></dfn></td>

        <td><code>Event</code></td>

        <td>The <code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code> object’s source will no longer
        provide any data, either because the user revoked the permissions, or because the
        source device has been ejected, or because the remote peer stopped sending data,
        or because the <code><a href="#dom-mediastream-stop">stop()</a></code> method was invoked.</td>
      </tr>
    </tbody>
  </table>

  <p>The following event fires on <code><a href="#idl-def-MediaStreamTrackList" class="idlType"><code>MediaStreamTrackList</code></a></code>
  objects:</p>

  <table>
    <tbody><tr>
      <th>Event name</th>

      <th>Interface</th>

      <th>Fired when...</th>
    </tr>

    </tbody><tbody>
      <tr>
        <td><dfn id="event-mediastreamtracklist-addtrack"><code>addtrack</code></dfn></td>

        <td><code><a href="#idl-def-MediaStreamTrackEvent" class="idlType"><code>MediaStreamTrackEvent</code></a></code></td>

        <td>A new <code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code> has been added to this list.</td>
      </tr>
      <tr>
        <td><dfn id="event-mediastreamtracklist-removetrack"><code>removetrack</code></dfn></td>

        <td><code><a href="#idl-def-MediaStreamTrackEvent" class="idlType"><code>MediaStreamTrackEvent</code></a></code></td>

        <td>A <code><a href="#idl-def-MediaStreamTrack" class="idlType"><code>MediaStreamTrack</code></a></code> has been removed from this list.</td>
      </tr>
    </tbody>
  </table>

  <p>The following events fire on <code><a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a></code> objects:</p>

  <table>
    <tbody><tr>
      <th>Event name</th>

      <th>Interface</th>

      <th>Fired when...</th>
    </tr>

    </tbody><tbody>
      <tr>
        <td><dfn id="event-mediastream-connecting"><code>connecting</code></dfn></td>

        <td><code>Event</code></td>

        <td>The ICE Agent has begun negotiating with the peer. This can happen multiple
        times during the lifetime of the <code><a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a></code> object.</td>
      </tr>

      <tr>
        <td><dfn id="event-mediastream-open"><code>open</code></dfn></td>

        <td><code>Event</code></td>

        <td>The ICE Agent has finished negotiating with the peer.</td>
      </tr>
<!-- 
        <tr>
          <td><dfn title="event-MediaStream-error"><code>error</code></dfn></td>
          <td><code>Event</code></td>
          <td></td>
        </tr>
        <tr>
          <td><dfn title="event-MediaStream-close"><code>close</code></dfn></td>
          <td><code>Event</code></td>
          <td>The <code title="dom-PeerConnection-close">close()</code> method was
            called. </td>
          </tr>
           -->


      <tr> 
<!--  '_'-suffix avoids name collision with DataChannel interface (ReSpec bug?) -->

        <td><dfn id="event-peerconnection-datachannel"><code>datachannel_</code></dfn></td>

        <td><code><a href="#idl-def-DataChannelEvent" class="idlType"><code>DataChannelEvent</code></a></code></td>

        <td>The other peer successfully created a new <code><a href="#idl-def-DataChannel" class="idlType"><code>DataChannel</code></a></code> object.</td>
      </tr>

      <tr>
        <td><dfn id="event-mediastream-addstream"><code>addstream</code></dfn></td>

        <td><code><a href="#idl-def-MediaStreamEvent" class="idlType"><code>MediaStreamEvent</code></a></code></td>

        <td>A new stream has been added to the <code title="dom-PeerConnection-remoteStreams"><a href="#widl-PeerConnection-remoteStreams">remoteStreams</a></code> array.</td>
      </tr>

      <tr>
        <td><dfn id="event-mediastream-removestream"><code>removestream</code></dfn></td>

        <td><code><a href="#idl-def-MediaStreamEvent" class="idlType"><code>MediaStreamEvent</code></a></code></td>

        <td>A stream has been removed from the <code title="dom-PeerConnection-remoteStreams"><a href="#widl-PeerConnection-remoteStreams">remoteStreams</a></code> array.</td>
      </tr>
    </tbody>
  </table>

  <p>The following events fire on <code><a href="#idl-def-DataChannel" class="idlType"><code>DataChannel</code></a></code> objects:</p>

  <table>
    <tbody><tr>
      <th>Event name</th>

      <th>Interface</th>

      <th>Fired when...</th>
    </tr>

    </tbody><tbody>

      <tr>
        <td><dfn id="event-datachannel-open"><code>open</code></dfn></td>

        <td><code>Event</code></td>

        <td>The <code><a href="#idl-def-DataChannel" class="idlType"><code>DataChannel</code></a></code> object’s <a href="#dfn-underlying-data-transport" class="internalDFN">underlying data transport</a>
        has been established (or re-established).</td>
      </tr>

      <tr>
        <td><dfn id="event-datachannel-error"><code>error</code></dfn></td>

        <td><code>Event</code></td>

        <td>-</td>
      </tr>

      <tr>
        <td><dfn id="event-datachannel-close"><code>close</code></dfn></td>

        <td><code>Event</code></td>

        <td>The <code><a href="#idl-def-DataChannel" class="idlType"><code>DataChannel</code></a></code> object’s <a href="#dfn-underlying-data-transport" class="internalDFN">underlying data transport</a>
        has was closed.</td>
      </tr>

      <tr>
        <td><dfn id="event-datachannel-message"><code>message</code></dfn></td>

        <td><code>MessageEvent</code></td>

        <td>A message was successfully received.</td>
      </tr>

    </tbody>
  </table>
  </div>

  <div id="application-html-peer-connection-data" class="section">
  
<!-- OddPage -->
<h2 id="application_html-peer-connection-data"><span class="secno">9. </span>application/html-peer-connection-data</h2>

  <p>This registration is for community review and will be submitted to the IESG for
  review, approval, and registration with IANA.</p>
<!-- 
   To: ietf-types@iana.org
   Subject: Registration of media type application/html-peer-connection-data
   -->


  <dl>
    <dt>Type name:</dt>

    <dd>application</dd>

    <dt>Subtype name:</dt>

    <dd>html-peer-connection-data</dd>

    <dt>Required parameters:</dt>

    <dd>No <em class="rfc2119" title="required">required</em> parameters</dd>

    <dt>Optional parameters:</dt>

    <dd>No <em class="rfc2119" title="optional">optional</em> parameters</dd>

    <dt>Encoding considerations:</dt>

    <dd>This MIME type defines a binary protocol format which uses UTF-8 for text
    encoding.</dd>

    <dt>Security considerations:</dt>

    <dd>
      <p>This format is used for encoding UDP packets transmitted by potentially hostile
      Web page content via a trusted user agent to a destination selected by a
      potentially hostile remote server. To prevent this mechanism from being abused for
      cross-protocol attacks, all the data in these packets is masked so as to appear to
      be random noise. The intent of this masking is to reduce the potential attack
      scenarios to those already possible previously.</p>

      <p>However, this feature still allows random data to be sent to destinations that
      might not normally have been able to receive them, such as to hosts within the
      victim’s intranet. If a service within such an intranet cannot handle receiving UDP
      packets containing random noise, it might be vulnerable to attack from this
      feature.</p>
    </dd>

    <dt>Interoperability considerations:</dt>

    <dd>Rules for processing both conforming and non-conforming content are defined in
    this specification.</dd>

    <dt>Published specification:</dt>

    <dd>This document is the relevant specification.</dd>

    <dt>Applications that use this media type:</dt>

    <dd>This type is only intended for use with SDP. [<cite><a class="bibref" rel="biblioentry" href="#bib-SDP">SDP</a></cite>]</dd>

    <dt>Additional information:</dt>

    <dd>
      <dl>
        <dt>Magic number(s):</dt>

        <dd>No sequence of bytes can uniquely identify data in this format, as all data
        in this format is intentionally masked to avoid cross-protocol attacks.</dd>

        <dt>File extension(s):</dt>

        <dd>This format is not for use with files.</dd>

        <dt>Macintosh file type code(s):</dt>

        <dd>This format is not for use with files.</dd>
      </dl>
    </dd>

    <dt>Person &amp; email address to contact for further information:</dt>

    <dd>Daniel C. Burnett &lt;dburnett@voxeo.com&gt;</dd>

    <dt>Intended usage:</dt>

    <dd>Common</dd>

    <dt>Restrictions on usage:</dt>

    <dd>No restrictions apply.</dd>

    <dt>Author:</dt>

    <dd>Daniel C. Burnett &lt;dburnett@voxeo.com&gt;</dd>

    <dt>Change controller:</dt>

    <dd><acronym title="World Wide Web Consortium">W3C</acronym></dd>
  </dl>

  <p>Fragment identifiers cannot be used with <code><a href="#application_html-peer-connection-data">application/html-peer-connection-data</a></code>
  as URLs cannot be used to identify streams that use this format.</p>
  </div>

  <div id="change-log" class="section">
  
<!-- OddPage -->
<h2><span class="secno">10. </span>Change Log</h2>
  <p> This section will be removed before publication. </p>

  <h3 id="to-do-items"> To Do Items </h3>
  <p> Need a way to indicate the type of the SDP when passing SDP strings. </p>

  <h3 id="changes-since-12-january-2012"> Changes since 12 January 2012</h3>
  <ol>
    <li> Clarified what relation of Stream, Track, and Channel. </li>
  </ol>

  <h3 id="changes-since-17-october-2011"> Changes since 17 October 2011</h3>
  <ol>
    <li>Tweak the introduction text and add a reference to the IETF RTCWEB group.</li>
    <li>Changed the first argument to getUserMedia to be an object.</li>
    <li>Added a MediaStreamHints object as a second argument to PeerConnection.addStream.</li>
    <li>Added AudioMediaStreamTrack class and DTMF interface.</li>
  </ol>

  <h3 id="changes-since-23-august-2011"> Changes since 23 August 2011</h3>
  <ol>
    <li> Separated the SDP and ICE Agent into separate agents and added explicit
 state attributes for each. </li>
    <li> Removed the send method from PeerConenction and associated callback function. </li>
    <li>Modified MediaStream() constructor to take a list of MediaStreamTrack objects instead
    of a MediaStream. Removed text about MediaStream parent and child relationship.</li>
    <li>Added abstract.</li>
    <li>Moved a few paragraphs from the MediaStreamTrack.label section to the
    MediaStream.label section (where they belong).</li>
    <li>Split MediaStream.tracks into MediaStream.audioTracks and MediaStream.videoTracks.</li>
    <li>Removed a sentence that implied that track access is limited to LocalMediaStream.</li>
    <li>Updated a few getUserMedia()-examples to use MediaStreamOptions.</li>
    <li>Replaced calls to URL.getObjectURL() with URL.createObjectURL() in example code.</li>
    <li>Fixed some broken getUserMedia() links.</li>
    <li>Introduced state handling on MediaStreamTrack (removed state handling from MediaStream).</li>
    <li>Reintroduced onended on MediaStream to simplify checking if all tracks are ended.</li>
    <li>Aligned the MediaStreamTrack ended event dispatching behavior with that of MediaStream.</li>
    <li>Updated the LocalMediaStream.stop() algorithm to implicitly use the end track algorithm.</li>
    <li>Replaced an occurrence the term finished track with ended track (to align with
    rest of spec).</li>
    <li>Moved (and extended) the explanation about track references and media sources from
    LocalMediaStream to MediaStreamTrack.</li>
    <li>Removed section &quot;Obtaining local multimedia content&quot;.</li>
    <li>Updated getUserMedia() calls in examples (changes in Media Capture TF spec).</li>
    <li>Introduced MediaStreamTrackList interface with support for adding and removing tracks.</li>
    <li>Updated the algorithm that is run when PeerConnection receives a stream (create new
    stream when negotiated instead of when data arrives).</li>
    <li>Removed some left-overs from the old Data Stream API.</li>
    <li>Initial import of new Data API.</li>
    <li>Renamed &quot;underlying data channel&quot; to &quot;underlying data transport&quot;. Fixed closing procedures.
    Fixed some typos. </li>
 </ol>
  
  </div>

 
  <div class="appendix section" id="acknowledgements">
  
<!-- OddPage -->
<h2><span class="secno">A. </span>Acknowledgements</h2>

  <p>The editors wish to thank the Working Group chairs, Harald Alvestrand and Stefan
  Håkansson, for their support.</p>
  </div>


<div id="references" class="appendix section">
<!-- OddPage -->
<h2><span class="secno">B. </span>References</h2><div id="normative-references" class="section"><h3><span class="secno">B.1 </span>Normative references</h3><dl class="bibliography"><dt id="bib-FILE-API">[FILE-API]</dt><dd>Arun Ranganathan; Jonas Sicking. <a href="http://www.w3.org/TR/2011/WD-FileAPI-20111020/"><cite>File API.</cite></a> 20 October 2011. W3C Working Draft. (Work in progress.) URL: <a href="http://www.w3.org/TR/2011/WD-FileAPI-20111020/">http://www.w3.org/TR/2011/WD-FileAPI-20111020/</a> 
</dd><dt id="bib-GETUSERMEDIA">[GETUSERMEDIA]</dt><dd>D. Burnett, A. Narayanan. <a href="http://dev.w3.org/2011/webrtc/editor/getusermedia.html"><cite>getusermedia: Getting access to local devices that can generate multimedia streams</cite></a> 22 December 2011. W3C Editors draft (Work in progress.) URL: <a href="http://dev.w3.org/2011/webrtc/editor/getusermedia.html">http://dev.w3.org/2011/webrtc/editor/getusermedia.html</a> 
</dd><dt id="bib-ICE">[ICE]</dt><dd>J. Rosenberg. <a href="http://tools.ietf.org/html/rfc5245"><cite>Interactive Connectivity Establishment (ICE): A Protocol for Network Address Translator (NAT) Traversal for Offer/Answer Protocols.</cite></a> April 2010. Internet RFC 5245. URL: <a href="http://tools.ietf.org/html/rfc5245">http://tools.ietf.org/html/rfc5245</a>
</dd><dt id="bib-RFC2119">[RFC2119]</dt><dd>S. Bradner. <a href="http://www.ietf.org/rfc/rfc2119.txt"><cite>Key words for use in RFCs to Indicate Requirement Levels.</cite></a> March 1997. Internet RFC 2119.  URL: <a href="http://www.ietf.org/rfc/rfc2119.txt">http://www.ietf.org/rfc/rfc2119.txt</a> 
</dd><dt id="bib-SDP">[SDP]</dt><dd>J. Rosenberg, H. Schulzrinne. <a href="http://tools.ietf.org/html/rfc3264"><cite>An Offer/Answer Model with the Session Description Protocol (SDP).</cite></a> June 2002. Internet RFC 3264. URL: <a href="http://tools.ietf.org/html/rfc3264">http://tools.ietf.org/html/rfc3264</a>
</dd><dt id="bib-SDPLABEL">[SDPLABEL]</dt><dd>O. Levin, G. Camarillo. <a href="http://tools.ietf.org/html/rfc4574"><cite>The Session Description Protocol (SDP) Label Attribute.</cite></a> August 2006. Internet RFC 4574. URL: <a href="http://tools.ietf.org/html/rfc4574">http://tools.ietf.org/html/rfc4574</a>
</dd><dt id="bib-STUN">[STUN]</dt><dd>J. Rosenberg, R. Mahy, P. Matthews, D. Wing. <a href="http://tools.ietf.org/html/rfc5389"><cite>Session Traversal Utilities for NAT (STUN).</cite></a> October 2008. Internet RFC 5389. URL: <a href="http://tools.ietf.org/html/rfc5389">http://tools.ietf.org/html/rfc5389</a>
</dd><dt id="bib-TURN">[TURN]</dt><dd>P. Mahy, P. Matthews, J. Rosenberg. <a href="http://tools.ietf.org/html/rfc5766"><cite>Traversal Using Relays around NAT (TURN): Relay Extensions to Session Traversal Utilities for NAT (STUN).</cite></a> April 2010. Internet RFC 5766. URL: <a href="http://tools.ietf.org/html/rfc5766">http://tools.ietf.org/html/rfc5766</a>
</dd><dt id="bib-WEBIDL">[WEBIDL]</dt><dd>Cameron McCormack. <a href="http://www.w3.org/TR/2011/WD-WebIDL-20110927/"><cite>Web IDL.</cite></a> 27 September 2011. W3C Working Draft. (Work in progress.) URL: <a href="http://www.w3.org/TR/2011/WD-WebIDL-20110927/">http://www.w3.org/TR/2011/WD-WebIDL-20110927/</a> 
</dd></dl></div><div id="informative-references" class="section"><h3><span class="secno">B.2 </span>Informative references</h3><p>No informative references.</p></div></div></body></html>
