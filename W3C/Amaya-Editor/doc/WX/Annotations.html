<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="content-type" content="text/html; charset=iso-8859-1" />
  <meta name="GENERATOR" content="amaya 9.52, see http://www.w3.org/Amaya/" />
  <title>Annotating documents</title>
  <style type="text/css">
  </style>
  <link href="style.css" rel="stylesheet" type="text/css" />
</head>

<body xml:lang="en" lang="en">

<div class="PageHead">
Amaya<img alt="logo" src="../../resources/icons/22x22/logo.png" class="logo"
/> 

<p class="nav"><a href="MakeBook.html" accesskey="p"><img alt="previous"
src="../../resources/icons/misc/left.png" /> </a><a href="Manual.html"
accesskey="t"><img alt="top" src="../../resources/icons/misc/up.png" /></a>
<a href="Configure.html" accesskey="n"><img alt="next"
src="../../resources/icons/misc/right.png" /></a></p>
</div>

<div id="page_body" class="PageBody">
<h2 id="Annotation">Annotating documents</h2>

<h3 id="What">What is an annotation?</h3>

<p>Annotations are comments, notes, explanations, or other types of external
remarks that can be attached to a Web document or to a selected part of a
document. As they are external, it is possible to annotate any Web document
independently, without needing to edit the document itself. From a technical
point of view, annotations are usually seen as <strong>metadata,</strong> as
they give additional information about an existing piece of data. Amaya uses
a special <strong><a href="http://www.w3.org/RDF/">RDF</a></strong> <a
href="http://www.w3.org/2000/10/annotation-ns">annotation schema</a> for
describing annotations.</p>

<p>Annotations can be stored locally or in one or more <em>annotation
servers</em>. When a document is browsed, Amaya queries each of these
servers, requesting the annotations related to that document. Amaya presents
an annotation with an icon <img src="../images/annot.png"
alt="Pencil representing an annotation" /> that is visually embedded in the
document. If you single-click this icon, the text that was annotated is
highlighted. If you double-clicks the icon, the annotation text and other
metadata are presented in a separate window.</p>

<p style="text-align: center"></p>

<p>An annotation has many properties including:</p>
<ul>
  <li>Physical location: is the annotation stored in the local file system or
    in an annotation server</li>
  <li>Scope: is the annotation associated to a whole document or just to a
    fragment.</li>
  <li>Annotation type: 'Annotation', 'Comment', 'Query', ...</li>
</ul>

<h3 id="About">Local and remote annotations</h3>

<p>Amaya can store annotation data in a <span>local file system</span>
(<em>local annotations</em>) or it can store annotations remotely, on
annotations servers accessed through the Web (<em>remote
annotations</em>).</p>

<p>You do not need a server to create local annotations. Local annotations
are stored under your <a href="Configure.html#AmayaHome">AmayaHome</a>
directory, in a special directory called <code>annotations</code>, and they
can be seen only by their owner (according to the system access right
setup).</p>

<p>This directory contains three kinds of files:</p>
<ul>
  <li><code>annot.index:</code> Associates URLs with the files containing the
    metadata of the annotations.</li>
  <li><code>index + random suffix:</code> Stores the metadata of the
    annotations related to a given URL. The metadata is specified in RDF. <br
    />
  </li>
  <li><code>annot + random suffix.html:</code> Contains the body of an
    annotation, stored as XHTML.</li>
</ul>

<p>At any time, you can convert a <em>local annotation</em> to a shared one
by choosing <strong>Post to server</strong> from the
<strong>Tools/Annotations</strong> submenu. Once this is completed, the local
annotation is deleted because it has been moved to an annotation server.</p>

<h4 id="Remote">Remote annotations</h4>

<p>You can store <em>remote annotations</em> in annotation servers so that
the annotations can be downloaded by anyone having the correct access rights,
such as is the case of other HTML documents.</p>

<p>Remote annotations are referred to as shared or public annotations,
because they can be seen by other people. If you wish to install your own
annotation server, please refer to <span style="color:blue"><a
href="http://www.w3.org/1999/02/26-modules/User/Annotations-HOWTO.html">Annotation-Server-HOWTO</a></span>.</p>

<h3 id="Creating">Creating an annotation</h3>

<p>Before creating an annotation, it is recommended to set some parameters in
the Preferences (see section <a href="Configure.html#Configurin1">Configuring
annotations</a>).</p>

<p>Amaya supports two kinds of annotations: annotations that apply to a whole
document and annotations that apply to a specific position or a selection in
a document.</p>
<ul>
  <li>To annotate an entire document, choose <strong>Annotate
    document</strong> from the <strong>Tools/Annotations</strong> menu. </li>
  <li>To annotate a position, put the insertion point at that position in the
    document and choose <strong>Annotate selection</strong> from the
    <strong>Tools/Annotations</strong> menu. </li>
  <li>To annotate a selection, make a selection in the document and choose
    <strong>Annotate selection</strong> from the
    <strong>Tools/Annotations</strong> menu.</li>
</ul>

<p>After these operations, an annotation document  is displayed, with some
inital metadata and an empty body.</p>

<p>The metadata consists of the <strong>title of the annotation</strong>, the
<strong>author's name</strong>, the <strong>title</strong> of the annotated
document, the <strong>annotation type</strong>, the <strong>creation
date</strong>, and the <strong>last modification date</strong>.</p>

<p>Some of the metadata fields have special properties:</p>
<ul>
  <li>The <strong>Source document</strong> field is a link that points back
    to the annotated text. If the user double-clicks it, as when following
    any other link with Amaya, the annotated document will be displayed with
    the annotated text highlighted.</li>
  <li>The <strong>Annotation types</strong> field lets you classify the
    annotation and change its type. Double-click on the text
    <strong>Annotation type</strong> to see the list of types available.</li>
  <li>The <strong>Last modified</strong> field is updated automatically each
    time that an annotation is saved.</li>
</ul>

<p>Below the header area is the annotation body area. It shows the current
content and can be edited like any other HTML document.</p>

<p>Some commands that can be applied to a document in the Amaya document
window also can be applied to an annotation document in the Annotation
window. For example, the body of an annotation can be printed by choosing
<strong>Print</strong> from the <strong>File</strong> menu, or reloaded by
choosing <strong>Reload document</strong> from the <strong>File</strong>
menu.</p>

<h3 id="Saving">Saving an annotation</h3>

<p>Saving an annotation is the same as saving any other document with Amaya:
choose <span class="Link"><strong>Save</strong></span> from the
<strong>File</strong> menu (or use its equivalent shortcut or button) or
press the <strong>Save</strong> button.</p>

<p>Local annotations are saved to the annotations directory and remote
annotations are saved to the annotation post server, if the user has write
access.</p>

<p>To convert a local annotation into a shared one, choose <strong>Post to
server</strong> from the <strong>Tools/Annotations</strong> menu to save the
annotation to the Post server as defined in the <span
class="Link"><strong>Configuration for Annotations</strong> dialog</span>. If
this operation is successful, the local annotation will be removed and future
<strong>Save</strong> operations will go directly to that annotation
server.</p>

<h3 id="Deleting">Deleting an annotation</h3>

<p>The <strong>Delete</strong> command on the
<strong>Tools/Annotations</strong> submenu enables you to delete the current
annotation. You can invoke this command from an annotation window.</p>

<p>You can also delete an annotation from the annotated document. Select the
icon of the annotation and call the same command from the
<strong>Tools</strong> menu in the annotated document window.</p>

<h3 id="Loading">Loading and presenting annotations</h3>

<p>The <strong>Tools/Annotations/Load</strong> command tells Amaya to load
the annotations that are associated with the URL of the current document.
Amaya will query the annotation servers, using the settings from
<strong>Preferences/Annotations</strong>, and ask for any relevant
annotation.</p>

<p>Annotations may also be loaded automatically whenever a new page is viewed
by selecting the <strong>Autoload remote annotations</strong> check box in
<strong>Preferences/Annotations</strong>.</p>

<p>Querying an annotation server returns all the annotations that are
associated with a document.</p>

<h3 id="Annotation3">Annotations in the Links window</h3>

<p>The link view of the annotated document shows all the annotations.</p>

<p>As with the document window, annotations are identified by a pencil icon.
A single-click on the icon selects the annotated text in the document window
and a double-click opens the annotation.</p>

<h3 id="Replying">Replying to annotations / discussion thread</h3>

<p>Annotations can be seen as comments to web pages. The
<strong>Tools/Annotations/Reply to annotation</strong> command enhances the
collaborative workspace by allowing users to reply to annotations or to other
replies.</p>

<p>The <strong>Reply to annotation</strong> command of the
<strong>Tools/Annotations</strong> submenu lets you create a reply to an
existing annotation or to a reply. You can invoke this command from an open
annotation or a reply window.</p>

<p>As a result a new annotation document opens. The fields in a reply
annotation can be edited just like in any other annotation as explained under
<a href="#Creating">Creating an annotation</a>.</p>

<p>When the reply is ready, you can post it to a server with the
<strong>Tools/Annotations/Post to server</strong> command or you can save it
locally using the <strong>File/Save</strong> command. To delete a reply, you
can use the <strong>Tools/Annotations/Delete</strong> command.</p>

<p>Replies can also be annotated like any other document, as explained in <a
href="#Creating">Creating an annotation</a>.</p>

<p>All replies related to an annotation are shown at the bottom of this
annotation, in a thread section. Each item in the thread gives the date of
the reply, the author, and the title of the reply. </p>

<p>The content of any of these replies can be retrieved by double clicking
the replies in the thread. The selected reply is highlighted and presented in
a reply tab. When another selection is made the same reply tab is used.</p>

<h4 id="Known">Known issues: incomplete thread</h4>

<p>There is no way to control which replies should be posted. In an ideal
world, it should not be possible to save a reply to a reply if the previous
reply was not saved in the same server. Likewise, if you delete a reply, you
should delete all replies to this annotation. Not doing that leads to having
fragments of threads that cannot be correctly attached in the thread.</p>

<p>For example, let R1 be the reply to annotation A1 and R2 a reply to R1. If
you post R1, and let R2 be stored locally, then when you browse A1 and only
download its local annotations, you will only see R2.</p>

<p>At this point, Amaya does not know that R1 exists, so it assumes that R2
has lost its parent. We identify these "orphan" threads by putting a question
mark symbol <strong>?</strong> in front of them. If later one, Amaya finds
new thread items, for example, if you download R1, Amaya will then sort the
thread view, inserting the threads as appropriately. In our example, R2 will
become a child of R1, as expected.</p>

<h3 id="Configurin">Configuring annotation icons</h3>

<h4 id="User-defin">User-definable icons by Annotation type (aka "dynamic
icons")</h4>

<p>The icon used to mark the location of an annotation within an annotated
document may be changed by the user. The icon that denotes an annotation is
chosen as a property of the annotation type. By including an RDF property of
each annotation type you wish to use, you select the icon associated with
annotations of that type.</p>

<p>The sample configuration associates the following icons:</p>

<table>
  <tbody>
    <tr>
      <td width="35"><img src="../../amaya/advice.png" alt="Advice" /> </td>
      <td>Advice</td>
    </tr>
    <tr>
      <td width="35"><img src="../../amaya/change.png" alt="Change" /> </td>
      <td>Change</td>
    </tr>
    <tr>
      <td width="35"><img src="../../amaya/annot.png" alt="Comment" /> </td>
      <td>Comment</td>
    </tr>
    <tr>
      <td width="35"><img src="../../amaya/example.png" alt="Example" /> </td>
      <td>Example</td>
    </tr>
    <tr>
      <td width="35"><img src="../../amaya/explanation.png" alt="Explanation"
        /> </td>
      <td>Explanation</td>
    </tr>
    <tr>
      <td width="35"><img src="../../amaya/question.png" alt="Question" />
      </td>
      <td>Question</td>
    </tr>
    <tr>
      <td width="35"><img src="../../amaya/seealso.png" alt="SeeAlso" /> </td>
      <td>SeeAlso</td>
    </tr>
  </tbody>
</table>

<p>The property name for adding annotation icons is <a
href="http://www.w3.org/2001/10/typeIcon#usesIcon">http://www.w3.org/2001/10/typeIcon#usesIcon</a>.
For instance, to specify an icon named file:///home/question-icon.jpg for
annotations that have type <a
href="http://www.w3.org/2000/10/annotationType#Question">http://www.w3.org/2000/10/annotationType#Question</a>
you would enter the following RDF/XML into a file that Amaya reads at startup
is:</p>
<pre>&lt;rdf:RDF
   xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
   xmlns:i = "http://www.w3.org/2001/10/typeIcon#"&gt;
&lt;rdf:Description rdf:about="http://www.w3.org/2000/10/annotationType#Question"&gt;
  &lt;i:usesIcon rdf:resource="file:///home/question-icon.jpg" /&gt;
&lt;/rdf:Description&gt;
&lt;/rdf:RDF&gt;</pre>

<p>The simplest way to get such RDF loaded into Amaya at startup is to
include the file in the <code>config/annot.schemas</code> file in the Amaya
program directory. In order to preserve this file so that it will not be
overwritten when you install a new version of Amaya, you should copy the
<code>config/annot.schemas</code> file into your personal <code><a
href="Configure.html#AmayaHome">AmayaHome</a></code> directory.</p>

<p>You may list as many RDF files as you want in <code>annot.schemas</code>.
See the comments in the file included in the Amaya kit for more details.</p>

<p>A sample file named <code>typeIcon.rdf</code> declares unique icons for
each annotation type declared in the <a
href="http://www.w3.org/2000/10/annotationType#">http://www.w3.org/2000/10/annotationType#</a>
namespace. To experiment with user-defined icons, it may be easiest to copy
this <code>typeIcon.rdf</code> into another directory and modify it. Copy
<code>annot.schemas</code> to your AmayaHome directory and change the line
near the end to point to your revised icon definition file.</p>

<p>Amaya supports JPEG, PNG, and GIF bitmap graphics formats for icon images.
The icon URI may only be a file: URI; that is, the icon must appear in a
local or mounted directory to Amaya. Two special forms of non-file: URIs are
supported. If the file path name starts with <code>$THOTDIR</code> or
<code>$APP_HOME</code> then the corresponding Amaya installation directory or
personal Amaya home directory is substituted into the pathname.</p>

<h3 id="Known1">Known issues with annotations and modified documents</h3>

<p>When you use annotations with live documents (documents whose contents can
be modified), you may encounter two kinds of problems: <strong>orphan
annotations</strong> and <strong>misleading annotations</strong>. To explain
these problems, we must first describe how Amaya attaches annotations to
documents.</p>

<p>Amaya uses <strong><a
href="http://www.w3.org/XML/Linking">XPointer</a></strong> to indicate where
an annotation should be attached to a document. XPointers are based in the
structure of the document. To build an XPointer for a selection, for example,
Amaya starts from the first point of the selection and walk backwards through
the document's structure, until it finds the root of the document. If an
element has an <code>id</code> attribute, Amaya stops building the XPointer
and considers the element with the <code>id</code> attribute value to be the
beginning of that XPointer.</p>

<p>For example, if you look at the HTML source for this document, you'll
notice that this section is enclosed within a <code>div</code> element that
has an <code>id</code> attribute with the value "Issues" Here's an extract of
the source code:</p>
<pre>  &lt;div id="Issues"&gt;
  &lt;h1&gt;Issues with ....&lt;/h1&gt;
  &lt;p&gt;If you are using...&lt;/p&gt;
  &lt;p&gt;Amaya uses &lt;strong&gt;XPointer&lt;/strong&gt;...&lt;/p&gt;
  ...
  &lt;/div&gt;</pre>

<p>This XPointer points to the second paragraph:
<code>xpointer(id("Issues")/p[2])</code></p>

<p>The above XPointer points to the second <code>p</code> element, from the
element parent having an <code>id</code> attribute with value "Issues".</p>

<p>Note that the use of the <code>id</code> attribute enables the document
author to move the entire reference by the XPointer to another location
within the document, without needing to update the XPointer. The XPointer
does not depend on the elements that precede it.</p>

<h4 id="Orphan">Orphan annotations</h4>

<p>An annotation becomes an "orphan" when it can no longer be attached to a
document, that is, when the XPointer does not resolve to any element in the
structure. This happens when a document's structure is modified. Amaya
displays a warning if it detects any orphan annotations while downloading a
set of annotations from an annotation server. All orphan annotations are
visible from the Links view and are associated with an icon that shows a
question mark superimposed on the annotation pencil <img
src="../images/annotorp.png" alt="Orphan annotation icon" /> .</p>

<h4 id="Misleading">Misleading annotations</h4>

<p>An annotation becomes "misleading" when it points to a wrong piece of
information. This problem is common when you annotate a portion of text that
may change. In the first release, Amaya does not warn the user if an
annotation is misleading. A future release may notify users of the potential
for an annotation to be misleading.</p>

<h4 id="What1">What can you do to avoid this?</h4>

<p>As the author of a document, try to use the <code>ID</code> attribute in
strategic places, for example, inside <code>&lt;DIV&gt;</code> and
<code>p</code> elements. For example:</p>
<pre>  &lt;p id="Amaya"&gt;Amaya uses...&lt;/p&gt;</pre>

<p>An XPointer that points to this paragraph is:
<code>xpointer(id("Amaya"))</code></p>

<p>Thus, the Xpointer will point to the same paragraph, regardless of its
position in the document's structure.</p>

<p>Amaya enables you to automatically associate with or remove an
<code>ID</code> attribute to/from a set of elements by choosing
<strong>Add/Remove IDs</strong> from the <strong>Links</strong> menu.</p>

<p></p>
</div>
</body>
</html>
