<!DOCTYPE html>
<html lang="en" dir="ltr" typeof="bibo:Document " prefix="bibo: http://purl.org/ontology/bibo/ w3p: http://www.w3.org/2001/02pd/rec54#">
<head><meta lang="" property="dc:language" content="en">
  <title>Web NFC API</title>
  <meta charset="UTF-8">
  
  
  <style>
    table.simple { border: 1px solid #000; }
    table.simple td { border-right: 1px solid #000; }
  </style>
<style>/*****************************************************************
 * ReSpec 3 CSS
 * Robin Berjon - http://berjon.com/
 *****************************************************************/

/* --- INLINES --- */
em.rfc2119 { 
    text-transform:     lowercase;
    font-variant:       small-caps;
    font-style:         normal;
    color:              #900;
}

h1 acronym, h2 acronym, h3 acronym, h4 acronym, h5 acronym, h6 acronym, a acronym,
h1 abbr, h2 abbr, h3 abbr, h4 abbr, h5 abbr, h6 abbr, a abbr {
    border: none;
}

dfn {
    font-weight:    bold;
}

a.internalDFN {
    color:  inherit;
    border-bottom:  1px solid #99c;
    text-decoration:    none;
}

a.externalDFN {
    color:  inherit;
    border-bottom:  1px dotted #ccc;
    text-decoration:    none;
}

a.bibref {
    text-decoration:    none;
}

cite .bibref {
    font-style: normal;
}

code {
    color:  #C83500;
}

/* --- TOC --- */
.toc a, .tof a {
    text-decoration:    none;
}

a .secno, a .figno {
    color:  #000;
}

ul.tof, ol.tof {
    list-style: none outside none;
}

.caption {
    margin-top: 0.5em;
    font-style:   italic;
}

/* --- TABLE --- */
table.simple {
    border-spacing: 0;
    border-collapse:    collapse;
    border-bottom:  3px solid #005a9c;
}

.simple th {
    background: #005a9c;
    color:  #fff;
    padding:    3px 5px;
    text-align: left;
}

.simple th[scope="row"] {
    background: inherit;
    color:  inherit;
    border-top: 1px solid #ddd;
}

.simple td {
    padding:    3px 10px;
    border-top: 1px solid #ddd;
}

.simple tr:nth-child(even) {
    background: #f0f6ff;
}

/* --- DL --- */
.section dd > p:first-child {
    margin-top: 0;
}

.section dd > p:last-child {
    margin-bottom: 0;
}

.section dd {
    margin-bottom:  1em;
}

.section dl.attrs dd, .section dl.eldef dd {
    margin-bottom:  0;
}

@media print {
    .removeOnSave {
        display: none;
    }
}
</style><style>/* --- EXAMPLES --- */
div.example-title {
    min-width: 7.5em;
    color: #b9ab2d;
}
div.example-title span {
    text-transform: uppercase;
}
aside.example, div.example, div.illegal-example {
    padding: 0.5em;
    margin: 1em 0;
    position: relative;
    clear: both;
}
div.illegal-example { color: red }
div.illegal-example p { color: black }
aside.example, div.example {
    padding: .5em;
    border-left-width: .5em;
    border-left-style: solid;
    border-color: #e0cb52;
    background: #fcfaee;
}

aside.example div.example {
    border-left-width: .1em;
    border-color: #999;
    background: #fff;
}
aside.example div.example div.example-title {
    color: #999;
}
</style><style>/* --- ISSUES/NOTES --- */
div.issue-title, div.note-title , div.ednote-title, div.warning-title {
    padding-right:  1em;
    min-width: 7.5em;
    color: #b9ab2d;
}
div.issue-title { color: #e05252; }
div.note-title, div.ednote-title { color: #2b2; }
div.warning-title { color: #f22; }
div.issue-title span, div.note-title span, div.ednote-title span, div.warning-title span {
    text-transform: uppercase;
}
div.note, div.issue, div.ednote, div.warning {
    margin-top: 1em;
    margin-bottom: 1em;
}
.note > p:first-child, .ednote > p:first-child, .issue > p:first-child, .warning > p:first-child { margin-top: 0 }
.issue, .note, .ednote, .warning {
    padding: .5em;
    border-left-width: .5em;
    border-left-style: solid;
}
div.issue, div.note , div.ednote,  div.warning {
    padding: 1em 1.2em 0.5em;
    margin: 1em 0;
    position: relative;
    clear: both;
}
span.note, span.ednote, span.issue, span.warning { padding: .1em .5em .15em; }

.issue {
    border-color: #e05252;
    background: #fbe9e9;
}
.note, .ednote {
    border-color: #52e052;
    background: #e9fbe9;
}

.warning {
    border-color: #f11;
    border-right-width: .2em;
    border-top-width: .2em;
    border-bottom-width: .2em;
    border-style: solid;
    background: #fbe9e9;
}

.warning-title:before{
    content: "âš "; /*U+26A0 WARNING SIGN*/
    font-size: 3em;
    float: left;
    height: 100%;
    padding-right: .3em;
    vertical-align: top;
    margin-top: -0.5em;
}

li.task-list-item {
    list-style: none;
}

input.task-list-item-checkbox {
    margin: 0 0.35em 0.25em -1.6em;
    vertical-align: middle;
}
</style><style>/* HIGHLIGHTS */
code.prettyprint {
    color:  inherit;
}

/* this from google-code-prettify */
.pln{color:#000}@media screen{.str{color:#080}.kwd{color:#008}.com{color:#800}.typ{color:#606}.lit{color:#066}.pun,.opn,.clo{color:#660}.tag{color:#008}.atn{color:#606}.atv{color:#080}.dec,.var{color:#606}.fun{color:red}}@media print,projection{.str{color:#060}.kwd{color:#006;font-weight:bold}.com{color:#600;font-style:italic}.typ{color:#404;font-weight:bold}.lit{color:#044}.pun,.opn,.clo{color:#440}.tag{color:#006;font-weight:bold}.atn{color:#404}.atv{color:#060}}ol.linenums{margin-top:0;margin-bottom:0}li.L0,li.L1,li.L2,li.L3,li.L5,li.L6,li.L7,li.L8{list-style-type:none}li.L1,li.L3,li.L5,li.L7,li.L9{background:#eee}
</style><style>/* --- WEB IDL --- */
pre.idl {
    border-top: 1px solid #90b8de;
    border-bottom: 1px solid #90b8de;
    padding:    1em;
    line-height:    120%;
}

pre.idl::before {
    content:    "WebIDL";
    display:    block;
    width:      150px;
    background: #90b8de;
    color:  #fff;
    font-family:    sans-serif;
    padding:    3px;
    font-weight:    bold;
    margin: -1em 0 1em -1em;
}

.idlType {
    color:  #ff4500;
    font-weight:    bold;
    text-decoration:    none;
}

/*.idlModule*/
/*.idlModuleID*/
/*.idlInterface*/
.idlInterfaceID, .idlDictionaryID, .idlCallbackID, .idlEnumID {
    font-weight:    bold;
    color:  #005a9c;
}
a.idlEnumItem {
    color:  #000;
    border-bottom:  1px dotted #ccc;
    text-decoration: none;
}

.idlSuperclass {
    font-style: italic;
    color:  #005a9c;
}

/*.idlAttribute*/
.idlAttrType, .idlFieldType, .idlMemberType {
    color:  #005a9c;
}
.idlAttrName, .idlFieldName, .idlMemberName {
    color:  #ff4500;
}
.idlAttrName a, .idlFieldName a, .idlMemberName a {
    color:  #ff4500;
    border-bottom:  1px dotted #ff4500;
    text-decoration: none;
}

/*.idlMethod*/
.idlMethType, .idlCallbackType {
    color:  #005a9c;
}
.idlMethName {
    color:  #ff4500;
}
.idlMethName a {
    color:  #ff4500;
    border-bottom:  1px dotted #ff4500;
    text-decoration: none;
}

/*.idlCtor*/
.idlCtorName {
    color:  #ff4500;
}
.idlCtorName a {
    color:  #ff4500;
    border-bottom:  1px dotted #ff4500;
    text-decoration: none;
}

/*.idlParam*/
.idlParamType {
    color:  #005a9c;
}
.idlParamName, .idlDefaultValue {
    font-style: italic;
}

.extAttr {
    color:  #666;
}

/*.idlSectionComment*/
.idlSectionComment {
    color: gray;
}

/*.idlIterable*/
.idlIterableKeyType, .idlIterableValueType {
    color:  #005a9c;
}

/*.idlMaplike*/
.idlMaplikeKeyType, .idlMaplikeValueType {
    color:  #005a9c;
}

/*.idlConst*/
.idlConstType {
    color:  #005a9c;
}
.idlConstName {
    color:  #ff4500;
}
.idlConstName a {
    color:  #ff4500;
    border-bottom:  1px dotted #ff4500;
    text-decoration: none;
}

/*.idlException*/
.idlExceptionID {
    font-weight:    bold;
    color:  #c00;
}

.idlTypedefID, .idlTypedefType {
    color:  #005a9c;
}

.idlRaises, .idlRaises a.idlType, .idlRaises a.idlType code, .excName a, .excName a code {
    color:  #c00;
    font-weight:    normal;
}

.excName a {
    font-family:    monospace;
}

.idlRaises a.idlType, .excName a.idlType {
    border-bottom:  1px dotted #c00;
}

.excGetSetTrue, .excGetSetFalse, .prmNullTrue, .prmNullFalse, .prmOptTrue, .prmOptFalse {
    width:  45px;
    text-align: center;
}
.excGetSetTrue, .prmNullTrue, .prmOptTrue { color:  #0c0; }
.excGetSetFalse, .prmNullFalse, .prmOptFalse { color:  #c00; }

.idlImplements a {
    font-weight:    bold;
}

dl.attributes, dl.methods, dl.constants, dl.constructors, dl.fields, dl.dictionary-members {
    margin-left:    2em;
}

.attributes dt, .methods dt, .constants dt, .constructors dt, .fields dt, .dictionary-members dt {
    font-weight:    normal;
}

.attributes dt code, .methods dt code, .constants dt code, .constructors dt code, .fields dt code, .dictionary-members dt code {
    font-weight:    bold;
    color:  #000;
    font-family:    monospace;
}

.attributes dt code, .fields dt code, .dictionary-members dt code {
    background:  #ffffd2;
}

.attributes dt .idlAttrType code, .fields dt .idlFieldType code, .dictionary-members dt .idlMemberType code {
    color:  #005a9c;
    background:  transparent;
    font-family:    inherit;
    font-weight:    normal;
    font-style: italic;
}

.methods dt code {
    background:  #d9e6f8;
}

.constants dt code {
    background:  #ddffd2;
}

.constructors dt code {
    background:  #cfc;
}

.attributes dd, .methods dd, .constants dd, .constructors dd, .fields dd, .dictionary-members dd {
    margin-bottom:  1em;
}

table.parameters, table.exceptions {
    border-spacing: 0;
    border-collapse:    collapse;
    margin: 0.5em 0;
    width:  100%;
}
table.parameters { border-bottom:  1px solid #90b8de; }
table.exceptions { border-bottom:  1px solid #deb890; }

.parameters th, .exceptions th {
    color:  #fff;
    padding:    3px 5px;
    text-align: left;
    font-weight:    normal;
    text-shadow:    #666 1px 1px 0;
}
.parameters th { background: #90b8de; }
.exceptions th { background: #deb890; }

.parameters td, .exceptions td {
    padding:    3px 10px;
    border-top: 1px solid #ddd;
    vertical-align: top;
}

.parameters tr:first-child td, .exceptions tr:first-child td {
    border-top: none;
}

.parameters td.prmName, .exceptions td.excName, .exceptions td.excCodeName {
    width:  100px;
}

.parameters td.prmType {
    width:  120px;
}

table.exceptions table {
    border-spacing: 0;
    border-collapse:    collapse;
    width:  100%;
}
</style><link rel="stylesheet" href="https://www.w3.org/community/src/css/spec/cg-draft.css"><!--[if lt IE 9]><script src='https://www.w3.org/2008/site/js/html5shiv.js'></script><![endif]--><script id="initialUserConfig" type="application/json">{
  "specStatus": "CG-DRAFT",
  "shortName": "web-nfc",
  "noLegacyStyle": true,
  "publishDate": "",
  "previousPublishDate": "",
  "previousMaturity": "",
  "edDraftURI": "https://w3c.github.io/web-nfc/",
  "crEnd": "",
  "editors": [
    {
      "name": "Kenneth Rohde Christiansen",
      "company": "Intel",
      "companyURL": "http://www.intel.com/"
    },
    {
      "name": "Zoltan Kis",
      "company": "Intel",
      "companyURL": "http://www.intel.com/"
    }
  ],
  "inlineCSS": true,
  "noIDLIn": true,
  "wg": "Web NFC Community Group",
  "wgURI": "https://www.w3.org/community/web-nfc/",
  "wgPublicList": "public-web-nfc",
  "issueBase": "https://www.github.com/w3c/web-nfc/issues/",
  "githubAPI": "https://api.github.com/repos/w3c/web-nfc",
  "otherLinks": [
    {
      "key": "Repository",
      "data": [
        {
          "value": "We are on Github.",
          "href": "https://github.com/w3c/web-nfc"
        },
        {
          "value": "File a bug.",
          "href": "https://github.com/w3c/web-nfc/issues"
        },
        {
          "value": "Commit history.",
          "href": "https://github.com/w3c/web-nfc/commits/gh-pages"
        },
        {
          "value": "Usage scenarios",
          "href": "https://w3c.github.io/web-nfc/use-cases.html"
        }
      ]
    },
    {
      "key": "Contributors",
      "data": [
        {
          "value": "In the github repository",
          "href": "https://github.com/w3c/web-nfc/graphs/contributors"
        }
      ]
    }
  ],
  "localBiblio": {
    "NFC-SECURITY": {
      "href": "https://github.com/w3c/web-nfc/security-privacy.html",
      "title": "Web NFC Security and Privacy",
      "publisher": "W3C",
      "date": "25 April 2015"
    },
    "NFC-USECASES": {
      "href": "https://github.com/w3c/web-nfc/use-cases.html",
      "title": "Web NFC Use Cases",
      "publisher": "W3C",
      "date": "25 April 2015"
    },
    "NFC-STANDARDS": {
      "href": "http://members.nfc-forum.org/specs/spec_list/",
      "title": "NFC Forum Technical Specifications",
      "publisher": "NFC Forum",
      "date": "24 July 2006"
    },
    "ISO-639.2": {
      "href": "https://www.loc.gov/standards/iso639-2/php/code_list.php",
      "title": "Codes for the Representation of Names of Languages",
      "publisher": "ISO",
      "date": "18 March 2014"
    },
    "WEBAPPSEC": {
      "href": "https://w3c.github.io/webappsec/specs/powerfulfeatures",
      "title": "Secure Contexts",
      "publisher": "W3C",
      "date": "17 July 2015"
    }
  }
}</script></head>

<body class="h-entry" role="document" id="respecDocument"><div class="head" role="contentinfo" id="respecHeader">
  <p>
    <a href="http://www.w3.org/"><img width="72" height="48" src="https://www.w3.org/Icons/w3c_home" alt="W3C"></a>
  </p>
  <h1 class="title p-name" id="title" property="dc:title">Web NFC API</h1>
  
  <h2 id="draft-community-group-report-25-september-2015">Draft Community Group Report <time property="dc:issued" class="dt-published" datetime="2015-09-25">25 September 2015</time></h2>
  <dl>
    
    
    
      <dt>Latest editor's draft:</dt>
      <dd><a href="https://w3c.github.io/web-nfc/">https://w3c.github.io/web-nfc/</a></dd>
    
    
    
    
    
    
      
    
    <dt>Editors:</dt>
    <dd class="p-author h-card vcard" property="bibo:editor" resource="_:editor0"><span property="rdf:first" typeof="foaf:Person"><span property="foaf:name" class="p-name fn">Kenneth Rohde Christiansen</span>, <a property="foaf:workplaceHomepage" class="p-org org h-org h-card" href="http://www.intel.com/">Intel</a></span>
<span property="rdf:rest" resource="_:editor1"></span>
</dd>
<dd class="p-author h-card vcard" resource="_:editor1"><span property="rdf:first" typeof="foaf:Person"><span property="foaf:name" class="p-name fn">Zoltan Kis</span>, <a property="foaf:workplaceHomepage" class="p-org org h-org h-card" href="http://www.intel.com/">Intel</a></span>
<span property="rdf:rest" resource="rdf:nil"></span>
</dd>

    
    
      
        
          <dt>Repository:</dt>
          
             
                
                  <dd>
                    <a href="https://github.com/w3c/web-nfc">
                      We are on Github.
                    </a>
                  </dd>
                
             
                
                  <dd>
                    <a href="https://github.com/w3c/web-nfc/issues">
                      File a bug.
                    </a>
                  </dd>
                
             
                
                  <dd>
                    <a href="https://github.com/w3c/web-nfc/commits/gh-pages">
                      Commit history.
                    </a>
                  </dd>
                
             
                
                  <dd>
                    <a href="https://w3c.github.io/web-nfc/use-cases.html">
                      Usage scenarios
                    </a>
                  </dd>
                
             
          
        
      
        
          <dt>Contributors:</dt>
          
             
                
                  <dd>
                    <a href="https://github.com/w3c/web-nfc/graphs/contributors">
                      In the github repository
                    </a>
                  </dd>
                
             
          
        
      
    
  </dl>
  
  <p class="copyright">
    <a href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> Â© 
    2015
    the Contributors to the Web NFC API Specification, published by the
    <a href="https://www.w3.org/community/web-nfc/">Web NFC Community Group</a> under the
    
      <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a>.
      A human-readable <a href="http://www.w3.org/community/about/agreements/cla-deed/">summary</a> is available.
    
  </p>
  <hr>
</div>

<!-- - - - - - - - - - - - - - - - Abstract - - - - - - - - - - - - - - - - -->
<section id="abstract" class="introductory" property="dc:abstract"><h2 id="h-abstract" resource="#h-abstract"><span property="xhv:role" resource="xhv:heading">Abstract</span></h2>
  <p>
    Near Field Communication (NFC) enables wireless communication between two
    devices at close proximity, usually less than a few centimeters.
    NFC is an international standard (ISO/IEC 18092) defining an interface and
    protocol for simple wireless interconnection of closely coupled devices
    operating at 13.56 MHz
    (see <a href="https://www.nfc-forum.org/specs/spec_list/">
    https://www.nfc-forum.org/specs/spec_list/</a>).
  </p>
  <p>
    This document defines an API to enable selected use-cases based on
    NFC technology.
  </p>
</section><section id="sotd" class="introductory"><h2 id="h-sotd" resource="#h-sotd"><span property="xhv:role" resource="xhv:heading">Status of This Document</span></h2>
  <p>
    This specification was published by the <a href="https://www.w3.org/community/web-nfc/">Web NFC Community Group</a>.
    It is not a W3C Standard nor is it on the W3C Standards Track.
    
      Please note that under the 
      <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a>
      there is a limited opt-out and other conditions apply.
    
    Learn more about 
    <a href="http://www.w3.org/community/">W3C Community and Business Groups</a>.
  </p>
  
  
  <p>
    Implementers need to be aware that this specification is considered
    unstable.
    Implementers who are not taking part in the discussions will find the
    specification changing out from under them in incompatible ways. Vendors
    interested in implementing this specification before it eventually reaches
    the Candidate Recommendation phase should subscribe to the repository on
    GitHub and take part in the discussions.
  </p>
  <p>
    Significant changes to this document since last publication are
    documented in the <a href="#Changes">Changes section</a>.
  </p>

  
    
      <p>If you wish to make comments regarding this document, please send them to 
      <a href="mailto:public-web-nfc@w3.org">public-web-nfc@w3.org</a> 
      (<a href="mailto:public-web-nfc-request@w3.org?subject=subscribe">subscribe</a>,
      <a href="http://lists.w3.org/Archives/Public/public-web-nfc/">archives</a>).</p>
    
  
</section><section id="toc"><h2 class="introductory" id="h-toc" resource="#h-toc"><span property="xhv:role" resource="xhv:heading">Table of Contents</span></h2><ul class="toc" role="directory" id="respecContents"><li class="tocline"><a href="#conformance" class="tocxref"><span class="secno">1. </span>Conformance</a></li><li class="tocline"><a href="#terminology-and-conventions" class="tocxref"><span class="secno">2. </span>Terminology and conventions</a><ul class="toc"><li class="tocline"><a href="#security-1" class="tocxref"><span class="secno">2.1 </span>Security</a></li><li class="tocline"><a href="#nfc-specific" class="tocxref"><span class="secno">2.2 </span>NFC specific</a></li></ul></li><li class="tocline"><a href="#introduction" class="tocxref"><span class="secno">3. </span>Introduction</a></li><li class="tocline"><a href="#examples" class="tocxref"><span class="secno">4. </span>Examples</a></li><li class="tocline"><a href="#use-cases" class="tocxref"><span class="secno">5. </span>Use Cases</a><ul class="toc"><li class="tocline"><a href="#reading-nfc-tags" class="tocxref"><span class="secno">5.1 </span>Reading <span class="formerLink" data-link-type="dfn">NFC tag</span>s</a></li><li class="tocline"><a href="#writing-to-nfc-tags" class="tocxref"><span class="secno">5.2 </span>Writing to <span class="formerLink" data-link-type="dfn">NFC tag</span>s</a></li><li class="tocline"><a href="#sending-data-to-nfc-peer-devices" class="tocxref"><span class="secno">5.3 </span>Sending data to <span class="formerLink" data-link-type="dfn">NFC peer</span> devices</a></li><li class="tocline"><a href="#handover-to-another-wireless-connection-type" class="tocxref"><span class="secno">5.4 </span>Handover to another wireless connection type</a></li><li class="tocline"><a href="#payment-scenarios" class="tocxref"><span class="secno">5.5 </span>Payment scenarios</a></li></ul></li><li class="tocline"><a href="#features" class="tocxref"><span class="secno">6. </span>Features</a></li><li class="tocline"><a href="#security" class="tocxref"><span class="secno">7. </span>Security and Privacy</a><ul class="toc"><li class="tocline"><a href="#chain-of-trust" class="tocxref"><span class="secno">7.1 </span>Chain of trust</a></li><li class="tocline"><a href="#threats" class="tocxref"><span class="secno">7.2 </span>Threats</a></li><li class="tocline"><a href="#permissions-and-user-prompts" class="tocxref"><span class="secno">7.3 </span>Permissions and user prompts</a></li><li class="tocline"><a href="#security-policies" class="tocxref"><span class="secno">7.4 </span>Security policies</a></li></ul></li><li class="tocline"><a href="#data-representation" class="tocxref"><span class="secno">8. </span>Data Representation</a><ul class="toc"><li class="tocline"><a href="#the-nfcrecord-dictionary" class="tocxref"><span class="secno">8.1 </span>The <strong>NFCRecord</strong> dictionary</a></li><li class="tocline"><a href="#the-nfcmessage-dictionary" class="tocxref"><span class="secno">8.2 </span>The <strong>NFCMessage</strong> dictionary</a></li><li class="tocline"><a href="#data-mapping" class="tocxref"><span class="secno">8.3 </span>Data mapping</a></li></ul></li><li class="tocline"><a href="#extensions-to-the-navigator-interface" class="tocxref"><span class="secno">9. </span>Extensions to the <strong>Navigator</strong> interface</a><ul class="toc"><li class="tocline"><a href="#the-nfc-attribute" class="tocxref"><span class="secno">9.1 </span>The <strong>nfc</strong> attribute</a></li></ul></li><li class="tocline"><a href="#the-nfc-interface" class="tocxref"><span class="secno">10. </span>The <strong>NFC</strong> interface</a></li><li class="tocline"><a href="#the-nfcadapter-interface" class="tocxref"><span class="secno">11. </span>The <strong>NFCAdapter</strong> interface</a><ul class="toc"><li class="tocline"><a href="#the-nfcpushoptions-dictionary" class="tocxref"><span class="secno">11.1 </span>The <strong>NFCPushOptions</strong> dictionary</a></li><li class="tocline"><a href="#the-nfcwatchoptions-dictionary" class="tocxref"><span class="secno">11.2 </span>The <strong>NFCWatchOptions</strong> dictionary</a></li><li class="tocline"><a href="#writing-or-pushing-content" class="tocxref"><span class="secno">11.3 </span><span data-dfn-type="dfn">Writing or pushing content</span></a><ul class="toc"><li class="tocline"><a href="#the-pushmessage-method" class="tocxref"><span class="secno">11.3.1 </span>The pushMessage() method</a><ul class="toc"><li class="tocline"><a href="#obtaining-push-permission" class="tocxref"><span class="secno">11.3.1.1 </span>Obtaining push permission</a></li><li class="tocline"><a href="#creating-web-nfc-message" class="tocxref"><span class="secno">11.3.1.2 </span>Creating Web NFC message</a></li><li class="tocline"><a href="#mapping-empty-record-to-ndef" class="tocxref"><span class="secno">11.3.1.3 </span>Mapping empty record to NDEF</a></li><li class="tocline"><a href="#mapping-string-to-ndef" class="tocxref"><span class="secno">11.3.1.4 </span>Mapping string to NDEF</a></li><li class="tocline"><a href="#mapping-url-to-ndef" class="tocxref"><span class="secno">11.3.1.5 </span>Mapping URL to NDEF</a></li><li class="tocline"><a href="#mapping-json-to-ndef" class="tocxref"><span class="secno">11.3.1.6 </span>Mapping JSON to NDEF</a></li><li class="tocline"><a href="#mapping-binary-data-to-ndef" class="tocxref"><span class="secno">11.3.1.7 </span>Mapping binary data to NDEF</a></li><li class="tocline"><a href="#creating-a-web-nfc-record" class="tocxref"><span class="secno">11.3.1.8 </span>Creating a Web NFC record</a></li></ul></li><li class="tocline"><a href="#cancelPush" class="tocxref"><span class="secno">11.3.2 </span>The cancelPush method</a></li></ul></li><li class="tocline"><a href="#watching-for-content" class="tocxref"><span class="secno">11.4 </span>Watching for content</a><ul class="toc"><li class="tocline"><a href="#match-patterns" class="tocxref"><span class="secno">11.4.1 </span>Match patterns</a></li><li class="tocline"><a href="#url-patterns" class="tocxref"><span class="secno">11.4.2 </span>URL patterns</a></li><li class="tocline"><a href="#the-watch-method" class="tocxref"><span class="secno">11.4.3 </span>The <strong>watch()</strong> method</a></li><li class="tocline"><a href="#the-unwatch-method" class="tocxref"><span class="secno">11.4.4 </span>The <strong>unwatch</strong>() method</a></li></ul></li><li class="tocline"><a href="#steps-receiving" class="tocxref"><span class="secno">11.5 </span>Receiving and parsing content</a><ul class="toc"><li class="tocline"><a href="#the-ndef-parsing-algorithm" class="tocxref"><span class="secno">11.5.1 </span>The NDEF parsing algorithm</a></li><li class="tocline"><a href="#dispatching-nfc-content" class="tocxref"><span class="secno">11.5.2 </span>Dispatching NFC content</a></li></ul></li><li class="tocline"><a href="#handling-visibility-and-focus" class="tocxref"><span class="secno">11.6 </span>Handling visibility and focus</a></li></ul></li><li class="tocline"><a href="#Changes" class="tocxref"><span class="secno">A. </span>Changes</a></li><li class="tocline"><a href="#openissues" class="tocxref"><span class="secno">B. </span>Open issues</a></li><li class="tocline"><a href="#acknowledgements" class="tocxref"><span class="secno">C. </span>Acknowledgements</a></li><li class="tocline"><a href="#references" class="tocxref"><span class="secno">D. </span>References</a><ul class="toc"><li class="tocline"><a href="#normative-references" class="tocxref"><span class="secno">D.1 </span>Normative references</a></li><li class="tocline"><a href="#informative-references" class="tocxref"><span class="secno">D.2 </span>Informative references</a></li></ul></li></ul></section>

<!-- - - - - - - - - - - - Status of this document  - - - - - - - - - - - - -->


<!-- - - - - - - - - - - - - - - Conformance  - - - - - - - - - - - - - - - -->
<section id="conformance" typeof="bibo:Chapter" resource="#conformance" property="bibo:hasPart"><!--OddPage--><h2 id="h-conformance" resource="#h-conformance"><span property="xhv:role" resource="xhv:heading"><span class="secno">1. </span>Conformance</span></h2>
<p>
  As well as sections marked as non-normative, all authoring guidelines, diagrams, examples,
  and notes in this specification are non-normative. Everything else in this specification is
  normative.
</p>
<p id="respecRFC2119">The key words <em class="rfc2119" title="MAY">MAY</em>, <em class="rfc2119" title="MUST">MUST</em>, <em class="rfc2119" title="MUST NOT">MUST NOT</em>, <em class="rfc2119" title="SHOULD">SHOULD</em>, and <em class="rfc2119" title="SHOULD NOT">SHOULD NOT</em> are 
  to be interpreted as described in [<cite><a class="bibref" href="#bib-RFC2119">RFC2119</a></cite>].
</p>

  <p>
    This document defines conformance criteria that apply to a single
    product: the <dfn data-dfn-type="dfn" id="dfn-ua">UA</dfn> that implements the interfaces it contains.
  </p>
  <p>
    Implementations that use ECMAScript to implement the APIs defined in
    this document <em class="rfc2119" title="MUST">MUST</em> implement them in a manner consistent with the
    ECMAScript Bindings defined in the Web IDL specification [<cite><a class="bibref" href="#bib-WEBIDL">WEBIDL</a></cite>], as
    this document uses that specification and terminology.
  </p>
</section>

<!-- - - - - - - - - - - - - - -  Terminology - - - - - - - - - - - - - - - -->
<section id="terminology-and-conventions" typeof="bibo:Chapter" resource="#terminology-and-conventions" property="bibo:hasPart"> <!--OddPage--><h2 id="h-terminology-and-conventions" resource="#h-terminology-and-conventions"><span property="xhv:role" resource="xhv:heading"><span class="secno">2. </span>Terminology and conventions</span></h2>
  <p>
    The term <a href="https://html.spec.whatwg.org/#browsing-context">
    <dfn data-dfn-type="dfn" id="dfn-browsing-context">browsing context</dfn></a> refers to the environment in which
    <a href="https://html.spec.whatwg.org/#document"><dfn data-dfn-type="dfn" id="dfn-document">Document</dfn></a>
    objects are presented to the user. A given <a href="#dfn-browsing-context" class="internalDFN" data-link-type="dfn">browsing context</a> has a
    single <a href="#dfn-origin" class="internalDFN" data-link-type="dfn">origin</a> and a single <code>WindowProxy</code> object, but it
    can have many <code>Document</code> objects, with their associated
    <code>Window</code> objects. The <i>browsing context</i> identifies
    the entity which invokes this API, which can be a <i>web app</i>, a
    <i>web page</i>, or an
    <a href="https://html.spec.whatwg.org/#the-iframe-element">iframe</a>.
  </p>
  <p>
    Inspired by the <a href="https://streams.spec.whatwg.org/#conventions">
    Streams specification</a>, we use the notation x@[[y]] to refer to
    <a href="http://ecma-international.org/ecma-262/6.0/#sec-object-internal-methods-and-internal-slots">
    internal slots</a> of an object, instead of saying "the [[y]] internal slot of x."
  </p>
  <p>
    The Augmented Backus-Naur Form (ABNF) notation used is specified in RFC5234. [<cite><a class="bibref" href="#bib-ABNF">ABNF</a></cite>]
  </p>
  <p>
    The term
    <a href="https://html.spec.whatwg.org/#script-execution-environment">
    <dfn data-dfn-type="dfn" id="dfn-script-execution-environment">script execution environment</dfn></a> is defined in [<cite><a class="bibref" href="#bib-HTML5">HTML5</a></cite>].
  </p>
  <p>
    The term <a href="https://html.spec.whatwg.org/#top-level-browsing-context">
    <dfn data-dfn-type="dfn" id="dfn-top-level-browsing-context">top-level browsing context</dfn></a> is defined in [<cite><a class="bibref" href="#bib-HTML5">HTML5</a></cite>].
  </p>
  <p>
    The term
    <a href="http://www.w3.org/TR/html5/webappapis.html#incumbent-settings-object">
    <dfn data-dfn-type="dfn" id="dfn-incumbent-settings-object">incumbent settings object</dfn></a> is defined in [<cite><a class="bibref" href="#bib-HTML5">HTML5</a></cite>].
  </p>
  <p>
    The term
    <a href="https://w3c.github.io/webappsec/specs/powerfulfeatures/#secure-context">
    <dfn data-dfn-type="dfn" id="dfn-secure-context">secure context</dfn></a> is defined in [<cite><a class="bibref" href="#bib-WEBAPPSEC">WEBAPPSEC</a></cite>].
  </p>
  <p>
    The term of executing algorithms
    <a href="https://html.spec.whatwg.org/#in-parallel"><dfn data-dfn-type="dfn" id="dfn-in-parallel">in parallel</dfn></a>
    is defined in [<cite><a class="bibref" href="#bib-HTML5">HTML5</a></cite>].
  </p>
  <p>
    <a href="http://www.w3.org/TR/url-1/"><dfn data-dfn-type="dfn" id="dfn-url">URL</dfn></a>
    is defined in [<cite><a class="bibref" href="#bib-URL">URL</a></cite>].
  </p>
  <p>
    The term
    <a href="http://www.w3.org/TR/2011/WD-html5-20110113/urls.html#document-base-url">
    <dfn data-dfn-type="dfn" id="dfn-document-base-url">document base URL</dfn></a> is defined in [<cite><a class="bibref" href="#bib-HTML5">HTML5</a></cite>].
  </p>
  <p>
    The term <a href="https://url.spec.whatwg.org/#concept-url-path">
    <dfn data-dfn-type="dfn" id="dfn-url-path">URL path</dfn></a> is defined in [<cite><a class="bibref" href="#bib-URL">URL</a></cite>].
  </p>
  <p>
    The term
    <a href="https://html.spec.whatwg.org/#origin">
    <dfn data-dfn-type="dfn" id="dfn-origin">origin</dfn></a> is defined in [<cite><a class="bibref" href="#bib-HTML5">HTML5</a></cite>].
  </p>
  <p>
    The term <a href="https://html.spec.whatwg.org/#ascii-serialisation-of-an-origin">
    <dfn data-dfn-type="dfn" id="dfn-ascii-serialized-origin">ASCII serialized origin</dfn></a> is defined in [<cite><a class="bibref" href="#bib-HTML5">HTML5</a></cite>].
  </p>
  <p>
    <a href="http://heycam.github.io/webidl/#idl-DOMString">
      <code><dfn data-dfn-type="dfn" id="dfn-domstring">DOMString</dfn></code></a>,
    <a href="http://heycam.github.io/webidl/#idl-ArrayBuffer">
      <code><dfn data-dfn-type="dfn" id="dfn-arraybuffer">ArrayBuffer</dfn></code></a>,
    <a href="http://heycam.github.io/webidl/#common-BufferSource">
      <code><dfn data-dfn-type="dfn" id="dfn-buffersource">BufferSource</dfn></code></a> and
    <a href="http://www.w3.org/TR/WebIDL/#idl-any">
      <code><dfn data-dfn-type="dfn" id="dfn-any">any</dfn></code></a>
    are defined in [<cite><a class="bibref" href="#bib-WEBIDL">WEBIDL</a></cite>].
  </p>
  <p>
    <!--a href="http://www.w3.org/TR/dom/#eventinit">
      <dfn>EventInit</dfn></a>,-->
    <a href="http://www.w3.org/TR/dom/#domexception">
      <dfn data-dfn-type="dfn" id="dfn-domexception">DOMException</dfn></a>,
    <a href="http://www.w3.org/TR/dom/#aborterror">
      <dfn data-dfn-type="dfn" id="dfn-aborterror">AbortError</dfn></a>,
    <a href="http://www.w3.org/TR/dom/#syntaxerror">
      <dfn data-dfn-type="dfn" id="dfn-syntaxerror">SyntaxError</dfn></a>,
    <a href="http://www.w3.org/TR/dom/#notsupportederror">
      <dfn data-dfn-type="dfn" id="dfn-notsupportederror">NotSupportedError</dfn></a>,
    <a href="http://www.w3.org/TR/dom/#notfounderror">
      <dfn data-dfn-type="dfn" id="dfn-notfounderror">NotFoundError</dfn></a>,
    <a href="http://www.w3.org/TR/dom/#networkerror">
      <dfn data-dfn-type="dfn" id="dfn-networkerror">NetworkError</dfn></a>,
    <a href="http://www.w3.org/TR/dom/#securityerror">
      <dfn data-dfn-type="dfn" id="dfn-securityerror">SecurityError</dfn></a>
    are defined in [<cite><a class="bibref" href="#bib-DOM4">DOM4</a></cite>].
  </p>
  <p>
    <a href="http://www.ecma-international.org/ecma-262/6.0/#sec-promise-objects">
    <dfn data-dfn-type="dfn" id="dfn-promise">Promise</dfn></a>,
    <a href="http://www.ecma-international.org/ecma-262/6.0/#sec-json-object">
    <dfn data-dfn-type="dfn" id="dfn-json">JSON</dfn></a>,
    <a href="http://www.ecma-international.org/ecma-262/6.0/#sec-json.stringify">
    <dfn data-dfn-type="dfn" id="dfn-json.stringify">JSON.stringify</dfn></a> and
    <a href="http://www.ecma-international.org/ecma-262/6.0/#sec-json.parse">
    <dfn data-dfn-type="dfn" id="dfn-json.parse">JSON.parse</dfn></a>
    are defined in [<cite><a class="bibref" href="#bib-ECMASCRIPT">ECMASCRIPT</a></cite>].
  </p>
  <p>
    The algorithms <a href="http://www.w3.org/TR/encoding/#utf-8-encode">
    <dfn data-dfn-type="dfn" id="dfn-utf-8-encode">utf-8 encode</dfn></a>, and
    <a href="http://www.w3.org/TR/encoding/#utf-8-decode">
    <dfn data-dfn-type="dfn" id="dfn-utf-8-decode">utf-8 decode</dfn></a> are defined in [<cite><a class="bibref" href="#bib-ENCODING">ENCODING</a></cite>].
  </p>
  <p>
    <dfn data-dfn-type="dfn" id="dfn-iana-media-type">IANA media type</dfn>s (formerly known as MIME types) are defined in
    <a href="http://tools.ietf.org/html/rfc2046">RFC2046</a>.
  </p>
  <p>
    A <a href="https://html.spec.whatwg.org/#valid-mime-type">
    <dfn data-dfn-type="dfn" id="dfn-valid-mime-type">valid MIME type</dfn></a> is defined in [<cite><a class="bibref" href="#bib-HTML5">HTML5</a></cite>].
  </p>
  <p>
    The term <dfn data-dfn-type="dfn" id="dfn-queue-a-task"><a href="https://html.spec.whatwg.org/#queue-a-task">queue
    a task</a></dfn> is defined in [<cite><a class="bibref" href="#bib-HTML5">HTML5</a></cite>].
  </p>
  <p>
    The term <dfn data-dfn-type="dfn" id="dfn-task-source"><a href="https://html.spec.whatwg.org/#task-source">task
    source</a></dfn> is defined in [<cite><a class="bibref" href="#bib-HTML5">HTML5</a></cite>].
  </p>
  <section id="security-1" typeof="bibo:Chapter" resource="#security-1" property="bibo:hasPart"> <h3 id="h-security-1" resource="#h-security-1"><span property="xhv:role" resource="xhv:heading"><span class="secno">2.1 </span>Security</span></h3>
  <p>
    The term <dfn data-dfn-type="dfn" id="dfn-expressed-permission">expressed permission</dfn> refers to an act by the user, e.g.
    via user interface or setting or host device platform features, using which
    the user approves the permission of a <a href="#dfn-browsing-context" class="internalDFN" data-link-type="dfn">browsing context</a> to access the
    given functionality.
  </p>
  <p>
    The term <dfn id="askforgiveness" data-dfn-type="dfn">ask for forgiveness</dfn> refers to some
    form of unobtrusive notification that informs the user of an operation
    while it is running.
    UAs <em class="rfc2119" title="SHOULD">SHOULD</em> provide the user with means to ignore similar future
    operations from the same <a href="#dfn-origin" class="internalDFN" data-link-type="dfn">origin</a> and advertise this to the user.
  </p>
  <p>
    The term <dfn data-dfn-type="dfn" id="dfn-prearranged-trust-relationship">prearranged trust relationship</dfn> means that the
    UA has already established a trust relationship for a
    certain operation using a platform specific mechanism, so that an
    <a href="#dfn-expressed-permission" class="internalDFN" data-link-type="dfn">expressed permission</a> from the user is not any more needed.
    See also this
    <a href="http://w3c.github.io/web-nfc/security-privacy.html#prearranged-trust-relationship">
    section</a> in the Security and Privacy document.
  </p>
  <p>
    The term <dfn data-dfn-type="dfn" id="dfn-obtain-permission">obtain permission</dfn> for a certain operation indicates
    that the UA has either obtained <a href="#dfn-expressed-permission" class="internalDFN" data-link-type="dfn">expressed permission</a>, or
    <a href="#askforgiveness">asks for forgiveness</a>, or ensured a
    <a href="#dfn-prearranged-trust-relationship" class="internalDFN" data-link-type="dfn">prearranged trust relationship</a> exists.
  </p>
  </section>
  <section id="nfc-specific" typeof="bibo:Chapter" resource="#nfc-specific" property="bibo:hasPart"> <h3 id="h-nfc-specific" resource="#h-nfc-specific"><span property="xhv:role" resource="xhv:heading"><span class="secno">2.2 </span>NFC specific</span></h3>
  <p>
    <b>NFC</b> stands for Near Field Communications, short-range wireless
    technology operating at 13.56 MHz which enables communication between
    devices at a distance less than 10 cm. The NFC communications protocols and
    data exchange formats, and are based on existing radio-frequency
    identification (RFID) standards, including ISO/IEC 14443 and FeliCa.
    The NFC standards include ISO/IEC 18092[5] and those defined by the NFC
    Forum. See https://www.nfc-forum.org/specs/spec_list/ for a complete
    listing.
  </p>
  <p>
    An <dfn data-dfn-type="dfn" id="dfn-nfc-adapter">NFC adapter</dfn> is the software entity in the underlying
    platform which provides access to NFC functionality implemented in a
    given hardware element (NFC chip). A device may have multiple NFC
    adapters, for instance a built-in one, and one attached via USB.
  </p>
  <p>
    An <dfn data-dfn-type="dfn" id="dfn-nfc-tag">NFC tag</dfn> is a passive NFC device.
    The <a href="#dfn-nfc-tag" class="internalDFN" data-link-type="dfn">NFC tag</a> is powered by magnetic induction when an active NFC
    device is in proximity range. An <a href="#dfn-nfc-tag" class="internalDFN" data-link-type="dfn">NFC tag</a> contains a single
    <a href="#dfn-ndef-message" class="internalDFN" data-link-type="dfn">NDEF message</a>.
    </p><div class="note"><div class="note-title" aria-level="4" role="heading" id="h-note1"><span>Note</span></div><p class="">
      The way of reading the message may happen through proprietary
      technologies, which require the reader and the tag to be of the same
      manufacturer. Implementations are expected to encapsulate this.
    </p></div>
  <p></p>
  <p>
    An <dfn data-dfn-type="dfn" id="dfn-nfc-peer">NFC peer</dfn> is an active, powered device, which can interact
    with other devices in order to exchange data using NFC.
  </p>
  <p>
    An <dfn data-dfn-type="dfn" id="dfn-nfc-device">NFC device</dfn> is either an <a href="#dfn-nfc-peer" class="internalDFN" data-link-type="dfn">NFC peer</a>, or an <a href="#dfn-nfc-tag" class="internalDFN" data-link-type="dfn">NFC tag</a>.
  </p>
  <p>
    An <dfn data-dfn-type="dfn" id="dfn-ndef-message">NDEF message</dfn> encapsulates one or more application-defined
    <a href="#dfn-ndef-record" class="internalDFN" data-link-type="dfn">NDEF record</a>s. <dfn data-dfn-type="dfn" id="dfn-ndef">NDEF</dfn> is an abbreviation for NFC Forum
    Data Exchange Format, a lightweight binary message format. NDEF messages
    can be stored on an <a href="#dfn-nfc-tag" class="internalDFN" data-link-type="dfn">NFC tag</a> or exchanged between NFC-enabled devices.
  </p>
  <p>
    The term <dfn data-dfn-type="dfn" id="dfn-nfc-content">NFC content</dfn> is a synonym for <a href="#dfn-ndef-message" class="internalDFN" data-link-type="dfn">NDEF message</a>,
    which can originate either from an <a href="#dfn-nfc-tag" class="internalDFN" data-link-type="dfn">NFC tag</a> or an <a href="#dfn-nfc-peer" class="internalDFN" data-link-type="dfn">NFC peer</a>.
  </p>
  <p>
    An <dfn data-dfn-type="dfn" id="dfn-ndef-record">NDEF record</dfn> is a part of an <a href="#dfn-ndef-message" class="internalDFN" data-link-type="dfn">NDEF message</a> that has a
    single associated type information to its payload. It contains a
    Type Name Format (TNF) field, the payload size, the payload type, an
    optional identifier which is a URL, and a payload of maximum size of
    2^32-1 bytes.
    The NFC Forum has standardized a small set of useful data types for
    use in <a href="#dfn-ndef-record" class="internalDFN" data-link-type="dfn">NDEF record</a>s, for instance text, URL, and binary data such as
    media. In addition, there are record types designed for more complex
    interactions, such as Smart Poster, and handover records.
  </p>
  <p>
    The <dfn data-dfn-type="dfn" id="dfn-tnf">TNF</dfn> (Type Name Format) field of the <a href="#dfn-ndef-record" class="internalDFN" data-link-type="dfn">NDEF record</a> can
    take binary values denoting the following <a href="#dfn-ndef-record" class="internalDFN" data-link-type="dfn">NDEF record</a> payload
    types:
    </p><table class="simple">
      <tbody><tr>
        <th><strong>TNF value</strong></th>
        <th><strong>NDEF record type</strong></th>
      </tr>
      <tr>
        <td>0</td>
        <td><dfn data-dfn-type="dfn" id="dfn-empty">Empty</dfn></td>
      </tr>
      <tr>
        <td>1</td>
        <td>NFC Forum <dfn data-dfn-type="dfn" id="dfn-well-known-type">Well-Known Type</dfn>
        </td>
      </tr>
      <tr>
        <td>2</td>
        <td><dfn data-dfn-type="dfn" id="dfn-media-type">Media Type</dfn></td>
      </tr>
      <tr>
        <td>3</td>
        <td><dfn data-dfn-type="dfn" id="dfn-absolute-uri">Absolute URI</dfn></td>
      </tr>
      <tr>
        <td>4</td>
        <td>NFC Forum <dfn data-dfn-type="dfn" id="dfn-external-type">External Type</dfn></td>
      </tr>
      <tr>
        <td>5</td>
        <td><dfn data-dfn-type="dfn" id="dfn-unknown">Unknown</dfn></td>
      </tr>
      <tr>
        <td>6</td>
        <td><dfn data-dfn-type="dfn" id="dfn-unchanged">Unchanged</dfn></td>
      </tr>
      <tr>
        <td>7</td>
        <td><dfn data-dfn-type="dfn" id="dfn-reserved">Reserved</dfn></td>
      </tr>
    </tbody></table>
    <br>
    NFC Forum <a href="#dfn-well-known-type" class="internalDFN" data-link-type="dfn">Well-Known Type</a> includes record types <i>text</i>,
    <i>URI</i>, <i>Smart Poster</i> (containing an URL or other
    data, and possible actions).
  <p></p>
  <p>
    An <strong><a href="#dfn-nfc-watch" class="internalDFN" data-link-type="dfn">NFC watch</a></strong> is a mechanism used to watch for
    available <a href="#dfn-web-nfc-message" class="internalDFN" data-link-type="dfn">Web NFC message</a>s fulfilling certain criteria.
    It is defined in more detail in <a href="#dfn-nfc-watch">The watch()
    method</a> section.
  </p>
  <p>
    A <dfn data-dfn-type="dfn" id="dfn-web-nfc-record">Web NFC record</dfn> is an <a href="#dfn-ndef-record" class="internalDFN" data-link-type="dfn">NDEF record</a> of External Type,
    specific to Web NFC. It indicates that the containing <a href="#dfn-ndef-message" class="internalDFN" data-link-type="dfn">NDEF message</a>
    is targeted for <a href="#dfn-browsing-context" class="internalDFN" data-link-type="dfn">browsing context</a>s using this API
    and contains information useful for handling the <a href="#dfn-ndef-message" class="internalDFN" data-link-type="dfn">NDEF message</a> with
    the algorithms defined in this specification.
    The format of a <a href="#dfn-web-nfc-record" class="internalDFN" data-link-type="dfn">Web NFC record</a> is as follows:
    </p><ul>
      <li>
        Uses NFC Forum External Type record (<a href="#dfn-tnf" class="internalDFN" data-link-type="dfn">TNF</a>=4) with the External
        Type field set to <code>urn:nfc:ext:w3.org:webnfc</code>.
      </li>
      <li>
        The payload contains the <a href="#web-nfc-id" class="internalDFN" data-link-type="dfn">Web NFC Id</a> of the
        <a href="#dfn-web-nfc-message" class="internalDFN" data-link-type="dfn">Web NFC message</a>.
      </li>
    </ul>
  <p></p>
  <p>
    The <dfn id="web-nfc-id" data-dfn-type="dfn">Web NFC Id</dfn> is a <a href="#dfn-url" class="internalDFN" data-link-type="dfn">URL</a> according to
    [<cite><a class="bibref" href="#bib-RFC3986">RFC3986</a></cite>], specifically an <a href="#dfn-ascii-serialized-origin" class="internalDFN" data-link-type="dfn">ASCII serialized origin</a> with
    <code>"https"</code> scheme, and optionally followed by a <a href="#dfn-url-path" class="internalDFN" data-link-type="dfn">URL path</a>.
    This allows matching <a href="#dfn-web-nfc-content" class="internalDFN" data-link-type="dfn">Web NFC content</a> with <a href="#dfn-url-pattern" class="internalDFN" data-link-type="dfn"><code>URL pattern</code></a>s
    specified by <a href="#dfn-nfc-watch" class="internalDFN" data-link-type="dfn">NFC watch</a>es.
  </p>
  <p>
    A <dfn data-dfn-type="dfn" id="dfn-web-nfc-message">Web NFC message</dfn> consists of a set of the <a href="#dfn-ndef-record" class="internalDFN" data-link-type="dfn">NDEF record</a>s
    and a single <a href="#dfn-web-nfc-record" class="internalDFN" data-link-type="dfn">Web NFC record</a>.
  </p>
  <div class="note"><div class="note-title" aria-level="4" role="heading" id="h-note2"><span>Note</span></div><p class="">
   The position of the <a href="#dfn-web-nfc-record" class="internalDFN" data-link-type="dfn">Web NFC record</a> within the <a href="#dfn-web-nfc-message" class="internalDFN" data-link-type="dfn">Web NFC message</a>
   is implementation specific, this specification only mandates its existence
   for a <a href="#dfn-web-nfc-message" class="internalDFN" data-link-type="dfn">Web NFC message</a>. It is not mandatory to a <a href="#dfn-ndef-message" class="internalDFN" data-link-type="dfn">NDEF message</a>.
  </p></div>
  <p>
    The term <dfn data-dfn-type="dfn" id="dfn-web-nfc-content">Web NFC content</dfn> denotes all <a href="#dfn-web-nfc-message" class="internalDFN" data-link-type="dfn">Web NFC message</a>s
    contained within an <a href="#dfn-ndef-message" class="internalDFN" data-link-type="dfn">NDEF message</a>, identified by the <a href="#web-nfc-id" class="internalDFN" data-link-type="dfn">Web NFC Id</a>
    within the <a href="#dfn-ndef-message" class="internalDFN" data-link-type="dfn">NDEF message</a>. This version of the specification
    supports one <a href="#dfn-web-nfc-message" class="internalDFN" data-link-type="dfn">Web NFC message</a> per <a href="#dfn-ndef-message" class="internalDFN" data-link-type="dfn">NDEF message</a>.
  </p>
  <div class="note"><div class="note-title" aria-level="4" role="heading" id="h-note3"><span>Note</span></div><p class="">
    As part of the <a href="#dfn-ndef-record" class="internalDFN" data-link-type="dfn">NDEF record</a>, an <dfn data-dfn-type="dfn" id="dfn-ndef-id">NDEF Id</dfn> field may be
    present for application specific usages. According to the
    [<cite><a class="bibref" href="#bib-NFC-STANDARDS">NFC-STANDARDS</a></cite>] it contains a URL with the maximum length of 256 octets.
    This URL is used for identifying the payload in an application specific
    way. Although the <a href="#dfn-ndef-id" class="internalDFN" data-link-type="dfn">NDEF Id</a> could be used for containing e.g. an
    <a href="#dfn-ascii-serialized-origin" class="internalDFN" data-link-type="dfn">ASCII serialized origin</a> associated with the <a href="#dfn-ndef-record" class="internalDFN" data-link-type="dfn">NDEF record</a>,
    <strong>it is not used in this version of the specification</strong> for
    record-level identification, since the message-level identification is
    handled by the <a href="#web-nfc-id" class="internalDFN" data-link-type="dfn">Web NFC Id</a>. Also, the content of the <a href="#dfn-ndef-id" class="internalDFN" data-link-type="dfn">NDEF Id</a>
    is also contained in the <a href="#web-nfc-id" class="internalDFN" data-link-type="dfn">Web NFC Id</a>, and since <a href="#dfn-nfc-tag" class="internalDFN" data-link-type="dfn">NFC tag</a>s are
    rather small storage units, this duplication is avoided in this version.
    When multiple <a href="#dfn-web-nfc-message" class="internalDFN" data-link-type="dfn">Web NFC message</a>s eventually will be supported within a
    single <a href="#dfn-ndef-message" class="internalDFN" data-link-type="dfn">NDEF message</a>, it would likely use the <a href="#dfn-ndef-id" class="internalDFN" data-link-type="dfn">NDEF Id</a> to store
    the same identifier for each <a href="#dfn-ndef-record" class="internalDFN" data-link-type="dfn">NDEF record</a> which is part of a given
    <a href="#dfn-web-nfc-message" class="internalDFN" data-link-type="dfn">Web NFC message</a>, which identifier will likely be an
    <a href="#dfn-ascii-serialized-origin" class="internalDFN" data-link-type="dfn">ASCII serialized origin</a> associated with the <a href="#dfn-web-nfc-content" class="internalDFN" data-link-type="dfn">Web NFC content</a>.
  </p></div>
  <p>
    The term <dfn data-dfn-type="dfn" id="dfn-trusted-integrity-nfc-content">trusted integrity NFC content</dfn> refers to an
    <a href="#dfn-ndef-message" class="internalDFN" data-link-type="dfn">NDEF message</a>, or an <a href="#dfn-ndef-record" class="internalDFN" data-link-type="dfn">NDEF record</a>, which can be trusted for
    data integrity, i.e. the content is not changed by third parties between
    writing and reading.
  </p>
  <p>
    An <dfn data-dfn-type="dfn" id="dfn-nfc-handover">NFC handover</dfn> defines NFC Forum Well Known Types and the
    corresponding message structure that allows negotiation and activation of
    an alternative communication carrier, such as Bluetooth or WiFi.
    The negotiated communication carrier would then be used (separately) to
    perform certain activities between the two devices, such as sending photos
    to the other device, printing to a Bluetooth printer or streaming video to
    a television set.
  </p>
  </section>
</section> <!-- Terminology -->

<!-- - - - - - - - - - - - - - -  Introduction  - - - - - - - - - - - - - - -->
<section class="informative" id="introduction" typeof="bibo:Chapter" resource="#introduction" property="bibo:hasPart"> <!--OddPage--><h2 id="h-introduction" resource="#h-introduction"><span property="xhv:role" resource="xhv:heading"><span class="secno">3. </span>Introduction</span></h2><p><em>This section is non-normative.</em></p>
  <p>
    In general, there are three groups of user scenarios for NFC:
    </p><ul>
      <li>
        Hold a device in close proximity of a passively powered tag, such as
        a plastic card or sticker, in order to read and/or write data.
      </li>
      <li>
        Hold two active devices, e.g. phones or tablets, in close proximity
        in order to push a <a href="#dfn-web-nfc-message" class="internalDFN" data-link-type="dfn">Web NFC message</a> from one device to the other.
      </li>
      <li>
        Hold two active devices, e.g. phones or tablets, in close proximity
        in order to initiate a connection using another wireless carrier such
        as Bluetooth or WiFi.
      </li>
      <li>Card emulation
       <ol>
        <li>
          With a secure element: for payments by holding your phone close to a
          point-of-sales terminal, instead of swiping a payment card.
        </li>
        <li>With host card emulation: for allowing use-cases like using a phone
          acting as a hotel room keycard.
        </li>
       </ol>
      </li>
    </ul>
  <p></p>
  <p>
    NFC works using magnetic induction, meaning that the reader will emit a
    small electric charge which then creates a magnetic field. This field powers
    the passive device which turns it into electrical impulses to communicate
    data. Thus, when the devices are within range, a read is always performed
    (see NFC Analog Specification and NFC Digital Protocol, NFC Forum, 2006).
    The peer-to-peer connection works in a similar way, as the device
    periodically switches into a so-called initiator mode in order to scan for
    targets, then later to fall back into target mode. If a target is found, the
    data is read the same way as for tags.
  </p>
  <p>
    As NFC is based on existing RFID standards, many NFC chipsets support
    reading RFIDs tags, but many of these are only supported by single
    vendors and not part of the NFC standards. Though certain devices support
    reading and writing to these, it is not a goal of this document to
    support proprietary tags or support interoperability with legacy systems.
  </p>
  <p>
    The NFC Forum has mandated the support of four different tag types to be
    operable with NFC devices. The same is required on operating systems such as
    Android.
    </p><ol>
      <li>
        <b>NFC Forum Type 1</b>: This tag is based on the ISO/IEC 14443-3A
        (also known as NFC-A, as defined in ISO/IEC 14443-3:2011, Part 3:
        Initialization and anticollision). The tags are rewritable and can be
        configured to become read-only. Memory size can be between 96 bytes and
        2 Kbytes. Communication speed is 106 kbit/sec.
      </li>
      <li><b>NFC Forum Type 2</b>: This tag is also based on the
        ISO/IEC 14443-3A (NFC-A). The tags are rewritable and can be configured
        to become read-only. Memory size can be between 48 bytes and 2 Kbytes.
        Communication speed is 106 kbit/sec. In contrast to Type 1, Type 2 has
        anti-collision protection for dealing with multiple tags within the NFC
        field.
      </li>
      <li><b>NFC Forum Type 3</b>: This tag is based on the Japanese Industrial
        Standard (JIS) X 6319-4, commonly known as FeliCa. The tags are
        preconfigured to be either rewritable or read-only. Memory availability
        is variable, theoretical memory limit is 1MByte per service.
        Communication speed is 106 kbit/sec. Like Type 2, it supports
        anti-collision protection.
      </li>
      <li><b>NFC Forum Type 4</b> (November 2010): This tag is based on the
        ISO/IEC 14443 like Type 1 and 2, but it support either NFC-A or NFC-B
        for communication. On top of that the tag may support the Data Exchange
        Protocol (aka ISO-DEP) defined in ISO/IEC 14443 (ISO/IEC 14443-4:2008
        Part 4: Transmission protocol). Like Type 3, the tags are preconfigured
        to be either rewritable or read-only. Variable memory, up to 32 KB per
        service. Supports three different communication speeds 106 or 212 or
        424 Kbits/s.
      </li>
    </ol>
  <p></p>
  <p>
    In addition to data types standardized for <a href="#dfn-ndef-record" class="internalDFN" data-link-type="dfn">NDEF record</a>s by the NFC
    Forum, many commercial products such as bus cards, door openers etc use
    different card specific data and protocol extensions which require specific
    NFC chips (same vendor of card and reader) in order to function.
  </p>
  <p>
    Card emulation mode capabilities also depend on the NFC chip in the device.
    For payments, a Secure Element is often needed.
  </p>
  <div class="note"><div class="note-title" aria-level="3" role="heading" id="h-note4"><span>Note</span></div><p class="">
    This document does not aim supporting all possible use cases of NFC
    technology, but only a few use cases which are considered relevant to be
    used by web pages in browsers, using the browser security model.
  </p></div>
  </section> <!-- Introduction -->

  <!-- - - - - - - - - - - - - - Usage Examples - - - - - - - - - - - - - - -->
  <section class="informative" id="examples" typeof="bibo:Chapter" resource="#examples" property="bibo:hasPart"> <!--OddPage--><h2 id="h-examples" resource="#h-examples"><span property="xhv:role" resource="xhv:heading"><span class="secno">4. </span>Examples</span></h2><p><em>This section is non-normative.</em></p>
  <p>
    This section shows how developers can make use of the various features of
    this specification.
  </p>
  <div class="example"><div class="example-title"><span>Example 1</span>: Read and update data stored on tag</div><pre class="example highlight prettyprint prettyprinted"><span class="pln">navigator</span><span class="pun">.</span><span class="pln">nfc</span><span class="pun">.</span><span class="pln">requestAdapter</span><span class="pun">().</span><span class="kwd">then</span><span class="pun">((</span><span class="pln">adapter</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  adapter</span><span class="pun">.</span><span class="pln">watch</span><span class="pun">({},</span><span class="pln"> </span><span class="pun">(</span><span class="pln">message</span><span class="pun">,</span><span class="pln"> url</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="str">"NDEF message received from URL "</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> url</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">message</span><span class="pun">[</span><span class="lit">0</span><span class="pun">].</span><span class="pln">kind </span><span class="pun">==</span><span class="pln"> </span><span class="str">'empty'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      adapter</span><span class="pun">.</span><span class="pln">pushMessage</span><span class="pun">([</span><span class="pln">
        </span><span class="pun">{</span><span class="pln">
          kind</span><span class="pun">:</span><span class="pln"> </span><span class="str">"text"</span><span class="pun">,</span><span class="pln">
          type</span><span class="pun">:</span><span class="pln"> </span><span class="str">""</span><span class="pun">,</span><span class="pln">
          data</span><span class="pun">:</span><span class="pln"> </span><span class="str">"Initializing tag"</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
      </span><span class="pun">]);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    processMessage</span><span class="pun">(</span><span class="pln">message</span><span class="pun">);</span><span class="pln">
  </span><span class="pun">});</span><span class="pln">
</span><span class="pun">});</span><span class="pln">

</span><span class="kwd">function</span><span class="pln"> processMessage</span><span class="pun">(</span><span class="pln">message</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  message</span><span class="pun">.</span><span class="pln">forEach</span><span class="pun">((</span><span class="pln">record</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">record</span><span class="pun">.</span><span class="pln">kind </span><span class="pun">==</span><span class="pln"> </span><span class="str">"string"</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(â€œ</span><span class="typ">Data</span><span class="pln"> </span><span class="kwd">is</span><span class="pln"> </span><span class="kwd">string</span><span class="pun">:</span><span class="pln"> </span><span class="pun">â€œ</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> data</span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">record</span><span class="pun">.</span><span class="pln">kind </span><span class="pun">==</span><span class="pln"> </span><span class="str">"json"</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      processJSON</span><span class="pun">(</span><span class="pln">record</span><span class="pun">.</span><span class="pln">data</span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">record</span><span class="pun">.</span><span class="pln">kind </span><span class="pun">==</span><span class="pln"> </span><span class="str">"url"</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="str">"Data is URL: "</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> record</span><span class="pun">.</span><span class="pln">data</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">record</span><span class="pun">.</span><span class="pln">kind </span><span class="pun">==</span><span class="pln"> </span><span class="str">"opaque"</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      processBinary</span><span class="pun">(</span><span class="pln">data</span><span class="pun">);</span><span class="pln">
  </span><span class="pun">});</span><span class="pln">
</span><span class="pun">};</span><span class="pln">

</span><span class="kwd">function</span><span class="pln"> processBinary</span><span class="pun">(</span><span class="pln">data</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="str">"Known (string) binary data: "</span><span class="pun">);</span><span class="pln">
  console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="typ">String</span><span class="pun">.</span><span class="pln">fromCharCode</span><span class="pun">.</span><span class="pln">apply</span><span class="pun">(</span><span class="kwd">null</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Uint16Array</span><span class="pun">(</span><span class="pln">data</span><span class="pun">)));</span><span class="pln">
</span><span class="pun">};</span><span class="pln">

</span><span class="kwd">function</span><span class="pln"> processJSON</span><span class="pun">(</span><span class="pln">data</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="kwd">var</span><span class="pln"> obj </span><span class="pun">=</span><span class="pln"> JSON</span><span class="pun">.</span><span class="pln">parse</span><span class="pun">(</span><span class="pln">data</span><span class="pun">);</span><span class="pln">
  console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="str">"JSON data: "</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> obj</span><span class="pun">.</span><span class="pln">myProperty</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">());</span><span class="pln">
</span><span class="pun">};</span></pre></div>
  <div class="example"><div class="example-title"><span>Example 2</span>: Sending data to a peer device</div><pre class="example highlight prettyprint prettyprinted"><span class="pln">navigator</span><span class="pun">.</span><span class="pln">nfc</span><span class="pun">.</span><span class="pln">requestAdapter</span><span class="pun">().</span><span class="kwd">then</span><span class="pun">((</span><span class="pln">adapter</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  adapter</span><span class="pun">.</span><span class="pln">pushMessage</span><span class="pun">([</span><span class="pln">
    </span><span class="pun">{</span><span class="pln">
      kind</span><span class="pun">:</span><span class="pln"> </span><span class="str">"text"</span><span class="pun">,</span><span class="pln">
      type</span><span class="pun">:</span><span class="pln"> </span><span class="str">""</span><span class="pun">,</span><span class="pln">
      data</span><span class="pun">:</span><span class="pln"> </span><span class="str">"Data meant for peers"</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
  </span><span class="pun">]).</span><span class="kwd">then</span><span class="pun">(()</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="str">"Message sent."</span><span class="pun">)</span><span class="pln">
  </span><span class="pun">}).</span><span class="kwd">catch</span><span class="pun">(()</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="str">"Send failed :-( try again."</span><span class="pun">)</span><span class="pln">
  </span><span class="pun">});</span><span class="pln">
</span><span class="pun">});</span></pre></div>
  <div class="example"><div class="example-title"><span>Example 3</span>: Save and restore game progress with another device</div><pre class="example highlight prettyprint prettyprinted"><span class="pln">navigator</span><span class="pun">.</span><span class="pln">nfc</span><span class="pun">.</span><span class="pln">requestAdapter</span><span class="pun">().</span><span class="kwd">then</span><span class="pun">((</span><span class="pln">adapter</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="str">"Awaiting game state"</span><span class="pun">);</span><span class="pln">

  adapter</span><span class="pun">.</span><span class="pln">watch</span><span class="pun">({</span><span class="pln"> url</span><span class="pun">:</span><span class="pln"> </span><span class="str">"*://mydomain/mygame/*"</span><span class="pln"> </span><span class="pun">},</span><span class="pln"> </span><span class="pun">(</span><span class="pln">message</span><span class="pun">,</span><span class="pln"> url</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="str">"Game state received from: "</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> url</span><span class="pun">;</span><span class="pln">
    console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="str">"Stored state: "</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> message</span><span class="pun">.</span><span class="pln">data</span><span class="pun">);</span><span class="pln">

    </span><span class="com">// Now do some calculations and then update the state.</span><span class="pln">
    </span><span class="com">// ...</span><span class="pln">
    adapter</span><span class="pun">.</span><span class="pln">pushMessage</span><span class="pun">([</span><span class="pln"> data</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> level</span><span class="pun">:</span><span class="pln"> </span><span class="lit">3</span><span class="pun">,</span><span class="pln"> points</span><span class="pun">:</span><span class="pln"> </span><span class="lit">4500</span><span class="pun">,</span><span class="pln"> lives</span><span class="pun">:</span><span class="pln"> </span><span class="lit">3</span><span class="pln"> </span><span class="pun">}</span><span class="pln"> </span><span class="pun">])</span><span class="pln">
    </span><span class="pun">.</span><span class="kwd">then</span><span class="pun">(()</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="str">"We have stored your current game state."</span><span class="pun">)</span><span class="pln"> </span><span class="pun">})</span><span class="pln">
    </span><span class="pun">.</span><span class="kwd">catch</span><span class="pun">(()</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="str">"Failed updating game state, try again."</span><span class="pun">)</span><span class="pln"> </span><span class="pun">});</span><span class="pln">
  </span><span class="pun">};</span><span class="pln">
</span><span class="pun">});</span></pre></div>
  </section> <!-- Usage examples -->

  <section class="informative" id="use-cases" typeof="bibo:Chapter" resource="#use-cases" property="bibo:hasPart"> <!--OddPage--><h2 id="h-use-cases" resource="#h-use-cases"><span property="xhv:role" resource="xhv:heading"><span class="secno">5. </span>Use Cases</span></h2><p><em>This section is non-normative.</em></p>
    <p>
      A few Web NFC user scenarios are described in the
      <a href="https://w3c.github.io/web-nfc/use-cases.html">Use Cases</a>
      document. These user scenarios can be grouped by criteria based on
      security, privacy and feature categories, resulting in generic flows as
      follows.
    </p>
    <section id="reading-nfc-tags" typeof="bibo:Chapter" resource="#reading-nfc-tags" property="bibo:hasPart"> <h3 id="h-reading-nfc-tags" resource="#h-reading-nfc-tags"><span property="xhv:role" resource="xhv:heading"><span class="secno">5.1 </span>Reading <a href="#dfn-nfc-tag" class="internalDFN" data-link-type="dfn">NFC tag</a>s</span></h3>
      <ol>
        <li>
          Reading <a href="#dfn-nfc-tag" class="internalDFN" data-link-type="dfn">NFC tag</a>s containing a <a href="#dfn-web-nfc-message" class="internalDFN" data-link-type="dfn">Web NFC message</a>, when a
          web page using the Web NFC API is open and in focus.
          For instance, a web page instructs the user to tap an NFC tag, and
          then receives information from the tag.
        </li>
        <li>
          Reading <a href="#dfn-nfc-tag" class="internalDFN" data-link-type="dfn">NFC tag</a>s containing other than <a href="#dfn-web-nfc-message" class="internalDFN" data-link-type="dfn">Web NFC message</a>,
          when a web page using the Web NFC API is open and in focus.
        </li>
        <li>
          Reading <a href="#dfn-nfc-tag" class="internalDFN" data-link-type="dfn">NFC tag</a>s when no web site using the Web NFC API is
          open or in focus.
          This use case is not supported in this version of the specification,
          and is has low priority for future versions as well.
        </li>
      </ol>
    </section>
    <section id="writing-to-nfc-tags" typeof="bibo:Chapter" resource="#writing-to-nfc-tags" property="bibo:hasPart"> <h3 id="h-writing-to-nfc-tags" resource="#h-writing-to-nfc-tags"><span property="xhv:role" resource="xhv:heading"><span class="secno">5.2 </span>Writing to <a href="#dfn-nfc-tag" class="internalDFN" data-link-type="dfn">NFC tag</a>s</span></h3>
      <p>
        The user opens a web page which can write an <a href="#dfn-nfc-tag" class="internalDFN" data-link-type="dfn">NFC tag</a>. The write
        operations may be one of the following:
        </p><ol>
          <li>
            Writing to an empty <a href="#dfn-nfc-tag" class="internalDFN" data-link-type="dfn">NFC tag</a>.
          </li>
          <li>
            Writing to <a href="#dfn-nfc-tag" class="internalDFN" data-link-type="dfn">NFC tag</a>s which already contains a
            <a href="#dfn-web-nfc-message" class="internalDFN" data-link-type="dfn">Web NFC message</a> with a different <a href="#web-nfc-id" class="internalDFN" data-link-type="dfn">Web NFC Id</a>
            (i.e. overwriting a web-specific tag).
          </li>
          <li>
            Writing to <a href="#dfn-nfc-tag" class="internalDFN" data-link-type="dfn">NFC tag</a>s which already contains a
            <a href="#dfn-web-nfc-message" class="internalDFN" data-link-type="dfn">Web NFC message</a> with the same <a href="#web-nfc-id" class="internalDFN" data-link-type="dfn">Web NFC Id</a>
            (i.e. updating own tag).
          </li>
          <li>
            Writing to other, writable <a href="#dfn-nfc-tag" class="internalDFN" data-link-type="dfn">NFC tag</a>s (i.e. overwriting a
            generic tag).
          </li>
        </ol>
      <p></p>
      <p class-"note"="">
        Note that an NFC write operation to an <a href="#dfn-nfc-tag" class="internalDFN" data-link-type="dfn">NFC tag</a> always involves
        also a read operation.
      </p>
    </section>
    <section id="sending-data-to-nfc-peer-devices" typeof="bibo:Chapter" resource="#sending-data-to-nfc-peer-devices" property="bibo:hasPart"> <h3 id="h-sending-data-to-nfc-peer-devices" resource="#h-sending-data-to-nfc-peer-devices"><span property="xhv:role" resource="xhv:heading"><span class="secno">5.3 </span>Sending data to <a href="#dfn-nfc-peer" class="internalDFN" data-link-type="dfn">NFC peer</a> devices</span></h3>
      <p>
        In general, sending data to another Web NFC capable device requires that
        on the initiating device the user would first have to navigate to a web
        site. The user would then touch the device against another Web NFC
        equipped device, and data transfer would occur. On the receiving device
        the UA will dispatch the content to an application registered
        and eligible to handle the content, and if that application is a browser
        which has a web page open and in focus that uses the Web NFC API and has
        set up a <a href="#dfn-nfc-watch" class="internalDFN" data-link-type="dfn">NFC watch</a> to listen to <a href="#dfn-web-nfc-content" class="internalDFN" data-link-type="dfn">Web NFC content</a>, then the
        content is delivered to the web page through the parameters of an
        <code>NFCMessageCallback</code>.
      </p>
    </section>
    <section id="handover-to-another-wireless-connection-type" typeof="bibo:Chapter" resource="#handover-to-another-wireless-connection-type" property="bibo:hasPart"> <h3 id="h-handover-to-another-wireless-connection-type" resource="#h-handover-to-another-wireless-connection-type"><span property="xhv:role" resource="xhv:heading"><span class="secno">5.4 </span>Handover to another wireless connection type</span></h3>
      <p>
        NFC supports handover protocols to Bluetooth or WiFi connectivity for
        the purpose of larger volume data transfer. The user touches another
        NFC capable device, and as a result configuration data is sent for a
        new Bluetooth or WiFi connection, which is then established between the
        devices.
        This use case is not supported in this version of the specification.
      </p>
    </section>
    <section id="payment-scenarios" typeof="bibo:Chapter" resource="#payment-scenarios" property="bibo:hasPart"> <h3 id="h-payment-scenarios" resource="#h-payment-scenarios"><span property="xhv:role" resource="xhv:heading"><span class="secno">5.5 </span>Payment scenarios</span></h3>
      <p>
        The user buys goods in a store, and payments options include NFC.
        In general, touching the device to the point of sales terminal receiver
        area will result in a transaction between the secure element from the
        device and the point of sales terminal. With the Web NFC API, if the
        user navigates to a web site before paying, there may be interaction
        with that site regarding the payment, e.g. the user could get points and
        discounts, or get delivered application or service specific data (e.g.
        tickets, keys, etc) to the device.
        This use case is not supported in this version of the specification.
      </p>
    </section>
  </section> <!-- Use Cases -->

  <section class="informative" id="features" typeof="bibo:Chapter" resource="#features" property="bibo:hasPart"> <!--OddPage--><h2 id="h-features" resource="#h-features"><span property="xhv:role" resource="xhv:heading"><span class="secno">6. </span>Features</span></h2><p><em>This section is non-normative.</em></p>
    <p>High level features for the Web NFC specification include the following:
      </p><ol>
        <li>
          Support devices with single or multiple NFC adapters.
          If there are multiple adapters present when requesting an NFC adapter
          then the UA <em class="rfc2119" title="MAY">MAY</em> display a dialog for selecting one of them,
          or <em class="rfc2119" title="MAY">MAY</em> otherwise choose a default adapter based on user settings or
          internal policy.
        </li>
        <li>
          Support communication with active (powered devices such as readers,
          phones) and passive (smart cards, tags, etc) devices.
        </li>
        <li>
          Allow users to act on (e.g. read, write or transceive) discovered
          NFC devices (passive and active) as well as access the payload
          which were read in the process as <a href="#dfn-web-nfc-message" class="internalDFN" data-link-type="dfn">Web NFC message</a>s.
        </li>
        <li>
          Allow users to write a payload via NDEF records to compatible
          devices, such as writeable tags, when they come in range, as
          <a href="#dfn-web-nfc-message" class="internalDFN" data-link-type="dfn">Web NFC message</a>s.
        </li>
        <li>
          [future] Allow manual connection for various technologies such as
          NFC-A and NFC-F depending on the secondary device.
        </li>
        <li>
          [future] Allow <a href="#dfn-nfc-handover" class="internalDFN" data-link-type="dfn">NFC handover</a> to Bluetooth or WiFi.
        </li>
        <li>
          [future] Allow card emulation with secure element or host card
          emulation.
        </li>
      </ol>
    <p></p>
    <p>
      NFC is usually deeply integrated into device platforms (e.g. Android,
      Windows, etc), because end-to-end user experience implications (e.g.
      users need to be presented platform specific dialogs for selecting
      applications and actions). Also, privacy and security related issues
      require platform specific solutions.
    </p>
    <p>
      The various integrated technologies, wide variety of use cases, and
      platform integration issues make standardization of NFC for the web a
      challenge.
      Therefore this document makes a few simplifications in what use cases
      and data types are possible to handle by users of this API:
      </p><ul>
        <li>
          Expose data types already known to web browsers as
          <a href="#dfn-iana-media-type" class="internalDFN" data-link-type="dfn">IANA media type</a>s.
        </li>
        <li>Use the web security model.</li>
        <li>
          Implementations encapsulate <a href="#dfn-ndef-record" class="internalDFN" data-link-type="dfn">NDEF record</a> handling and the API
          exposes only data and control events.
        </li>
      </ul>
    <p></p>
  </section> <!-- Features -->
 <!-- Introduction -->

<!-- - - - - - - - - - - - - Security and Privacy - - - - - - - - - - - - - -->
<section typeof="bibo:Chapter" resource="#security" property="bibo:hasPart"> <!--OddPage--><h2 id="security" resource="#security"><span property="xhv:role" resource="xhv:heading"><span class="secno">7. </span>Security and Privacy</span></h2>
  <p>
    The trust model, attacker model, threat model and possible mitigation
    proposals for the Web NFC API are presented in the
    <a href="http://w3c.github.io/web-nfc/security-privacy.html">
    Security and Privacy</a> document. This section presents the chosen
    security and privacy model through normative requirements to
    implementations.
  </p>

  <section id="chain-of-trust" typeof="bibo:Chapter" resource="#chain-of-trust" property="bibo:hasPart"> <h3 id="h-chain-of-trust" resource="#h-chain-of-trust"><span property="xhv:role" resource="xhv:heading"><span class="secno">7.1 </span>Chain of trust</span></h3>
  <p>
    Web pages using the Web NFC API are not trusted.
    This means that the user needs to be aware of exactly what a web page is
    intending to do with NFC at any given moment. Implementations need to
    make sure that when the user authorizes a method of this API, then only that
    action is run, without side effects, and exactly in the context and the
    number of times the user allows the execution of NFC related operations,
    according to the algorithmic steps detailed in this specification.
  </p>
  <p>
    The integrity of <a href="#dfn-nfc-content" class="internalDFN" data-link-type="dfn">NFC content</a> <em class="rfc2119" title="SHOULD NOT">SHOULD NOT</em> be trusted when
    used for implementing security policies, for instance the authenticity of
    <a href="#dfn-origin" class="internalDFN" data-link-type="dfn">origin</a>s saved in the <a href="#dfn-ndef-id" class="internalDFN" data-link-type="dfn">NDEF Id</a> field, unless a
    <a href="#dfn-prearranged-trust-relationship" class="internalDFN" data-link-type="dfn">prearranged trust relationship</a> (such as encryption and other means)
    exists.
  </p>
  </section>

  <section id="threats" typeof="bibo:Chapter" resource="#threats" property="bibo:hasPart"> <h3 id="h-threats" resource="#h-threats"><span property="xhv:role" resource="xhv:heading"><span class="secno">7.2 </span>Threats</span></h3>
  <p>
    The main threats are summarized in the
    <a href="http://w3c.github.io/web-nfc/security-privacy.html#threats-and-possible-solutions">Security and Privacy</a> document.
  </p>
  <p>
    In this specification the following threats are handled with the highest
    priority:
    </p><ul>
      <li>
        User data privacy: involuntary sharing of user data (such as location,
        contacts, personal data, etc) from an NFC-capable device such as a
        phone, tablet, or PC.
      </li>
      <li>
        Protecting existing <a href="#dfn-nfc-tag" class="internalDFN" data-link-type="dfn">NFC tag</a>s from being overwritten by malicious
        web pages.
      </li>
    </ul>
  <p></p>
  </section>

  <section id="permissions-and-user-prompts" typeof="bibo:Chapter" resource="#permissions-and-user-prompts" property="bibo:hasPart"> <h3 id="h-permissions-and-user-prompts" resource="#h-permissions-and-user-prompts"><span property="xhv:role" resource="xhv:heading"><span class="secno">7.3 </span>Permissions and user prompts</span></h3>
  <p>
    This specification attempts to help minimizing the user prompts needed to
    use the Web NFC API and tries to involve implicit policies which can
    address the
    <a href="http://w3c.github.io/web-nfc/security-privacy.html#threats-and-possible-solutions">
    threats</a>.
    However, this specification does not describe, nor does it
    mandate specific user prompting policies. The term <a href="#dfn-obtain-permission" class="internalDFN" data-link-type="dfn">obtain permission</a>
    is used for acquiring trust for a given operation.
  </p>
  <div class="note"><div class="note-title" aria-level="4" role="heading" id="h-note5"><span>Note</span></div><p class="">
    The <a href="http://www.w3.org/TR/permissions/">Permissions API</a> is
    suggested to be used by UAs for implementing NFC related
    [<cite><a class="bibref" href="#bib-permissions">permissions</a></cite>] in order to minimize the need for user prompting.
    The suggested
    <a href="https://w3c.github.io/permissions/#idl-def-PermissionName">
    permission name</a> is
    <code><a href="https://github.com/w3c/permissions/issues/47">"nfc"</a></code>.
    This allows saving user permissions for a given <a href="#dfn-origin" class="internalDFN" data-link-type="dfn">origin</a> in a
    persistent database until revocation.
  </p></div>
  <p>
    All <a href="#dfn-expressed-permission" class="internalDFN" data-link-type="dfn">expressed permission</a>s that are preserved beyond the current
    browsing session <em class="rfc2119" title="MUST">MUST</em> be revocable.
  </p>
  </section>

  <section class="informative" id="security-policies" typeof="bibo:Chapter" resource="#security-policies" property="bibo:hasPart"> <h3 id="h-security-policies" resource="#h-security-policies"><span property="xhv:role" resource="xhv:heading"><span class="secno">7.4 </span>Security policies</span></h3><p><em>This section is non-normative.</em></p>
    <p>
      This section summarizes the security policies which are specified as
      normative requirements in the respective algorithms of this
      specification:
    </p>
    <ul>
      <li>
        Only <a href="#dfn-script-execution-environment" class="internalDFN" data-link-type="dfn">script execution environment</a>s of <code>
        <a href="https://html.spec.whatwg.org/#document">Document</a></code>s
        with a <a href="#dfn-browsing-context" class="internalDFN" data-link-type="dfn">browsing context</a>, and an <a href="#dfn-incumbent-settings-object" class="internalDFN" data-link-type="dfn">incumbent settings object</a>
        which is a <a href="#dfn-secure-context" class="internalDFN" data-link-type="dfn">secure context</a> are allowed to access
        <a href="#dfn-nfc-content" class="internalDFN" data-link-type="dfn">NFC content</a>.
        Browsers may ignore this rule for development purposes only.
      </li>
      <li>
        In order to use NFC, the <code>Window</code> object associated with the
        <code><a href="#dfn-document" class="internalDFN" data-link-type="dfn">Document</a></code> contained by the
        <a href="http://www.w3.org/TR/html5/browsers.html#top-level-browsing-context">
        top level browsing context</a> using
        the Web NFC API must be
        <a href="http://www.w3.org/TR/page-visibility/#now-visible-algorithm">
        visible</a> and in
        <a href="https://html.spec.whatwg.org/#focus">focus</a>.
        This also means that UAs should block access to the NFC radio if
        the display is off or the device is locked.
        For backgrounded web pages, receiving and sending <a href="#dfn-nfc-content" class="internalDFN" data-link-type="dfn">NFC content</a>
        must be <a id="#nfc-suspended" href="#nfc-suspended" class="internalDFN" data-link-type="dfn">suspended</a>.
      </li>
      <li>
        When sending (i.e. writing or pushing) <a href="#dfn-web-nfc-content" class="internalDFN" data-link-type="dfn">Web NFC content</a>, the
        <a href="#dfn-ascii-serialized-origin" class="internalDFN" data-link-type="dfn">ASCII serialized origin</a> of the <a href="#dfn-browsing-context" class="internalDFN" data-link-type="dfn">browsing context</a> requesting
        the operation may be recorded in each sent <a href="#dfn-ndef-record" class="internalDFN" data-link-type="dfn">NDEF record</a>'s
        <a href="#dfn-ndef-id" class="internalDFN" data-link-type="dfn">NDEF Id</a> field.
        For details see the <a href="#dfn-writing-or-pushing-content" class="internalDFN" data-link-type="dfn">Writing or pushing content</a> section.
      </li>
      <li>
        When sending (i.e. writing or pushing) <a href="#dfn-web-nfc-content" class="internalDFN" data-link-type="dfn">Web NFC content</a>, the
        <a href="#dfn-url-path" class="internalDFN" data-link-type="dfn">URL path</a> of the <a href="#dfn-browsing-context" class="internalDFN" data-link-type="dfn">browsing context</a> requesting
        the operation must be recorded in each sent <a href="#dfn-ndef-message" class="internalDFN" data-link-type="dfn">NDEF message</a>'s
        <a href="#dfn-web-nfc-record" class="internalDFN" data-link-type="dfn">Web NFC record</a> field.
        For details see the <a href="#dfn-writing-or-pushing-content" class="internalDFN" data-link-type="dfn">Writing or pushing content</a> section.
      </li>
      <li>
        When requesting an NFC adapter by the <code>requestAdapter</code>
        method, or when setting up listeners for reading, or when sending
        <a href="#dfn-nfc-content" class="internalDFN" data-link-type="dfn">NFC content</a>, the UA may warn the user that
        physical location may be inferred from the act of using NFC by the
        given <a href="#dfn-origin" class="internalDFN" data-link-type="dfn">origin</a>.
      </li>
      <li>
        Writing <a href="#dfn-web-nfc-content" class="internalDFN" data-link-type="dfn">Web NFC content</a> to an <a href="#dfn-nfc-tag" class="internalDFN" data-link-type="dfn">NFC tag</a> does not need to
        <a href="#dfn-obtain-permission" class="internalDFN" data-link-type="dfn">obtain permission</a>, if the <a href="#dfn-nfc-tag" class="internalDFN" data-link-type="dfn">NFC tag</a> contains
        <a href="#dfn-trusted-integrity-nfc-content" class="internalDFN" data-link-type="dfn">trusted integrity NFC content</a> and the value of the <a href="#dfn-ndef-id" class="internalDFN" data-link-type="dfn">NDEF Id</a>
        field is equal to the <a href="#dfn-ascii-serialized-origin" class="internalDFN" data-link-type="dfn">ASCII serialized origin</a> of the
        <a href="#dfn-incumbent-settings-object" class="internalDFN" data-link-type="dfn">incumbent settings object</a>.
        Otherwise the UA must <a href="#dfn-obtain-permission" class="internalDFN" data-link-type="dfn">obtain permission</a> for
        sending <a href="#dfn-nfc-content" class="internalDFN" data-link-type="dfn">NFC content</a> which overwrites existing information.
        See also the <a href="#dfn-writing-or-pushing-content" class="internalDFN" data-link-type="dfn">Writing or pushing content</a> section.
      </li>
      <li>
        Sending <a href="#dfn-nfc-content" class="internalDFN" data-link-type="dfn">NFC content</a> to an <a href="#dfn-nfc-peer" class="internalDFN" data-link-type="dfn">NFC peer</a> does not need to
        <a href="#dfn-obtain-permission" class="internalDFN" data-link-type="dfn">obtain permission</a>, but the previous rules apply.
        See the <a href="#dfn-writing-or-pushing-content" class="internalDFN" data-link-type="dfn">Writing or pushing content</a> section.
      </li>
      <li>
        Making an <a href="#dfn-nfc-tag" class="internalDFN" data-link-type="dfn">NFC tag</a> read-only must <a href="#dfn-obtain-permission" class="internalDFN" data-link-type="dfn">obtain permission</a>, or
        otherwise fail.
      </li>
      <li>
        Setting up listeners for reading <a href="#dfn-nfc-content" class="internalDFN" data-link-type="dfn">NFC content</a> should
        <a href="#dfn-obtain-permission" class="internalDFN" data-link-type="dfn">obtain permission</a>.
      </li>
      <li>
        The process of reading an <a href="#dfn-ndef-message" class="internalDFN" data-link-type="dfn">NDEF message</a>does not need to
        <a href="#dfn-obtain-permission" class="internalDFN" data-link-type="dfn">obtain permission</a>.
      </li>
      <li>
        The payload data on NFC content is untrusted, and must not be used
        by the UA to do automatic handling such as opening a web page
        with a URL found in an NFC tag, unless the user approves that.
      </li>
      <li>
        Since all local content that a web page has access to can be shared with
        NFC, the user needs to be clearly aware about the permissions granted
        to the web page using the Web NFC API.
      </li>
      <!--li>
        For Bluetooth and WiFi handover (supported in later versions),
        the user should have to grant access to the secondary API and must be
        able to properly understand what they are granting.
      </li-->
    </ul>
  </section> <!-- Policies -->
</section> <!-- Security and Privacy  -->

<!-- - - - - - - - - - - - - Data representation - - - - - - - - - - - - - -->
<section id="data-representation" typeof="bibo:Chapter" resource="#data-representation" property="bibo:hasPart"> <!--OddPage--><h2 id="h-data-representation" resource="#h-data-representation"><span property="xhv:role" resource="xhv:heading"><span class="secno">8. </span>Data Representation</span></h2>
  <section id="the-nfcrecord-dictionary" typeof="bibo:Chapter" resource="#the-nfcrecord-dictionary" property="bibo:hasPart"> <h3 id="h-the-nfcrecord-dictionary" resource="#h-the-nfcrecord-dictionary"><span property="xhv:role" resource="xhv:heading"><span class="secno">8.1 </span>The <strong>NFCRecord</strong> dictionary</span></h3>
    <p>
      The content of any <a href="#dfn-ndef-record" class="internalDFN" data-link-type="dfn">NDEF record</a> is exposed by the <dfn data-dfn-for="" data-dfn-type="dfn" id="dom-nfcrecord" data-idl=""><code>NFCRecord</code></dfn>
      dictionary:
    </p>
    <pre class="idl"><span class="idlEnum" id="idl-def-nfcrecordtype" data-idl="" data-title="NFCRecordType">enum <span class="idlEnumID">NFCRecordType</span> {
    "<a href="#idl-def-.empty" class="idlEnumItem">empty</a>",
    "<a href="#idl-def-.text" class="idlEnumItem">text</a>",
    "<a href="#idl-def-.url" class="idlEnumItem">url</a>",
    "<a href="#idl-def-.json" class="idlEnumItem">json</a>",
    "<a href="#idl-def-.opaque" class="idlEnumItem">opaque</a>"
};</span>

<span class="idlTypedef" id="idl-def-nfcrecorddata" data-idl="" data-title="NFCRecordData">typedef <span class="idlTypedefType">(<a href="#dfn-domstring" class="internalDFN" data-link-type="dfn"><code>DOMString</code></a> or unrestricted double or object or <a href="#dfn-arraybuffer" class="internalDFN" data-link-type="dfn"><code>ArrayBuffer</code></a>)</span> <span class="idlTypedefID">NFCRecordData</span>;</span>

<span class="idlDictionary" id="idl-def-nfcrecord" data-idl="" data-title="NFCRecord">dictionary <span class="idlDictionaryID"><a data-lt="NFCRecord" href="#dom-nfcrecord" class="internalDFN" data-link-type="dfn" data-for=""><code>NFCRecord</code></a></span> {
<span class="idlMember" id="idl-def-nfcrecord-kind" data-idl="" data-title="kind" data-dfn-for="nfcrecord">    <span class="idlMemberType"><a href="#idl-def-nfcrecordtype" class="internalDFN" data-link-type="dfn"><code>NFCRecordType</code></a></span> <span class="idlMemberName">kind</span>;</span>
<span class="idlMember" id="idl-def-nfcrecord-type" data-idl="" data-title="type" data-dfn-for="nfcrecord">    <span class="idlMemberType">USVString</span>     <span class="idlMemberName"><a data-lt="type" href="#dom-nfcrecord-type" class="internalDFN" data-link-type="dfn" data-for="NFCRecord"><code>type</code></a></span>;</span>
<span class="idlMember" id="idl-def-nfcrecord-data" data-idl="" data-title="data" data-dfn-for="nfcrecord">    <span class="idlMemberType"><a href="#idl-def-nfcrecorddata" class="internalDFN" data-link-type="dfn"><code>NFCRecordData</code></a></span> <span class="idlMemberName"><a data-lt="data" href="#dom-nfcrecord-data" class="internalDFN" data-link-type="dfn" data-for="NFCRecord"><code>data</code></a></span>;</span>
};</span></pre>
    <p>
      The <dfn data-dfn-for="nfcrecord" data-dfn-type="dfn" data-lt="type" id="dom-nfcrecord-type" data-idl=""><code>NFCRecord.type</code></dfn>
      property represents the <a href="#dfn-iana-media-type" class="internalDFN" data-link-type="dfn">IANA media type</a> of the <a href="#dfn-ndef-record" class="internalDFN" data-link-type="dfn">NDEF record</a>
      payload.
    </p>
    <p>
      The <dfn data-dfn-for="nfcrecord" data-dfn-type="dfn" data-lt="data" id="dom-nfcrecord-data" data-idl=""><code>NFCRecord.data</code></dfn> property represents the
      payload data of the <a href="#dfn-ndef-record" class="internalDFN" data-link-type="dfn">NDEF record</a> with an appropriate ECMAScript
      type, which depends on the <a href="#dfn-iana-media-type" class="internalDFN" data-link-type="dfn">IANA media type</a>.
    </p>
    <p>
    The mapping from data types of an <code><a href="#dom-nfcrecord" class="internalDFN" data-link-type="dfn"><code>NFCRecord</code></a></code> to and from
    <a href="#dfn-ndef-record" class="internalDFN" data-link-type="dfn">NDEF record</a> types is presented in the algorithmic steps which handle
    the data and described in the
    <a href="#steps-receiving">Receiving and parsing content</a>
    and <a href="#dfn-writing-or-pushing-content" class="internalDFN" data-link-type="dfn">Writing or pushing content</a> sections.
    </p>
  </section> <!-- NFCRecord dictionary -->
  <section id="the-nfcmessage-dictionary" typeof="bibo:Chapter" resource="#the-nfcmessage-dictionary" property="bibo:hasPart"> <h3 id="h-the-nfcmessage-dictionary" resource="#h-the-nfcmessage-dictionary"><span property="xhv:role" resource="xhv:heading"><span class="secno">8.2 </span>The <strong>NFCMessage</strong> dictionary</span></h3>
    <p>
      The content of any <a href="#dfn-web-nfc-message" class="internalDFN" data-link-type="dfn">Web NFC message</a> is exposed by the
      <dfn data-dfn-for="" data-dfn-type="dfn" id="dom-nfcmessage" data-idl=""><code>NFCMessage</code></dfn> dictionary:
    </p>
    <pre class="idl"><span class="idlDictionary" id="idl-def-nfcmessage" data-idl="" data-title="NFCMessage">dictionary <span class="idlDictionaryID"><a data-lt="NFCMessage" href="#dom-nfcmessage" class="internalDFN" data-link-type="dfn" data-for=""><code>NFCMessage</code></a></span> {
<span class="idlMember" id="idl-def-nfcmessage-data" data-idl="" data-title="data" data-dfn-for="nfcmessage">    <span class="idlMemberType">sequence&lt;<a href="#dom-nfcrecord" class="internalDFN" data-link-type="dfn"><code>NFCRecord</code></a>&gt;</span> <span class="idlMemberName"><a data-lt="data" href="#dom-nfcmessage-data" class="internalDFN" data-link-type="dfn" data-for="NFCMessage"><code>data</code></a></span>;</span>
<span class="idlMember" id="idl-def-nfcmessage-url" data-idl="" data-title="url" data-dfn-for="nfcmessage">    <span class="idlMemberType">USVString</span>           <span class="idlMemberName"><a data-lt="url" href="#dom-nfcmessage-url" class="internalDFN" data-link-type="dfn" data-for="NFCMessage"><code>url</code></a></span>;</span>
};</span></pre>
    <p>
      The <dfn data-dfn-for="nfcmessage" data-dfn-type="dfn" data-lt="url" id="dom-nfcmessage-url" data-idl=""><code>NFCMessage.url</code></dfn>
      property represents the <a href="#web-nfc-id" class="internalDFN" data-link-type="dfn">Web NFC Id</a> of the <a href="#dfn-web-nfc-message" class="internalDFN" data-link-type="dfn">Web NFC message</a>.
    </p>
    <p>
      The <dfn data-dfn-for="nfcmessage" data-dfn-type="dfn" data-lt="data" id="dom-nfcmessage-data" data-idl=""><code>NFCMessage.data</code></dfn>
      property represents the <a href="#dfn-ndef-message" class="internalDFN" data-link-type="dfn">NDEF message</a> defining the
      <a href="#dfn-web-nfc-message" class="internalDFN" data-link-type="dfn">Web NFC message</a>.
    </p>
  </section>

  <section id="data-mapping" typeof="bibo:Chapter" resource="#data-mapping" property="bibo:hasPart"><h3 id="h-data-mapping" resource="#h-data-mapping"><span property="xhv:role" resource="xhv:heading"><span class="secno">8.3 </span>Data mapping</span></h3>
  <p>
    A <dfn data-dfn-type="dfn" id="dfn-json-compatible-iana-media-type">JSON compatible <a href="#dfn-iana-media-type" class="internalDFN" data-link-type="dfn">IANA media type</a></dfn> is defined by the following
    ABNF:
    </p><pre>      <code>"application/"</code> (<code>"json"</code> / &lt;VCHAR except '/' and "*"&gt; <code>"+json"</code>)
    </pre>
  <p></p>
  <p>
    The mapping from data types of an <code><a href="#dom-nfcrecord" class="internalDFN" data-link-type="dfn"><code>NFCRecord</code></a></code> to
    <a href="#dfn-ndef-record" class="internalDFN" data-link-type="dfn">NDEF record</a> types, as used in the <a href="#dfn-writing-or-pushing-content" class="internalDFN" data-link-type="dfn">Writing or pushing content</a>
    section is as follows:
  </p>
  <table class="simple">
    <tbody><tr>
      <th>NFCRecord kind</th>
      <th>NFCRecord type</th>
      <th>NFCRecord data</th>
      <th>NDEF record type</th>
    </tr>
    <tr>
      <td>"empty"</td>
      <td><i>not used</i></td>
      <td><i>not used</i></td>
      <td>NFC Forum Empty Type (<a href="#dfn-tnf" class="internalDFN" data-link-type="dfn">TNF</a>=0)</td>
    </tr>
    <tr>
      <td>"text"</td>
      <td><i>not used</i></td>
      <td><code>DOMString</code></td>
      <td>NFC Forum Well Known Type (<a href="#dfn-tnf" class="internalDFN" data-link-type="dfn">TNF</a>=1) with type <i>Text</i></td>
    </tr>
    <tr>
      <td>"url"</td>
      <td><i>not used</i></td>
      <td><code>DOMString</code></td>
      <td>NFC Forum Well Known Type (<a href="#dfn-tnf" class="internalDFN" data-link-type="dfn">TNF</a>=1) with type <i>URI</i></td>
    </tr>
    <tr>
      <td>"json"</td>
      <td><a href="#dfn-json-compatible-iana-media-type" class="internalDFN" data-link-type="dfn">JSON compatible IANA media type</a></td>
      <td>
        <code>null</code> or <code>DOMString</code> or <code>Number</code> or
        <code>Object</code>
      </td>
      <td>Media Type as defined in [<cite><a class="bibref" href="#bib-RFC2046">RFC2046</a></cite>] (<a href="#dfn-tnf" class="internalDFN" data-link-type="dfn">TNF</a>=2) with
        <a href="#dfn-iana-media-type" class="internalDFN" data-link-type="dfn">IANA media type</a> specified in the <code>type</code> attribute.
      </td>
    </tr>
    <tr>
      <td>"opaque"</td>
      <td><a href="#dfn-iana-media-type" class="internalDFN" data-link-type="dfn">IANA media type</a></td>
      <td><code>ArrayBuffer</code></td>
      <td>Media Type as defined in [<cite><a class="bibref" href="#bib-RFC2046">RFC2046</a></cite>] (<a href="#dfn-tnf" class="internalDFN" data-link-type="dfn">TNF</a>=2)</td>
    </tr>
    <tr>
      <td>"opaque"</td>
      <td><code>""</code> (<i>empty</i>)</td>
      <td><code>ArrayBuffer</code> or typed array</td>
      <td>NFC Forum External Type (<a href="#dfn-tnf" class="internalDFN" data-link-type="dfn">TNF</a>=4)</td>
    </tr>
  </tbody></table>
  <p>
    The mapping from <a href="#dfn-ndef-record" class="internalDFN" data-link-type="dfn">NDEF record</a> types to <code><a href="#dom-nfcrecord" class="internalDFN" data-link-type="dfn"><code>NFCRecord</code></a></code>,
    as used for incoming <a href="#dfn-ndef-message" class="internalDFN" data-link-type="dfn">NDEF message</a>s described in the
    <a href="#steps-receiving">Receiving and parsing content</a> section, is as
    follows:
  </p>
  <table class="simple">
    <tbody><tr>
      <th>NDEF record type</th>
      <th>NFCRecord kind</th>
      <th>NFCRecord type</th>
      <th>NFCRecord data</th>
    </tr>
    <tr>
      <td>NFC Forum Empty Type (<a href="#dfn-tnf" class="internalDFN" data-link-type="dfn">TNF</a>=0)</td>
      <td>"empty"</td>
      <td>""</td>
      <td><code>null</code></td>
    </tr>
    <tr>
      <td>NFC Forum Well Known Type (<a href="#dfn-tnf" class="internalDFN" data-link-type="dfn">TNF</a>=1) with type <i>Text</i></td>
      <td>"text"</td>
      <td>"text/plain"</td>
      <td><code>DOMString</code></td>
    </tr>
    <tr>
      <td>NFC Forum Well Known Type (<a href="#dfn-tnf" class="internalDFN" data-link-type="dfn">TNF</a>=1) with type <i>URI</i></td>
      <td>"url"</td>
      <td>"text/plain"</td>
      <td><code>DOMString</code></td>
    </tr>
    <tr>
      <td>NFC Forum Well Known Type (<a href="#dfn-tnf" class="internalDFN" data-link-type="dfn">TNF</a>=1) with type
          <i>Smart Poster</i></td>
      <td>"url"</td>
      <td>"text/plain"</td>
      <td><code>DOMString</code></td>
    </tr>
    <tr>
      <td>Absolute URI as defined in [<cite><a class="bibref" href="#bib-RFC3986">RFC3986</a></cite>] (<a href="#dfn-tnf" class="internalDFN" data-link-type="dfn">TNF</a>=3)</td>
      <td>"url"</td>
      <td>"text/plain"</td>
      <td><code>DOMString</code></td>
    </tr>
    <tr>
      <td>Media Type as defined in [<cite><a class="bibref" href="#bib-RFC2046">RFC2046</a></cite>] (<a href="#dfn-tnf" class="internalDFN" data-link-type="dfn">TNF</a>=2) with
        <a href="#dfn-json-compatible-iana-media-type" class="internalDFN" data-link-type="dfn">JSON compatible IANA media type</a>
      </td>
      <td>"json"</td>
      <td>The <a href="#dfn-iana-media-type" class="internalDFN" data-link-type="dfn">IANA media type</a> used in the NDEF record</td>
      <td>
        <code>null</code> or <code>DOMString</code> or <code>Number</code> or
        <code>Object</code>
      </td>
    </tr>
    <tr>
      <td>Media Type as defined in [<cite><a class="bibref" href="#bib-RFC2046">RFC2046</a></cite>] (<a href="#dfn-tnf" class="internalDFN" data-link-type="dfn">TNF</a>=2)</td>
      <td>"opaque"</td>
      <td>The <a href="#dfn-iana-media-type" class="internalDFN" data-link-type="dfn">IANA media type</a> used in the NDEF record</td>
      <td><code>ArrayBuffer</code></td>
    </tr>
    <tr>
      <td>NFC Forum External Type (<a href="#dfn-tnf" class="internalDFN" data-link-type="dfn">TNF</a>=4) with type other than
        <code>urn:nfc:ext:w3.org:webnfc*</code></td>
      <td>"opaque"</td>
      <td>"application/octet-stream"</td>
      <td><code>ArrayBuffer</code></td>
    </tr>
    <tr>
      <td>Any other <a href="#dfn-ndef-record" class="internalDFN" data-link-type="dfn">NDEF record</a> type</td>
      <td>"opaque"</td>
      <td>"application/octet-stream"</td>
      <td><code>ArrayBuffer</code></td>
    </tr>
  </tbody></table>
  <p>
    The <a href="#dfn-web-nfc-record" class="internalDFN" data-link-type="dfn">Web NFC record</a>s <em class="rfc2119" title="MUST NOT">MUST NOT</em> be exposed to client
    <a href="#dfn-browsing-context" class="internalDFN" data-link-type="dfn">browsing context</a>s.
  </p>
  </section>
</section> <!-- Data types and content -->

<!-- - - - - - - - - - - Extended interface Navigator - - - - - - - - - - - -->
<section id="extensions-to-the-navigator-interface" typeof="bibo:Chapter" resource="#extensions-to-the-navigator-interface" property="bibo:hasPart"> <!--OddPage--><h2 id="h-extensions-to-the-navigator-interface" resource="#h-extensions-to-the-navigator-interface"><span property="xhv:role" resource="xhv:heading"><span class="secno">9. </span>Extensions to the <strong>Navigator</strong> interface</span></h2>
  <p>
    The HTML document defines a
    <a href="http://www.whatwg.org/specs/web-apps/current-work/#dom-navigator">
    <code>Navigator</code></a> interface [HTML] which this specification
    extends.
  </p>
  <pre class="idl"><span class="idlInterface" id="idl-def-navigator" data-idl="" data-title="Navigator">partial interface <span class="idlInterfaceID">Navigator</span> {
<span class="idlAttribute" id="idl-def-navigator-nfc" data-idl="" data-title="nfc" data-dfn-for="navigator">    readonly    attribute <span class="idlAttrType"><a href="#dom-nfc" class="internalDFN" data-link-type="dfn"><code>NFC</code></a></span> <span class="idlAttrName">nfc</span>;</span>
};</span></pre>
  <!-- - - - - - - - - - - - nfc attribute  - - - - - - - - - - - -->
  <section id="the-nfc-attribute" typeof="bibo:Chapter" resource="#the-nfc-attribute" property="bibo:hasPart"> <h3 id="h-the-nfc-attribute" resource="#h-the-nfc-attribute"><span property="xhv:role" resource="xhv:heading"><span class="secno">9.1 </span>The <strong>nfc</strong> attribute</span></h3>
  <p>
    On getting the <a href="#dom-nfc" class="internalDFN" data-link-type="dfn"><code>nfc</code></a> attribute, the UA <em class="rfc2119" title="MUST">MUST</em> return the <a href="#dom-nfc" class="internalDFN" data-link-type="dfn"><code>NFC</code></a>
    object, which provides NFC related functionality.
  </p>
  </section> <!-- nfc attribute -->
</section> <!-- Navigator -->

<section id="the-nfc-interface" typeof="bibo:Chapter" resource="#the-nfc-interface" property="bibo:hasPart"> <!--OddPage--><h2 id="h-the-nfc-interface" resource="#h-the-nfc-interface"><span property="xhv:role" resource="xhv:heading"><span class="secno">10. </span>The <strong>NFC</strong> interface</span></h2>
  An <dfn data-dfn-for="" data-dfn-type="dfn" id="dom-nfc" data-idl=""><code>NFC</code></dfn> instance provides a way for the <a href="#dfn-browsing-context" class="internalDFN" data-link-type="dfn">browsing context</a> to
  obtain an <a href="#dfn-nfc-adapter" class="internalDFN" data-link-type="dfn">NFC adapter</a> providing NFC functionality.
  Implementations <em class="rfc2119" title="MAY">MAY</em> expose multiple adapters.
  <pre class="idl"><span class="idlInterface" id="idl-def-nfc" data-idl="" data-title="NFC">interface <span class="idlInterfaceID"><a data-lt="NFC" href="#dom-nfc" class="internalDFN" data-link-type="dfn" data-for=""><code>NFC</code></a></span> {
<span class="idlMethod" id="idl-def-nfc-requestadapter()" data-idl="" data-title="requestAdapter" data-dfn-for="nfc">    <span class="idlMethType">Promise&lt;<a href="#idl-def-nfcadapter" class="internalDFN" data-link-type="dfn"><code>NFCAdapter</code></a>&gt;</span> <span class="idlMethName"><a data-lt="requestAdapter" href="#dom-nfc-requestadapter" class="internalDFN" data-link-type="dfn" data-for="NFC"><code>requestAdapter</code></a></span>();</span>
};</span></pre>
  <p>
    Instances of <a href="#idl-def-nfcadapter" class="internalDFN" data-link-type="dfn"><code>NFCAdapter</code></a> are created with the internal slots
    described in the following table:
  </p>
  <table class="simple">
    <thead>
     <tr>
      <th>Internal Slot</th>
      <th>Description (<em>non-normative</em>)</th>
     </tr>
    </thead>
    <tbody>
     <tr>
      <td>[[receivedMessage]]</td>
      <td>
        An <a href="#dom-nfcmessage" class="internalDFN" data-link-type="dfn"><code>NFCMessage</code></a> to hold the last received message, initially
        set to <code>null</code>.
      </td>
     </tr>
     <tr>
      <td>[[suspended]]</td>
      <td>
        A boolean flag indicating whether the adapter is suspended or not,
        initially <code>false</code>.
      </td>
     </tr>
     <tr>
      <td>[[tagMessage]]</td>
      <td>
        An <a href="#dom-nfcmessage" class="internalDFN" data-link-type="dfn"><code>NFCMessage</code></a> to hold the <a href="#dfn-ndef-message" class="internalDFN" data-link-type="dfn">NDEF message</a> to be pushed to a
        <a href="#dfn-nfc-tag" class="internalDFN" data-link-type="dfn">NFC tag</a>, initially set to <code>null</code>.
      </td>
     </tr>
     <tr>
      <td>[[tagTimer]]</td>
      <td>A timer which can perform an action after <i>timeout</i> milliseconds.</td>
     </tr>
     <tr>
      <td>[[peerMessage]]</td>
      <td>
        An <a href="#dom-nfcmessage" class="internalDFN" data-link-type="dfn"><code>NFCMessage</code></a> to hold the <a href="#dfn-ndef-message" class="internalDFN" data-link-type="dfn">NDEF message</a> to be pushed to a
        <a href="#dfn-nfc-peer" class="internalDFN" data-link-type="dfn">NFC peer</a>, initially set to <code>null</code>.
      </td>
     </tr>
     <tr>
      <td>[[peerTimer]]</td>
      <td>A timer which can perform an action after <i>timeout</i> milliseconds.</td>
     </tr>
     <tr>
      <td>[[watchList]]</td>
      <td>
        A list of <a href="#dfn-nfc-watch" class="internalDFN" data-link-type="dfn">NFC watch</a>es initially set to empty list.
      </td>
     </tr>
    </tbody>
  </table>
  <p>
    The <dfn data-dfn-for="nfc" data-dfn-type="dfn" data-lt="requestadapter" id="dom-nfc-requestadapter" data-idl=""><code>NFC.requestAdapter</code></dfn>() method, when invoked <em class="rfc2119" title="MUST">MUST</em> return a new
    promise <var>promise</var> and run the following steps <a href="#dfn-in-parallel" class="internalDFN" data-link-type="dfn">in parallel</a>:
    </p><ol id="steps-requestAdapter">
      <li>
        If the <a href="#dfn-incumbent-settings-object" class="internalDFN" data-link-type="dfn">incumbent settings object</a> is not a <a href="#dfn-secure-context" class="internalDFN" data-link-type="dfn">secure context</a>,
        reject <var>promise</var> with <code>"<a href="#dfn-securityerror" class="internalDFN" data-link-type="dfn">SecurityError</a>"</code>,
        and abort these steps.
        <div class="note"><div class="note-title" aria-level="3" role="heading" id="h-note6"><span>Note</span></div><div class="">
          Browsers may ignore this rule for development purposes only.
        </div></div>
      </li>
      <li>
        If there is no support for <a href="#dfn-nfc-adapter" class="internalDFN" data-link-type="dfn">NFC adapter</a> handling functionality in
        hardware, software, or due to physical incompatibility,
        reject <var>promise</var> with
        <code>"<a href="#dfn-notsupportederror" class="internalDFN" data-link-type="dfn">NotSupportedError</a>"</code>, and abort these steps.
      </li>
      <li>
        Let <var>adapter</var> be <code>null</code>.
        <div class="note"><div class="note-title" aria-level="3" role="heading" id="h-note7"><span>Note</span></div><p class="">
          Each <code>Window</code> object has a separate <code>NFCAdapter</code>
          instance. The
          <a href="http://www.w3.org/TR/page-visibility/#now-visible-algorithm">
           visibility</a> and
           <a href="https://html.spec.whatwg.org/#focus">focus</a>
           state of the <code>Window</code> object
           determines the <a href="#nfc-suspended">suspended</a> state
           of the associated <code>NFCAdapter</code> instance.
        </p></div>
      </li>
      <li>
        If there is a default <a href="#dfn-nfc-adapter" class="internalDFN" data-link-type="dfn">NFC adapter</a>, set <var>adapter</var> to the
        corresponding <code><a href="#idl-def-nfcadapter" class="internalDFN" data-link-type="dfn"><code>NFCAdapter</code></a></code> object, or if that does not
        exist, a new <code><a href="#idl-def-nfcadapter" class="internalDFN" data-link-type="dfn"><code>NFCAdapter</code></a></code> object which is bound to
        work with the default <a href="#dfn-nfc-adapter" class="internalDFN" data-link-type="dfn">NFC adapter</a>.
        Resolve <a href="#dfn-promise" class="internalDFN" data-link-type="dfn">promise</a> with <var>adapter</var>, and terminate these
        steps.
      </li>
      <li>
        Otherwise, make a request to enumerate available <a href="#dfn-nfc-adapter" class="internalDFN" data-link-type="dfn">NFC adapter</a>s.
        If the request fails, reject <var>promise</var> with
        <code>"<a href="#dfn-notfounderror" class="internalDFN" data-link-type="dfn">NotFoundError</a>"</code>, and abort these steps.
      </li>
      <li>
        If the request is successful, select one of the <a href="#dfn-nfc-adapter" class="internalDFN" data-link-type="dfn">NFC adapter</a>s
        based on the following algorithm:
        <ol>
          <li>Let <var>adapter</var> be a new <code><a href="#idl-def-nfcadapter" class="internalDFN" data-link-type="dfn"><code>NFCAdapter</code></a></code>
            object.
          </li>
          <li>
            If there is only one <a href="#dfn-nfc-adapter" class="internalDFN" data-link-type="dfn">NFC adapter</a>, then bind
            <var>adapter</var> to that.
          </li>
          <li>
            Otherwise, if there are multiple <a href="#dfn-nfc-adapter" class="internalDFN" data-link-type="dfn">NFC adapter</a>s available, and
            there is a system or user setting available with a preference to
            select the default adapter, then bind <var>adapter</var> to that.
          </li>
          <li>
            Otherwise, the UA <em class="rfc2119" title="MAY">MAY</em> pop up a user dialog for
            selecting one of the <a href="#dfn-nfc-adapter" class="internalDFN" data-link-type="dfn">NFC adapter</a>, and bind <var>adapter</var>
            to the selected one.
          </li>
          <li>
            Otherwise if user prompt is blocked or canceled, bind
            <var>adapter</var> to the first built-in <a href="#dfn-nfc-adapter" class="internalDFN" data-link-type="dfn">NFC adapter</a>
          </li>
          <li>
            Otherwise, if no built-in adapters are found, bind
            <var>adapter</var> the first external (e.g. USB) <a href="#dfn-nfc-adapter" class="internalDFN" data-link-type="dfn">NFC adapter</a>.
          </li>
        </ol>
      </li>
      <li>
        Resolve <var>promise</var> with <var>adapter</var>.
      </li>
    </ol>
  <p></p>
</section> <!-- NFC interface -->

<section id="the-nfcadapter-interface" typeof="bibo:Chapter" resource="#the-nfcadapter-interface" property="bibo:hasPart"> <!--OddPage--><h2 id="h-the-nfcadapter-interface" resource="#h-the-nfcadapter-interface"><span property="xhv:role" resource="xhv:heading"><span class="secno">11. </span>The <strong>NFCAdapter</strong> interface</span></h2>
  The <a href="#idl-def-nfcadapter" class="internalDFN" data-link-type="dfn"><code>NFCAdapter</code></a> represents an NFC hardware device which can read and
  write data. It allows for sending <a href="#dfn-web-nfc-message" class="internalDFN" data-link-type="dfn">Web NFC message</a>s to <a href="#dfn-nfc-tag" class="internalDFN" data-link-type="dfn">NFC tag</a>s
  or <a href="#dfn-nfc-peer" class="internalDFN" data-link-type="dfn">NFC peer</a>s within range, and to set up and cancel <a href="#dfn-nfc-watch" class="internalDFN" data-link-type="dfn">NFC watch</a>es
  to handle incoming <a href="#dfn-web-nfc-message" class="internalDFN" data-link-type="dfn">Web NFC message</a>s either from an <a href="#dfn-nfc-tag" class="internalDFN" data-link-type="dfn">NFC tag</a> or an
  <a href="#dfn-nfc-peer" class="internalDFN" data-link-type="dfn">NFC peer</a>.
  <pre class="idl"><span class="idlInterface" id="idl-def-nfcadapter" data-idl="" data-title="NFCAdapter">interface <span class="idlInterfaceID">NFCAdapter</span> {
<span class="idlMethod" id="idl-def-nfcadapter-pushmessage(nfcmessage,nfcpushoptions)" data-idl="" data-title="pushMessage" data-dfn-for="nfcadapter">    <span class="idlMethType">Promise&lt;void&gt;</span> <span class="idlMethName"><a data-lt="pushMessage" href="#dom-nfcadapter-pushmessage" class="internalDFN" data-link-type="dfn" data-for="NFCAdapter"><code>pushMessage</code></a></span>(<span class="idlParam"><span class="idlParamType"><a href="#dom-nfcmessage" class="internalDFN" data-link-type="dfn"><code>NFCMessage</code></a></span> <span class="idlParamName">message</span></span>, <span class="idlParam"><span class="idlParamType"><a href="#idl-def-nfcpushoptions" class="internalDFN" data-link-type="dfn"><code>NFCPushOptions</code></a></span> <span class="idlParamName">options</span></span>);</span>
<span class="idlMethod" id="idl-def-nfcadapter-cancelpush(nfcpushtarget)" data-idl="" data-title="cancelPush" data-dfn-for="nfcadapter">    <span class="idlMethType">void</span>          <span class="idlMethName"><a data-lt="cancelPush" href="#dom-nfcadapter-cancelpush" class="internalDFN" data-link-type="dfn" data-for="NFCAdapter"><code>cancelPush</code></a></span>(<span class="idlParam"><span class="idlParamType"><a href="#idl-def-nfcpushtarget" class="internalDFN" data-link-type="dfn"><code>NFCPushTarget</code></a></span> <span class="idlParamName">target</span></span>);</span>
<span class="idlMethod" id="idl-def-nfcadapter-watch(nfcwatchoptions,messagecallback)" data-idl="" data-title="watch" data-dfn-for="nfcadapter">    <span class="idlMethType">Promise&lt;long&gt;</span> <span class="idlMethName"><a data-lt="watch" href="#dom-nfcadapter-watch" class="internalDFN" data-link-type="dfn" data-for="NFCAdapter"><code>watch</code></a></span>(<span class="idlParam"><span class="idlParamType"><a href="#dom-nfcwatchoptions" class="internalDFN" data-link-type="dfn"><code>NFCWatchOptions</code></a></span> <span class="idlParamName">options</span></span>, <span class="idlParam"><span class="idlParamType"><a href="#idl-def-messagecallback" class="internalDFN" data-link-type="dfn"><code>MessageCallback</code></a></span> <span class="idlParamName">callback</span></span>);</span>
<span class="idlMethod" id="idl-def-nfcadapter-unwatch(long)" data-idl="" data-title="unwatch" data-dfn-for="nfcadapter">    <span class="idlMethType">Promise&lt;void&gt;</span> <span class="idlMethName"><a data-lt="unwatch" href="#dom-nfcadapter-unwatch" class="internalDFN" data-link-type="dfn" data-for="NFCAdapter"><code>unwatch</code></a></span>(<span class="idlParam"><span class="idlParamType">long</span> <span class="idlParamName">id</span></span>);</span>
};</span>

<span class="idlCallback" id="idl-def-messagecallback" data-idl="" data-title="MessageCallback">callback <span class="idlCallbackID">MessageCallback</span> = <span class="idlCallbackType">void</span> (<span class="idlParam"><span class="idlParamType"><a href="#dom-nfcmessage" class="internalDFN" data-link-type="dfn"><code>NFCMessage</code></a></span> <span class="idlParamName">message</span></span>);</span></pre>
  <div class="note"><div class="note-title" aria-level="3" role="heading" id="h-note8"><span>Note</span></div><p class="">
    In later versions <code>cancelPush()</code> and <code>unwatch()</code>
    may be obsoleted by <a href="https://github.com/domenic/cancelable-promise">
    cancelable Promises</a> used with <code>pushMessage()</code> and
    <code>watch()</code>, respectively.
  </p></div>
  <section id="the-nfcpushoptions-dictionary" typeof="bibo:Chapter" resource="#the-nfcpushoptions-dictionary" property="bibo:hasPart"> <h3 id="h-the-nfcpushoptions-dictionary" resource="#h-the-nfcpushoptions-dictionary"><span property="xhv:role" resource="xhv:heading"><span class="secno">11.1 </span>The <strong>NFCPushOptions</strong> dictionary</span></h3>
    <pre class="idl"><span class="idlEnum" id="idl-def-nfcpushtarget" data-idl="" data-title="NFCPushTarget">enum <span class="idlEnumID">NFCPushTarget</span> {
    "<a href="#idl-def-.tag" class="idlEnumItem">tag</a>",
    "<a href="#idl-def-.peer" class="idlEnumItem">peer</a>",
    "<a href="#idl-def-.any" class="idlEnumItem">any</a>"
};</span>

<span class="idlDictionary" id="idl-def-nfcpushoptions" data-idl="" data-title="NFCPushOptions">dictionary <span class="idlDictionaryID">NFCPushOptions</span> {
<span class="idlMember" id="idl-def-nfcpushoptions-target" data-idl="" data-title="target" data-dfn-for="nfcpushoptions">    <span class="idlMemberType"><a href="#idl-def-nfcpushtarget" class="internalDFN" data-link-type="dfn"><code>NFCPushTarget</code></a></span> <span class="idlMemberName"><a data-lt="target" href="#dom-nfcpushoptions-target" class="internalDFN" data-link-type="dfn" data-for="NFCPushOptions"><code>target</code></a></span> = <span class="idlMemberValue">"any"</span>;</span>
<span class="idlMember" id="idl-def-nfcpushoptions-timeout" data-idl="" data-title="timeout" data-dfn-for="nfcpushoptions">    <span class="idlMemberType">unsigned long</span> <span class="idlMemberName"><a data-lt="timeout" href="#dom-nfcpushoptions-timeout" class="internalDFN" data-link-type="dfn" data-for="NFCPushOptions"><code>timeout</code></a></span>;</span>
};</span></pre>
    <p>
      The <dfn data-dfn-for="nfcpushoptions" data-dfn-type="dfn" data-lt="target" id="dom-nfcpushoptions-target" data-idl=""><code>NFCPushOptions.target</code></dfn> property
      denotes the intended target for the pending <code>pushMessage()</code>
      operation.
    </p>
    <p>
      The <dfn data-dfn-for="nfcpushoptions" data-dfn-type="dfn" data-lt="timeout" id="dom-nfcpushoptions-timeout" data-idl=""><code>NFCPushOptions.timeout</code></dfn> property
      denotes the timeout for the pending <code>pushMessage()</code>
      operation expressed in milliseconds. The default value is
      implementation-dependent. The value <code>Infinity</code> means there is
      no timeout. After the <var>timeout</var> expires, the
      message set for sending is cleared, an error is returned, and a new
      <a href="#dfn-web-nfc-message" class="internalDFN" data-link-type="dfn">Web NFC message</a> can be set for sending.
    </p>
  </section>
  <section id="the-nfcwatchoptions-dictionary" typeof="bibo:Chapter" resource="#the-nfcwatchoptions-dictionary" property="bibo:hasPart"> <h3 id="h-the-nfcwatchoptions-dictionary" resource="#h-the-nfcwatchoptions-dictionary"><span property="xhv:role" resource="xhv:heading"><span class="secno">11.2 </span>The <strong>NFCWatchOptions</strong> dictionary</span></h3>
      <p>
        To describe which messages an application is interested in, the
        <dfn data-dfn-for="" data-dfn-type="dfn" id="dom-nfcwatchoptions" data-idl=""><code>NFCWatchOptions</code></dfn> dictionary is used:
      </p>
      <pre class="idl"><span class="idlEnum" id="idl-def-nfcwatchmode" data-idl="" data-title="NFCWatchMode">enum <span class="idlEnumID">NFCWatchMode</span> {
    "<a href="#idl-def-.web-nfc-only" class="idlEnumItem">web-nfc-only</a>",
    "<a href="#idl-def-.any" class="idlEnumItem">any</a>"
};</span>

<span class="idlDictionary" id="idl-def-nfcwatchoptions" data-idl="" data-title="NFCWatchOptions">dictionary <span class="idlDictionaryID"><a data-lt="NFCWatchOptions" href="#dom-nfcwatchoptions" class="internalDFN" data-link-type="dfn" data-for=""><code>NFCWatchOptions</code></a></span> {
<span class="idlMember" id="idl-def-nfcwatchoptions-url" data-idl="" data-title="url" data-dfn-for="nfcwatchoptions">    <span class="idlMemberType">USVString</span>    <span class="idlMemberName"><a data-lt="url" href="#dom-nfcwatchoptions-url" class="internalDFN" data-link-type="dfn" data-for="NFCWatchOptions"><code>url</code></a></span> = <span class="idlMemberValue">""</span>;</span>
<span class="idlMember" id="idl-def-nfcwatchoptions-kind" data-idl="" data-title="kind" data-dfn-for="nfcwatchoptions">    <span class="idlMemberType">USVString</span>    <span class="idlMemberName"><a data-lt="kind" href="#dom-nfcwatchoptions-kind" class="internalDFN" data-link-type="dfn" data-for="NFCWatchOptions"><code>kind</code></a></span> = <span class="idlMemberValue">""</span>;</span>
<span class="idlMember" id="idl-def-nfcwatchoptions-type" data-idl="" data-title="type" data-dfn-for="nfcwatchoptions">    <span class="idlMemberType">USVString</span>    <span class="idlMemberName"><a data-lt="type" href="#dom-nfcwatchoptions-type" class="internalDFN" data-link-type="dfn" data-for="NFCWatchOptions"><code>type</code></a></span> = <span class="idlMemberValue">""</span>;</span>
<span class="idlMember" id="idl-def-nfcwatchoptions-mode" data-idl="" data-title="mode" data-dfn-for="nfcwatchoptions">    <span class="idlMemberType"><a href="#idl-def-nfcwatchmode" class="internalDFN" data-link-type="dfn"><code>NFCWatchMode</code></a></span> <span class="idlMemberName"><a data-lt="mode" href="#dom-nfcwatchoptions-mode" class="internalDFN" data-link-type="dfn" data-for="NFCWatchOptions"><code>mode</code></a></span> = <span class="idlMemberValue">"web-nfc-only"</span>;</span>
};</span></pre>
      <p>
        The <dfn data-dfn-for="nfcwatchoptions" data-dfn-type="dfn" data-lt="url" id="dom-nfcwatchoptions-url" data-idl=""><code>NFCWatchOptions.url</code></dfn> property
        denotes the <a href="#dfn-url-pattern" class="internalDFN" data-link-type="dfn"><code>URL pattern</code></a> which is used for matching the
        URL <a href="#dfn-origin" class="internalDFN" data-link-type="dfn">origin</a> and <a href="#dfn-url-path" class="internalDFN" data-link-type="dfn">URL path</a> of the <a href="#dfn-web-nfc-message" class="internalDFN" data-link-type="dfn">Web NFC message</a>
        which is stored in the <a href="#dfn-web-nfc-record" class="internalDFN" data-link-type="dfn">Web NFC record</a>.
        The default value <code>""</code> means that no matching happens.
      </p>
      <p>
        The <dfn data-dfn-for="nfcwatchoptions" data-dfn-type="dfn" data-lt="kind" id="dom-nfcwatchoptions-kind" data-idl=""><code>NFCWatchOptions.kind</code></dfn> property
        denotes the string value which is used for matching the
        <code>kind</code> property of each <code>NFCRecord</code> object
        in a <a href="#dfn-web-nfc-message" class="internalDFN" data-link-type="dfn">Web NFC message</a>.
        The default value <code>""</code> means that no matching happens.
      </p>
      <p>
        The <dfn data-dfn-for="nfcwatchoptions" data-dfn-type="dfn" data-lt="type" id="dom-nfcwatchoptions-type" data-idl=""><code>NFCWatchOptions.type</code></dfn> property
        denotes the <a href="#dfn-match-pattern" class="internalDFN" data-link-type="dfn"><code>match pattern</code></a> which is used for matching the
        <code>type</code> property of each <code>NFCRecord</code> object
        in a <a href="#dfn-web-nfc-message" class="internalDFN" data-link-type="dfn">Web NFC message</a>.
        The default value <code>""</code> means that no matching happens.
      </p>
      <p>
        The <dfn data-dfn-for="nfcwatchoptions" data-dfn-type="dfn" data-lt="mode" id="dom-nfcwatchoptions-mode" data-idl=""><code>NFCWatchOptions.mode</code></dfn> property tells
        whether only <a href="#dfn-web-nfc-content" class="internalDFN" data-link-type="dfn">Web NFC content</a> or any <a href="#dfn-nfc-content" class="internalDFN" data-link-type="dfn">NFC content</a> will be
        watched.
      </p>
      <p>
        The <code>"web-nfc-only"</code> value means that only those
        <a href="#dfn-ndef-message" class="internalDFN" data-link-type="dfn">NDEF message</a>s are exposed which contain a
        <a href="#dfn-web-nfc-record" class="internalDFN" data-link-type="dfn">Web NFC record</a>, i.e. which are meant for web pages.
      </p>
      <p>
        The <code>"any"</code> value means that all <a href="#dfn-ndef-message" class="internalDFN" data-link-type="dfn">NDEF message</a>s
        are exposed.
      </p>
      <div class="example"><div class="example-title"><span>Example 4</span>: Filter accepting only JSON content from https://www.w3.org</div><pre class="example highlight prettyprint prettyprinted"><span class="kwd">var</span><span class="pln"> watchOptions </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  url</span><span class="pun">:</span><span class="pln"> </span><span class="str">"https://www.w3.org/*"</span><span class="pun">,</span><span class="pln">  </span><span class="com">// any path from the domain is accepted</span><span class="pln">
  kind</span><span class="pun">:</span><span class="pln"> </span><span class="str">"json"</span><span class="pun">,</span><span class="pln">
  type</span><span class="pun">:</span><span class="pln"> </span><span class="str">"application/*+json"</span><span class="pln">  </span><span class="com">// any JSON-based IANA media type</span><span class="pln">
</span><span class="pun">}</span></pre></div>
      <div class="example"><div class="example-title"><span>Example 5</span>: Filter which only accept binary content from a given path but any domain</div><pre class="example highlight prettyprint prettyprinted"><span class="kwd">var</span><span class="pln"> watchOptions </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  url</span><span class="pun">:</span><span class="pln"> </span><span class="str">"*://*/info/restaurant/daily-menu/"</span><span class="pun">,</span><span class="pln">  </span><span class="com">// accepted from any domain</span><span class="pln">
  kind</span><span class="pun">:</span><span class="pln"> </span><span class="str">"opaque"</span><span class="pun">,</span><span class="pln">
  type</span><span class="pun">:</span><span class="pln"> </span><span class="str">"application/octet-stream"</span><span class="pln">
</span><span class="pun">}</span></pre></div>
    </section> <!-- NFCWatchOptions -->

  <section id="writing-or-pushing-content" typeof="bibo:Chapter" resource="#writing-or-pushing-content" property="bibo:hasPart"><h3 id="h-writing-or-pushing-content" resource="#h-writing-or-pushing-content"><span property="xhv:role" resource="xhv:heading"><span class="secno">11.3 </span><dfn data-dfn-type="dfn" id="dfn-writing-or-pushing-content">Writing or pushing content</dfn></span></h3>
    <p>
      This section describes how to write an <a href="#dfn-ndef-message" class="internalDFN" data-link-type="dfn">NDEF message</a>
      to an <a href="#dfn-nfc-tag" class="internalDFN" data-link-type="dfn">NFC tag</a> or how to push it to an <a href="#dfn-nfc-peer" class="internalDFN" data-link-type="dfn">NFC peer</a>
      device next time when they get into proximity range, or until
      a timeout expires. At any time there is at maximum two
      <a href="#dfn-web-nfc-message" class="internalDFN" data-link-type="dfn">Web NFC message</a>s that can be set for sending for an <a href="#dfn-origin" class="internalDFN" data-link-type="dfn">origin</a>:
      one targeted to <a href="#dfn-nfc-tag" class="internalDFN" data-link-type="dfn">NFC tag</a>s and one to <a href="#dfn-nfc-peer" class="internalDFN" data-link-type="dfn">NFC peer</a>s.
      When there is a <a href="#dfn-web-nfc-message" class="internalDFN" data-link-type="dfn">Web NFC message</a> set for sending
      to <code>"any"</code> target, then no more messages are accepted to be
      set until the current message is sent, or a timeout happens, or the
      sending is canceled by the
      <a href="cancelPush"><code>cancelPush()</code></a> method.
    </p>
    <section id="the-pushmessage-method" typeof="bibo:Chapter" resource="#the-pushmessage-method" property="bibo:hasPart"><h4 id="h-the-pushmessage-method" resource="#h-the-pushmessage-method"><span property="xhv:role" resource="xhv:heading"><span class="secno">11.3.1 </span>The pushMessage() method</span></h4>
      <p id="steps-pushMessage">
        The
        <dfn data-dfn-for="nfcadapter" data-dfn-type="dfn" data-lt="pushmessage" id="dom-nfcadapter-pushmessage" data-idl=""><code>NFCAdapter.pushMessage</code></dfn>(<var>message</var>, <var>options</var>)
         method, when invoked, <em class="rfc2119" title="MUST">MUST</em> run the
        <dfn data-dfn-type="dfn" id="dfn-push-a-message">push a message</dfn> algorithm:
        </p><ol>
          <li>
            Return a new <a href="#dfn-promise" class="internalDFN" data-link-type="dfn"><code>Promise</code></a> <var>promise</var>, and
            then continue running this algorithm <a href="#dfn-in-parallel" class="internalDFN" data-link-type="dfn">in parallel</a>.
          </li>
          <li>
            If any exception occurs while running these steps, reject
            <var>promise</var> with that exception, and abort these steps.
          </li>
          <li>
            If there are any existing instance of this algorithm running
            for the current <a href="#dfn-nfc-adapter" class="internalDFN" data-link-type="dfn">NFC adapter</a>
            whose <var>target</var> is equal to <var>options</var>.target, abort
            that instance of this algorithm by rejecting its
            <var>promise</var> with <code>"<a href="#dfn-aborterror" class="internalDFN" data-link-type="dfn">AbortError</a>"</code>.
            <div class="note"><div class="note-title" aria-level="5" role="heading" id="h-note9"><span>Note</span></div><p class="">
            In other words, the current invocation of <code>pushMessage()</code>
            rejects and replaces existing running invocations handling the same
            <var>options</var>.target.
            </p></div>
            <div class="note"><div class="note-title" aria-level="5" role="heading" id="h-note10"><span>Note</span></div><p class="">
              Implementations are expected to clean up state on aborting these
              steps, e.g. reset the related timer (either
              <var>this@[[tagTimer]]</var> or <var>this@[[peerTimer]]</var>),
              clear the related message (either <var>this@[[tagMessage]]</var>
              or <var>this@[[peerMessage]]</var>), as well as release any
              resources bound to NFC functionality, so that new invocations of
              this algorithm do not depend on previous invocations.
            </p></div>
          </li>
          <li>
            If the <a href="#dfn-incumbent-settings-object" class="internalDFN" data-link-type="dfn">incumbent settings object</a> is not a
            <a href="#dfn-secure-context" class="internalDFN" data-link-type="dfn">secure context</a>, reject <var>promise</var> with
            <code>"<a href="#dfn-securityerror" class="internalDFN" data-link-type="dfn">SecurityError</a>"</code>, and abort these steps.
            <div class="note"><div class="note-title" aria-level="5" role="heading" id="h-note11"><span>Note</span></div><div class="">
              Browsers may ignore this rule for development purposes only.
            </div></div>
          </li>
          <li>
            An implementation <em class="rfc2119" title="MAY">MAY</em> reject <var>promise</var> with <code>
            "<a href="#dfn-notsupportederror" class="internalDFN" data-link-type="dfn">NotSupportedError</a>"</code>, and abort these steps.
            <div class="note"><div class="note-title" aria-level="5" role="heading" id="h-note12"><span>Note</span></div><div class="">
              The UA might terminate message push at this point. The reasons
              for terminations are implementation details. For example, the user
              could have has set a preference to allow a given origin only to
              read, write, or send data to peers. Also, the implementation might
               be unable to support the operation requested.
            </div></div>
          </li>
          <li>
            If the <a href="#dfn-obtain-push-permission" class="internalDFN" data-link-type="dfn">obtain push permission</a> steps return
            <code>false</code>, then reject <var>promise</var> with
            <code>"SecurityError"</code>, and abort these steps.
          </li>
          <li>
            If the <var>message</var> parameter is an empty sequence,
            then reject <var>promise</var> with <code>"SyntaxError"</code>,
            and abort these steps.
          </li>
          <li>
            Let <var>output</var> be the notation for the <a href="#dfn-ndef-message" class="internalDFN" data-link-type="dfn">NDEF message</a>
            to be created by UA, as the result of passing
            <var>message</var> to <a href="#dfn-create-web-nfc-message" class="internalDFN" data-link-type="dfn">create Web NFC message</a>.
            If this threw an exception, reject <var>promise</var> with that
            exception and abort these steps.
          </li>
          <li>
            If <var>options</var>.timeout value is not valid or not supported
            by the UA, reject <var>promise</var> with
            <code>"SyntaxError"</code>, and abort these steps.
          </li>
          <li>
            If <var>target</var> has the value <code>"tag"</code>, then
            <ol>
              <li>
                Set <var>this@[[tagMessage]]</var> (referred to as
                <var>message</var> in this instance of the algorithm) to
                <var>output</var>.
              </li>
              <li>
                If <var>options</var>.timeout value is not
                <code>Infinity</code>, start the timer
                <var>this@[[tagTimer]]</var> (referred to as
                <var>timer</var> in this instance of the algorithm) with the
                timeout value set to <var>options</var>.timeout.
              </li>
            </ol>
          </li>
          <li>
            If <var>target</var> has the value <code>"peer"</code>, then
            <ol>
              <li>
                Set <var>this@[[peerMessage]]</var> (referred to as
                <var>message</var> in this instance of the algorithm) to
                <var>output</var>.
              </li>
              <li>
                If <var>options</var>.timeout value is not
                <code>Infinity</code>, start the timer
                <var>this@[[peerTimer]]</var> (referred to as
                <var>timer</var> in this instance of the algorithm) with the
                timeout value set to <var>options</var>.timeout.
              </li>
            </ol>
          </li>
          <li>
            Wait until one of the following events happens:
            <ul>
              <li>
                The <var>timer</var> expires, reject <var>promise</var>
                with <code>"TimeoutError"</code> and abort these steps.
              </li>
              <li>
                If <var>timer</var> is active, and the
                <a href="cancelPush"><code>cancelPush()</code></a>
                method is called, reject <var>promise</var> with
                <code>"<a href="#dfn-aborterror" class="internalDFN" data-link-type="dfn">AbortError</a>"</code>, as described in the
                <a href="#steps-cancelPush"><code>cancelPush()</code>
                algorithm</a>.
              </li>
              <li>
                When an <a href="#dfn-nfc-device" class="internalDFN" data-link-type="dfn">NFC device</a> <var>device</var> comes within
                communication range,
                <ol>
                  <li>
                    If <var>this@[[suspended]]</var> is <code>true</code>,
                    then abort these steps without rejecting <var>promise</var>.
                    <div class="note"><div class="note-title" aria-level="5" role="heading" id="h-note13"><span>Note</span></div><p class="">
                      The <var>promise</var> will then be pending until a
                      timeout, or until <var>this@[[suspended]]</var>
                      becomes <code>false</code> and a new tap happens.
                    </p></div>
                  </li>
                  <li>
                    If <var>device</var> is an <a href="#dfn-nfc-tag" class="internalDFN" data-link-type="dfn">NFC tag</a>, and
                    <var>tagMessage</var> is <code>null</code>, then reject
                    <var>promise</var> with <code>"InvalidAccessError"</code>
                    and abort these steps.
                  </li>
                  <li>
                    If <var>device</var> is an <a href="#dfn-nfc-peer" class="internalDFN" data-link-type="dfn">NFC peer</a>, and
                    <var>peerMessage</var> is <code>null</code>, then reject
                    <var>promise</var> with <code>"InvalidAccessError"</code>
                    and abort these steps.
                  </li>
                  <li>
                    Initiate data transfer to <var>device</var>.
                  </li>
                  <li>
                    If the connection is lost during the transfer, or an error
                    occured, reject <var>promise</var> with
                    <code>"<a href="#dfn-networkerror" class="internalDFN" data-link-type="dfn">NetworkError</a>"</code> and terminate this
                    algorithm.
                  </li>
                  <li>
                    Otherwise if the transfer is successful, cancel
                    <var>timer</var> and set <var>message</var> to
                    <code>null</code> and then resolve <var>promise</var>.
                  </li>
                </ol>
              </li>
            </ul>
          </li>
        </ol>
      <p></p>

      <section id="obtaining-push-permission" typeof="bibo:Chapter" resource="#obtaining-push-permission" property="bibo:hasPart"><h5 id="h-obtaining-push-permission" resource="#h-obtaining-push-permission"><span property="xhv:role" resource="xhv:heading"><span class="secno">11.3.1.1 </span>Obtaining push permission</span></h5>
      <p>
        To <dfn data-dfn-type="dfn" id="dfn-obtain-push-permission">obtain push permission</dfn>, run these steps:
        </p><ol>
          <li>
            If a <a href="#dfn-prearranged-trust-relationship" class="internalDFN" data-link-type="dfn">prearranged trust relationship</a> exists,
            then return <code>true</code>.
          </li>
          <li>
            Otherwise, if an <a href="#dfn-expressed-permission" class="internalDFN" data-link-type="dfn">expressed permission</a> has been granted to
            the <a href="#dfn-origin" class="internalDFN" data-link-type="dfn">origin</a> using the
            <a href="http://www.w3.org/TR/permissions/">Permissions API</a>,
            then return <code>true</code>.
          </li>
          <li>
            Return <code>false</code>.
          </li>
        </ol>
      <p></p>
      </section>

      <section id="creating-web-nfc-message" typeof="bibo:Chapter" resource="#creating-web-nfc-message" property="bibo:hasPart"><h5 id="h-creating-web-nfc-message" resource="#h-creating-web-nfc-message"><span property="xhv:role" resource="xhv:heading"><span class="secno">11.3.1.2 </span>Creating Web NFC message</span></h5>
        <p>
          To <dfn data-dfn-type="dfn" id="dfn-create-web-nfc-message">create Web NFC message</dfn> given a <var>message</var> run
          these steps:
        </p>
        <ol id="create-web-nfc-message">
          <li>
            Let <var>output</var> be the notation for the <a href="#dfn-ndef-message" class="internalDFN" data-link-type="dfn">NDEF message</a>
            to be created by the UA as a result of these steps.
          </li>
          <li>
            For each <a href="#dom-nfcrecord" class="internalDFN" data-link-type="dfn"><code>NFCRecord</code></a> <var>record</var> in the sequence
            <var>message</var>.data, run the following steps, or make sure
            that the underlying platform provides equivalent values to
            <var>ndef</var>:
            <ol id="steps-map-nfcrecord-ndef">
              <li>
                If <var>record</var>.kind is <code>"empty"</code>, then
                Let <var>ndef</var> be the result of passing <var>record</var>
                to <a href="#dfn-map-empty-record-to-ndef" class="internalDFN" data-link-type="dfn">map empty record to NDEF</a>.
                If this threw an exception, reject <var>promise</var> with
                that exception and abort these steps.
              </li>
              <li>
                Otherwise, if <var>record</var>.kind is <code>"text"</code>,
                then let <var>ndef</var> be the result of passing
                <var>record</var> to <a href="#dfn-map-text-to-ndef" class="internalDFN" data-link-type="dfn">map text to NDEF</a>.
                If this threw an exception, reject
                <var>promise</var> with that exception and abort these steps.
              </li>
              <li>
                Otherwise, if <var>record</var>.kind is <code>"url"</code>,
                then let <var>ndef</var> the be result of passing
                <var>record</var> to <a href="#dfn-map-a-url-to-ndef" class="internalDFN" data-link-type="dfn">map a URL to NDEF</a>.
                If this threw an exception, reject <var>promise</var> with that
                exception and abort these steps.
              </li>
              <li>
                Otherwise, if <var>record</var>.kind is <code>"json"</code>,
                then let <var>ndef</var> the be result of passing
                <var>record</var> to <a href="#dfn-map-a-json-object-to-ndef" class="internalDFN" data-link-type="dfn">map a JSON object to NDEF</a>.
                If this threw an exception, reject <var>promise</var> with that
                exception and abort these steps.
              </li>
              <li>
                Otherwise, if <var>record</var>.kind is <code>"opaque"</code>,
                then let <var>ndef</var> the be result of passing
                <var>record</var> to <a href="#dfn-map-binary-data-to-ndef" class="internalDFN" data-link-type="dfn">map binary data to NDEF</a>.
                If this threw an exception, reject <var>promise</var> with that
                exception and abort these steps.
              </li>
              <li> <!-- guess type from data and map to NDEF -->
                Otherwise, if <var>record</var>.kind is <code>undefined</code>,
                then:
                <ol id="steps-map-data-to-ndef">
                  <li>
                    If <var>record</var>.data is instance of
                    <code>ArrayBuffer</code>, then set <var>record</var>.type to
                    <code>"application/octet-stream"</code> and run the
                    <a href="#dfn-map-binary-data-to-ndef" class="internalDFN" data-link-type="dfn">map binary data to NDEF</a>
                    steps.
                  </li>
                  <li>
                    Otherwise, if type of <var>record</var>.data is
                    <code>"object"</code>, then set <var>record</var>.type to
                    <code>"application/json"</code> and run the
                    <a href="#dfn-map-a-json-object-to-ndef" class="internalDFN" data-link-type="dfn">map a JSON object to NDEF</a> steps.
                  </li>
                  <li>
                    Otherwise, if type of <var>record</var>.data is
                    <code>"number"</code> or <code>"string"</code>, then
                    set <var>record</var>.type to <code>"plain/text"</code> and
                    run the <a href="#dfn-map-text-to-ndef" class="internalDFN" data-link-type="dfn">map text to NDEF</a> steps.
                  </li>
                  <li>
                    Otherwise reject <var>promise</var> with
                    <code>"SyntaxError"</code>, and abort these steps.
                  </li>
                </ol>
              </li>
              <li>
                Add <var>ndef</var> to <var>output</var>.
              </li>
            </ol>
          </li> <!-- guessing record.type from the data -->
          <li>
            Let <var>webnfc</var> be the result of invoking
            <a href="#dfn-create-a-web-nfc-record" class="internalDFN" data-link-type="dfn">create a Web NFC record</a>.
          </li>
          <li>
            Add <var>webnfc</var> to <var>output</var>.
            <div class="note"><div class="note-title" aria-level="6" role="heading" id="h-note14"><span>Note</span></div><p class="">
              Implementations may choose the location of the Web NFC record
              within the <a href="#dfn-ndef-message" class="internalDFN" data-link-type="dfn">NDEF message</a>.
            </p></div>
          </li>
        </ol>
      </section>

      <section id="mapping-empty-record-to-ndef" typeof="bibo:Chapter" resource="#mapping-empty-record-to-ndef" property="bibo:hasPart"><h5 id="h-mapping-empty-record-to-ndef" resource="#h-mapping-empty-record-to-ndef"><span property="xhv:role" resource="xhv:heading"><span class="secno">11.3.1.3 </span>Mapping empty record to NDEF</span></h5>
      <p>
        To <dfn data-dfn-type="dfn" id="dfn-map-empty-record-to-ndef">map empty record to NDEF</dfn> given a <var>record</var>, run
        these steps:
        </p><ol>
          <li>
            Let <var>ndef</var> be the notation for the <a href="#dfn-ndef-record" class="internalDFN" data-link-type="dfn">NDEF record</a> to
            be created by the UA.
          </li>
          <li>Set the
            <var>ndef.TNF</var> field to 0 (NFC Empty Type record).
          </li>
          <li>Set
            <var>ndef.TYPE_LENGTH</var>,
            <var>ndef.ID_LENGTH</var> and
            <var>ndef.PAYLOAD_LENGTH</var> fields to 0,
            and omit the associated fields from the <a href="#dfn-ndef-record" class="internalDFN" data-link-type="dfn">NDEF record</a>:
            <var>ndef.TYPE</var>,
            <var>ndef.ID</var>,
            <var>ndef.PAYLOAD</var>.
          </li>
          <li>
            Return <var>ndef</var>.
          </li>
        </ol>
      <p></p>
      </section>

      <section id="mapping-string-to-ndef" typeof="bibo:Chapter" resource="#mapping-string-to-ndef" property="bibo:hasPart"><h5 id="h-mapping-string-to-ndef" resource="#h-mapping-string-to-ndef"><span property="xhv:role" resource="xhv:heading"><span class="secno">11.3.1.4 </span>Mapping string to NDEF</span></h5>
      <p>
        To <dfn data-dfn-type="dfn" id="dfn-map-text-to-ndef">map text to NDEF</dfn> given a <var>record</var>, run these
        steps:
        </p><div class="note"><div class="note-title" aria-level="6" role="heading" id="h-note15"><span>Note</span></div><p class="">
          This kind is useful when clients specifically want to write an
          NDEF Well Known Type Text record. Other options would be to
          use the value <code>"opaque"</code> with an explicit
          <a href="#dfn-iana-media-type" class="internalDFN" data-link-type="dfn">IANA media type</a> text type, which allows for better
          differentiation, e.g. when using "text/xml", or "text/vcard".
        </p></div>
        <ol>
          <li>
            If <var>record</var>.data is not a string or number,
            throw a <code>"SyntaxError"</code> exception, and abort these steps.
          </li>
          <li>
            If <var>record</var>.type is not a string or starts with <code>
            "text/"</code>, then throw a <code>"SyntaxError"</code> exception,
            and abort these steps.

            In addition, UAs <em class="rfc2119" title="MAY">MAY</em> check that
            <var>record</var>.type is an IANA registered media type
            for <a href="http://www.iana.org/assignments/media-types/media-types.xhtml#text">
            text</a>.
            If not, then the UA <em class="rfc2119" title="MAY">MAY</em> throw a <code>"SyntaxError"</code>
            exception, and abort these steps.
          </li>
          <li>
            Let <var>language</var> be <code>"en"</code>.

            If <var>record</var>.type includes a <code>lang=</code>
            parameter, detailing the language encoding (e.g.
            "text/plain; lang=fr"), then set <var>language</var> to
            the language code extracted from <var>record</var>.type.

            If <var>language</var> is not one of the language codes listed
            in the <a href="http://www.iana.org/assignments/language-subtag-registry/language-subtag-registry">
            IANA language registry</a>
            (or [<cite><a class="bibref" href="#bib-ISO-639.2">ISO-639.2</a></cite>]), then UAs <em class="rfc2119" title="MAY">MAY</em> throw a <code>"SyntaxError"</code>
            exception, and abort these steps.

            <div class="note"><div class="note-title" aria-level="6" role="heading" id="h-note16"><span>Note</span></div><p class="">
              Note that <code>lang=</code> is not standard parameter
              to <a href="#dfn-iana-media-type" class="internalDFN" data-link-type="dfn">IANA media type</a>s, but it is used in this specification
              in order to maintain compatibility with NFC specifications.
            </p></div>
          </li>
          <li>
            Let <var>ndef</var> be the notation for the <a href="#dfn-ndef-record" class="internalDFN" data-link-type="dfn">NDEF record</a> to
            be created by the UA.
          </li>
          <li>
            Set the <var>ndef.TNF</var> field to 1 (NFC Well Known Type).
          </li>
          <li>
            Set the <var>def.TYPE</var> field to <code>"T"</code>
            (value 0x54 following NFC binary encoding).
          </li>
          <li>
            Set the <var>ndef.PAYLOAD</var> field to
            <var>record</var>.data encoded according to the
            [<cite><a class="bibref" href="#bib-NFC-STANDARDS">NFC-STANDARDS</a></cite>], NFC Forum Text Record Type
            Definition specification:
            <ol>
              <li>
                The first octet is a status byte containing bit flags.
                <ol>
                  <li>
                    If <var>record</var>.type contains the parameter
                    "charset=UTF-8" (e.g. "text/plain; charset=UTF-8;"),
                    then set bit 7 (MSB) to 0 (UTF-8 encoding),
                    otherwise to 1 (UTF-16 encoding).
                  </li>
                  <li>Set bit 6 to 0.</li>
                  <li>
                    Set bits 5 to 0 to the length of the
                    <var>language</var> string.
                  </li>
                </ol>
              </li>
              <li>
                Set the consecutive octets of <var>ndef.PAYLOAD</var>
                to the value of <var>language</var> encoded as US-ASCII.
              </li>
              <li>
                Set the consecutive payload octets to
                <var>record</var>.data in the encoding set by the
                MSB bit of the first payload octet (by default UTF-16,
                or UTF-8 on special request).
              </li>
            </ol>
          </li>
          <li>
            Return <var>ndef</var>.
          </li>
        </ol>
      <p></p>
      </section>

      <section id="mapping-url-to-ndef" typeof="bibo:Chapter" resource="#mapping-url-to-ndef" property="bibo:hasPart"><h5 id="h-mapping-url-to-ndef" resource="#h-mapping-url-to-ndef"><span property="xhv:role" resource="xhv:heading"><span class="secno">11.3.1.5 </span>Mapping URL to NDEF</span></h5>
      <p>
        To <dfn data-dfn-type="dfn" id="dfn-map-a-url-to-ndef">map a URL to NDEF</dfn> given a <var>record</var>, run these
        steps:
        </p><ol>
          <li>
            If <var>record</var>.data is not a string,
            throw a <code>"SyntaxError"</code> exception and abort these steps.
          </li>
          <li>
            Let <var>ndef</var> be the notation for the <a href="#dfn-ndef-record" class="internalDFN" data-link-type="dfn">NDEF record</a> to
            be created by the UA.
          </li>
          <li>
            Set the <var>ndef.TNF</var> field to 1 (Well Known Type).
          </li>
          <li>
            Set the <var>ndef.TYPE</var> field to "U" (0x55
            following NFC binary encoding).
          </li>
          <li>
            Set the <var>ndef.PAYLOAD</var> field to
            <var>record</var>.data encoded according to the
            [<cite><a class="bibref" href="#bib-NFC-STANDARDS">NFC-STANDARDS</a></cite>], NFC Forum URI Record Type Definition
            specification: set the first octet according to the
            applicable scheme abbreviation, and set the rest of the
            payload bytes to <var>record</var>.data in UTF-8 encoding.
          </li>
          <li>
            Return <var>ndef</var>.
          </li>
        </ol>
      <p></p>
      </section>

      <section id="mapping-json-to-ndef" typeof="bibo:Chapter" resource="#mapping-json-to-ndef" property="bibo:hasPart"><h5 id="h-mapping-json-to-ndef" resource="#h-mapping-json-to-ndef"><span property="xhv:role" resource="xhv:heading"><span class="secno">11.3.1.6 </span>Mapping JSON to NDEF</span></h5>
      <p>
        To <dfn data-dfn-type="dfn" id="dfn-map-a-json-object-to-ndef">map a JSON object to NDEF</dfn> given a <var>record</var>,
        run these steps:
        </p><ol>
          <li>
            Let <var>data</var> be the result of
            <a data-lt="JSON.stringify" href="#dfn-json.stringify" class="internalDFN" data-link-type="dfn">serializing</a> <var>record</var>.data
            and if that throws, throw a <code>"TypeError"</code> exception
            and abort these steps.
          </li>
          <li>
            If <var>record</var>.type doesn't match
            <code>"application/json"</code>, or any other
            <a href="#dfn-iana-media-type" class="internalDFN" data-link-type="dfn">IANA media type</a> for JSON
            (starting with <code>"application/"</code> and ending with <code>
            "+json"</code>), throw a <code>"SyntaxError"</code> exception and
            abort these steps.
          </li>
          <li>
            Let <var>ndef</var> be the notation for the <a href="#dfn-ndef-record" class="internalDFN" data-link-type="dfn">NDEF record</a> to
            be created by the UA.
          </li>
          <li>
            Set the <var>ndef.TNF</var> field to 2 (Media Type).
          </li>
          <li>
            Set the <var>ndef.TYPE</var> field to <var>record</var>.type.
          </li>
          <li>
            Set the <var>ndef.PAYLOAD</var> field to <var>data</var>
            according to the [<cite><a class="bibref" href="#bib-NFC-STANDARDS">NFC-STANDARDS</a></cite>], i.e. as an opaque octet stream.
          </li>
          <li>
            Return <var>ndef</var>.
          </li>
        </ol>
      <p></p>
      </section>

      <section id="mapping-binary-data-to-ndef" typeof="bibo:Chapter" resource="#mapping-binary-data-to-ndef" property="bibo:hasPart"><h5 id="h-mapping-binary-data-to-ndef" resource="#h-mapping-binary-data-to-ndef"><span property="xhv:role" resource="xhv:heading"><span class="secno">11.3.1.7 </span>Mapping binary data to NDEF</span></h5>
      <p>
        To <dfn data-dfn-type="dfn" id="dfn-map-binary-data-to-ndef">map binary data to NDEF</dfn> given a <var>record</var>,
        run these steps:
        </p><ol>
          <li>
            If <var>record</var>.data is not of instance of
            <code>ArrayBuffer</code>, reject <var>promise</var> with
            <code>"SyntaxError"</code>, and abort these steps.
          </li>
          <li>
            The UA <em class="rfc2119" title="MAY">MAY</em> check if <var>record</var>.type is
            a valid IANA registered type. If not, then <em class="rfc2119" title="MAY">MAY</em> throw a <code>
            "SyntaxError"</code> exception and abort these steps.
          </li>
          <li>
            Let <var>ndef</var> be the notation for the <a href="#dfn-ndef-record" class="internalDFN" data-link-type="dfn">NDEF record</a> to
            be created by the UA.
          </li>
          <li>
            Set the <var>ndef.TNF</var> field to 2 (Media Type).
          </li>
          <li>
            Set the <var>ndef.TYPE</var> field to <var>record</var>.type.
          </li>
          <li>
            Set the <var>ndef.PAYLOAD</var> field to <var>record</var>.data
            according to the [<cite><a class="bibref" href="#bib-NFC-STANDARDS">NFC-STANDARDS</a></cite>], i.e. as an opaque octet stream.
          </li>
          <li>
            Return <var>ndef</var>.
          </li>
        </ol>
      <p></p>
      </section>

      <section id="creating-a-web-nfc-record" typeof="bibo:Chapter" resource="#creating-a-web-nfc-record" property="bibo:hasPart"><h5 id="h-creating-a-web-nfc-record" resource="#h-creating-a-web-nfc-record"><span property="xhv:role" resource="xhv:heading"><span class="secno">11.3.1.8 </span>Creating a Web NFC record</span></h5>
      <p>
        To <dfn data-dfn-type="dfn" id="dfn-create-a-web-nfc-record">create a <a href="#dfn-web-nfc-record" class="internalDFN" data-link-type="dfn">Web NFC record</a></dfn>, run these steps:
        </p><ol>
          <li>
            Let <var>ndef</var> be the notation for the <a href="#dfn-ndef-record" class="internalDFN" data-link-type="dfn">NDEF record</a> to
            be created by the UA.
          </li>
          <li>
            Set <var>ndef.TNF</var> to 4 (NDEF External Type).
          </li>
          <li>
            Set <var>ndef.TYPE</var> to
            <code>"urn:nfc:ext:w3.org:webnfc"</code>.
          </li>
          <li>
            Set <var>ndef.PAYLOAD</var> to the <a href="#dfn-url-path" class="internalDFN" data-link-type="dfn">URL path</a> of the
            <a href="#dfn-browsing-context" class="internalDFN" data-link-type="dfn">browsing context</a>, encoded as UTF-16.
            This is going to be used by <a href="#dfn-nfc-watch" class="internalDFN" data-link-type="dfn">NFC watch</a> filters.
            <div class="note"><div class="note-title" aria-level="6" role="heading" id="h-note17"><span>Note</span></div><p class="">
              In future versions a list of "allowed-origins" may be
              supported.
              It is still up for discussions due to security issues. See the
              <a href="http://w3c.github.io/web-nfc/security-privacy.html#security-and-privacy-context-of-nfc">
              Security and Privacy</a> document.
            </p></div>
          </li>
          <li>
            Return <var>ndef</var>.
          </li>
        </ol>
      <p></p>
      </section>
    </section> <!-- pushMessage() -->

    <section id="cancelPush" typeof="bibo:Chapter" resource="#cancelPush" property="bibo:hasPart"><h4 id="h-cancelpush" resource="#h-cancelpush"><span property="xhv:role" resource="xhv:heading"><span class="secno">11.3.2 </span>The cancelPush method</span></h4>
      <p>
        The <code>
        <dfn data-dfn-for="nfcadapter" data-dfn-type="dfn" data-lt="cancelpush" id="dom-nfcadapter-cancelpush" data-idl="">NFCAdapter.cancelPush</dfn>(target)</code>
        method, when invoked, <em class="rfc2119" title="MUST">MUST</em> run <dfn data-dfn-type="dfn" id="dfn-cancel-push">cancel push</dfn> algorithm:
      </p>
      <ol id="steps-cancelPush">
        <li>
          If the <a href="#dfn-incumbent-settings-object" class="internalDFN" data-link-type="dfn">incumbent settings object</a> is not a
          <a href="#dfn-secure-context" class="internalDFN" data-link-type="dfn">secure context</a>, reject <var>promise</var> with
          <code>"<a href="#dfn-securityerror" class="internalDFN" data-link-type="dfn">SecurityError</a>"</code>, and abort these steps.
          <div class="note"><div class="note-title" aria-level="5" role="heading" id="h-note18"><span>Note</span></div><div class="">
            Browsers may ignore this rule for development purposes only.
          </div></div>
        </li>
        <li>
          If the parameter <var>target</var> is <code>"tag"</code>, and
          if <var>this@[[tagMessage]]</var> is non-<code>null</code>, then
          <ol>
            <li>Reset <var>this@[[tagTimer]]</var>.</li>
            <li>Set <var>this@[[tagMessage]]</var> to <code>null</code>.</li>
            <li>
              Reject the pending <var>promise</var> in the connected instance
              of the <a href="#steps-pushMessage"><code>pushMessage()</code></a>
              algorithm with <code>"<a href="#dfn-aborterror" class="internalDFN" data-link-type="dfn">AbortError</a>"</code>.
            </li>
          </ol>
        </li>
        <li>
          If the parameter <var>target</var> is <code>"peer"</code>, and
          if <var>this@[[peerMessage]]</var> is non-<code>null</code>, then
          <ol>
            <li>Reset <var>this@[[peerTimer]]</var>.</li>
            <li>Set <var>this@[[peerMessage]]</var> to <code>null</code>.</li>
            <li>
              Reject the pending <var>promise</var> in the connected instance
              of the <a href="#steps-pushMessage"><code>pushMessage()</code></a>
              algorithm with <code>"<a href="#dfn-aborterror" class="internalDFN" data-link-type="dfn">AbortError</a>"</code>.
            </li>
          </ol>
        </li>
      </ol>
    </section>
  </section> <!-- Writing or pushing content -->

  <section id="watching-for-content" typeof="bibo:Chapter" resource="#watching-for-content" property="bibo:hasPart"> <h3 id="h-watching-for-content" resource="#h-watching-for-content"><span property="xhv:role" resource="xhv:heading"><span class="secno">11.4 </span>Watching for content</span></h3>
    In order to receive <a href="#dfn-nfc-content" class="internalDFN" data-link-type="dfn">NFC content</a>, the client needs to call the
    <a href="#dom-nfcadapter-watch" class="internalDFN" data-link-type="dfn"><code>NFCAdapter.watch</code></a>() to opt into content of interest.


    <section id="match-patterns" typeof="bibo:Chapter" resource="#match-patterns" property="bibo:hasPart"> <h4 id="h-match-patterns" resource="#h-match-patterns"><span property="xhv:role" resource="xhv:heading"><span class="secno">11.4.1 </span>Match patterns</span></h4>
      <p>
        A <a href="#dfn-match-pattern" class="internalDFN" data-link-type="dfn"><code>match pattern</code></a> is defined by the following ABNF:
        </p><pre>          <dfn data-dfn-type="dfn" id="dfn-match-pattern">match-pattern</dfn>       = <a href="#dfn-top-level-type-name" class="internalDFN" data-link-type="dfn"><code>top-level type name</code></a> <code>"/"</code> [ tree <code>"."</code> ] <a href="#dfn-subtype-name" class="internalDFN" data-link-type="dfn"><code>subtype name</code></a> [ <code>"+"</code> suffix ] [ <code>";"</code> parameters ]
          <dfn data-dfn-type="dfn" id="dfn-top-level-type-name">top-level type name</dfn> = <code>"*"</code> / &lt;VCHAR except <code>'/'</code> and <code>"*"</code>&gt;
          <dfn data-dfn-type="dfn" id="dfn-subtype-name">subtype name</dfn>        = <code>"*"</code> / &lt;VCHAR except <code>'+'</code>&gt;
        </pre>
        A <a href="#dfn-match-pattern" class="internalDFN" data-link-type="dfn"><code>match pattern</code></a> is a
        <a href="http://pubs.opengroup.org/onlinepubs/007904875/utilities/xcu_chap02.html#tag_02_13_03">
        glob</a> used for matching <a href="#dfn-iana-media-type" class="internalDFN" data-link-type="dfn">IANA media type</a>s,
        for instance the pattern <code>'application/*+json'</code> matches
        <code>'application/calendar+json'</code>, but does not match
        <code>'application/json'</code>. The pattern
        <code>'*/*json'</code>, on the other hand, matches both.
      <p></p>
    </section>
    <section id="url-patterns" typeof="bibo:Chapter" resource="#url-patterns" property="bibo:hasPart"> <h4 id="h-url-patterns" resource="#h-url-patterns"><span property="xhv:role" resource="xhv:heading"><span class="secno">11.4.2 </span>URL patterns</span></h4>
      <p>
        A <a href="#dfn-url-pattern" class="internalDFN" data-link-type="dfn"><code>URL pattern</code></a> is a URL which may contain the <code>'*'</code>
        wildcard character.
        It consists of a <a data-lt="star scheme" href="#dfn-scheme" class="internalDFN" data-link-type="dfn"><code>scheme</code></a>, a
        <a data-lt="star host" href="#dfn-host" class="internalDFN" data-link-type="dfn"><code>host</code></a> and (optionally) a
        <a data-lt="star path" href="#dfn-path" class="internalDFN" data-link-type="dfn"><code>path</code></a>, defined by the following ABNF:
        </p><pre>          <dfn data-dfn-type="dfn" id="dfn-url-pattern">url-pattern</dfn> = <a data-lt="star scheme" href="#dfn-scheme" class="internalDFN" data-link-type="dfn"><code>scheme</code></a> <code>"://"</code> <a data-lt="star host" href="#dfn-host" class="internalDFN" data-link-type="dfn"><code>host</code></a> <a data-lt="star path" href="#dfn-path" class="internalDFN" data-link-type="dfn"><code>path</code></a>
          <dfn data-dfn-type="dfn" id="dfn-scheme">scheme</dfn>      = <code>"*"</code> / <code>"https"</code>
          <dfn data-dfn-type="dfn" id="dfn-host">host</dfn>        = <code>"*"</code> / <code>"*."</code> &lt;VCHAR except <code>"/"</code> and <code>"*"</code>&gt;
          <dfn data-dfn-type="dfn" id="dfn-path">path</dfn>        = <code>"/"</code> &lt;VCHAR&gt;
        </pre>
      <p></p>
      <p>
        Most characters match themselves, however <code>'*'</code> (wildcard)
        matches a sequence of visible characters. A <a href="#dfn-url-pattern" class="internalDFN" data-link-type="dfn"><code>URL pattern</code></a> that
        doesn't conform to the above ABNF is a non-match.
      </p>
      <div class="note"><div class="note-title" aria-level="5" role="heading" id="h-note19"><span>Note</span></div><p class="">
        Though <code>'*'</code> matches a sequence of characters, only URLs
        with scheme <code>"https"</code> are accepted in the algorithms
        taking a <a href="#dfn-url-pattern" class="internalDFN" data-link-type="dfn"><code>URL pattern</code></a>.
      </p></div>
      <p>
        For example, <code>'*://*.mydomain.com/*'</code> will match
        <code>'https://services.mydomain.com/myservice1/myapp2/'</code> and
        <code>'https://info.mydomain.com/general/'</code>.
      </p>
    </section>
    <section id="the-watch-method" typeof="bibo:Chapter" resource="#the-watch-method" property="bibo:hasPart"> <h4 id="h-the-watch-method" resource="#h-the-watch-method"><span property="xhv:role" resource="xhv:heading"><span class="secno">11.4.3 </span>The <strong>watch()</strong> method</span></h4>
      <p>
        This method enables listening to incoming <a href="#dfn-ndef-message" class="internalDFN" data-link-type="dfn">NDEF message</a>s.
        The <a href="#dfn-nfc-content" class="internalDFN" data-link-type="dfn">NFC content</a> to which clients listen can be filtered based on
        its data type, and based on the <a href="#dfn-url-path" class="internalDFN" data-link-type="dfn">URL path</a> of the
        <a href="#dfn-browsing-context" class="internalDFN" data-link-type="dfn">browsing context</a> which has been saved to the <a href="#dfn-web-nfc-record" class="internalDFN" data-link-type="dfn">Web NFC record</a>
        of the <a href="#dfn-nfc-content" class="internalDFN" data-link-type="dfn">NFC content</a>. The latter is matched against
        <a href="#dfn-url-pattern" class="internalDFN" data-link-type="dfn"><code>URL pattern</code></a>s used in <a href="#dfn-nfc-watch" class="internalDFN" data-link-type="dfn">NFC watch</a>es.
      </p>
      <p>
        An <dfn data-dfn-type="dfn" id="dfn-nfc-watch">NFC watch</dfn> is referring to a
        <code><a href="#dom-nfcwatchoptions" class="internalDFN" data-link-type="dfn"><code>NFCWatchOptions</code></a></code> filter saved together with the
        <code><a href="#idl-def-nfcadapter" class="internalDFN" data-link-type="dfn"><code>NFCAdapter</code></a></code> instance it belongs
        to, and a locally unique identifier which is used for cancellation.
        The section <a href="#steps-receiving">
        Receiving and parsing content</a> uses <a href="#dfn-nfc-watch" class="internalDFN" data-link-type="dfn">NFC watch</a>es to match
        incoming <a href="#dfn-nfc-content" class="internalDFN" data-link-type="dfn">NFC content</a>.
      </p>
      <p>
        Multiple consecutive calls to the <code>watch()</code> method from the
        same <a href="#dfn-origin" class="internalDFN" data-link-type="dfn">origin</a> create filters which are in OR relationship.
      </p>
      <p>
        Watch filters are grouped by <a href="#dfn-nfc-adapter" class="internalDFN" data-link-type="dfn">NFC adapter</a>.
      </p>
      <p>
        When the <code>
        <dfn data-dfn-for="nfcadapter" data-dfn-type="dfn" data-lt="watch" id="dom-nfcadapter-watch" data-idl="">NFCAdapter.watch</dfn>(<var>options</var>, <var>callback</var>)
        </code> method is invoked, the UA <em class="rfc2119" title="MUST">MUST</em> run the following
        <dfn id="steps-watch" data-dfn-type="dfn">NFC watch algorithm</dfn>:
        </p><ol>
          <li>
            Let <var>promise</var> be a new <a href="#dfn-promise" class="internalDFN" data-link-type="dfn"><code>Promise</code></a> object.
          </li>
          <li>
            Return <var>promise</var> and continue the following steps
            <a href="#dfn-in-parallel" class="internalDFN" data-link-type="dfn">in parallel</a>.
          </li>
          <li>
            If any exception occurs while running these steps, reject
            <var>promise</var> with that exception, and abort these steps.
          </li>
          <li>
            If the <a href="#dfn-incumbent-settings-object" class="internalDFN" data-link-type="dfn">incumbent settings object</a> is not a
            <a href="#dfn-secure-context" class="internalDFN" data-link-type="dfn">secure context</a>, reject <var>promise</var> with
            <code>"<a href="#dfn-securityerror" class="internalDFN" data-link-type="dfn">SecurityError</a>"</code>, and abort these steps.
            <div class="note"><div class="note-title" aria-level="5" role="heading" id="h-note20"><span>Note</span></div><div class="">
              Browsers may ignore this rule for development purposes only.
            </div></div>
          </li>
          <li>
            If there is no support for the functionality of receiving data from
            an <a href="#dfn-nfc-peer" class="internalDFN" data-link-type="dfn">NFC peer</a> or <a href="#dfn-nfc-tag" class="internalDFN" data-link-type="dfn">NFC tag</a> in proximity range, reject
            <var>promise</var> with <code>"NotSupportedError"</code>, and
            terminate this algorithm.
          </li>
          <li>
            If the <a href="#dfn-obtain-watch-permission" class="internalDFN" data-link-type="dfn">obtain watch permission</a> steps return
            <code>false</code>, then reject <var>promise</var> with
            <code>"SecurityError"</code>, and abort these steps.
          </li>
          <li>
            If this is the first watch being set up for the current
            <a href="#dfn-nfc-adapter" class="internalDFN" data-link-type="dfn">NFC adapter</a>, then make a request to listen to
            <a href="#dfn-ndef-message" class="internalDFN" data-link-type="dfn">NDEF message</a>s.
          </li>
          <li>
            If the request fails, reject <var>promise</var> with
            <code>"NotSupportedError"</code> , and abort these steps.
          </li>
          <li>
            Let <var>watchId</var> be a number that will identify this
            <a href="#dfn-nfc-watch" class="internalDFN" data-link-type="dfn">NFC watch</a>.
          </li>
          <li>
            Add <var>watchId</var>, <var>options</var>, and <var>callback</var>
            together as an <a href="#dfn-nfc-watch" class="internalDFN" data-link-type="dfn">NFC watch</a> to <var>this@[[watchList]]</var>.
          </li>
          <li>
            Resolve <var>promise</var> with <var>watchId</var>.
          </li>
          <li>
            If the <a href="#dfn-browsing-context" class="internalDFN" data-link-type="dfn">browsing context</a> loses focus (e.g. the user navigated
            to another page), then the registered watches still <em class="rfc2119" title="SHOULD">SHOULD</em> continue
            to exist, but <em class="rfc2119" title="SHOULD">SHOULD</em> become paused, i.e. the UA <em class="rfc2119" title="SHOULD NOT">SHOULD NOT</em> check
            and use them until the focus is regained.
          </li>
        </ol>
      <p></p>
      <p>
        To <dfn data-dfn-type="dfn" id="dfn-obtain-watch-permission">obtain watch permission</dfn>, run these steps:
        </p><ol>
          <li>
            If there is a <a href="#dfn-prearranged-trust-relationship" class="internalDFN" data-link-type="dfn">prearranged trust relationship</a>,
            return <code>true</code>.
          </li>
          <li>
            Otherwise, if the user has earlier denied permission for the calling
            <a href="#dfn-origin" class="internalDFN" data-link-type="dfn">origin</a> for all future calls of <code>watch()</code> as well,
            then return <code>false</code>.
          </li>
          <li>
            Otherwise, UAs <em class="rfc2119" title="SHOULD">SHOULD</em>
            <a href="#askforgiveness">ask for forgiveness</a> with relevant
            information displayed to the user.
            <div class="note"><div class="note-title" aria-level="5" role="heading" id="h-note21"><span>Note</span></div><p class="">
              The <a href="#askforgiveness">ask for forgiveness</a> interaction
              might show choices like "block now" or "block forever", etc.
              If the user has chosen to "block forever" the given
              <a href="#dfn-origin" class="internalDFN" data-link-type="dfn">origin</a>, it is the responsibility of the UA to remember
              these user choices for each <a href="#dfn-origin" class="internalDFN" data-link-type="dfn">origin</a>, regardless of which
              <a href="#dfn-nfc-adapter" class="internalDFN" data-link-type="dfn">NFC adapter</a> is used, and consult them on later invocations.
            </p></div>
            <div class="note"><div class="note-title" aria-level="5" role="heading" id="h-note22"><span>Note</span></div><p class="">
             In this step UAs are advised to notify users about
             that reading <a href="#dfn-nfc-content" class="internalDFN" data-link-type="dfn">NFC content</a> may indirectly reveal the physical
             location of the user. In addition, if <code>"any"</code>
             <code><a href="#idl-def-nfcwatchmode" class="internalDFN" data-link-type="dfn"><code>NfcWatchMode</code></a></code> is used, then also include in this
             information that the <a href="#dfn-origin" class="internalDFN" data-link-type="dfn">origin</a> is requesting to read not only
             <a href="#dfn-nfc-content" class="internalDFN" data-link-type="dfn">NFC content</a> meant for web pages, but any <a href="#dfn-nfc-content" class="internalDFN" data-link-type="dfn">NFC content</a>.
            </p></div>
          </li>
          <li>
            Return <code>true</code>.
          </li>
        </ol>
      <p></p>
    </section> <!-- watch() method -->

    <!-- The unwatch() method -->
    <section id="the-unwatch-method" typeof="bibo:Chapter" resource="#the-unwatch-method" property="bibo:hasPart"><h4 id="h-the-unwatch-method" resource="#h-the-unwatch-method"><span property="xhv:role" resource="xhv:heading"><span class="secno">11.4.4 </span>The <strong>unwatch</strong>() method</span></h4>
      <p>
        When the <code><dfn data-dfn-for="nfcadapter" data-dfn-type="dfn" data-lt="unwatch" id="dom-nfcadapter-unwatch" data-idl="">NFCAdapter.unwatch</dfn>(id)</code> method is
        invoked, the UA <em class="rfc2119" title="MUST">MUST</em> return a <a href="#dfn-promise" class="internalDFN" data-link-type="dfn"><code>Promise</code></a>
        <var>promise</var> and run the following steps <a href="#dfn-in-parallel" class="internalDFN" data-link-type="dfn">in parallel</a>.
        </p><ol id="steps-unwatch">
          <li>
            If the <a href="#dfn-incumbent-settings-object" class="internalDFN" data-link-type="dfn">incumbent settings object</a> is not a
            <a href="#dfn-secure-context" class="internalDFN" data-link-type="dfn">secure context</a>, reject <var>promise</var> with
            <code>"<a href="#dfn-securityerror" class="internalDFN" data-link-type="dfn">SecurityError</a>"</code>, and abort these steps.
            <div class="note"><div class="note-title" aria-level="5" role="heading" id="h-note23"><span>Note</span></div><div class="">
              Browsers may ignore this rule for development purposes only.
            </div></div>
          </li>
          <li>
            If the parameter <var>id</var> is <code>undefined</code>, then
            remove all watches and filters set by successive calls of the
            <code><a href="#dfn-nfc-watch" class="internalDFN" data-link-type="dfn">NFC watch</a>()</code> method on the current
            <a href="#dfn-nfc-adapter" class="internalDFN" data-link-type="dfn">NFC adapter</a>.
          </li>
          <li>
            Otherwise, if the parameter <var>id</var> matches the local
            identifier of one of the previously set up watches, remove the
            corresponding watch.
          </li>
          <li>
            Otherwise, reject <var>promise</var> with
            <code>"<a href="#dfn-notfounderror" class="internalDFN" data-link-type="dfn">NotFoundError</a>"</code>, and abort these steps.
          </li>
          <li>
            If there are no more watches on the current <a href="#dfn-nfc-adapter" class="internalDFN" data-link-type="dfn">NFC adapter</a>,
            then make a request to stop listening to <a href="#dfn-ndef-message" class="internalDFN" data-link-type="dfn">NDEF message</a>s
            on that adapter.
          </li>
          <li>
            Resolve <var>promise</var>.
          </li>
        </ol>
      <p></p>
    </section> <!-- unwatch() -->
  </section>

  <section id="steps-receiving" typeof="bibo:Chapter" resource="#steps-receiving" property="bibo:hasPart">
  <h3 id="h-steps-receiving" resource="#h-steps-receiving"><span property="xhv:role" resource="xhv:heading"><span class="secno">11.5 </span>Receiving and parsing content</span></h3>
  <p>
    If there are any <a href="#dfn-nfc-watch" class="internalDFN" data-link-type="dfn">NFC watch</a>es set up for any <a href="#dfn-nfc-adapter" class="internalDFN" data-link-type="dfn">NFC adapter</a> in
    their <var>NFCAdapter@[[watchList]]</var>, then
    UAs <em class="rfc2119" title="MUST">MUST</em> listen to <a href="#dfn-ndef-message" class="internalDFN" data-link-type="dfn">NDEF message</a>s, according to step 9
    of the <a href="#steps-watch">NFC watch algorithm</a>.
  </p>
  <section id="the-ndef-parsing-algorithm" typeof="bibo:Chapter" resource="#the-ndef-parsing-algorithm" property="bibo:hasPart"><h4 id="h-the-ndef-parsing-algorithm" resource="#h-the-ndef-parsing-algorithm"><span property="xhv:role" resource="xhv:heading"><span class="secno">11.5.1 </span>The NDEF parsing algorithm</span></h4>
    When the <a href="#dfn-ua" class="internalDFN" data-link-type="dfn">UA</a> is to <dfn data-dfn-type="dfn" id="dfn-receive-an-ndef-message">receive an NDEF message</dfn> it <em class="rfc2119" title="MUST">MUST</em> run the
    following algorithm:
    <ol id="parse-ndef">
      <li>
        Let <var>input</var> be the notation for the <a href="#dfn-ndef-message" class="internalDFN" data-link-type="dfn">NDEF message</a>
        which has been received.
        <div class="note"><div class="note-title" aria-level="5" role="heading" id="h-note24"><span>Note</span></div><p class="">
          This is a placeholder for a possible future feature. In this step,
          implementations <em class="rfc2119" title="MAY">MAY</em> check if the <a href="#dfn-origin" class="internalDFN" data-link-type="dfn">origin</a> of the <a href="#dfn-incumbent-settings-object" class="internalDFN" data-link-type="dfn">incumbent
          settings object</a> matches the <a href="#web-nfc-id" class="internalDFN" data-link-type="dfn">Web NFC Id</a> of <var>input</var>.
          If yes, and also <a href="#dfn-prearranged-trust-relationship" class="internalDFN" data-link-type="dfn">prearranged trust relationship</a>
          exists so that <var>input</var> is <a href="#dfn-trusted-integrity-nfc-content" class="internalDFN" data-link-type="dfn">trusted integrity NFC content</a>,
          then same-origin policies <em class="rfc2119" title="MAY">MAY</em> be applied.
        </p></div>
        <div class="note"><div class="note-title" aria-level="5" role="heading" id="h-note25"><span>Note</span></div><p class="">
          This is a placeholder for a possible future feature. In this step,
          implementations <em class="rfc2119" title="MAY">MAY</em> check if any of the <a href="#dfn-url-pattern" class="internalDFN" data-link-type="dfn"><code>URL pattern</code></a>s saved
          in the <a href="#dfn-web-nfc-record" class="internalDFN" data-link-type="dfn">Web NFC record</a> (in the future) match the <a href="#dfn-origin" class="internalDFN" data-link-type="dfn">origin</a>
          of the <a href="#dfn-incumbent-settings-object" class="internalDFN" data-link-type="dfn">incumbent settings object</a>.
          If yes, and also if <a href="#dfn-prearranged-trust-relationship" class="internalDFN" data-link-type="dfn">prearranged trust relationship</a> exists so
          that <var>input</var> is <a href="#dfn-trusted-integrity-nfc-content" class="internalDFN" data-link-type="dfn">trusted integrity NFC content</a>, then
          allowed-origin policies <em class="rfc2119" title="MAY">MAY</em> be applied.
        </p></div>
      </li>
      <li>
        Let <var>message</var> be a new <code>NFCMessage</code> object.
      </li>
      <li>
        Let <var>message</var>.url be <code>null</code>, used for storing the
        <a href="#web-nfc-id" class="internalDFN" data-link-type="dfn">Web NFC Id</a> of <var>message</var>.
      </li>
      <li>
        For each <a href="#dfn-ndef-record" class="internalDFN" data-link-type="dfn">NDEF record</a> which is part of <var>input</var>, run the
        following sub-steps for <dfn data-dfn-type="dfn" id="dfn-parsing-ndef-record">parsing NDEF record</dfn>:
        <ol>
          <li>
            Let <var>ndef</var> be the notation for the current
            <a href="#dfn-ndef-record" class="internalDFN" data-link-type="dfn">NDEF record</a>. The fields of <var>ndef</var> are described by
            the [<cite><a class="bibref" href="#bib-NFC-STANDARDS">NFC-STANDARDS</a></cite>].
          </li>
          <li>
            Let <var>record</var> be a new <code><a href="#dom-nfcrecord" class="internalDFN" data-link-type="dfn"><code>NFCRecord</code></a></code> object.
          </li>
          <li>
            If <var>ndef.TNF</var> is 0 (NFC Empty Record), then set
            <var>record</var>.kind to <code>"empty"</code>,
            <var>record</var>.type to <code>""</code>,
            and <var>record</var>.data to <code>null</code>.
          </li>
          <li>
            If <var>ndef.TNF</var> is 1 (NFC Well Known Type Record), and
            <var>ndef.TYPE</var> is <code>"T"</code> (value 0x54 following NFC
            binary encoding), then run the following sub-steps for
            <dfn data-dfn-type="dfn" id="dfn-parsing-ndef-text-record">parsing NDEF Text record</dfn>, or ensure that the
            underlying platform provides equivalent values to the
            <var>record</var> object properties:
            <ol>
              <li>Set <var>record</var>.kind to <code>"text"</code>.</li>
              <li>Set <var>record</var>.type to <code>"text/plain"</code>.</li>
              <li>
                Read the first octet of <var>ndef.PAYLOAD</var>.
                Let <var>offset</var> be the value given by bits 5 to 0 of the
                first payload octet.
              </li>
              <li>
                Let <var>language</var> be the string defined by the consecutive
                <var>offset</var> number of octets, converted from US-ASCII
                encoding. Append <code>";lang="</code> and then the value of
                <var>language</var> to <var>record</var>.type.
              </li>
              <li>
                Set <var>record</var>.data to the string created from the
                consecutive <var>ndef.PAYLOAD</var> octets, converted to UTF-16
                encoding.
              </li>
            </ol>
          </li> <!-- reading NDEF Text record -->
          <li>
            If <var>ndef.TNF</var> is 1 (NFC Well Known Type Record), and
            <var>ndef.TYPE</var> is <code>"U"</code> (value 0x55 in NFC binary
            encoding), then run the following sub-steps for
            <dfn data-dfn-type="dfn" id="dfn-parsing-ndef-url-record">parsing NDEF URL record</dfn>, or make sure that the
            underlying platform provides equivalent values to the
            <var>record</var> object properties:
            <ol>
              <li>Set <var>record</var>.kind to <code>"url"</code>.</li>
              <li>Set <var>record</var>.type to <code>"text/plain"</code>.</li>
              <li>
                Let <var>scheme</var> be the value of the first octet of
                <var>ndef.PAYLOAD</var>.
              </li>
              <li>
                If <var>scheme</var> is not 0, then set <var>record</var>.data
                to the string obtained from mapping the value of
                <var>scheme</var> to the URL scheme as specified in the
                [<cite><a class="bibref" href="#bib-NFC-STANDARDS">NFC-STANDARDS</a></cite>] URI Record Type Definition specification,
                Section 3.2.2.
              </li>
              <li>
                Set <var>record</var>.data to the UTF-16 string converted from
                the octets of <var>ndef.PAYLOAD</var> except the first octet.
              </li>
            </ol>
          </li> <!-- parsing NDEF URL record -->
          <li>
            If <var>ndef.TNF</var> is 3 (NFC Absolute URI Type record), then
            set <var>record</var>.kind to <code>"url"</code>,
            set <var>record</var>.type to <code>"text/plain"</code> and
            set <var>record</var>.data to the string converted from
            <var>ndef.PAYLOAD</var>.
          </li> <!-- parsing NDEF Absolute URI record -->
          <li>
            If <var>ndef.TNF</var> is 2 (NFC Media Type record), then run
            the following sub-steps for <dfn data-dfn-type="dfn" id="dfn-parsing-ndef-media-record">parsing NDEF Media record</dfn>, or
            make sure that the underlying platform provides equivalent values to
            the <var>record</var> object properties:
            <ol>
              <li>
                If <var>ndef.TYPE</var> matches the <a href="#dfn-match-pattern" class="internalDFN" data-link-type="dfn"><code>match pattern</code></a>
                <code>"application/*json"</code>, then
                <ol>
                  <li>Set <var>record</var>.kind to <code>"json"</code>.</li>
                  <li>Set <var>record</var>.type to <var>ndef.TYPE</var>.</li>
                  <li>
                    Set <var>record</var>.data to the result of converting
                    <var>ndef.PAYLOAD</var> to string.
                    <div class="note"><div class="note-title" aria-level="5" role="heading" id="h-note26"><span>Note</span></div><p class="">
                      The payload <em class="rfc2119" title="SHOULD NOT">SHOULD NOT</em> be evaluated by UAs for
                      security reasons.
                    </p></div>
                  </li>
                </ol>
              </li>
              <li>
                Otherwise,
                <ol>
                  <li>Set <var>record</var>.kind to <code>"opaque"</code>.</li>
                  <li>Set <var>record</var>.type to <var>ndef.TYPE</var>.</li>
                  <li>
                    Set <var>record</var>.data to a new <code>ArrayBuffer</code>
                    object constructed from the octets of
                    <var>ndef.PAYLOAD</var>.
                  </li>
                </ol>
              </li>
            </ol>
          </li> <!-- parsing NDEF Media record -->
          <li>
            If <var>ndef.TNF</var> is 4 (NFC External Type record), and
            <var>ndef.TYPE</var> is <code>urn:nfc:ext:w3.org:webnfc</code>,
            then set <var>message</var>.url to the value decoded from
            <var>ndef.PAYLOAD</var> in UTF-16.
          </li> <!-- parsing Web NFC record -->
          <li>
            Otherwise, if <var>ndef.TNF</var> is 4 (NFC External Type record),
            or 5 (NFC Unknown Type record) then run the following sub-steps,
            or make sure that the underlying platform provides equivalent values
            to the <var>record</var> object properties:
            <ol>
              <li>Set <var>record</var>.kind to <code>"opaque"</code>.</li>
              <li>
                If <var>ndef.TYPE</var> is defined, then set
                <var>record</var>.type to that string value, otherwise to
                <code>"application/octet-stream</code>.
              </li>
              <li>
                Set <var>record</var>.data to a new <code>ArrayBuffer</code>
                object constructed from the octets of <var>ndef.PAYLOAD</var>.
              </li>
            </ol>
          </li> <!-- parsing NDEF External/Unknown record -->
          <li>
            Otherwise, skip to the next <a href="#dfn-ndef-record" class="internalDFN" data-link-type="dfn">NDEF record</a> in <var>input</var>.
          </li>
          <li>
            Add <var>record</var> to <var>message</var>.data.
          </li>
        </ol>
      </li>
      <li>
        Set <var>NFCAdapter@[[receivedMessage]]</var> to <var>message</var>.
      </li>
      <li>
        If <var>NFCAdapter@[[suspended]]</var> is <code>false</code>,
        then run the <a href="#steps-dispatch">dispatch NFC content</a>
        algorithm.
      </li>
    </ol>
    </section>

    <section id="dispatching-nfc-content" typeof="bibo:Chapter" resource="#dispatching-nfc-content" property="bibo:hasPart"><h4 id="h-dispatching-nfc-content" resource="#h-dispatching-nfc-content"><span property="xhv:role" resource="xhv:heading"><span class="secno">11.5.2 </span>Dispatching NFC content</span></h4>
    <p>
      The following steps are used for dispatching received <a href="#dfn-nfc-content" class="internalDFN" data-link-type="dfn">NFC content</a>:
    </p>
    <ol id="steps-dispatch">
      <li>
        Let <var>message</var> be <var>NFCAdapter@[[receivedMessage]]</var>.
      </li>
      <li>
        For each <a href="#dfn-nfc-watch" class="internalDFN" data-link-type="dfn">NFC watch</a> <var>watch</var> that has
        been registered using the <code>watch()</code> method in
        <var>this@[[watchList]]</var>, run the following sub-steps:
        <ol>
          <li>
            Let <var>options</var> be the <code><a href="#dom-nfcwatchoptions" class="internalDFN" data-link-type="dfn"><code>NFCWatchOptions</code></a></code>
            saved with <var>watch</var>, and let <var>callback</var> be the
            registered callback function.
          </li>
          <li>
            If <var>options</var>.mode is <code>"web-nfc-only"</code>, and
            <var>message</var>.url is <var>null</var>, then skip to the next
            <a href="#dfn-nfc-watch" class="internalDFN" data-link-type="dfn">NFC watch</a>.
          </li>
          <li>
            Otherwise, if <var>options</var>.mode is
            <code>"web-nfc-only"</code>, and <var>message</var>.url is not
            <code>null</code>, or if <var>options</var>.mode is
            <code>"any"</code>, then run the following sub-steps:
            <ol>
              <li>
                If <var>message</var>.url does not match the <a href="#dfn-url-pattern" class="internalDFN" data-link-type="dfn"><code>URL pattern</code></a>
                stored in <var>options</var>.url, then skip to the next
                <a href="#dfn-nfc-watch" class="internalDFN" data-link-type="dfn">NFC watch</a>.
              </li>
              <li>
                If <var>options</var>.kind is not equal to any
                <var>record</var>.kind where <var>record</var> is an element of
                <var>message</var>, then skip to the next <a href="#dfn-nfc-watch" class="internalDFN" data-link-type="dfn">NFC watch</a>.
              </li>
              <li>
                If <var>options</var>.type is not equal to any
                <var>record</var>.type where <var>record</var> is an element of
                <var>message</var>, then skip to the next <a href="#dfn-nfc-watch" class="internalDFN" data-link-type="dfn">NFC watch</a>.
              </li>
              <li>
                <a href="#dfn-queue-a-task" class="internalDFN" data-link-type="dfn">Queue a task</a> using the <dfn data-dfn-type="dfn" id="dfn-web-nfc-task-source">Web NFC task source</dfn>
                to invoke the <code>MessageCallback</code>var&gt;callback
                with <var>message</var> as its argument.
              </li>
              <li>
                Set <var>NFCAdapter@[[receivedMessage]]</var> to
                <code>null</code>.
              </li>
            </ol>
          </li>
        </ol>
      </li>
      <li>
        Set <var>NFCAdapter@[[receivedMessage]]</var> to <code>null</code>.
      </li>
    </ol>
    </section>
  </section> <!-- receiving content -->

  <section id="handling-visibility-and-focus" typeof="bibo:Chapter" resource="#handling-visibility-and-focus" property="bibo:hasPart"><h3 id="h-handling-visibility-and-focus" resource="#h-handling-visibility-and-focus"><span property="xhv:role" resource="xhv:heading"><span class="secno">11.6 </span>Handling visibility and focus</span></h3>
    <p>
      With the term <dfn id="nfc-suspended" data-dfn-type="dfn">suspended</dfn> this specification
      refers to NFC operations being suspended, i.e. no <a href="#dfn-nfc-content" class="internalDFN" data-link-type="dfn">NFC content</a> is
      pushed, and no received <a href="#dfn-nfc-content" class="internalDFN" data-link-type="dfn">NFC content</a> is presented via watches while
      suspended.
      However, timers instantiated on platform level for the
      <code><a href="#dom-nfcadapter-pushmessage" class="internalDFN" data-link-type="dfn"><code>NFCAdapter.pushMessage</code></a>()</code> method continue running,
      and if they expire, the event should be recorded and handled
      next time the execution is resumed, i.e. when the <code>focus</code>
      event is fired on the <code>Window</code> object.
    </p>
    <p>
      When the <code>Window</code> object associated with the
      <code><a href="#dfn-document" class="internalDFN" data-link-type="dfn">Document</a></code> using the Web NFC API
      <a href="http://www.w3.org/TR/page-visibility/#now-visible-algorithm">
      becomes visible</a> and in
      <a href="https://html.spec.whatwg.org/#focus">focus</a>,
      then run the following steps:
    </p>
    <ol id="steps-visible-focus">
      <li>
        Set <var>NFCAdapter@[[suspended]]</var> to <code>false</code>.
      </li>
      <li>
        If <var>NFCAdapter@[[receivedMessage]]</var> is not
        <code>null</code>, then run the <a href="#steps-dispatch">
        dispatch NFC content</a> algorithm.
      </li>
    </ol>
    <p>
      When the <code>Window</code> object associated with the
      <code><a href="#dfn-document" class="internalDFN" data-link-type="dfn">Document</a></code> using the Web NFC API
      <a href="https://html.spec.whatwg.org/#handler-onblur">loses focus</a>,
      then run the following steps:
    </p>
    <ol id="steps-focus-lost">
      <li>
        Set <var>NFCAdapter@[[suspended]]</var> to <code>true</code>.
      </li>
    </ol>
  </section>

</section> <!-- NFCAdapter -->

<!-- - - - - - - - - - - - - - -  Changes - - - - - - - - - - - - - - - - - -->
<section class="appendix" id="Changes" typeof="bibo:Chapter" resource="#Changes" property="bibo:hasPart"><!--OddPage--><h2 id="h-changes" resource="#h-changes"><span property="xhv:role" resource="xhv:heading"><span class="secno">A. </span>Changes</span></h2>
  <p>
    The following is a list of substantial changes to the document. For a
    complete list of changes, see the <a href="https://github.com/w3c/web-nfc/commits/gh-pages">change log on
    Github</a>. You can also view the <a href="https://github.com/w3c/web-nfc/issues?page=1&amp;state=closed">
    recently closed bugs</a>.
  </p>
  <ul>
    <li>Corrections in the usage of origin.</li>
    <li>Defined <code><a href="#idl-def-nfcrecorddata" class="internalDFN" data-link-type="dfn"><code>NFCRecordData</code></a></code> as explicit union.</li>
    <li>Defined <code><a href="#dom-nfcmessage" class="internalDFN" data-link-type="dfn"><code>NFCMessage</code></a></code> as a dictionary.</li>
    <li>Improved definitions for URL and match pattern.
    </li><li>Added section for handling visibility and focus.</li>
    <li>Added internal slots to <code><a href="#idl-def-nfcadapter" class="internalDFN" data-link-type="dfn"><code>NFCAdapter</code></a></code>.</li>
    <li>Changed push policy for background pages.</li>
    <li>Changed receive policy for background pages.</li>
  </ul>
</section>

<!-- - - - - - - - - - - - - - - Open issues - - - - - - - - - - - - - - - -->
<section typeof="bibo:Chapter" resource="#openissues" property="bibo:hasPart"> <!--OddPage--><h2 class="appendix" id="openissues" resource="#openissues"><span property="xhv:role" resource="xhv:heading"><span class="secno">B. </span>Open issues</span></h2>
  <p>
    The following problems are being discussed and need most attention:
    </p><ul>
      <li>
        <a href="https://github.com/w3c/web-nfc/issues/2">
        Verify security model.</a>
      </li>
      <li>
        <a href="https://github.com/w3c/web-nfc/issues/3">
        Suggest a permission UI flow.</a>
      </li>
      <li>
        <a href="https://github.com/w3c/web-nfc/issues/40">
        Simplify process for obtaining permissions.</a>
      </li>
      <li>
        <a href="https://github.com/w3c/web-nfc/issues/17">
        Using service workers and protocol handlers.</a>
      </li>
      <li>
        <a href="https://github.com/w3c/web-nfc/issues/53">
        How much needs to be hidden from pages that lose focus during NFC
        operations?</a>
      </li>
    </ul>
    This version addresses the issues above, and also other issues.
  <p></p>
</section>

<!-- - - - - - - - - - - - - - - Acknowledgements - - - - - - - - - - - - - -->
<section id="acknowledgements" typeof="bibo:Chapter" resource="#acknowledgements" property="bibo:hasPart"> <!--OddPage--><h2 id="h-acknowledgements" resource="#h-acknowledgements"><span property="xhv:role" resource="xhv:heading"><span class="secno">C. </span>Acknowledgements</span></h2>
  <p>
    The editors would like to express their gratitude to the former editors
    Luc Yriarte and Samuel Ortiz, and also to Don Coleman, Anne van Kesteren,
    Domenic Denicola, Jonas Sickling, Jeffrey Yasskin, Alexander Shalamov,
    Salvatore Iovene, Rijubrata Bhaumik and Anssi Kostiainen for their technical
    guidance, implementation feedback and support.
  </p>
</section>



<section id="references" class="appendix" typeof="bibo:Chapter" resource="#references" property="bibo:hasPart"><!--OddPage--><h2 id="h-references" resource="#h-references"><span property="xhv:role" resource="xhv:heading"><span class="secno">D. </span>References</span></h2><section id="normative-references" typeof="bibo:Chapter" resource="#normative-references" property="bibo:hasPart"><h3 id="h-normative-references" resource="#h-normative-references"><span property="xhv:role" resource="xhv:heading"><span class="secno">D.1 </span>Normative references</span></h3><dl class="bibliography" resource=""><dt id="bib-DOM4">[DOM4]</dt><dd>Anne van Kesteren; Aryeh Gregor; Ms2ger; Alex Russell; Robin Berjon. <a href="http://www.w3.org/TR/dom/" property="dc:requires"><cite>W3C DOM4</cite></a>. 18 June 2015. W3C Last Call Working Draft. URL: <a href="http://www.w3.org/TR/dom/" property="dc:requires">http://www.w3.org/TR/dom/</a>
</dd><dt id="bib-ECMASCRIPT">[ECMASCRIPT]</dt><dd>Allen Wirfs-Brock. <a href="http://www.ecma-international.org/ecma-262/6.0/" property="dc:requires"><cite>ECMA-262 6th Edition, The ECMAScript 2015 Language Specification</cite></a>. June 2015. Standard. URL: <a href="http://www.ecma-international.org/ecma-262/6.0/" property="dc:requires">http://www.ecma-international.org/ecma-262/6.0/</a>
</dd><dt id="bib-ENCODING">[ENCODING]</dt><dd>Anne van Kesteren; Joshua Bell; Addison Phillips. <a href="http://www.w3.org/TR/encoding/" property="dc:requires"><cite>Encoding</cite></a>. 16 September 2014. W3C Candidate Recommendation. URL: <a href="http://www.w3.org/TR/encoding/" property="dc:requires">http://www.w3.org/TR/encoding/</a>
</dd><dt id="bib-HTML5">[HTML5]</dt><dd>Ian Hickson; Robin Berjon; Steve Faulkner; Travis Leithead; Erika Doyle Navara; Edward O'Connor; Silvia Pfeiffer. <a href="http://www.w3.org/TR/html5/" property="dc:requires"><cite>HTML5</cite></a>. 28 October 2014. W3C Recommendation. URL: <a href="http://www.w3.org/TR/html5/" property="dc:requires">http://www.w3.org/TR/html5/</a>
</dd><dt id="bib-NFC-STANDARDS">[NFC-STANDARDS]</dt><dd><a href="http://members.nfc-forum.org/specs/spec_list/" property="dc:requires"><cite>NFC Forum Technical Specifications</cite></a>. 24 July 2006. URL: <a href="http://members.nfc-forum.org/specs/spec_list/" property="dc:requires">http://members.nfc-forum.org/specs/spec_list/</a>
</dd><dt id="bib-RFC2119">[RFC2119]</dt><dd>S. Bradner. <a href="https://tools.ietf.org/html/rfc2119" property="dc:requires"><cite>Key words for use in RFCs to Indicate Requirement Levels</cite></a>. March 1997. Best Current Practice. URL: <a href="https://tools.ietf.org/html/rfc2119" property="dc:requires">https://tools.ietf.org/html/rfc2119</a>
</dd><dt id="bib-URL">[URL]</dt><dd>Anne van Kesteren; Sam Ruby. <a href="http://www.w3.org/TR/url-1/" property="dc:requires"><cite>URL</cite></a>. 9 December 2014. W3C Working Draft. URL: <a href="http://www.w3.org/TR/url-1/" property="dc:requires">http://www.w3.org/TR/url-1/</a>
</dd><dt id="bib-WEBAPPSEC">[WEBAPPSEC]</dt><dd><a href="https://w3c.github.io/webappsec/specs/powerfulfeatures" property="dc:requires"><cite>Secure Contexts</cite></a>. 17 July 2015. URL: <a href="https://w3c.github.io/webappsec/specs/powerfulfeatures" property="dc:requires">https://w3c.github.io/webappsec/specs/powerfulfeatures</a>
</dd><dt id="bib-WEBIDL">[WEBIDL]</dt><dd>Cameron McCormack; Boris Zbarsky. <a href="http://www.w3.org/TR/WebIDL-1/" property="dc:requires"><cite>WebIDL Level 1</cite></a>. 4 August 2015. W3C Working Draft. URL: <a href="http://www.w3.org/TR/WebIDL-1/" property="dc:requires">http://www.w3.org/TR/WebIDL-1/</a>
</dd></dl></section><section id="informative-references" typeof="bibo:Chapter" resource="#informative-references" property="bibo:hasPart"><h3 id="h-informative-references" resource="#h-informative-references"><span property="xhv:role" resource="xhv:heading"><span class="secno">D.2 </span>Informative references</span></h3><dl class="bibliography" resource=""><dt id="bib-ABNF">[ABNF]</dt><dd>D. Crocker, Ed.; P. Overell. <a href="https://tools.ietf.org/html/rfc5234" property="dc:references"><cite>Augmented BNF for Syntax Specifications: ABNF</cite></a>. January 2008. Internet Standard. URL: <a href="https://tools.ietf.org/html/rfc5234" property="dc:references">https://tools.ietf.org/html/rfc5234</a>
</dd><dt id="bib-ISO-639.2">[ISO-639.2]</dt><dd><a href="https://www.loc.gov/standards/iso639-2/php/code_list.php" property="dc:references"><cite>Codes for the Representation of Names of Languages</cite></a>. 18 March 2014. URL: <a href="https://www.loc.gov/standards/iso639-2/php/code_list.php" property="dc:references">https://www.loc.gov/standards/iso639-2/php/code_list.php</a>
</dd><dt id="bib-RFC2046">[RFC2046]</dt><dd>N. Freed; N. Borenstein. <a href="https://tools.ietf.org/html/rfc2046" property="dc:references"><cite>Multipurpose Internet Mail Extensions (MIME) Part Two: Media Types</cite></a>. November 1996. Draft Standard. URL: <a href="https://tools.ietf.org/html/rfc2046" property="dc:references">https://tools.ietf.org/html/rfc2046</a>
</dd><dt id="bib-RFC3986">[RFC3986]</dt><dd>T. Berners-Lee; R. Fielding; L. Masinter. <a href="https://tools.ietf.org/html/rfc3986" property="dc:references"><cite>Uniform Resource Identifier (URI): Generic Syntax</cite></a>. January 2005. Internet Standard. URL: <a href="https://tools.ietf.org/html/rfc3986" property="dc:references">https://tools.ietf.org/html/rfc3986</a>
</dd><dt id="bib-permissions">[permissions]</dt><dd>Mounir Lamouri; Marcos Caceres. <a href="http://www.w3.org/TR/permissions/" property="dc:references"><cite>The Permissions API</cite></a>. 7 April 2015. W3C Working Draft. URL: <a href="http://www.w3.org/TR/permissions/" property="dc:references">http://www.w3.org/TR/permissions/</a>
</dd></dl></section></section></body></html>