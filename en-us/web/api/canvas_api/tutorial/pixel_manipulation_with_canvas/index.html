<p>{{CanvasSidebar}} {{PreviousNext(“Web/API/Canvas_API/Tutorial/Advanced_animations”, “Web/API/Canvas_API/Tutorial/Optimizing_canvas”)}}</p>
<p>Until now we haven’t looked at the actual pixels of our canvas. With the <code>ImageData</code> object you can directly read and write a data array to manipulate pixel data. We will also look into how image smoothing (anti-aliasing) can be controlled and how to save images from your canvas.</p>
<h2 id="the-imagedata-object">The ImageData object</h2>
<p>The {{domxref(“ImageData”)}} object represents the underlying pixel data of an area of a canvas object. It contains the following read-only attributes:</p>
<ul>
<li><code>width</code>
<ul>
<li>: The width of the image in pixels.</li>
</ul></li>
<li><code>height</code>
<ul>
<li>: The height of the image in pixels.</li>
</ul></li>
<li><code>data</code>
<ul>
<li>: A {{jsxref(“Uint8ClampedArray”)}} representing a one-dimensional array containing the data in the RGBA order, with integer values between <code>0</code> and <code>255</code> (included).</li>
</ul></li>
</ul>
<p>The <code>data</code> property returns a {{jsxref(“Uint8ClampedArray”)}} which can be accessed to look at the raw pixel data; each pixel is represented by four one-byte values (red, green, blue, and alpha, in that order; that is, “RGBA” format). Each color component is represented by an integer between 0 and 255. Each component is assigned a consecutive index within the array, with the top left pixel’s red component being at index 0 within the array. Pixels then proceed from left to right, then downward, throughout the array.</p>
<p>The {{jsxref(“Uint8ClampedArray”)}} contains <code>height</code> × <code>width</code> × 4 bytes of data, with index values ranging from 0 to (<code>height</code>×<code>width</code>×4)-1.</p>
<p>For example, to read the blue component’s value from the pixel at column 200, row 50 in the image, you would do the following:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb1-1" title="1">blueComponent <span class="op">=</span> <span class="va">imageData</span>.<span class="at">data</span>[((<span class="dv">50</span> <span class="op">*</span> (<span class="va">imageData</span>.<span class="at">width</span> <span class="op">*</span> <span class="dv">4</span>)) <span class="op">+</span> (<span class="dv">200</span> <span class="op">*</span> <span class="dv">4</span>)) <span class="op">+</span> <span class="dv">2</span>]<span class="op">;</span></a></code></pre></div>
<p>If given a set of coordinates (X and Y), you may end up doing something like this:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">var</span> xCoord <span class="op">=</span> <span class="dv">50</span><span class="op">;</span></a>
<a class="sourceLine" id="cb2-2" title="2"><span class="kw">var</span> yCoord <span class="op">=</span> <span class="dv">100</span><span class="op">;</span></a>
<a class="sourceLine" id="cb2-3" title="3"><span class="kw">var</span> canvasWidth <span class="op">=</span> <span class="dv">1024</span><span class="op">;</span></a>
<a class="sourceLine" id="cb2-4" title="4"></a>
<a class="sourceLine" id="cb2-5" title="5"><span class="kw">function</span> <span class="at">getColorIndicesForCoord</span>(x<span class="op">,</span> y<span class="op">,</span> width) <span class="op">{</span></a>
<a class="sourceLine" id="cb2-6" title="6">  <span class="kw">var</span> red <span class="op">=</span> y <span class="op">*</span> (width <span class="op">*</span> <span class="dv">4</span>) <span class="op">+</span> x <span class="op">*</span> <span class="dv">4</span><span class="op">;</span></a>
<a class="sourceLine" id="cb2-7" title="7">  <span class="cf">return</span> [red<span class="op">,</span> red <span class="op">+</span> <span class="dv">1</span><span class="op">,</span> red <span class="op">+</span> <span class="dv">2</span><span class="op">,</span> red <span class="op">+</span> <span class="dv">3</span>]<span class="op">;</span></a>
<a class="sourceLine" id="cb2-8" title="8"><span class="op">}</span></a>
<a class="sourceLine" id="cb2-9" title="9"></a>
<a class="sourceLine" id="cb2-10" title="10"><span class="kw">var</span> colorIndices <span class="op">=</span> <span class="at">getColorIndicesForCoord</span>(xCoord<span class="op">,</span> yCoord<span class="op">,</span> canvasWidth)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-11" title="11"></a>
<a class="sourceLine" id="cb2-12" title="12"><span class="kw">var</span> redIndex <span class="op">=</span> colorIndices[<span class="dv">0</span>]<span class="op">;</span></a>
<a class="sourceLine" id="cb2-13" title="13"><span class="kw">var</span> greenIndex <span class="op">=</span> colorIndices[<span class="dv">1</span>]<span class="op">;</span></a>
<a class="sourceLine" id="cb2-14" title="14"><span class="kw">var</span> blueIndex <span class="op">=</span> colorIndices[<span class="dv">2</span>]<span class="op">;</span></a>
<a class="sourceLine" id="cb2-15" title="15"><span class="kw">var</span> alphaIndex <span class="op">=</span> colorIndices[<span class="dv">3</span>]<span class="op">;</span></a>
<a class="sourceLine" id="cb2-16" title="16"></a>
<a class="sourceLine" id="cb2-17" title="17"><span class="kw">var</span> redForCoord <span class="op">=</span> <span class="va">imageData</span>.<span class="at">data</span>[redIndex]<span class="op">;</span></a>
<a class="sourceLine" id="cb2-18" title="18"><span class="kw">var</span> greenForCoord <span class="op">=</span> <span class="va">imageData</span>.<span class="at">data</span>[greenIndex]<span class="op">;</span></a>
<a class="sourceLine" id="cb2-19" title="19"><span class="kw">var</span> blueForCoord <span class="op">=</span> <span class="va">imageData</span>.<span class="at">data</span>[blueIndex]<span class="op">;</span></a>
<a class="sourceLine" id="cb2-20" title="20"><span class="kw">var</span> alphaForCoord <span class="op">=</span> <span class="va">imageData</span>.<span class="at">data</span>[alphaIndex]<span class="op">;</span></a></code></pre></div>
<p>Or, if ES2015 is appropriate:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">const</span> xCoord <span class="op">=</span> <span class="dv">50</span><span class="op">;</span></a>
<a class="sourceLine" id="cb3-2" title="2"><span class="kw">const</span> yCoord <span class="op">=</span> <span class="dv">100</span><span class="op">;</span></a>
<a class="sourceLine" id="cb3-3" title="3"><span class="kw">const</span> canvasWidth <span class="op">=</span> <span class="dv">1024</span><span class="op">;</span></a>
<a class="sourceLine" id="cb3-4" title="4"></a>
<a class="sourceLine" id="cb3-5" title="5"><span class="kw">const</span> getColorIndicesForCoord <span class="op">=</span> (x<span class="op">,</span> y<span class="op">,</span> width) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb3-6" title="6">  <span class="kw">const</span> red <span class="op">=</span> y <span class="op">*</span> (width <span class="op">*</span> <span class="dv">4</span>) <span class="op">+</span> x <span class="op">*</span> <span class="dv">4</span><span class="op">;</span></a>
<a class="sourceLine" id="cb3-7" title="7">  <span class="cf">return</span> [red<span class="op">,</span> red <span class="op">+</span> <span class="dv">1</span><span class="op">,</span> red <span class="op">+</span> <span class="dv">2</span><span class="op">,</span> red <span class="op">+</span> <span class="dv">3</span>]<span class="op">;</span></a>
<a class="sourceLine" id="cb3-8" title="8"><span class="op">};</span></a>
<a class="sourceLine" id="cb3-9" title="9"></a>
<a class="sourceLine" id="cb3-10" title="10"><span class="kw">const</span> colorIndices <span class="op">=</span> <span class="at">getColorIndicesForCoord</span>(xCoord<span class="op">,</span> yCoord<span class="op">,</span> canvasWidth)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-11" title="11"></a>
<a class="sourceLine" id="cb3-12" title="12"><span class="kw">const</span> [redIndex<span class="op">,</span> greenIndex<span class="op">,</span> blueIndex<span class="op">,</span> alphaIndex] <span class="op">=</span> colorIndices<span class="op">;</span></a></code></pre></div>
<p>You may also access the size of the pixel array in bytes by reading the <code>Uint8ClampedArray.length</code> attribute:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb4-1" title="1"><span class="kw">var</span> numBytes <span class="op">=</span> <span class="va">imageData</span>.<span class="va">data</span>.<span class="at">length</span><span class="op">;</span></a></code></pre></div>
<h2 id="creating-an-imagedata-object">Creating an ImageData object</h2>
<p>To create a new, blank <code>ImageData</code> object, you should use the {{domxref(“CanvasRenderingContext2D.createImageData”, “createImageData()”)}} method. There are two versions of the <code>createImageData()</code> method:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb5-1" title="1"><span class="kw">var</span> myImageData <span class="op">=</span> <span class="va">ctx</span>.<span class="at">createImageData</span>(width<span class="op">,</span> height)<span class="op">;</span></a></code></pre></div>
<p>This creates a new <code>ImageData</code> object with the specified dimensions. All pixels are preset to transparent black (all zeroes i.e rgba(0,0,0,0)).</p>
<p>You can also create a new <code>ImageData</code> object with the same dimensions as the object specified by <code>anotherImageData</code>. The new object’s pixels are all preset to transparent black. <strong>This does not copy the image data!</strong></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb6-1" title="1"><span class="kw">var</span> myImageData <span class="op">=</span> <span class="va">ctx</span>.<span class="at">createImageData</span>(anotherImageData)<span class="op">;</span></a></code></pre></div>
<h2 id="getting-the-pixel-data-for-a-context">Getting the pixel data for a context</h2>
<p>To obtain an <code>ImageData</code> object containing a copy of the pixel data for a canvas context, you can use the <code>getImageData()</code> method:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb7-1" title="1"><span class="kw">var</span> myImageData <span class="op">=</span> <span class="va">ctx</span>.<span class="at">getImageData</span>(left<span class="op">,</span> top<span class="op">,</span> width<span class="op">,</span> height)<span class="op">;</span></a></code></pre></div>
<p>This method returns an <code>ImageData</code> object representing the pixel data for the area of the canvas whose corners are represented by the points (<code>left</code>,<code>top</code>), (<code>left+width</code>, <code>top</code>), (<code>left</code>, <code>top+height</code>), and (<code>left+width</code>, <code>top+height</code>). The coordinates are specified in canvas coordinate space units.</p>
<blockquote>
<p><strong>Note:</strong> Any pixels outside the canvas are returned as transparent black in the resulting <code>ImageData</code> object.</p>
</blockquote>
<p>This method is also demonstrated in the article <a href="/en-US/docs/Web/API/Canvas_API/Manipulating_video_using_canvas">Manipulating video using canvas</a>.</p>
<h3 id="a-color-picker">A color picker</h3>
<p>In this example we are using the <a href="/en-US/docs/Web/API/CanvasRenderingContext2D/getImageData"><code>getImageData()</code></a>method to display the color under the mouse cursor. For this, we need the current position of the mouse with <code>layerX</code> and <code>layerY</code>, then we look up the pixel data on that position in the pixel array that <a href="/en-US/docs/Web/API/CanvasRenderingContext2D/getImageData"><code>getImageData()</code></a> provides us. Finally, we use the array data to set a background color and a text in the <code>&lt;div&gt;</code> to display the color. Clicking on the image will do the same operation but remember what the selected color was.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb8-1" title="1"><span class="kw">var</span> img <span class="op">=</span> <span class="kw">new</span> <span class="at">Image</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb8-2" title="2"><span class="va">img</span>.<span class="at">crossOrigin</span> <span class="op">=</span> <span class="st">&#39;anonymous&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb8-3" title="3"><span class="va">img</span>.<span class="at">src</span> <span class="op">=</span> <span class="st">&#39;./assets/rhino.jpg&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb8-4" title="4"><span class="kw">var</span> canvas <span class="op">=</span> <span class="va">document</span>.<span class="at">getElementById</span>(<span class="st">&#39;canvas&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb8-5" title="5"><span class="kw">var</span> ctx <span class="op">=</span> <span class="va">canvas</span>.<span class="at">getContext</span>(<span class="st">&#39;2d&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb8-6" title="6"><span class="va">img</span>.<span class="at">onload</span> <span class="op">=</span> <span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb8-7" title="7">  <span class="va">ctx</span>.<span class="at">drawImage</span>(img<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb8-8" title="8">  <span class="va">img</span>.<span class="va">style</span>.<span class="at">display</span> <span class="op">=</span> <span class="st">&#39;none&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb8-9" title="9"><span class="op">};</span></a>
<a class="sourceLine" id="cb8-10" title="10"><span class="kw">var</span> hoveredColor <span class="op">=</span> <span class="va">document</span>.<span class="at">getElementById</span>(<span class="st">&#39;hovered-color&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb8-11" title="11"><span class="kw">var</span> selectedColor <span class="op">=</span> <span class="va">document</span>.<span class="at">getElementById</span>(<span class="st">&#39;selected-color&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb8-12" title="12"></a>
<a class="sourceLine" id="cb8-13" title="13"><span class="kw">function</span> <span class="at">pick</span>(event<span class="op">,</span> destination) <span class="op">{</span></a>
<a class="sourceLine" id="cb8-14" title="14">  <span class="kw">var</span> x <span class="op">=</span> <span class="va">event</span>.<span class="at">layerX</span><span class="op">;</span></a>
<a class="sourceLine" id="cb8-15" title="15">  <span class="kw">var</span> y <span class="op">=</span> <span class="va">event</span>.<span class="at">layerY</span><span class="op">;</span></a>
<a class="sourceLine" id="cb8-16" title="16">  <span class="kw">var</span> pixel <span class="op">=</span> <span class="va">ctx</span>.<span class="at">getImageData</span>(x<span class="op">,</span> y<span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">1</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb8-17" title="17">  <span class="kw">var</span> data <span class="op">=</span> <span class="va">pixel</span>.<span class="at">data</span><span class="op">;</span></a>
<a class="sourceLine" id="cb8-18" title="18"></a>
<a class="sourceLine" id="cb8-19" title="19">    const rgba <span class="op">=</span> <span class="vs">`rgba(</span><span class="sc">${</span>data[<span class="dv">0</span>]<span class="sc">}</span><span class="vs">, </span><span class="sc">${</span>data[<span class="dv">1</span>]<span class="sc">}</span><span class="vs">, </span><span class="sc">${</span>data[<span class="dv">2</span>]<span class="sc">}</span><span class="vs">, </span><span class="sc">${</span>data[<span class="dv">3</span>] / <span class="dv">255</span><span class="sc">}</span><span class="vs">)`</span><span class="op">;</span></a>
<a class="sourceLine" id="cb8-20" title="20">   <span class="va"> destination</span>.<span class="va">style</span>.<span class="at">background</span> <span class="op">=</span> rgba<span class="op">;</span></a>
<a class="sourceLine" id="cb8-21" title="21">   <span class="va"> destination</span>.<span class="at">textContent</span> <span class="op">=</span> rgba<span class="op">;</span></a>
<a class="sourceLine" id="cb8-22" title="22"></a>
<a class="sourceLine" id="cb8-23" title="23">    return rgba<span class="op">;</span></a>
<a class="sourceLine" id="cb8-24" title="24"><span class="op">}</span></a>
<a class="sourceLine" id="cb8-25" title="25"></a>
<a class="sourceLine" id="cb8-26" title="26"><span class="va">canvas</span>.<span class="at">addEventListener</span>(<span class="st">&#39;mousemove&#39;</span><span class="op">,</span> <span class="kw">function</span>(event) <span class="op">{</span></a>
<a class="sourceLine" id="cb8-27" title="27">   <span class="at"> pick</span>(event<span class="op">,</span> hoveredColor)<span class="op">;</span></a>
<a class="sourceLine" id="cb8-28" title="28"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb8-29" title="29"><span class="va">canvas</span>.<span class="at">addEventListener</span>(<span class="st">&#39;click&#39;</span><span class="op">,</span> <span class="kw">function</span>(event) <span class="op">{</span></a>
<a class="sourceLine" id="cb8-30" title="30">   <span class="at"> pick</span>(event<span class="op">,</span> selectedColor)<span class="op">;</span></a>
<a class="sourceLine" id="cb8-31" title="31"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>The code’s usage is demonstrated in the following live example:</p>
<p>{{EmbedGHLiveSample(“dom-examples/canvas/pixel-manipulation/color-picker.html”, ‘100%’, 300)}}</p>
<p>Also see the source code — <a href="https://github.com/mdn/dom-examples/blob/master/canvas/pixel-manipulation/color-picker.html">HTML</a>, <a href="https://github.com/mdn/dom-examples/blob/master/canvas/pixel-manipulation/color-picker.js">JavaScript</a>.</p>
<h2 id="painting-pixel-data-into-a-context">Painting pixel data into a context</h2>
<p>You can use the <a href="/en-US/docs/Web/API/CanvasRenderingContext2D/putImageData">putImageData()</a> method to paint pixel data into a context:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb9-1" title="1"><span class="va">ctx</span>.<span class="at">putImageData</span>(myImageData<span class="op">,</span> dx<span class="op">,</span> dy)<span class="op">;</span></a></code></pre></div>
<p>The <code>dx</code> and <code>dy</code> parameters indicate the device coordinates within the context at which to paint the top left corner of the pixel data you wish to draw.</p>
<p>For example, to paint the entire image represented by <code>myImageData</code> to the top left corner of the context, you can do the following:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb10-1" title="1"><span class="va">ctx</span>.<span class="at">putImageData</span>(myImageData<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></a></code></pre></div>
<h3 id="grayscaling-and-inverting-colors">Grayscaling and inverting colors</h3>
<p>In this example we iterate over all pixels to change their values, then we put the modified pixel array back to the canvas using <a href="/en-US/docs/Web/API/CanvasRenderingContext2D/putImageData">putImageData()</a>. The invert function subtracts each color from the max value 255. The grayscale function uses the average of red, green and blue. You can also use a weighted average, given by the formula <code>x = 0.299r + 0.587g + 0.114b</code>, for example. See <a href="https://en.wikipedia.org/wiki/Grayscale">Grayscale</a> on Wikipedia for more information.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb11-1" title="1"><span class="kw">var</span> img <span class="op">=</span> <span class="kw">new</span> <span class="at">Image</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb11-2" title="2"><span class="va">img</span>.<span class="at">crossOrigin</span> <span class="op">=</span> <span class="st">&#39;anonymous&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb11-3" title="3"><span class="va">img</span>.<span class="at">src</span> <span class="op">=</span> <span class="st">&#39;./assets/rhino.jpg&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb11-4" title="4"></a>
<a class="sourceLine" id="cb11-5" title="5"><span class="kw">var</span> canvas <span class="op">=</span> <span class="va">document</span>.<span class="at">getElementById</span>(<span class="st">&#39;canvas&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb11-6" title="6"><span class="kw">var</span> ctx <span class="op">=</span> <span class="va">canvas</span>.<span class="at">getContext</span>(<span class="st">&#39;2d&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb11-7" title="7"></a>
<a class="sourceLine" id="cb11-8" title="8"><span class="va">img</span>.<span class="at">onload</span> <span class="op">=</span> <span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb11-9" title="9">   <span class="va"> ctx</span>.<span class="at">drawImage</span>(img<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb11-10" title="10"><span class="op">};</span></a>
<a class="sourceLine" id="cb11-11" title="11"></a>
<a class="sourceLine" id="cb11-12" title="12"><span class="kw">var</span> original <span class="op">=</span> <span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb11-13" title="13">   <span class="va"> ctx</span>.<span class="at">drawImage</span>(img<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb11-14" title="14"><span class="op">};</span></a>
<a class="sourceLine" id="cb11-15" title="15"></a>
<a class="sourceLine" id="cb11-16" title="16"><span class="kw">var</span> invert <span class="op">=</span> <span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb11-17" title="17">   <span class="va"> ctx</span>.<span class="at">drawImage</span>(img<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb11-18" title="18">    const imageData <span class="op">=</span> <span class="va">ctx</span>.<span class="at">getImageData</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="va">canvas</span>.<span class="at">width</span><span class="op">,</span> <span class="va">canvas</span>.<span class="at">height</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb11-19" title="19">    const data <span class="op">=</span> <span class="va">imageData</span>.<span class="at">data</span><span class="op">;</span></a>
<a class="sourceLine" id="cb11-20" title="20">   <span class="at"> for</span> (<span class="kw">var</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="va">data</span>.<span class="at">length</span><span class="op">;</span> i <span class="op">+=</span> <span class="dv">4</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb11-21" title="21">        data[i]     <span class="op">=</span> <span class="dv">255</span> <span class="op">-</span> data[i]<span class="op">;</span>     <span class="co">// red</span></a>
<a class="sourceLine" id="cb11-22" title="22">        data[i <span class="op">+</span> <span class="dv">1</span>] <span class="op">=</span> <span class="dv">255</span> <span class="op">-</span> data[i <span class="op">+</span> <span class="dv">1</span>]<span class="op">;</span> <span class="co">// green</span></a>
<a class="sourceLine" id="cb11-23" title="23">        data[i <span class="op">+</span> <span class="dv">2</span>] <span class="op">=</span> <span class="dv">255</span> <span class="op">-</span> data[i <span class="op">+</span> <span class="dv">2</span>]<span class="op">;</span> <span class="co">// blue</span></a>
<a class="sourceLine" id="cb11-24" title="24">    <span class="op">}</span></a>
<a class="sourceLine" id="cb11-25" title="25">   <span class="va"> ctx</span>.<span class="at">putImageData</span>(imageData<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb11-26" title="26"><span class="op">};</span></a>
<a class="sourceLine" id="cb11-27" title="27"></a>
<a class="sourceLine" id="cb11-28" title="28"><span class="kw">var</span> grayscale <span class="op">=</span> <span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb11-29" title="29">   <span class="va"> ctx</span>.<span class="at">drawImage</span>(img<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb11-30" title="30">    const imageData <span class="op">=</span> <span class="va">ctx</span>.<span class="at">getImageData</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="va">canvas</span>.<span class="at">width</span><span class="op">,</span> <span class="va">canvas</span>.<span class="at">height</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb11-31" title="31">    const data <span class="op">=</span> <span class="va">imageData</span>.<span class="at">data</span><span class="op">;</span></a>
<a class="sourceLine" id="cb11-32" title="32">   <span class="at"> for</span> (<span class="kw">var</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="va">data</span>.<span class="at">length</span><span class="op">;</span> i <span class="op">+=</span> <span class="dv">4</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb11-33" title="33">        var avg <span class="op">=</span> (data[i] <span class="op">+</span> data[i <span class="op">+</span> <span class="dv">1</span>] <span class="op">+</span> data[i <span class="op">+</span> <span class="dv">2</span>]) / <span class="dv">3</span><span class="op">;</span></a>
<a class="sourceLine" id="cb11-34" title="34">        data[i]     <span class="op">=</span> avg<span class="op">;</span> <span class="co">// red</span></a>
<a class="sourceLine" id="cb11-35" title="35">        data[i <span class="op">+</span> <span class="dv">1</span>] <span class="op">=</span> avg<span class="op">;</span> <span class="co">// green</span></a>
<a class="sourceLine" id="cb11-36" title="36">        data[i <span class="op">+</span> <span class="dv">2</span>] <span class="op">=</span> avg<span class="op">;</span> <span class="co">// blue</span></a>
<a class="sourceLine" id="cb11-37" title="37">    <span class="op">}</span></a>
<a class="sourceLine" id="cb11-38" title="38">   <span class="va"> ctx</span>.<span class="at">putImageData</span>(imageData<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb11-39" title="39"><span class="op">};</span></a>
<a class="sourceLine" id="cb11-40" title="40"></a>
<a class="sourceLine" id="cb11-41" title="41"><span class="kw">const</span> inputs <span class="op">=</span> <span class="va">document</span>.<span class="at">querySelectorAll</span>(<span class="st">&#39;[name=color]&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb11-42" title="42"><span class="cf">for</span> (<span class="kw">const</span> input <span class="kw">of</span> inputs) <span class="op">{</span></a>
<a class="sourceLine" id="cb11-43" title="43">   <span class="va"> input</span>.<span class="at">addEventListener</span>(<span class="st">&quot;change&quot;</span><span class="op">,</span> <span class="kw">function</span>(evt) <span class="op">{</span></a>
<a class="sourceLine" id="cb11-44" title="44">       <span class="at"> switch</span> (<span class="va">evt</span>.<span class="va">target</span>.<span class="at">value</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb11-45" title="45">            case <span class="st">&quot;inverted&quot;</span><span class="op">:</span></a>
<a class="sourceLine" id="cb11-46" title="46">                return <span class="at">invert</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb11-47" title="47">            case <span class="st">&quot;grayscale&quot;</span><span class="op">:</span></a>
<a class="sourceLine" id="cb11-48" title="48">                return <span class="at">grayscale</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb11-49" title="49">           <span class="dt"> default</span><span class="op">:</span></a>
<a class="sourceLine" id="cb11-50" title="50">                return <span class="at">original</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb11-51" title="51">        <span class="op">}</span></a>
<a class="sourceLine" id="cb11-52" title="52">    <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb11-53" title="53"><span class="op">}</span></a></code></pre></div>
<p>The code’s usage is demonstrated in the following live example:</p>
<p>{{EmbedGHLiveSample(“dom-examples/canvas/pixel-manipulation/color-manipulation.html”, ‘100%’, 300)}}</p>
<p>Also see the source code — <a href="https://github.com/mdn/dom-examples/blob/master/canvas/pixel-manipulation/color-manipulation.html">HTML</a>, <a href="https://github.com/mdn/dom-examples/blob/master/canvas/pixel-manipulation/color-manipulation.js">JavaScript</a>.</p>
<h2 id="zooming-and-anti-aliasing">Zooming and anti-aliasing</h2>
<p>With the help of the {{domxref(“CanvasRenderingContext2D.drawImage”, “drawImage()”)}} method, a second canvas and the {{domxref(“CanvasRenderingContext2D.imageSmoothingEnabled”, “imageSmoothingEnabled”)}} property, we are able to zoom into our picture and see the details. A third canvas without {{domxref(“CanvasRenderingContext2D.imageSmoothingEnabled”, “imageSmoothingEnabled”)}} is also drawn onto to be able to have a side by side comparison</p>
<p>We get the position of the mouse and crop an image of 5 pixels left and above to 5 pixels right and below. Then we copy that one over to another canvas and resize the image to the size we want it to. In the zoom canvas we resize a 10×10 pixel crop of the original canvas to 200×200.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb12-1" title="1"><span class="va">zoomctx</span>.<span class="at">drawImage</span>(canvas<span class="op">,</span></a>
<a class="sourceLine" id="cb12-2" title="2">                  <span class="va">Math</span>.<span class="at">min</span>(<span class="va">Math</span>.<span class="at">max</span>(<span class="dv">0</span><span class="op">,</span> x <span class="op">-</span> <span class="dv">5</span>)<span class="op">,</span> <span class="va">img</span>.<span class="at">width</span> <span class="op">-</span> <span class="dv">10</span>)<span class="op">,</span></a>
<a class="sourceLine" id="cb12-3" title="3">                  <span class="va">Math</span>.<span class="at">min</span>(<span class="va">Math</span>.<span class="at">max</span>(<span class="dv">0</span><span class="op">,</span> y <span class="op">-</span> <span class="dv">5</span>)<span class="op">,</span> <span class="va">img</span>.<span class="at">height</span> <span class="op">-</span> <span class="dv">10</span>)<span class="op">,</span></a>
<a class="sourceLine" id="cb12-4" title="4">                  <span class="dv">10</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">200</span><span class="op">,</span> <span class="dv">200</span>)<span class="op">;</span></a></code></pre></div>
<p>Zoom example:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb13-1" title="1"><span class="kw">var</span> img <span class="op">=</span> <span class="kw">new</span> <span class="at">Image</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb13-2" title="2"><span class="va">img</span>.<span class="at">crossOrigin</span> <span class="op">=</span> <span class="st">&#39;anonymous&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb13-3" title="3"><span class="va">img</span>.<span class="at">src</span> <span class="op">=</span> <span class="st">&#39;./assets/rhino.jpg&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb13-4" title="4"><span class="va">img</span>.<span class="at">onload</span> <span class="op">=</span> <span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb13-5" title="5">  <span class="at">draw</span>(<span class="kw">this</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb13-6" title="6"><span class="op">};</span></a>
<a class="sourceLine" id="cb13-7" title="7"></a>
<a class="sourceLine" id="cb13-8" title="8"><span class="kw">function</span> <span class="at">draw</span>(img) <span class="op">{</span></a>
<a class="sourceLine" id="cb13-9" title="9">  <span class="kw">var</span> canvas <span class="op">=</span> <span class="va">document</span>.<span class="at">getElementById</span>(<span class="st">&#39;canvas&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb13-10" title="10">  <span class="kw">var</span> ctx <span class="op">=</span> <span class="va">canvas</span>.<span class="at">getContext</span>(<span class="st">&#39;2d&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb13-11" title="11">  <span class="va">ctx</span>.<span class="at">drawImage</span>(img<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb13-12" title="12"></a>
<a class="sourceLine" id="cb13-13" title="13">  <span class="kw">var</span> smoothedZoomCtx <span class="op">=</span> <span class="va">document</span>.<span class="at">getElementById</span>(<span class="st">&#39;smoothed-zoom&#39;</span>).<span class="at">getContext</span>(<span class="st">&#39;2d&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb13-14" title="14">  <span class="va">smoothedZoomCtx</span>.<span class="at">imageSmoothingEnabled</span> <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></a>
<a class="sourceLine" id="cb13-15" title="15">  <span class="va">smoothedZoomCtx</span>.<span class="at">mozImageSmoothingEnabled</span> <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></a>
<a class="sourceLine" id="cb13-16" title="16">  <span class="va">smoothedZoomCtx</span>.<span class="at">webkitImageSmoothingEnabled</span> <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></a>
<a class="sourceLine" id="cb13-17" title="17">  <span class="va">smoothedZoomCtx</span>.<span class="at">msImageSmoothingEnabled</span> <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></a>
<a class="sourceLine" id="cb13-18" title="18"></a>
<a class="sourceLine" id="cb13-19" title="19">  <span class="kw">var</span> pixelatedZoomCtx <span class="op">=</span> <span class="va">document</span>.<span class="at">getElementById</span>(<span class="st">&#39;pixelated-zoom&#39;</span>).<span class="at">getContext</span>(<span class="st">&#39;2d&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb13-20" title="20"> <span class="va"> pixelatedZoomCtx</span>.<span class="at">imageSmoothingEnabled</span> <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></a>
<a class="sourceLine" id="cb13-21" title="21">  <span class="va">pixelatedZoomCtx</span>.<span class="at">mozImageSmoothingEnabled</span> <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></a>
<a class="sourceLine" id="cb13-22" title="22">  <span class="va">pixelatedZoomCtx</span>.<span class="at">webkitImageSmoothingEnabled</span> <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></a>
<a class="sourceLine" id="cb13-23" title="23">  <span class="va">pixelatedZoomCtx</span>.<span class="at">msImageSmoothingEnabled</span> <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></a>
<a class="sourceLine" id="cb13-24" title="24"></a>
<a class="sourceLine" id="cb13-25" title="25">  <span class="kw">var</span> zoom <span class="op">=</span> <span class="kw">function</span>(ctx<span class="op">,</span> x<span class="op">,</span> y) <span class="op">{</span></a>
<a class="sourceLine" id="cb13-26" title="26">    <span class="va">ctx</span>.<span class="at">drawImage</span>(canvas<span class="op">,</span></a>
<a class="sourceLine" id="cb13-27" title="27">        <span class="va">Math</span>.<span class="at">min</span>(<span class="va">Math</span>.<span class="at">max</span>(<span class="dv">0</span><span class="op">,</span> x <span class="op">-</span> <span class="dv">5</span>)<span class="op">,</span> <span class="va">img</span>.<span class="at">width</span> <span class="op">-</span> <span class="dv">10</span>)<span class="op">,</span></a>
<a class="sourceLine" id="cb13-28" title="28">        <span class="va">Math</span>.<span class="at">min</span>(<span class="va">Math</span>.<span class="at">max</span>(<span class="dv">0</span><span class="op">,</span> y <span class="op">-</span> <span class="dv">5</span>)<span class="op">,</span> <span class="va">img</span>.<span class="at">height</span> <span class="op">-</span> <span class="dv">10</span>)<span class="op">,</span></a>
<a class="sourceLine" id="cb13-29" title="29">        <span class="dv">10</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span></a>
<a class="sourceLine" id="cb13-30" title="30">        <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span></a>
<a class="sourceLine" id="cb13-31" title="31">        <span class="dv">200</span><span class="op">,</span> <span class="dv">200</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb13-32" title="32">  <span class="op">};</span></a>
<a class="sourceLine" id="cb13-33" title="33"></a>
<a class="sourceLine" id="cb13-34" title="34">  <span class="va">canvas</span>.<span class="at">addEventListener</span>(<span class="st">&#39;mousemove&#39;</span><span class="op">,</span> <span class="kw">function</span>(event) <span class="op">{</span></a>
<a class="sourceLine" id="cb13-35" title="35">    <span class="kw">const</span> x <span class="op">=</span> <span class="va">event</span>.<span class="at">layerX</span><span class="op">;</span></a>
<a class="sourceLine" id="cb13-36" title="36">    <span class="kw">const</span> y <span class="op">=</span> <span class="va">event</span>.<span class="at">layerY</span><span class="op">;</span></a>
<a class="sourceLine" id="cb13-37" title="37">    <span class="at">zoom</span>(smoothedZoomCtx<span class="op">,</span> x<span class="op">,</span> y)<span class="op">;</span></a>
<a class="sourceLine" id="cb13-38" title="38">    <span class="at">zoom</span>(pixelatedZoomCtx<span class="op">,</span> x<span class="op">,</span> y)<span class="op">;</span></a>
<a class="sourceLine" id="cb13-39" title="39">  <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb13-40" title="40"><span class="op">}</span></a></code></pre></div>
<p>The code’s usage is demonstrated in the following live example:</p>
<p>{{EmbedGHLiveSample(“dom-examples/canvas/pixel-manipulation/image-smoothing.html”, ‘100%’, 300)}}</p>
<p>Also see the source code — <a href="https://github.com/mdn/dom-examples/blob/master/canvas/pixel-manipulation/image-smoothing.html">HTML</a>, <a href="https://github.com/mdn/dom-examples/blob/master/canvas/pixel-manipulation/image-smoothing.js">JavaScript</a>.</p>
<h2 id="saving-images">Saving images</h2>
<p>The {{domxref(“HTMLCanvasElement”)}} provides a <code>toDataURL()</code> method, which is useful when saving images. It returns a <a href="/en-US/docs/Web/HTTP/Basics_of_HTTP/Data_URIs">data URI</a> containing a representation of the image in the format specified by the <code>type</code> parameter (defaults to <a href="https://en.wikipedia.org/wiki/Portable_Network_Graphics">PNG</a>). The returned image is in a resolution of 96 dpi.</p>
<blockquote>
<p><strong>Note:</strong> Be aware that if the canvas contains any pixels that were obtained from another {{Glossary(“origin”)}} without using CORS, the canvas is <strong>tainted</strong> and its contents can no longer be read and saved. See {{SectionOnPage(“/en-US/docs/Web/HTML/CORS_enabled_image”, “Security and tainted canvases”)}}</p>
</blockquote>
<ul>
<li>{{domxref(“HTMLCanvasElement.toDataURL”, “canvas.toDataURL(‘image/png’)”)}}
<ul>
<li>: Default setting. Creates a PNG image.</li>
</ul></li>
<li>{{domxref(“HTMLCanvasElement.toDataURL”, “canvas.toDataURL(‘image/jpeg’, quality)”)}}
<ul>
<li>: Creates a JPG image. Optionally, you can provide a quality in the range from 0 to 1, with one being the best quality and with 0 almost not recognizable but small in file size.</li>
</ul></li>
</ul>
<p>Once you have generated a data URI from you canvas, you are able to use it as the source of any {{HTMLElement(“image”)}} or put it into a hyper link with a <a href="/en-US/docs/Web/HTML/Element/a#attr-download">download attribute</a> to save it to disc, for example.</p>
<p>You can also create a {{domxref(“Blob”)}} from the canvas.</p>
<ul>
<li>{{domxref(“HTMLCanvasElement.toBlob”, “canvas.toBlob(<em>callback</em>, <em>type</em>, <em>encoderOptions</em>)”)}}
<ul>
<li>: Creates a <code>Blob</code> object representing the image contained in the canvas.</li>
</ul></li>
</ul>
<h2 id="see-also">See also</h2>
<ul>
<li>{{domxref(“ImageData”)}}</li>
<li><a href="/en-US/docs/Web/API/Canvas_API/Manipulating_video_using_canvas">Manipulating video using canvas</a></li>
<li><a href="https://codepo8.github.io/canvas-images-and-pixels/">Canvas, images and pixels – by Christian Heilmann</a></li>
</ul>
<p>{{PreviousNext(“Web/API/Canvas_API/Tutorial/Advanced_animations”, “Web/API/Canvas_API/Tutorial/Optimizing_canvas”)}}</p>
