# Introduction #

> This proposal is mainly contructed by Alex Zu with his development team from ASTRI.
> The full proposal
  * in word version is available at http://epub-revision.googlecode.com/files/ASTRI%20Annotation%20Spec%20Proposalv0.9.doc
  * with sample annotation xml file at http://epub-revision.googlecode.com/files/sample.xml
  * and annotation xml schema definition at http://epub-revision.googlecode.com/files/annotation.xsd

# Reference and Terminologies #

  * Ref 1: IDPF EPub 2.0 standard at http://www.idpf.org/specs.htm
  * Ref 2: IDPF EPub 3.0 Requirements at http://code.google.com/p/epub-revision/wiki/Annotations
  * Reader System: The Software/Hardware which renders and displays the EPub content as defined in Ref 1


# Annotation Storage Format #

Annotations should not alter the content of the original Ebook, thus recording the annotations in a separate file from the original Ebook is preferred.
In the proposal spec below, the annotation content is generated per book per user (i.e. the annotator) base. The following folder structure is suggested for the user generated annotations.
The user may annotate the book using image, audio or video format. The multimedia content is stored in the folder structure below.

```
...
  Annotations/
    Book1/
      User 1/
        Annotations.xml
        AudioNotes/
          audio1.mp3
          audio2.mp3
        ImageNotes/
          fig1.svg
          fig2.svg
        VideoNotes/
          video1.mp4
          video2.mp4
      User 2/
      ...
    Book2/
...

```


## Folder structure is explained below： ##
  1. Annotations Folder: <p>It is the root folder where the Reader System stores all the annotations generated by all the users who have ever read any EPub Ebooks controlled by the Reader System. The Reader System may need to identify the users by using local login or by communication with a remote login management server.<br>
<ol><li>Book1/Book2/… Folder: <p>It is the sample child folder generated by the Reader System for Ebook named "Book1" or "Book2", etc. All annotations generated by any users who have ever read the named book will be stored under this folder.<br>
</li><li>User 1 folder under Book1: <p>It is the sample child folder generated by the Reader System for Ebook named "Book1" which stores all the annotations generated by "User 1" for "Book1". All annotations generated by "User 1" for "Book1" will be stored under this folder.<br>
</li><li>Annotations.xml: <p>Stores the user annotations which maybe “text” comment, pointers to locally created “multimedia notes” by Reader System or “external reference links” such as HTTP URLs. The “AnnotatedArea” defines the original reference content of the book (i.e. the Book1/Book2/etc as mentioned above). For details, please refer to the Annotations.xml detail explained section below.<br>
</li><li>AudioNotes folder: <p>Stores the audio notes generated by the annotator by using the Reader System. MP3 audio format is used to store user generated content. User may also import audio files to this folder from other sources. User may also use other format such as OGG or WMA as long as it is supported by the Reader System. But the make the audio notes more portable, MP3 is preferred.<br>
</li><li>ImageNotes folder: <p>Stores the doodle/picture notes generated by the annotator. SVG graphics format is used to store user generated content. The good of SVG is that it supports the Zoom IN/OUT of the graphic without display quality drop. User may also import image files to this folder from other sources. User may also use other format such as JPEG, GIF or PNG as long as it is supported by the Reader System.<br>
</li><li>VideoNotes folder: <p>Stores the video notes generated by the annotator. MP4 file format with H.264 video + AAC audio is used to store the user generated content. User may also import video files to this folder from other sources. User may also use other file format such as MKV, AVI, WMV with other audio/video CODEC combinations as long as it is supported by the Reader System, however, MP4 (H.264+AAC) is preferred to fulfill the portability requirement.</li></ol>

<h2>Annotation Publishing/Sharing Scenario:</h2>

<h3>Scenario 1: Create the first sharable annotation</h3>
<blockquote>The annotator may create bookmarks, highlight, comments, reference, doodling, audio/video or the mixture of these annotations. Sometimes the annotator wants to share his/her annotation with the general public or friends. In the following examples, annotator1 wants to share his annotations for book1 with annotator2.<br>
As required by the EPub 3.0 annotation requirement, the annotator should not change his shared or published annotation any more. To fulfill this requirement, the "Published" flag and “Redistributable” flag are adopted (see annotations.xml below).<br>
The Reader System may need to support the following:<br>
</blockquote><ol><li>Annotator1 trigger the share/publish action.<br>
</li><li>Reader System popup all annotations generated by annotator1 for selection.<br>
</li><li>The selected annotations will be marked as "Published" (set to 1) and packaged in to a zip file for sharing. If the annotations point to any multimedia notes located under ImageNotes, AudioNotes and VideoNotes folder, those multimedia files should also be packaged into the zip file for sharing.<br>
</li><li>If annotator1 wants to make his annotations redistributable/quotable by other annotators, the “Redistributable” flag should be set to “True” (or 1).<br>
</li><li>Zip file name and structure should follow the below definition.<br>
<ul><li>File Name: BookID-AnnotatorID-TimeStamp-SerialNo.zip, e.g. book1-annotator1-201009302230-1.zip means this is the first (SerialNo=1) shared annotation created by annotator1 for book1 at 22:30, Sep 30th, 2010.<br>
</li></ul></li><li>Zip file structure below:<br>
<pre><code>book1/<br>
  annotator1/<br>
    Annotations.xml<br>
      AudioNotes/<br>
        audio1.mp3<br>
        audio2.mp3<br>
      ImageNotes/<br>
        fig1.svg<br>
        fig2.svg<br>
      VideoNotes/<br>
        video1.mp4<br>
        video2.mp4<br>
</code></pre>
</li><li>Once the annotation is flagged as "Published" (set to 1), the standard compliant Reader System should not let the annotator1 to change the annotation any more. The published annotation with its associated text and multimedia annotations should be kept "Read-Only" across the Reading Systems.<br>
</li><li>Note the Annotations.xml contains only the “Published” annotations extracted from the complete list of annotations (stores under …/Annotations/book1/annotator1/annotations.xml) created by annotator1.</li></ol>

<h3>Scenario 2: Create the annotation of annotations</h3>
<blockquote>The annotator2 wants to create annotation of annotations upon annotator1’s “Published” annotations shared by annotator1 to him.<br>
In this case, there is no need to point to the original content in the book1 as it is already defined in annotator1’s annotation, so we just use a “RefID” to point to annotator1’s “Published” annotations that annotator2 wants to annotate.<br>
The Reader System should be able to find annotator1’s annotation inside …/book1/annotator1/annotations.xml using the “RefID”. By doing so, the Reader System can find the original AnnotatedArea of book1 and present it to annotator2.<br>
The annotator2 may also want to publish his annotations, thus the Reader System may do the following:</blockquote>

<ol><li>Annotator2 trigger the share/publish action.<br>
</li><li>Reader System popup all annotations generated by annotator2 for selection.<br>
</li><li>The selected annotations will be marked as "Published" (set to 1) and packaged in to a zip file for sharing. If the annotations point to any multimedia notes located under ImageNotes, AudioNotes and VideoNotes folder, those multimedia files should also be packaged into the zip file for sharing.<br>
</li><li>If the selected published annotation is the annotation upon annotator1’s annotation, the Reader System should do the following:<br>
<ol><li>Reader System should check the “Redistributable” flag of annotator1’s annotation with the RefID as its AnnotationID, if it is set to “True”, this annotator1’s annotation should be also included in the sharable package created by annotator2.<br>
</li><li>As a result of 4.1, the zip file book1-annotator2-201010101020-1.zip is created with the zip file structure demoed below:<br>
<pre><code>book1/<br>
  annotator1/<br>
    Annotations.xml<br>
    AudioNotes/<br>
      audio1.mp3<br>
      audio2.mp3<br>
    ImageNotes/<br>
      fig1.svg<br>
    VideoNotes/<br>
      video1.mp4<br>
  annotator2/<br>
    Annotations.xml<br>
      AudioNotes/<br>
        audio1.mp3<br>
      ImageNotes/<br>
        fig1.svg<br>
      VideoNotes/<br>
        video1.mp4<br>
</code></pre>
</li></ol></li></ol><blockquote>Note the book1/annotator1/Annotations.xml contains only the “Redistributable” annotations with “RefID” given in annotator2’s annotation.<br>
If annotator1’s annotation has its “Redistributable” flag set to “False”, that means annotator1 does not want others to quote/redistribute this particular annotation without prior agreement. Then the Reader System should not include annotator1’s annotation in annotator2’s published annotations. When this case happens, then annotator3 may get lost with annotator2’s annotation with the absence of annotator1’s original annotations. More complicated solution may allow annotator3 to request access to annotator1’s annotation by some kind of authorization process, but that is outside the scope of this document.<br>
The major purpose of the “Redistributable” flag is to provide certain protections to copyrighted annotations with commercial values.<br>
Other settings are similar to that described in scenario 1.</blockquote>

<h3>Scenario 3: Create the annotation of annotation of annotations</h3>
<blockquote>Similar as scenario 2, but there will be two RefIDs identified to reference to annotation from annotator1 and annotator2 separately.<br>
Reader System should be able to recursively identified the series of annotations by using RefIDs list to point to annotations from annotator1 & annotator2.</blockquote>

<h2>Annotations.xml</h2>
<blockquote>The annotations.xml file stores all the annotations generated by one user for one book.  In case the user generated annotation is in multimedia format (image/audio/video) and stored locally in the related folders (i.e. the AudioNotes, ImageNotes and VideoNoets) as specified above, an URI link (i.e. The RefURI element defined below) is given to address the content.</blockquote>

<blockquote>UTF-8 char coding is used for annotations.xml.</blockquote>

<h3>Annotations.xml xsd schema overview:</h3>
<blockquote>The following diagram gives an overview of the xml schema that Annotations.xml should follow:<br>
<img src='http://epub-revision.googlecode.com/files/annotations-schema.png' /></blockquote>

<h3>Annotations.xml File Schema Explained:</h3>

Details please refer to the word doc given in the first section for now. I will add it according to twiki format later.