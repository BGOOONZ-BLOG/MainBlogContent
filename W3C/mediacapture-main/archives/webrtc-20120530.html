<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.0 Transitional//EN' 'http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd'>
<html dir="ltr" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <link type="text/css" rel="stylesheet" href="./webrtc.css" />

    <title>WebRTC 1.0: Real-time Communication Between
    Browsers</title>

    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

    
<!-- 
     === NOTA BENE ===
      For the three scripts below, if your spec resides on dev.w3 you can check them
      out in the same tree and use relative links so that they'll work offline.

      To tag a new releas in git hub

          Once the version is checked in and ready to go, you tag it with (need
          to chance the 20110823 to correct date )

               git tag -a v20120323 -m "This is release 20120323"

         Tags are not transferred by default with the push so you have to
         add a - -tags parameter to the push so it looks like. Note you need to
         remoce the space between the - and -tag to make a double dash. 

              git push - -tags 

         or alternatively you can push just the new tag with 

              git push origin v20120323


      To generate the dated version of the specification:

           Open this doc in Mozilla. 

           Do a CTRL-ALT-SHIFT-S

           Select "XHMTL( source)" from dialog box. This will pop a new tab with
           generated version of the document.

           This will open a new tab with generated html. Copy and paste this to
           a new file. Note if you use Chrome or Safari, this step will not
           work. What will happen is the paste will have the original document,
           not what was displayed in the window that you did the copy on.

           Rename the new file to the correct day such as
           webrtc-broken-20111003.html then search for and edit the links for
           "This version" and "Previos version". Add the new file into CVS and
           check in. 

           Once everyone is happy, the webrtc-broken.html and
           webrtc-broken-20111003.html files can be copied to
           webrtc.html and webrtc-20111003.html
           respectively in the ../editor/. directory. 
     -->


    

    
  <link href="http://www.w3.org/StyleSheets/TR/W3C-ED" rel="stylesheet" type="text/css" charset="utf-8" /></head>

  <body style="display: inherit;"><div class="head"><p><a href="http://www.w3.org/"><img width="72" height="48" alt="W3C" src="http://www.w3.org/Icons/w3c_home" /></a></p><h1 id="title" class="title">WebRTC 1.0: Real-time Communication Between Browsers</h1><h2 id="w3c-editor-s-draft-30-may-2012"><acronym title="World Wide Web Consortium">W3C</acronym> Editor's Draft 30 May 2012</h2><dl><dt>This version:</dt><dd><a href="http://dev.w3.org/2011/webrtc/editor/webrtc.html-20120530">http://dev.w3.org/2011/webrtc/editor/webrtc-20120530.html</a></dd><dt>Latest published version:</dt><dd><a href="http://www.w3.org/TR/webrtc/">http://www.w3.org/TR/webrtc/</a></dd><dt>Latest editor's draft:</dt><dd><a href="http://dev.w3.org/2011/webrtc/editor/webrtc.html">http://dev.w3.org/2011/webrtc/editor/webrtc.html</a></dd><dt>Previous version:</dt><dd><a href="http://dev.w3.org/2011/webrtc/editor/webrtc-20120528.html">http://dev.w3.org/2011/webrtc/editor/webrtc-20120528.html</a></dd><dt>Editors:</dt><dd><span>Adam Bergkvist</span>, Ericsson</dd>
<dd><span>Daniel C. Burnett</span>, Voxeo</dd>
<dd><span>Cullen Jennings</span>, Cisco</dd>
<dd><span>Anant Narayanan</span>, Mozilla</dd>
</dl><p class="copyright">Initial Author of this Specification was Ian Hickson, Google Inc., with the following copyright statement:<br /> © Copyright 2004-2011 Apple Computer, Inc., Mozilla Foundation, and Opera Software ASA. You are granted a license to use, reproduce and create derivative works of this document.</p> <p class="copyright">All subsequent changes since 26 July 2011 done by the <acronym title="World Wide Web Consortium">W3C</acronym> WebRTC Working Group are under the following <a href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a>:<br />© 2011-2012 <a href="http://www.w3.org/"><acronym title="World Wide Web Consortium">W3C</acronym></a><sup>®</sup> (<a href="http://www.csail.mit.edu/"><acronym title="Massachusetts Institute of Technology">MIT</acronym></a>, <a href="http://www.ercim.eu/"><acronym title="European Research Consortium for Informatics and Mathematics">ERCIM</acronym></a>, <a href="http://www.keio.ac.jp/">Keio</a>), All Rights Reserved. <a href="http://www.w3.org/Consortium/Legal/copyright-documents">Document use</a>  rules apply.</p> <p class="copyright">For the entire publication on the <acronym title="World Wide Web Consortium">W3C</acronym> site the <a href="http://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a> and <a href="http://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a> rules apply.</p><hr /></div>
    <div id="abstract" class="introductory section"><h2>Abstract</h2>
      <p>This document defines a set of APIs to represent streaming media,
      including audio and video, in JavaScript, to allow media to be sent over
      the network to another browser or device implementing the appropriate
      set of real-time protocols, and media received from another browser or
      device to be processed and displayed locally. This specification is
      being developed in conjunction with a protocol specification developed
      by the IETF RTCWEB group and an API specification to get access to local
      media devices developed by the Media Capture Task Force.</p>
    </div><div class="introductory section" id="sotd"><h2>Status of This Document</h2><p><em>This section describes the status of this document at the time of its publication. Other documents may supersede this document. A list of current <acronym title="World Wide Web Consortium">W3C</acronym> publications and the latest revision of this technical report can be found in the <a href="http://www.w3.org/TR/"><acronym title="World Wide Web Consortium">W3C</acronym> technical reports index</a> at http://www.w3.org/TR/.</em></p>
      <p>This document is not complete. It is subject to major changes and,
      while early experimentation is encouraged, it is therefore not
      intended for implementation. The API is based on preliminary work done
      in the WHATWG. The Web Real-Time Communications Working Group expects
      this specification to evolve significantly based on:</p>

      <ul>
        <li>The outcome of ongoing exchanges in the companion RTCWEB group at
        IETF to define the set of protocols that, together with this document,
        will enable real-time communications in Web browsers.</li>

        <li>Privacy issues that arise when exposing local capabilities and
        local streams.</li>

        <li>Technical discussions within the group, on the data channel in
        particular.</li>

        <li>Experience gained through early experimentations.</li>

        <li>Feedback received from other groups and individuals.</li>
      </ul>
    <p>This document was published by the <a href="http://www.w3.org/2011/04/webrtc/">Web Real-Time Communications Working Group</a> as an Editor's Draft. If you wish to make comments regarding this document, please send them to <a href="mailto:public-webrtc@w3.org">public-webrtc@w3.org</a> (<a href="mailto:public-webrtc-request@w3.org?subject=subscribe">subscribe</a>, <a href="http://lists.w3.org/Archives/Public/public-webrtc/">archives</a>). All feedback is welcome.</p><p>Publication as an Editor's Draft does not imply endorsement by the <acronym title="World Wide Web Consortium">W3C</acronym> Membership. This is a draft document and may be updated, replaced or obsoleted by other documents at any time. It is inappropriate to cite this document as other than work in progress.</p><p>This document was produced by a group operating under the <a href="http://www.w3.org/Consortium/Patent-Policy-20040205/">5 February 2004 <acronym title="World Wide Web Consortium">W3C</acronym> Patent Policy</a>. <acronym title="World Wide Web Consortium">W3C</acronym> maintains a <a rel="disclosure" href="http://www.w3.org/2004/01/pp-impl/47318/status">public list of any patent disclosures</a> made in connection with the deliverables of the group; that page also includes instructions for disclosing a patent. An individual who has actual knowledge of a patent which the individual believes contains <a href="http://www.w3.org/Consortium/Patent-Policy-20040205/#def-essential">Essential Claim(s)</a> must disclose the information in accordance with <a href="http://www.w3.org/Consortium/Patent-Policy-20040205/#sec-Disclosure">section 6 of the <acronym title="World Wide Web Consortium">W3C</acronym> Patent Policy</a>.</p></div><div id="toc" class="section"><h2 class="introductory">Table of Contents</h2><ul class="toc"><li class="tocline"><a href="#conformance" class="tocxref"><span class="secno">1. </span>Conformance</a></li><li class="tocline"><a href="#intro" class="tocxref"><span class="secno">2. </span>Introduction</a></li><li class="tocline"><a href="#network-stream-api" class="tocxref"><span class="secno">3. </span>Network Stream API</a><ul class="toc"><li class="tocline"><a href="#introduction" class="tocxref"><span class="secno">3.1 </span>Introduction</a></li><li class="tocline"><a href="#interface-definitions" class="tocxref"><span class="secno">3.2 </span>Interface definitions</a><ul class="toc"><li class="tocline"><a href="#mediastream" class="tocxref"><span class="secno">3.2.1 </span>MediaStream</a><ul class="toc"><li class="tocline"><a href="#label" class="tocxref"><span class="secno">3.2.1.1 </span>label</a></li><li class="tocline"><a href="#events-on-mediastream" class="tocxref"><span class="secno">3.2.1.2 </span>Events on MediaStream</a></li></ul></li><li class="tocline"><a href="#mediastreamtrack" class="tocxref"><span class="secno">3.2.2 </span>MediaStreamTrack</a></li></ul></li><li class="tocline"><a href="#audiomediastreamtrack" class="tocxref"><span class="secno">3.3 </span>AudioMediaStreamTrack</a><ul class="toc"><li class="tocline"><a href="#attributes" class="tocxref"><span class="secno">3.3.1 </span>Attributes</a></li><li class="tocline"><a href="#methods" class="tocxref"><span class="secno">3.3.2 </span>Methods</a></li></ul></li></ul></li><li class="tocline"><a href="#peer-to-peer-connections" class="tocxref"><span class="secno">4. </span>Peer-to-peer connections</a><ul class="toc"><li class="tocline"><a href="#peerconnection" class="tocxref"><span class="secno">4.1 </span>PeerConnection</a><ul class="toc"><li class="tocline"><a href="#sdptype" class="tocxref"><span class="secno">4.1.1 </span>SdpType</a></li><li class="tocline"><a href="#sessiondescription-class" class="tocxref"><span class="secno">4.1.2 </span> SessionDescription Class </a><ul class="toc"><li class="tocline"><a href="#attributes-1" class="tocxref"><span class="secno">4.1.2.1 </span>Attributes</a></li><li class="tocline"><a href="#methods-1" class="tocxref"><span class="secno">4.1.2.2 </span>Methods</a></li></ul></li><li class="tocline"><a href="#sessiondescriptioncallback" class="tocxref"><span class="secno">4.1.3 </span> SessionDescriptionCallback </a></li><li class="tocline"><a href="#peerconnectionerrorcallback" class="tocxref"><span class="secno">4.1.4 </span> PeerConnectionErrorCallback </a></li><li class="tocline"><a href="#peerstate-enum" class="tocxref"><span class="secno">4.1.5 </span> PeerState Enum </a></li><li class="tocline"><a href="#icestate-enum" class="tocxref"><span class="secno">4.1.6 </span> IceState Enum </a></li><li class="tocline"><a href="#icecandidate-type" class="tocxref"><span class="secno">4.1.7 </span> IceCandidate Type </a><ul class="toc"><li class="tocline"><a href="#attributes-2" class="tocxref"><span class="secno">4.1.7.1 </span>Attributes</a></li><li class="tocline"><a href="#methods-2" class="tocxref"><span class="secno">4.1.7.2 </span>Methods</a></li></ul></li><li class="tocline"><a href="#icecandidatecallback" class="tocxref"><span class="secno">4.1.8 </span> IceCandidateCallback </a></li><li class="tocline"><a href="#iceservers-type---option-1" class="tocxref"><span class="secno">4.1.9 </span> IceServers Type - Option 1</a><ul class="toc"><li class="tocline"><a href="#attributes-3" class="tocxref"><span class="secno">4.1.9.1 </span>Attributes</a></li></ul></li><li class="tocline"><a href="#iceservers-type---option-2" class="tocxref"><span class="secno">4.1.10 </span> IceServers Type - Option 2</a><ul class="toc"><li class="tocline"><a href="#attributes-4" class="tocxref"><span class="secno">4.1.10.1 </span>Attributes</a></li></ul></li><li class="tocline"><a href="#peerconnection-interface" class="tocxref"><span class="secno">4.1.11 </span>PeerConnection Interface</a><ul class="toc"><li class="tocline"><a href="#attributes-5" class="tocxref"><span class="secno">4.1.11.1 </span>Attributes</a></li><li class="tocline"><a href="#methods-3" class="tocxref"><span class="secno">4.1.11.2 </span>Methods</a></li></ul></li></ul></li></ul></li><li class="tocline"><a href="#iana-registrations" class="tocxref"><span class="secno">5. </span>IANA Registrations</a><ul class="toc"><li class="tocline"><a href="#constraints" class="tocxref"><span class="secno">5.1 </span>Constraints</a></li></ul></li><li class="tocline"><a href="#simple-example" class="tocxref"><span class="secno">6. </span>Simple Example</a></li><li class="tocline"><a href="#advanced-example" class="tocxref"><span class="secno">7. </span>Advanced Example</a></li><li class="tocline"><a href="#peer-to-peer-data-api" class="tocxref"><span class="secno">8. </span>Peer-to-peer Data API</a><ul class="toc"><li class="tocline"><a href="#datachannel" class="tocxref"><span class="secno">8.1 </span>DataChannel</a><ul class="toc"><li class="tocline"><a href="#attributes-6" class="tocxref"><span class="secno">8.1.1 </span>Attributes</a></li><li class="tocline"><a href="#methods-4" class="tocxref"><span class="secno">8.1.2 </span>Methods</a></li><li class="tocline"><a href="#constants" class="tocxref"><span class="secno">8.1.3 </span>Constants</a></li><li class="tocline"><a href="#dictionary-datachannelinit-members" class="tocxref"><span class="secno">8.1.4 </span>Dictionary <span class="idlType formerLink idlType"><code>DataChannelInit</code></span> Members</a></li></ul></li><li class="tocline"><a href="#examples" class="tocxref"><span class="secno">8.2 </span>Examples</a></li></ul></li><li class="tocline"><a href="#garbage-collection" class="tocxref"><span class="secno">9. </span>Garbage collection</a></li><li class="tocline"><a href="#event-definitions" class="tocxref"><span class="secno">10. </span>Event definitions</a><ul class="toc"><li class="tocline"><a href="#peerconnectionevent" class="tocxref"><span class="secno">10.1 </span>PeerConnectionEvent</a><ul class="toc"><li class="tocline"><a href="#attributes-7" class="tocxref"><span class="secno">10.1.1 </span>Attributes</a></li><li class="tocline"><a href="#dictionary-peerconnectioneventinit-members" class="tocxref"><span class="secno">10.1.2 </span>Dictionary <span class="idlType formerLink idlType"><code>PeerConnectionEventInit</code></span> Members</a></li></ul></li><li class="tocline"><a href="#peerconnectioniceevent" class="tocxref"><span class="secno">10.2 </span>PeerConnectionIceEvent</a><ul class="toc"><li class="tocline"><a href="#attributes-8" class="tocxref"><span class="secno">10.2.1 </span>Attributes</a></li><li class="tocline"><a href="#dictionary-peerconnectioneventiceinit-members" class="tocxref"><span class="secno">10.2.2 </span>Dictionary <span class="idlType formerLink idlType"><code>PeerConnectionEventIceInit</code></span> Members</a></li></ul></li><li class="tocline"><a href="#mediastreamtrackevent" class="tocxref"><span class="secno">10.3 </span>MediaStreamTrackEvent</a><ul class="toc"><li class="tocline"><a href="#attributes-9" class="tocxref"><span class="secno">10.3.1 </span>Attributes</a></li><li class="tocline"><a href="#dictionary-mediastreamtrackeventinit-members" class="tocxref"><span class="secno">10.3.2 </span>Dictionary <span class="idlType formerLink idlType"><code>MediaStreamTrackEventInit</code></span> Members</a></li></ul></li><li class="tocline"><a href="#mediastreamevent" class="tocxref"><span class="secno">10.4 </span>MediaStreamEvent</a><ul class="toc"><li class="tocline"><a href="#attributes-10" class="tocxref"><span class="secno">10.4.1 </span>Attributes</a></li><li class="tocline"><a href="#dictionary-mediastreameventinit-members" class="tocxref"><span class="secno">10.4.2 </span>Dictionary <span class="idlType formerLink idlType"><code>MediaStreamEventInit</code></span> Members</a></li></ul></li><li class="tocline"><a href="#datachannelevent" class="tocxref"><span class="secno">10.5 </span>DataChannelEvent</a><ul class="toc"><li class="tocline"><a href="#attributes-11" class="tocxref"><span class="secno">10.5.1 </span>Attributes</a></li><li class="tocline"><a href="#dictionary-datachanneleventinit-members" class="tocxref"><span class="secno">10.5.2 </span>Dictionary <span class="idlType formerLink idlType"><code>DataChannelEventInit</code></span> Members</a></li></ul></li></ul></li><li class="tocline"><a href="#event-summary" class="tocxref"><span class="secno">11. </span>Event summary</a></li><li class="tocline"><a href="#change-log" class="tocxref"><span class="secno">12. </span>Change Log</a></li><li class="tocline"><a href="#acknowledgements" class="tocxref"><span class="secno">A. </span>Acknowledgements</a></li><li class="tocline"><a href="#references" class="tocxref"><span class="secno">B. </span>References</a><ul class="toc"><li class="tocline"><a href="#normative-references" class="tocxref"><span class="secno">B.1 </span>Normative references</a></li><li class="tocline"><a href="#informative-references" class="tocxref"><span class="secno">B.2 </span>Informative references</a></li></ul></li></ul></div>

    <div id="conformance" class="section">
<!-- OddPage -->
<h2><span class="secno">1. </span>Conformance</h2><p>As well as sections marked as non-normative, all authoring guidelines, diagrams, examples, and notes in this specification are non-normative. Everything else in this specification is normative.</p>
<p>The key words <em class="rfc2119" title="must">must</em>, <em class="rfc2119" title="must not">must not</em>, <em class="rfc2119" title="required">required</em>, <em class="rfc2119" title="should">should</em>, <em class="rfc2119" title="should not">should not</em>, <em class="rfc2119" title="recommended">recommended</em>, <em class="rfc2119" title="may">may</em>, and <em class="rfc2119" title="optional">optional</em> in this specification are to be interpreted as described in [<cite><a class="bibref" rel="biblioentry" href="#bib-RFC2119">RFC2119</a></cite>].</p>

      <p> Implementations that use ECMAScript to implement the APIs defined in
      this specification must implement them in a manner consistent with the
      ECMAScript Bindings defined in the Web IDL specification [<cite><a class="bibref" rel="biblioentry" href="#bib-WEBIDL">WEBIDL</a></cite>], as
      this specification uses that specification and terminology. </p>
    </div>

    

    <div id="intro" class="informative section">
      
<!-- OddPage -->
<h2><span class="secno">2. </span>Introduction</h2><p><em>This section is non-normative.</em></p>

      <p>There are a number of facets to video-conferencing in HTML covered by
      this specification:</p>

      <ul>
        <li>Representing a multimedia stream (video, audio, or both) from
        local devices (video cameras, microphones, Web cams) or from
        prerecorded files provided by the user.</li>

        <li>Connecting to remote peers using NAT-traversal technologies such
        as ICE, STUN, and TURN.</li>

        <li>Sending the locally-produced streams to remote peers and receiving
        streams from remote peers.</li>

        <li>Sending arbitrary data directly to remote peers.</li>
      </ul>

      <p>This document defines the APIs used for these features. This
      specification is being developed in conjunction with a protocol
      specification developed by the <a href="http://datatracker.ietf.org/wg/rtcweb/">IETF RTCWEB group</a> and
      an API specification to get access to local media devices developed by
      the <a href="http://www.w3.org/2011/04/webrtc/">Media Capture Task
      Force</a>.</p>
    </div>

    <div id="network-stream-api" class="section">
      
<!-- OddPage -->
<h2><span class="secno">3. </span>Network Stream API</h2>

      <div id="introduction" class="section">
        <h3><span class="secno">3.1 </span>Introduction</h3>

        <p>The <code>MediaStream</code> interface, as defined in the
        [<cite><a class="bibref" rel="biblioentry" href="#bib-GETUSERMEDIA">GETUSERMEDIA</a></cite>] specification, typically represents a stream of data
        of audio and/or video. A <code>MediaStream</code> may be extended to represent a
        stream that either comes from or is sent to a remote node (and not
        just the local camera, for instance). The extensions required to
        enable this capability on the <code>MediaStream</code> object will be
        described in this document.</p>

        <p>A <code>MediaStream</code> as defined in [<cite><a class="bibref" rel="biblioentry" href="#bib-GETUSERMEDIA">GETUSERMEDIA</a></cite>] may
        contain zero or more <code>MediaStreamTrack</code> objects. A
        <code>MediaStreamTrack</code> sent to another peer will appear as one
        and only one <code>MediaStreamTrack</code> to the recipient.</p>

        <p>Channels are the smallest unit considered in the
        <code>MediaStream</code> specification. Channels are intended to be
        encoded together for transmission as, for instance, an RTP payload
        type. All of the channels that a codec needs to encode jointly <em class="rfc2119" title="must">must</em> be
        in the same <code>MediaStreamTrack</code> and the codecs <em class="rfc2119" title="should">should</em> be
        able to encode, or discard, all the channels in the track.</p>

        <p>The concepts of an input and output to a given
        <code>MediaStream</code> apply in the case of <code>MediaStream</code>
        objects transmitted over the network as well. A <code>
            <a>MediaStream</a>
          </code> created by a <code>
            <a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a>
          </code> object (later described in this document) will take as input
        the data received from a remote peer. Similarly, a
        <code>MediaStream</code> from a local source, for instance a camera
        via [<cite><a class="bibref" rel="biblioentry" href="#bib-GETUSERMEDIA">GETUSERMEDIA</a></cite>] will have an output that represents what is
        transmitted to a remote peer if the object is used with a <code>
            <a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a>
          </code> object.</p>

        <p>The concept of duplicating <code>MediaStream</code> objects as
        described in [<cite><a class="bibref" rel="biblioentry" href="#bib-GETUSERMEDIA">GETUSERMEDIA</a></cite>] is also applicable here. This feature
        can be used, for instance, in a video-conferencing scenario to display
        the local video from the user’s camera and microphone in a local
        monitor, while only transmitting the audio to the remote peer (e.g. in
        response to the user using a &quot;video mute&quot; feature). Combining tracks
        from different <code>
            <a>MediaStream</a>
          </code> objects into a new <code>
            <a>MediaStream</a>
          </code> is useful in certain cases.</p>
      </div>

      <div id="interface-definitions" class="section">
        <h3><span class="secno">3.2 </span>Interface definitions</h3>

        <p class="note">In this section, we only specify aspects of the the
        following objects that are relevant when used along with a
        <code>PeerConnection</code>. Please refer to the original definitions
        of the objects in the [<cite><a class="bibref" rel="biblioentry" href="#bib-GETUSERMEDIA">GETUSERMEDIA</a></cite>] document for general
        information on using <code>MediaStream</code> and
        <code>MediaStreamTrack</code> both in and outside the context of
        <code>PeerConnection</code>.</p>

        <div id="mediastream" class="section">
          <h4><span class="secno">3.2.1 </span>MediaStream</h4>

          <div id="label" class="section">
            <h5><span class="secno">3.2.1.1 </span>label</h5>

            <p>The <code>label</code> attribute specified in
            <code>MediaStream</code> returns a label that is unique to this
            stream, so that streams can be recognized after they are sent
            through the <code>
                <a href="#peerconnection">PeerConnection</a>
              </code> API.</p>

            <p>When a <code>
                <a href="#mediastream">MediaStream</a>
              </code> is created to represent a stream obtained from a remote
            peer, the <code>label</code> attribute is initialized from
            information provided by the remote source.</p>

            <p class="note">The label of a <code>
                <a>MediaStream</a>
              </code> object is unique to the source of the stream, but that
            does not mean it is not possible to end up with duplicates. For
            example, a locally generated stream could be sent from one user to
            a remote peer using <code>
                <a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a>
              </code>, and then sent back to the original user in the same
            manner, in which case the original user will have multiple streams
            with the same label (the locally-generated one and the one
            received from the remote peer).</p>
          </div>

          <div id="events-on-mediastream" class="section">
            <h5><span class="secno">3.2.1.2 </span>Events on MediaStream</h5>

            <p>A new media component may be associated with an existing <code>
                <a>MediaStream</a>
              </code>. This happens, e.g., on the A-side when the B-side adds
            a new <code>
                <a>MediaStreamTrack</a>
              </code> object to one of the track lists of a <code>
                <a>MediaStream</a>
              </code> that is being sent over a <code>
                <a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a>
              </code>. If this happens for the reason exemplified, or for any
            other reason than the <code>add()</code> [<cite><a class="bibref" rel="biblioentry" href="#bib-GETUSERMEDIA">GETUSERMEDIA</a></cite>] method
            being invoked locally on a <code>
                <a>MediaStreamTrackList</a>
              </code> or tracks are being added as the stream is created (i.e.
            the stream is initialized with tracks), the user agent <em class="rfc2119" title="must">must</em> run
            the following steps:</p>

            <ol>
              <li>
                <p>Create a <code>
                    <a>MediaStreamTrack</a>
                  </code> object <var>track</var> to represent the new media
                component.</p>
              </li>

              <li>
                <p>If <var>track’s</var> <code>
                    <a href="#dom-mediastreamtrack-kind">kind</a>
                  </code> attribute equals &quot;<code>audio</code>&quot;, add it to the
                <code>
                    <a>MediaStream</a>
                  </code> object’s <code>
                    <a href="#dom-mediastream-audiotracks">audioTracks</a>
                  </code> <code>
                    <a>MediaStreamTrackList</a>
                  </code> object. [[OPEN ISSUE: Is there a way to generalize this
		so that if we add a &quot;smell&quot; track this continues to work.]]</p>
              </li>

              <li>
                <p>If <var>track’s</var> <code>
                    <a href="#dom-mediastreamtrack-kind">kind</a>
                  </code> attribute equals &quot;<code>video</code>&quot;, add it to the
                <code>
                    <a>MediaStream</a>
                  </code> object’s <code>
                    <a href="#dom-mediastream-videotracks">videoTracks</a>
                  </code> <code>
                    <a>MediaStreamTrackList</a>
                  </code> object.</p>
              </li>

              <li>
                <p><a href="#dfn-fire-a-track-event-2" class="internalDFN">Fire a track event</a> named <code>
                    <a href="#event-mediastreamtracklist-addtrack">addtrack</a>
                  </code> with the newly created <var>track</var> at the <code>
                    <a>MediaStreamTrackList</a>
                  </code> object.</p>
              </li>
            </ol>

            <p>An existing media component may also be disassociated from a
            <code>
                <a>MediaStream</a>
              </code>. If this happens for any other reason than the
            <code>remove()</code> [<cite><a class="bibref" rel="biblioentry" href="#bib-GETUSERMEDIA">GETUSERMEDIA</a></cite>] method being invoked
            locally on a <code>
                <a>MediaStreamTrackList</a>
              </code> or the stream is being destroyed, the user agent <em class="rfc2119" title="must">must</em>
            run the following steps:</p>

            <ol>
              <li>
                <p>Let <var>track</var> be the <code>
                    <a>MediaStreamTrack</a>
                  </code> object representing the media component about to be
                removed.</p>
              </li>

              <li>
                <p>Remove <var>track</var> from the <code>
                    <a>MediaStreamTrackList</a>
                  </code> object.</p>
              </li>

              <li>
                <p><a href="#dfn-fire-a-track-event-2" class="internalDFN">Fire a track event</a> named <code>
                    <a href="#event-mediastreamtracklist-removetrack">removetrack</a>
                  </code> with <var>track</var> at the <code>
                    <a>MediaStreamTrackList</a>
                  </code> object.</p>
              </li>
            </ol>

            <p>The event source for the <code>onended</code> event in the
            networked case is the <code>PeerConnection</code> object.</p>
          </div>
        </div>

        <div id="mediastreamtrack" class="section">
          <h4><span class="secno">3.2.2 </span>MediaStreamTrack</h4>

          <p>A <code>MediaStreamTrack</code> object’s reference to its
          <code>MediaStream</code> in the non-local media source case (an RTP
          source, as is the case for a <code>MediaStream</code> received over
          a <code>PeerConnection</code>) is always strong.</p>

          <p>When a track belongs to a <code>
              <a>MediaStream</a>
            </code> that comes from a remote peer and the remote peer has
          permanently stopped sending data the <code>ended</code> event <em class="rfc2119" title="must">must</em>
          be fired on the track, as specified in [<cite><a class="bibref" rel="biblioentry" href="#bib-GETUSERMEDIA">GETUSERMEDIA</a></cite>].
	  [[ OPEN ISSUE: How do you know when it has stopped? This seems like
	  an SDP question, not a media-levelquestion.]]</p>

          <p>A track in a <code>
              <a>MediaStream</a>
            </code>, received with a <code>
              <a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a>
            </code>, <em class="rfc2119" title="must">must</em> have its <code>readyState</code> attribute
          [<cite><a class="bibref" rel="biblioentry" href="#bib-GETUSERMEDIA">GETUSERMEDIA</a></cite>] set to <code>
              <a href="#widl-MediaStreamTrack-MUTED">MUTED</a>
            </code> (1) until media data arrives.</p>

          <p>In addition, a <code>MediaStreamTrack</code> has its
          <code>readyState</code> set to <code>MUTED</code> on the B-side if
          the A-side disables the corresponding <code>
              <a>MediaStreamTrack</a>
            </code> in the <code>
              <a>MediaStream</a>
            </code> that is being sent. When the addstream event triggers on a
          <code>
              <a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a>
            </code>, all <code>
              <a>MediaStreamTrack</a>
            </code> objects in the resulting <code>
              <a>MediaStream</a>
            </code> are muted until media data can be read from the RTP
          source.
	  [[ OPEN ISSUE: How do you know when it has been disabled? This seems like
	  an SDP question, not a media-levelquestion.]]
	  </p>
        </div>
      </div>

      <div id="audiomediastreamtrack" class="section">
        <h3><span class="secno">3.3 </span>AudioMediaStreamTrack</h3>

        <p>The <code>
            <a href="#idl-def-AudioMediaStreamTrack" class="idlType"><code>AudioMediaStreamTrack</code></a>
          </code> is a specialization of of a normal <code>
            <a>MediaStreamTrack</a>
          </code> that only carries audio and is extended to have the
        capability to send and/or receive DTMF codes.</p>

        <pre class="idl"><span id="idl-def-AudioMediaStreamTrack" class="idlInterface">interface <span class="idlInterfaceID">AudioMediaStreamTrack</span> : <span class="idlSuperclass"><a>MediaStreamTrack</a></span> {
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a>boolean</a></span> <span class="idlAttrName"><a href="#widl-AudioMediaStreamTrack-canInsertDTMF">canInsertDTMF</a></span>;</span>
<span class="idlMethod">    <span class="idlMethType"><a>void</a></span> <span class="idlMethName"><a href="#widl-AudioMediaStreamTrack-insertDTMF-void-DOMString-tones-long-duration">insertDTMF</a></span> (<span class="idlParam"><span class="idlParamType"><a>DOMString</a></span> <span class="idlParamName">tones</span></span>, <span class="idlParam">optional <span class="idlParamType"><a>long</a></span> <span class="idlParamName">duration</span></span>);</span>
};</span>
</pre><div id="attributes" class="section"><h4><span class="secno">3.3.1 </span>Attributes</h4><dl class="attributes"><dt id="widl-AudioMediaStreamTrack-canInsertDTMF"><code>canInsertDTMF</code> of type <span class="idlAttrType"><a>boolean</a></span>, readonly</dt><dd>
            <p>The <dfn id="dom-audiomediastreamtrack-caninsertdtmf">
                <code>canInsertDTMF</code>
              </dfn> attribute <em class="rfc2119" title="must">must</em> indicate if the <code>
                <a href="#idl-def-AudioMediaStreamTrack" class="idlType"><code>AudioMediaStreamTrack</code></a>
              </code> is capable of sending DTMF.</p>
          </dd></dl></div><div id="methods" class="section"><h4><span class="secno">3.3.2 </span>Methods</h4><dl class="methods"><dt id="widl-AudioMediaStreamTrack-insertDTMF-void-DOMString-tones-long-duration"><code>insertDTMF</code></dt><dd>
            <p>When a <code>
                <a href="#idl-def-AudioMediaStreamTrack" class="idlType"><code>AudioMediaStreamTrack</code></a>
              </code> object’s <dfn id="dom-AudioMediaStreamTrack-insertDTMF">
                <code>insertDTMF()</code>
              </dfn> method is invoked, the user agent <em class="rfc2119" title="must">must</em> queue a task that
            that sends the DTMF tones.</p>

            <p>The tone parameters is treated as a series of characters. The
            characters 0 to 9, A to D, #, and * generated the associated DTMF
            tones. The characters a to d are equivalent to A to D. The
            character , indicates a an delay of 2 seconds before processing
            the next character in the tones parameter. Unrecognized characters
            are ignored.</p>

            <p>The duration parameters indicates the duration in ms to play
            the each DTMF passed in the tones parameters. The duration can not
            be more than 6000 or less than 70. The default duration is 100 ms
            for each tone. The gap between tones <em class="rfc2119" title="must">must</em> be at least 50 ms but
            should be as short as possible. [[OPEN ISSUE: How are invalid values
	    handled?]]</p>

            <p>If insertDTMF is called on the same object while an existing
            task for this object is generate DTMF is still running, the
            previous task is canceled. Calling insertDTMF with an empty tones
            parameter can be used to cancel any tones currently being
            send.</p>

            <p class="note">Editor Note: We need to add a callback that is set
            on the object that is called after the tones are sent. This is
            needed to allow the application to know when it can send new tones
            without canceling the tones that are currently being sent.</p>

            <p class="note">Editor Note: It seems we would want a callback or
            event for incoming tones. The proposal sent to the list had them
            played as audio to the speaker but I don’t see how that is
            useful.</p>
          <table class="parameters"><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">tones</td><td class="prmType"><code><a>DOMString</a></code></td><td class="prmNullFalse">✘</td><td class="prmOptFalse">✘</td><td class="prmDesc"></td></tr><tr><td class="prmName">duration</td><td class="prmType"><code><a>long</a></code></td><td class="prmNullFalse">✘</td><td class="prmOptTrue">✔</td><td class="prmDesc"></td></tr></table><div><em>Return type: </em><code><a>void</a></code></div></dd></dl></div>
      </div>
    </div>

    <div id="peer-to-peer-connections" class="section">
      
<!-- OddPage -->
<h2><span class="secno">4. </span>Peer-to-peer connections</h2>

      <p>A <code>
          <a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a>
        </code> allows two users to communicate directly, browser to browser.
      Communications are coordinated via a signaling channel which is provided
      by unspecified means, but generally by a script in the page via the server,
      e.g. using <code>XMLHttpRequest</code>.</p>

      <p>Calling <code>new <a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a>(<var>configuration</var>
      )</code> creates a <code>
          <a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a>
        </code> object.</p>

      <p>The <var>configuration</var> has the information to find and access
      the [<cite><a class="bibref" rel="biblioentry" href="#bib-STUN">STUN</a></cite>] and [<cite><a class="bibref" rel="biblioentry" href="#bib-TURN">TURN</a></cite>] servers. There may be multiple servers of
      each type and any TURN server also acts as a STUN server. </p>

      <p>A PeerConnection object has an associated ICE Agent, PeerConnection
      state, and ICE State. These are initialized when the object is
      created.</p>

      <p>When the <dfn id="dom-peerconnection">
          <code>PeerConnection()</code>
        </dfn> constructor is invoked, the user agent <em class="rfc2119" title="must">must</em> run the following
      steps. This algorithm has a synchronous section (which is triggered as
      part of the event loop algorithm).</p>

      <ol>
        <li>
          <p>Create an ICE Agent and let <var>connection</var>’s <a href="#peerconnection-ice-agent"><code>PeerConnection</code> ICE
          Agent</a> be that ICE Agent and provide it the STUN and TURN servers
          from the configuration array. The [<cite><a class="bibref" rel="biblioentry" href="#bib-ICE">ICE</a></cite>] will proceed with
          gathering as soon as the IceTransports constraint is not set to
          &quot;none&quot;. At this point the ICE Agent does not know how many 
	  ICE components it needs (and hence the number of candidates to
	  gather) but it can make a reasonable
          assumption and as the PeerConnection object gets more information,
          it can adjust the number of components. </p>
        </li>

        <li>
          <p>Set <var>connection</var>’s <a href="#peerconnection-readiness-state"><code>PeerConnection</code>
          readiness state</a> to <code>
              <a href="#widl-PeerConnection-NEW">&quot;new&quot;</a>
            </code>. </p>
        </li>

        <li>
          <p>Set <var>connection</var>’s <a href="#peerconnection-readiness-state"><code>PeerConnection</code>
          ice state </a> to <code>
              <a href="#widl-PeerConnection-NEW">&quot;new&quot;</a>
            </code>. </p>
        </li>

        <li>
          <p>Let <var>connection</var>’s <code title="dom-PeerConnection-localStreams">
              <a href="#widl-PeerConnection-localStreams">localStreams</a>
            </code> attribute be an empty read-only <code>
              <a>MediaStream</a>
            </code> array. </p>
        </li>

        <li>
          <p>Let <var>connection</var>’s <code title="dom-PeerConnection-remoteStreams">
              <a href="#widl-PeerConnection-remoteStreams">remoteStreams</a>
            </code> attribute be an empty read-only <code>
              <a>MediaStream</a>
            </code> array. </p>
        </li>

        <li>
          <p>Return <var>connection</var>, but continue these steps
          asynchronously.</p>
        </li>

        <li>
          <p>Await a stable state. The synchronous section consists of the
          remaining steps of this algorithm. </p>
        </li>
      </ol>

      <p> During the lifetime of the PeerConnection object, the following
      procedures are followed: </p>

      <ol>
        <li>
          <p>If the ice state is &quot;new&quot; and the IceTransports constraint
          is not set to &quot;none&quot;, it <em class="rfc2119" title="must">must</em> queue a task to start gathering ICE
          address and set the ice state to &quot;gathering&quot;.</p>
        </li>

        <li>
          <p> If the ICE Agent has found one or more candidate pairs for any
          MediaTrack that forms a valid connection, the ICE state is changed
          to &quot;connected&quot;. </p>
        </li>

        <li>
          <p> When the ICE Agent finishes checking all candidate pairs, if at least
          one connection has been found for some MediaTrack, the iceState is
          changed to &quot;completed&quot; and if no connection has been found for any
          MediaTrack, the iceState is changed to &quot;failed&quot;. 
	  [[OPEN ISSUE: Note that this means that if I was able to negotiate
	    audio but not video via ICE, then iceState == &quot;completed&quot;. Is this
	    really what is desired?]]
	  </p>
        </li>

        <li>
          <p> If the iceState is &quot;connected&quot; or &quot;completed&quot; and both the local
          and remote session descriptions are set, the peerState is set to
          &quot;active&quot;. </p>
        </li>

        <li>
          <p> If the iceState is &quot;failed&quot;, a task is queued to calls the close
          method. Open Issue: CJ - this seems wrong to me. </p>
        </li>
      </ol>

      <p>User agents negotiate the codec resolution, bitrate, and other media
      parameters. User agents are encouraged to initially negotiate for the
      maximum resolution of a video stream. For streams that are then rendered
      (using a <code>video</code> element), user agents are encouraged to
      renegotiate for a resolution that matches the rendered display size.</p>

      <p class="note">Starting with the native resolution means that if the
      Web application notifies its peer of the native resolution as it starts
      sending data, and the peer prepares its <code>video</code> element
      accordingly, there will be no need for a renegotiation once the stream
      is flowing.</p>

      
<!-- 
      <p>All SDP media descriptions for RTP flows represented by <code>
          <a>MediaTrack</a>
        </code> objects MUST include a label attribute ("<code
      title="">a=label:</code>") whose value is the value of the <code>
          <a>MediaStream</a>
        </code> object's <code title="dom-MediaStream-label">
          <a href="#dom-mediastream-label">label</a>
        </code> attribute. [[!SDP]] [[!SDPLABEL]]</p>

      <p><a href="#peerconnection"><code>PeerConnection</code>s</a> MUST not
      generate any candidates for media streams whose media descriptions do
      not have a label attribute ("<code>a=label:</code>"). [[!ICE]] [[!SDP]]
      [[!SDPLABEL]]  (Note: CJ - I have no idea why this is here) </p>
       -->


      <p> The word &quot;components&quot; in this context refers to an RTP media flow
      and does not have anything to do with how [<cite><a class="bibref" rel="biblioentry" href="#bib-ICE">ICE</a></cite>] uses the term
      &quot;component&quot;. </p>

      <p>When a user agent has reached the point where a <code>
          <a>MediaStream</a>
        </code> can be created to represent incoming components, the user
      agent <em class="rfc2119" title="must">must</em> run the following steps:</p>

      <ol>
        <li>
          <p>Let <var>connection</var> be the <code>
              <a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a>
            </code> expecting this media.</p>
        </li>

        <li>
          <p>Create a <code>
              <a>MediaStream</a>
            </code> object to represent the media stream.
        
<!--  Set its <code>
              <a href="#dom-mediastream-label">label</a>
            </code> attribute to the value of the SDP Label attribute for that
          component's media stream.  -->

	    [[OPEN ISSUE: What if one already exists?]]
	  </p>
        </li>

        <li>
          <p>Run the following steps for each component in the media
          stream.</p>

          <ol>
            <li>
              <p>Create a <code>
                  <a>MediaStreamTrack</a>
                </code> object <var>track</var> to represent the
              component.
		[[EDITORIAL: Can we just reference 3.2.1.2 here?]]
	      </p>
            </li>

            <li>
              <p>If <var>track's</var> <code>
                  <a href="#dom-mediastreamtrack-kind">kind</a>
                </code> attribute equals &quot;<code>audio</code>&quot;, add it to the
              <code>
                  <a>MediaStream</a>
                </code> object's <code>
                  <a href="#dom-mediastream-audiotracks">audioTracks</a>
                </code> <code>
                  <a>MediaStreamTrackList</a>
                </code> object.</p>
            </li>

            <li>
              <p>If <var>track's</var> <code>
                  <a href="#dom-mediastreamtrack-kind">kind</a>
                </code> attribute equals &quot;<code>video</code>&quot;, add it to the
              <code>
                  <a>MediaStream</a>
                </code> object's <code>
                  <a href="#dom-mediastream-videotracks">videoTracks</a>
                </code> <code>
                  <a>MediaStreamTrackList</a>
                </code> object.</p>
            </li>
          </ol>

           <p class="note">
	    The creation of new incoming <code>MediaStream</code>s may be
	    triggered either by SDP negotiation or by the receipt of
	    media on a given flow.
	  
<!--   [[OPEN ISSUE: How many <code>MediaStream</code>s are created
	    when you receive multiple conflicting pranswers?]]  -->

	  </p>
          
          <p class="note">The internal order in the <code>
              <a>MediaStreamTrackList</a>
            </code> objects on the receiving side should reflect the order on
          the sending side. One way to enforce this is to specify the order in
          the SDP.</p>
        </li>

        <li>
          <p>Queue a task to run the following substeps:</p>

          <ol>
            <li>
              <p>If the <var>connection</var>’s <a href="#peerconnection-readiness-state"><code>PeerConnection</code>
              readiness state</a> is <code>
                  <a href="#widl-PeerConnection-CLOSED">CLOSED</a>
                </code> (3), abort these steps.</p>
            </li>

            
<!--  close() was probably called just before this
     task ran  -->


            <li>
              <p>Add the newly created <code>
                  <a>MediaStream</a>
                </code> object to the end of <var>connection</var>’s <code title="dom-PeerConnection-remoteStreams">
                  <a href="#widl-PeerConnection-remoteStreams">remoteStreams</a>
                </code> array.</p>
            </li>

            <li>
              <p><a href="#fire-a-stream-event">Fire a stream event</a> named
              <code title="event-MediaStream-addstream">
                  <a href="#event-mediastream-addstream">addstream</a>
                </code> with the newly created <code>
                  <a>MediaStream</a>
                </code> object at the <var title="">connection</var> object.
              </p>
            </li>
          </ol>
        </li>
      </ol>

      <p>When a user agent has negotiated media for a component that belongs
      to a media stream that is already represented by an existing <code>
          <a>MediaStream</a>
        </code> object, the user agent <em class="rfc2119" title="must">must</em> associate the component with that
      <code>
          <a>MediaStream</a>
        </code> object.</p>

      <p>When a <a href="#peerconnection">
          <code>PeerConnection</code>
        </a> finds that a stream from the remote peer has been removed 
<!--  (its
      port has been set to zero in a media description sent on the signaling
      channel),  -->
, the user agent <em class="rfc2119" title="must">must</em> follow these steps:</p>

      <ol>
        <li>
          <p>Let <var>connection</var> be the <code>
              <a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a>
            </code> associated with the stream being removed.</p>
        </li>

        <li>
          <p>Let <var>stream</var> be the <code>
              <a>MediaStream</a>
            </code> object that represents the media stream being removed, if
          any. If there isn't one, then abort these steps.</p>
        </li>

        <li>
          <p>By definition, <var>stream</var> is now <a>finished</a>.</p>

          <p class="note">A <span title="concept-task">task</span> is thus
          <span title="queue a task">queued</span> to update <var>stream</var>
          and fire an event.</p>
        </li>

        <li>
          <p>Queue a task to run the following substeps:</p>

          <ol>
            <li>
              <p>If the <var>connection</var>’s <a href="#peerconnection-readiness-state"><code>PeerConnection</code>
              readiness state</a> is <code>
                  <a href="#widl-PeerConnection-CLOSED">CLOSED</a>
                </code> (3), abort these steps.</p>
            </li>

            
<!--  close() was probably called just before this
     task ran  -->


            <li>
              <p>Remove <var>stream</var> from <var>connection</var>’s <code>
                  <a href="#widl-PeerConnection-remoteStreams">remoteStreams</a>
                </code> array.</p>
            </li>

            <li>
              <p><a href="#fire-a-stream-event">Fire a stream event</a> named
              <code title="event-MediaStream-removestream">
                  <a href="#event-mediastream-removestream">removestream</a>
                </code> with <var title="">stream</var> at the
              <var>connection</var> object.</p>
            </li>
          </ol>
        </li>
      </ol>

      <p>The task source for the <span title="concept-task">tasks</span>
      listed in this section is the networking task source.</p>

      <p>If something in the browser changes that causes the <code>
          <a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a>
        </code> object to need to initiate a new session descipriton
      negotiation, an <code>
          <a href="#event-renegotiation">renegotiationneeded</a>
        </code> event is fired at the <code>
          <a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a>
        </code> object. </p>

      <p>In particular, if a <code>
          <a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a>
        </code> object is <a title="consumer">consuming</a> a <code>
          <a>MediaStream</a>
        </code> and a track is added to one of the stream's <code>
          <a>MediaStreamTrackList</a>
        </code> objects, by, e.g., the <code>
          <a href="#dom-mediastreamtracklist-add">add()</a>
        </code> method being invoked, the <code>
          <a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a>
        </code> object <em class="rfc2119" title="must">must</em> fire the &quot;renegotiationneeded&quot; event. Removal
      of media components must also trigger &quot;renegotianneeded&quot;.</p>


      <p class="warning">To prevent network sniffing from allowing a fourth
      party to establish a connection to a peer using the information sent
      out-of-band to the other peer and thus spoofing the client, the
      configuration information <em class="rfc2119" title="should">should</em> always be transmitted using an
      encrypted connection.</p>

      <div id="peerconnection" class="section">
        <h3><span class="secno">4.1 </span>PeerConnection</h3>

        <p> The general operation of the PeerConnection is described in
        [<cite><a class="bibref" rel="biblioentry" href="#bib-RTCWEB-JSEP">RTCWEB-JSEP</a></cite>]. </p>

        <div id="sdptype" class="section">
          <h4><span class="secno">4.1.1 </span>SdpType</h4>

          <p> The SdpType enums serve as arguments to setLocalDescription and
          setRemoteDescription. They provide information as to how the SDP
          should be handled. </p>


          <pre> enum SdpType { &quot;offer&quot;, &quot;pranswer&quot;, &quot;answer&quot; } </pre>

      
          
<!--  <dl class='idl' title='enum SdpType { "offer", "pranswer",  "answer" }'> </dl> -->


          <dl>
            <dt>
              <code title="widl-SdpType-offer">
                <a href="#widl-SdpType-offer">&quot;offer&quot;</a>
              </code>
            </dt>

            <dd>
              <p> An SdpType of &quot;offer&quot; indicates that a description should be
              treated as an [<cite><a class="bibref" rel="biblioentry" href="#bib-SDP">SDP</a></cite>] offer. </p>
            </dd>

            <dt>
              <code title="widl-SdpType-pranswer">
                <a href="#widl-SdpType-pranswer">&quot;pranswer&quot;</a>
              </code>
            </dt>

            <dd>
              <p> An SdpType of &quot;pranswer&quot; indicates that a description should
              be treated as an [<cite><a class="bibref" rel="biblioentry" href="#bib-SDP">SDP</a></cite>] answer, but not a final answer. A
              description used as a SDP &quot;pranswer&quot; may be applied as a
              response to a SDP offer, or an update to a previously sent SDP
              &quot;pranswer&quot;. </p>
            </dd>

            <dt>
              <code title="widl-SdpType-answer">
                <a href="#widl-SdpType-answer">&quot;answer&quot;</a>
              </code>
            </dt>

            <dd>
              <p> An SdpType of &quot;answer&quot; indicates that a description should
              be treated as an [<cite><a class="bibref" rel="biblioentry" href="#bib-SDP">SDP</a></cite>] final answer, and the offer-answer
              exchange should be considered complete. A description used as a
              SDP answer may be applied as a response to a SDP offer, or an
              update to a previously send SDP &quot;pranswer&quot;. </p>
            </dd>
          </dl>
        </div>

        <div id="sessiondescription-class" class="section">
          <h4><span class="secno">4.1.2 </span> SessionDescription Class </h4>

          <p>The <dfn id="dom-sessiondescription">
              <code>SessionDescription()</code>
            </dfn> constructor takes one argument, <var>description</var>,
          whose content is used to construct the new <code>
              <a href="#idl-def-SessionDescription" class="idlType"><code>SessionDescription</code></a>
            </code> object. This class is a future extensible carrier
              for for the data contained in it and does not perform any
              substantive processing. </p>

          <pre class="idl"><span id="idl-def-SessionDescription" class="idlInterface">[<span class="extAttr">Constructor (DOMString description)</span>]
interface <span class="idlInterfaceID">SessionDescription</span> {
<span class="idlAttribute">    attribute <span class="idlAttrType"><a>SdpType</a></span>   <span class="idlAttrName"><a href="#widl-SessionDescription-type">type</a></span>;</span>
<span class="idlAttribute">    attribute <span class="idlAttrType"><a>DOMString</a></span> <span class="idlAttrName"><a href="#widl-SessionDescription-sdp">sdp</a></span>;</span>
<span class="idlMethod">    <span class="idlMethType"><a>stringifier</a></span> <span class="idlMethName"><a href="#widl-SessionDescription-DOMString-stringifier">DOMString</a></span> ();</span>
};</span>
</pre><div id="attributes-1" class="section"><h5><span class="secno">4.1.2.1 </span>Attributes</h5><dl class="attributes"><dt id="widl-SessionDescription-sdp"><code>sdp</code> of type <span class="idlAttrType"><a>DOMString</a></span></dt><dd>The string representation of the SDP [<cite><a class="bibref" rel="biblioentry" href="#bib-SDP">SDP</a></cite>]</dd><dt id="widl-SessionDescription-type"><code>type</code> of type <span class="idlAttrType"><a>SdpType</a></span></dt><dd>What type of SDP this SessionDescription represents.</dd></dl></div><div id="methods-1" class="section"><h5><span class="secno">4.1.2.2 </span>Methods</h5><dl class="methods"><dt id="widl-SessionDescription-DOMString-stringifier"><code>DOMString</code></dt><dd>
              <p>Objects that implement the <code>
                  <a href="#idl-def-SessionDescription" class="idlType"><code>SessionDescription</code></a>
                </code> interface must stringify as [<cite><a class="bibref" rel="biblioentry" href="#bib-SDP">SDP</a></cite>]. </p>
            <div><em>No parameters.</em></div><div><em>Return type: </em><code><a>stringifier</a></code></div></dd></dl></div>
        </div>

        <div id="sessiondescriptioncallback" class="section">
          <h4><span class="secno">4.1.3 </span> SessionDescriptionCallback </h4>

        <pre> callback SessionDescriptionCallback = void (SessionDescription
          sdp) </pre> 

          <dl>
            
<!--  dl title='callback SessionDescriptionCallback = void' class='idl'  -->


            <dt>SessionDescription sdp</dt>

            <dd>The object containing the SDP [<cite><a class="bibref" rel="biblioentry" href="#bib-SDP">SDP</a></cite>]. </dd>
          </dl>
        </div>

        <div id="peerconnectionerrorcallback" class="section">
          <h4><span class="secno">4.1.4 </span> PeerConnectionErrorCallback </h4>

         <pre> callback PeerConnectionErrorCallback = void (DOMString errorInformation)
          </pre> 

          <dl>
            
<!--   dl title='callback PeerConnectionErrorCallback = void' class='idl'  -->


            <dt>DOMString errorInformation</dt>

            <dd>Information about what went wrong. Open Issue: How does this
          work? Is it human readable? I18N? ENUM? </dd>
          </dl>

          <p> TODO: Open Issue: should this be defined as event like
          NavigatorUserMediaErrorCallback in getusermedia </p>
        </div>

        <div id="peerstate-enum" class="section">
          <h4><span class="secno">4.1.5 </span> PeerState Enum </h4>

         <pre>enum PeerState { &quot;new&quot; &quot;opening&quot;, &quot;active&quot;, &quot;closing&quot;, &quot;closed&quot;
          }</pre> 

          
<!--   <dl  title='enum PeerState { "new" "opening","active", "closing", "closed" }' class='idl' > </dl>  -->


          <dl>
            <dt>
              <code title="widl-PeerConnection-NEW">
                <a href="#widl-PeerConnection-NEW">&quot;new&quot;</a>
              </code>
            </dt>

            <dd> The object was just created, and no networking has yet
            occurred. </dd>

            <dt>
              <code title="dom-PeerConnection-NEGOTIATING">
                <a href="#widl-PeerConnection-OPENING">&quot;opening&quot;</a>
              </code>
            </dt>

            <dd>The user agent is attempting to establish an connection with
            the ICE Agent and waiting for local and remote SDP to be set.
            (Open Issue: do we need more states between &quot;opening&quot; and
            &quot;active&quot;) </dd>

            <dt>
              <code title="dom-PeerConnection-ACTIVE">
                <a href="#widl-PeerConnection-ACTIVE">&quot;active&quot;</a>
              </code>
            </dt>

            <dd>The ICE Agent has found a connection both the local and remote
            SDP have been set. It is possible for media to flow. </dd>

            <dt>
              <code title="dom-PeerConnection-CLOSING">
                <a href="#widl-PeerConnection-CLOSED">&quot;closing&quot;</a>
              </code>
            </dt>

            <dd> The <code>
                <a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a>
              </code> object is terminating all media and is in the process of
            closing the connection. </dd>

            <dt>
              <code title="dom-PeerConnection-CLOSED">
                <a href="#widl-PeerConnection-CLOSED">&quot;closed&quot;</a>
              </code>
            </dt>

            <dd> The connection is closed. </dd>
          </dl>
        </div>

        <div id="icestate-enum" class="section">
          <h4><span class="secno">4.1.6 </span> IceState Enum </h4>

     <pre> enum IceState { &quot;new&quot; &quot;gathering&quot;, &quot;waiting&quot;, &quot;checking&quot;,
          &quot;connected&quot;, &quot;completed&quot;,&quot;failed&quot;, &quot;closed&quot; }</pre> 

          
<!--  <dl class='idl' title='enum IceState { "new" "gathering", "waiting", "checking", "connected", "completed","failed", "closed"}'> </dl>  -->


          <dl>
            <dt>
              <code title="widl-PeerConnection-NEW">
                <a href="#widl-PeerConnection-NEW">&quot;new&quot;</a>
              </code>
            </dt>

            <dd>The PeerConnection object was just created, and no networking
            has yet occurred.</dd>

            <dt>
              <code title="dom-PeerConnection-GATHERING">
                <a href="#widl-PeerConnection-ICE_GATHERING">&quot;gathering&quot;</a>
              </code>
            </dt>

            <dd>The ICE Agent is attempting to gather addresses.</dd>

            <dt>
              <code title="dom-PeerConnection-ICE_WAITING">
                <a href="#widl-PeerConnection-ICE_WAITING">&quot;waiting&quot;</a>
              </code>
            </dt>

            <dd>The ICE Agent is not gathering any addresses and is waiting
            for candidates from the other side before it can start
            checking.</dd>

            <dt>
              <code title="dom-PeerConnection-CHECKING">
                <a href="#widl-PeerConnection-ACTIVE">&quot;checking&quot;</a>
              </code>
            </dt>

            <dd>The ICE Agent is checking candidate pairs but has not yet found a
            connection. In addition to checking, it may also still be
            gathering. </dd>

            <dt>
              <code title="dom-PeerConnection-CONNECTED">
                <a href="#widl-PeerConnection-CLOSED">&quot;connected&quot;</a>
              </code>
            </dt>

            <dd>The ICE Agent has found a connection but is still checking
            other candidate pairs to see if there is a better connection. It may
            also still be gathering. </dd>

            <dt>
              <code title="dom-PeerConnection-COMPLETED">
                <a href="#widl-PeerConnection-CLOSED">&quot;completed&quot;</a>
              </code>
            </dt>

            <dd>The ICE Agent has finished gathering and checking and found a
            connection.</dd>

            <dt>
              <code title="dom-PeerConnection-ICE_FAILED">
                <a href="#widl-PeerConnection-CLOSED">&quot;failed&quot;</a>
              </code>
            </dt>

            <dd>The ICE Agent is finished checking all candidate pairs and failed
            to find a connection.</dd>

            <dt>
              <code title="dom-PeerConnection-CLOSED">
                <a href="#widl-PeerConnection-CLOSED">&quot;closed&quot;</a>
              </code>
            </dt>

            <dd>The ICE Agent has shut down and is no longer responding to
            STUN requests.</dd>
          </dl>
        </div>

        <div id="icecandidate-type" class="section">
          <h4><span class="secno">4.1.7 </span> IceCandidate Type </h4>

          <p>The <dfn id="dom-icecandidate">
              <code>IceCandidate()</code>
            </dfn> constructor takes one argument, <var>candidate</var>, whose
          content is used to construct the new <code>
              <a href="#event-icecandidate" class="internalDFN">IceCandidate</a>
            </code> object. This class is a future extensible carrier
              for for the data contained in it and does not perform any
              substantive processing. </p>

          <pre class="idl"><span id="idl-def-IceCandidate" class="idlInterface">[<span class="extAttr">Constructor (DOMString candidate)</span>]
interface <span class="idlInterfaceID">IceCandidate</span> {
<span class="idlAttribute">    attribute <span class="idlAttrType"><a>DOMString</a></span> <span class="idlAttrName"><a href="#widl-IceCandidate-candidate">candidate</a></span>;</span>
<span class="idlMethod">    <span class="idlMethType"><a>stringifier</a></span> <span class="idlMethName"><a href="#widl-IceCandidate-DOMString-stringifier">DOMString</a></span> ();</span>
};</span>
</pre><div id="attributes-2" class="section"><h5><span class="secno">4.1.7.1 </span>Attributes</h5><dl class="attributes"><dt id="widl-IceCandidate-candidate"><code>candidate</code> of type <span class="idlAttrType"><a>DOMString</a></span></dt><dd> This carries the candidate-attribute as defined in section
            15.1 of [<cite><a class="bibref" rel="biblioentry" href="#bib-ICE">ICE</a></cite>]. ( TODO - need to add more information to allow
            this to match to correct m line - Open Issue: How to correlate. Need
            to wait for the mapping from media tracks to SDP to be resolved in
            IETF before tackling this problem). </dd></dl></div><div id="methods-2" class="section"><h5><span class="secno">4.1.7.2 </span>Methods</h5><dl class="methods"><dt id="widl-IceCandidate-DOMString-stringifier"><code>DOMString</code></dt><dd>
              <p>Objects that implement the <code>
                  <a href="#event-icecandidate" class="internalDFN">IceCandidate</a>
                </code> interface must stringify as the candidate-attribute as defined in section
            15.1 of [<cite><a class="bibref" rel="biblioentry" href="#bib-ICE">ICE</a></cite>].</p>
            <div><em>No parameters.</em></div><div><em>Return type: </em><code><a>stringifier</a></code></div></dd></dl></div>
        </div>

        <div id="icecandidatecallback" class="section">
          <h4><span class="secno">4.1.8 </span> IceCandidateCallback </h4>

     <pre> callback IceCandidateCallback = void (IceCandidate candidate)
          </pre> 

          <dl>
            
<!--   dl title='callback IceCandidateCallback = void' class='idl'  -->


            <dt>IceCandidate candidate</dt>

            <dd>The new ICE candidate. </dd>
          </dl>
        </div>

        <div id="iceservers-type---option-1" class="section">
          <h4><span class="secno">4.1.9 </span> IceServers Type - Option 1</h4>
          <p> Open Issue: choose option 1 or option 2 for IceServers Type. </p>
          <pre class="idl"><span id="idl-def-IceServers" class="idlInterface">interface <span class="idlInterfaceID">IceServers</span> {
<span class="idlAttribute">    attribute <span class="idlAttrType"><a>DOMString</a></span> <span class="idlAttrName"><a href="#widl-IceServers-servers">servers[][]</a></span>;</span>
};</span>
</pre><div id="attributes-3" class="section"><h5><span class="secno">4.1.9.1 </span>Attributes</h5><dl class="attributes"><dt id="widl-IceServers-servers"><code>servers[][]</code> of type <span class="idlAttrType"><a>DOMString</a></span></dt><dd> <p> The IceServers type is an array of pairs where each pair is
            defined as an
            array. Each pair provides the information to reach and use one STUN
            or TURN server. The first element in each pair is a stun or turn URIs as defined in
            [<cite><a class="bibref" rel="biblioentry" href="#bib-STUN-URI">STUN-URI</a></cite>] and [<cite><a class="bibref" rel="biblioentry" href="#bib-TURN-URI">TURN-URI</a></cite>]. If the first element of the pair
            is TURN URI, then the second element of the pair is the credential
            to use with that TURN server. </p> </dd></dl></div>

          <p> In network topologies with multiple layers of NATs, it is
          desirable to have a STUN servers between every layer of NATs in
          addition to the TURN servers to minimize the number peer to peer
          network latency. </p>

          <p>An example configuration object is:</p>

          <p>
              <code> { servers:[ [&quot;stun:stun.example.net&quot;] ,
              [&quot;turn:user@turn.example.org&quot;,&quot;myPassword&quot;] ]} </code>
            </p>
        </div>

              <div id="iceservers-type---option-2" class="section">
          <h4><span class="secno">4.1.10 </span> IceServers Type - Option 2</h4>
          <p> Open Issue: choose option 1 or option 2 for IceServers Type. </p>
          <pre class="idl"><span id="idl-def-IceServers" class="idlInterface">interface <span class="idlInterfaceID">IceServers</span> {
<span class="idlAttribute">    attribute <span class="idlAttrType"><a>DOMString</a></span> <span class="idlAttrName"><a href="#widl-IceServers-servers">servers[]</a></span>;</span>
};</span>
</pre><div id="attributes-4" class="section"><h5><span class="secno">4.1.10.1 </span>Attributes</h5><dl class="attributes"><dt id="widl-IceServers-servers-1"><code>servers[]</code> of type <span class="idlAttrType"><a>DOMString</a></span></dt><dd> <p> The IceServers type is an array of strings where each string
            provides the URL and credentials for a server. Each string is either
            a the URL to reach a STUN server ad defined in 
            [<cite><a class="bibref" rel="biblioentry" href="#bib-STUN-URI">STUN-URI</a></cite>] or is the URL of a TURN server as defined in [<cite><a class="bibref" rel="biblioentry" href="#bib-TURN-URI">TURN-URI</a></cite>]
            followed by a single space and then the rest of the string is the
            credential used to access that server. Note the credential may
            contains spaces. </p> </dd></dl></div>

          <p> In network topologies with multiple layers of NATs, it is
          desirable to have a STUN servers between every layer of NATs in
          addition to the TURN servers to minimize the number peer to peer
          network latency. </p>

          <p>An example configuration object is:</p>

          <p>
              <code> { servers:[ &quot;stun:stun.example.net&quot; ,
            &quot;turn:user@turn.example.org myPassword&quot; ]} </code>
            </p>
        </div>

        <div id="peerconnection-interface" class="section">
          <h4><span class="secno">4.1.11 </span>PeerConnection Interface</h4>

          <p> Open Issue: should we collapse some of these functions a single
          &quot;processRemoteSignal&quot; method? </p>


          <pre class="idl"><span id="idl-def-PeerConnection" class="idlInterface">[<span class="extAttr">Constructor (IceServers configuration, optional MediaConstraints constraints)</span>]
interface <span class="idlInterfaceID">PeerConnection</span> {
<span class="idlMethod">    <span class="idlMethType"><a>void</a></span>        <span class="idlMethName"><a href="#widl-PeerConnection-createOffer-void-SessionDescriptionCallback-successCallback-PeerConnectionErrorCallback-failureCallback-MediaConstraints-constraints">createOffer</a></span> (<span class="idlParam"><span class="idlParamType"><a>SessionDescriptionCallback</a></span> <span class="idlParamName">successCallback</span></span>, <span class="idlParam">optional <span class="idlParamType"><a>PeerConnectionErrorCallback</a></span> <span class="idlParamName">failureCallback</span></span>, <span class="idlParam">optional <span class="idlParamType"><a>MediaConstraints</a></span> <span class="idlParamName">constraints</span></span>);</span>
<span class="idlMethod">    <span class="idlMethType"><a>void</a></span>        <span class="idlMethName"><a href="#widl-PeerConnection-createAnswer-void-SessionDescription-offer-SessionDescriptionCallback-successCallback-PeerConnectionErrorCallback-failureCallback-MediaConstraints-constraints-Boolean-createProvisionalAnswer-false">createAnswer</a></span> (<span class="idlParam"><span class="idlParamType"><a href="#idl-def-SessionDescription" class="idlType"><code>SessionDescription</code></a></span> <span class="idlParamName">offer</span></span>, <span class="idlParam"><span class="idlParamType"><a>SessionDescriptionCallback</a></span> <span class="idlParamName">successCallback</span></span>, <span class="idlParam">optional <span class="idlParamType"><a>PeerConnectionErrorCallback</a></span> <span class="idlParamName">failureCallback</span></span>, <span class="idlParam">optional <span class="idlParamType"><a>MediaConstraints</a></span> <span class="idlParamName">constraints</span></span>, <span class="idlParam">optional <span class="idlParamType"><a>Boolean</a></span> <span class="idlParamName">createProvisionalAnswer=false</span></span>);</span>
<span class="idlMethod">    <span class="idlMethType"><a>void</a></span>        <span class="idlMethName"><a href="#widl-PeerConnection-setLocalDescription-void-SdpType-action-SessionDescription-description">setLocalDescription</a></span> (<span class="idlParam"><span class="idlParamType"><a>SdpType</a></span> <span class="idlParamName">action</span></span>, <span class="idlParam"><span class="idlParamType"><a href="#idl-def-SessionDescription" class="idlType"><code>SessionDescription</code></a></span> <span class="idlParamName">description</span></span>);</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a href="#idl-def-SessionDescription" class="idlType"><code>SessionDescription</code></a></span> <span class="idlAttrName"><a href="#widl-PeerConnection-localDescription">localDescription</a></span>;</span>
<span class="idlMethod">    <span class="idlMethType"><a>void</a></span>        <span class="idlMethName"><a href="#widl-PeerConnection-setRemoteDescription-void-SdpType-action-SessionDescription-description">setRemoteDescription</a></span> (<span class="idlParam"><span class="idlParamType"><a>SdpType</a></span> <span class="idlParamName">action</span></span>, <span class="idlParam"><span class="idlParamType"><a href="#idl-def-SessionDescription" class="idlType"><code>SessionDescription</code></a></span> <span class="idlParamName">description</span></span>);</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a href="#idl-def-SessionDescription" class="idlType"><code>SessionDescription</code></a></span> <span class="idlAttrName"><a href="#widl-PeerConnection-remoteDescription">remoteDescription</a></span>;</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a>PeerState</a></span>          <span class="idlAttrName"><a href="#widl-PeerConnection-readyState">readyState</a></span>;</span>
<span class="idlMethod">    <span class="idlMethType"><a>void</a></span>        <span class="idlMethName"><a href="#widl-PeerConnection-updateIce-void-IceServers-configuration-MediaConstraints-constraints-Boolean-restart-false">updateIce</a></span> (<span class="idlParam">optional <span class="idlParamType"><a href="#idl-def-IceServers" class="idlType"><code>IceServers</code></a></span> <span class="idlParamName">configuration</span></span>, <span class="idlParam">optional <span class="idlParamType"><a>MediaConstraints</a></span> <span class="idlParamName">constraints</span></span>, <span class="idlParam">optional <span class="idlParamType"><a>Boolean</a></span> <span class="idlParamName">restart=false</span></span>);</span>
<span class="idlMethod">    <span class="idlMethType"><a>void</a></span>        <span class="idlMethName"><a href="#widl-PeerConnection-addIceCandidate-void-IceCandidate-candidate">addIceCandidate</a></span> (<span class="idlParam"><span class="idlParamType"><a href="#idl-def-IceCandidate" class="idlType"><code>IceCandidate</code></a></span> <span class="idlParamName">candidate</span></span>);</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a>IceState</a></span>           <span class="idlAttrName"><a href="#widl-PeerConnection-iceState">iceState</a></span>;</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a>MediaStream</a>[]</span>      <span class="idlAttrName"><a href="#widl-PeerConnection-localStreams">localStreams</a></span>;</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a>MediaStream</a>[]</span>      <span class="idlAttrName"><a href="#widl-PeerConnection-remoteStreams">remoteStreams</a></span>;</span>
<span class="idlMethod">    <span class="idlMethType"><a href="#idl-def-DataChannel" class="idlType"><code>DataChannel</code></a></span> <span class="idlMethName"><a href="#widl-PeerConnection-createDataChannel-DataChannel-DOMString-label-DataChannelInit-dataChannelDict">createDataChannel</a></span> (<span class="idlParam">[<span class="extAttr">TreatNullAs=EmptyString</span>] <span class="idlParamType"><a>DOMString</a>?</span> <span class="idlParamName">label</span></span>, <span class="idlParam">optional <span class="idlParamType"><a href="#idl-def-DataChannelInit" class="idlType"><code>DataChannelInit</code></a>?</span> <span class="idlParamName">dataChannelDict</span></span>);</span>
<span class="idlAttribute">             attribute <span class="idlAttrType"><a>Function</a>?</span>          <span class="idlAttrName"><a href="#widl-PeerConnection-ondatachannel">ondatachannel</a></span>;</span>
<span class="idlMethod">    <span class="idlMethType"><a>void</a></span>        <span class="idlMethName"><a href="#widl-PeerConnection-addStream-void-MediaStream-stream-MediaConstraints-constraints">addStream</a></span> (<span class="idlParam"><span class="idlParamType"><a>MediaStream</a></span> <span class="idlParamName">stream</span></span>, <span class="idlParam">optional <span class="idlParamType"><a>MediaConstraints</a></span> <span class="idlParamName">constraints</span></span>);</span>
<span class="idlMethod">    <span class="idlMethType"><a>void</a></span>        <span class="idlMethName"><a href="#widl-PeerConnection-removeStream-void-MediaStream-stream">removeStream</a></span> (<span class="idlParam"><span class="idlParamType"><a>MediaStream</a></span> <span class="idlParamName">stream</span></span>);</span>
<span class="idlMethod">    <span class="idlMethType"><a>void</a></span>        <span class="idlMethName"><a href="#widl-PeerConnection-close-void">close</a></span> ();</span>
<span class="idlAttribute">             attribute <span class="idlAttrType"><a>Function</a>?</span>          <span class="idlAttrName"><a href="#widl-PeerConnection-onrenegotationneeded">onrenegotationneeded</a></span>;</span>
<span class="idlAttribute">             attribute <span class="idlAttrType"><a>Function</a>?</span>          <span class="idlAttrName"><a href="#widl-PeerConnection-onicecandidate">onicecandidate</a></span>;</span>
<span class="idlAttribute">             attribute <span class="idlAttrType"><a>Function</a>?</span>          <span class="idlAttrName"><a href="#widl-PeerConnection-onconnecting">onconnecting</a></span>;</span>
<span class="idlAttribute">             attribute <span class="idlAttrType"><a>Function</a>?</span>          <span class="idlAttrName"><a href="#widl-PeerConnection-onopen">onopen</a></span>;</span>
<span class="idlAttribute">             attribute <span class="idlAttrType"><a>Function</a>?</span>          <span class="idlAttrName"><a href="#widl-PeerConnection-onstatechange">onstatechange</a></span>;</span>
<span class="idlAttribute">             attribute <span class="idlAttrType"><a>Function</a>?</span>          <span class="idlAttrName"><a href="#widl-PeerConnection-onaddstream">onaddstream</a></span>;</span>
<span class="idlAttribute">             attribute <span class="idlAttrType"><a>Function</a>?</span>          <span class="idlAttrName"><a href="#widl-PeerConnection-onremovestream">onremovestream</a></span>;</span>
<span class="idlAttribute">             attribute <span class="idlAttrType"><a>Function</a>?</span>          <span class="idlAttrName"><a href="#widl-PeerConnection-onicechange">onicechange</a></span>;</span>
};</span>
</pre><div id="attributes-5" class="section"><h5><span class="secno">4.1.11.1 </span>Attributes</h5><dl class="attributes"><dt id="widl-PeerConnection-iceState"><code>iceState</code> of type <span class="idlAttrType"><a>IceState</a></span>, readonly</dt><dd>
              <p>The <dfn id="dom-peerconnection-icestate">
                  <code>iceState</code>
                </dfn> attribute <em class="rfc2119" title="must">must</em> return the state of the <a href="#peerconnection-ice-agent"><code>PeerConnection</code> ICE
              Agent</a> ICE state. </p>
            </dd><dt id="widl-PeerConnection-localDescription"><code>localDescription</code> of type <span class="idlAttrType"><a href="#idl-def-SessionDescription" class="idlType"><code>SessionDescription</code></a></span>, readonly</dt><dd>
              <p> The localDescription method returns a copy of the 
              SessionDescription that was most recently passed to
              setLocalDescription, plus any local candidates that have been
              generated by the ICE Agent since then. </p>

              <p> A null object will be returned if the local description has
              not yet been set. </p>
            </dd><dt id="widl-PeerConnection-localStreams"><code>localStreams</code> of type array of <span class="idlAttrType"><a>MediaStream</a></span>, readonly</dt><dd>
              <p>Returns a live array containing the local streams (those that
              were added with <code title="dom-PeerConnection-addStream">
                  <a href="#dom-peerconnection-addstream">addStream()</a>
                </code>).</p>
            </dd><dt id="widl-PeerConnection-onaddstream"><code>onaddstream</code> of type <span class="idlAttrType"><a>Function</a></span>, nullable</dt><dd>This event handler, of <span title="event handler event type">event handler event type</span>
            <code>
                <a href="#event-mediastream-addstream">addstream</a>
              </code>, <em class="rfc2119" title="must">must</em> be supported by all objects implementing the <code>
                <a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a>
              </code> interface. Open Issue: It seems like this even handler
            needs to be fired when the first of two things happens - the
            remote side sends signaling indicating a media will be sent, or
            the side that sent an offer start receiving media in reply to that
            offer. </dd><dt id="widl-PeerConnection-onconnecting"><code>onconnecting</code> of type <span class="idlAttrType"><a>Function</a></span>, nullable</dt><dd>This event handler, of <span title="event handler event type">event handler event type</span>
            <code>
                <a href="#event-mediastream-connecting">connecting</a>
              </code>, <em class="rfc2119" title="must">must</em> be supported by all objects implementing the <code>
                <a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a>
              </code> interface.</dd><dt id="widl-PeerConnection-ondatachannel"><code>ondatachannel</code> of type <span class="idlAttrType"><a>Function</a></span>, nullable</dt><dd>This event handler, of type <code>
                <a href="#event-peerconnection-datachannel">datachannel</a>
              </code>, <em class="rfc2119" title="must">must</em> be supported by all objects implementing the <code>
                <a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a>
              </code> interface.</dd><dt id="widl-PeerConnection-onicecandidate"><code>onicecandidate</code> of type <span class="idlAttrType"><a>Function</a></span>, nullable</dt><dd>This event handler, of <span title="event handler event type">event handler event type</span>
            <code>
                <a href="#event-onicecandidate">onicecandidate</a>
              </code>, <em class="rfc2119" title="must">must</em> be supported by all objects implementing the <code>
                <a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a>
              </code> interface. It is called any time there is a new ICE
            candiate can be added to the a previos offer or answer. </dd><dt id="widl-PeerConnection-onicechange"><code>onicechange</code> of type <span class="idlAttrType"><a>Function</a></span>, nullable</dt><dd>This event handler, of <span title="event handler event type">event handler event type</span>
            <code>
                <a href="#event-mediastream-icechange">icechange</a>
              </code>, <em class="rfc2119" title="must">must</em> be supported by all objects implementing the <code>
                <a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a>
              </code> interface. It is called any time the iceState
            changes.</dd><dt id="widl-PeerConnection-onopen"><code>onopen</code> of type <span class="idlAttrType"><a>Function</a></span>, nullable</dt><dd>This event handler, of <span title="event handler event type">event handler event type</span>
            <code>
                <a href="#event-mediastream-open">open</a>
              </code>, <em class="rfc2119" title="must">must</em> be supported by all objects implementing the <code>
                <a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a>
              </code> interface.</dd><dt id="widl-PeerConnection-onremovestream"><code>onremovestream</code> of type <span class="idlAttrType"><a>Function</a></span>, nullable</dt><dd>This event handler, of <span title="event handler event type">event handler event type</span>
            <code>
                <a href="#event-mediastream-removestream">removestream</a>
              </code>, <em class="rfc2119" title="must">must</em> be supported by all objects implementing the <code>
                <a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a>
              </code> interface.</dd><dt id="widl-PeerConnection-onrenegotationneeded"><code>onrenegotationneeded</code> of type <span class="idlAttrType"><a>Function</a></span>, nullable</dt><dd> This event handler, of <span title="event handler event type">event handler event type</span>
            <code>
                <a href="#event-renegotiation-needed">renegotiationneeded</a>
              </code>, <em class="rfc2119" title="must">must</em> be supported by all objects implementing the <code>
                <a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a>
              </code> interface.
              Open Issue: Need to sort out which things should be Function and
            which should be a Callback. 
            </dd><dt id="widl-PeerConnection-onstatechange"><code>onstatechange</code> of type <span class="idlAttrType"><a>Function</a></span>, nullable</dt><dd>This event handler, of <span title="event handler event type">event handler event type</span>
            <code>
                <a href="#event-mediastream-open">statechange</a>
              </code>, <em class="rfc2119" title="must">must</em> be supported by all objects implementing the <code>
                <a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a>
              </code> interface. It is called any time the readyState changes.
            </dd><dt id="widl-PeerConnection-readyState"><code>readyState</code> of type <span class="idlAttrType"><a>PeerState</a></span>, readonly</dt><dd>
              <p>The <dfn id="dom-peerconnection-readystate">
                  <code title="">readyState</code>
                </dfn> attribute <em class="rfc2119" title="must">must</em> return the <code>
                  <a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a>
                </code> object's <a href="#peerconnection-readiness-state"><code>PeerConnection</code>
              readiness state</a>. </p>
            </dd><dt id="widl-PeerConnection-remoteDescription"><code>remoteDescription</code> of type <span class="idlAttrType"><a href="#idl-def-SessionDescription" class="idlType"><code>SessionDescription</code></a></span>, readonly</dt><dd>
              <p> The remoteDescription method returns a copy of the current
              remote the SessionDescription that was most recently passed to
              setRemoteDescription, plus any remote candidates that have been
              supplied via addIceCandidate since then. </p>

              <p> A null object will be returned if the remote description has
              not yet been set. </p>
            </dd><dt id="widl-PeerConnection-remoteStreams"><code>remoteStreams</code> of type array of <span class="idlAttrType"><a>MediaStream</a></span>, readonly</dt><dd>
              <p>Returns a live array containing the streams that the remote
              streams. (those that were added by the remote side). </p>

              <p>This array is updated when <code>
                  <a href="#event-mediastream-addstream">addstream</a>
                </code> and <code title="event-MediaStream-removestream">
                  <a href="#event-mediastream-removestream">removestream</a>
                </code> events are fired.</p>
            </dd></dl></div><div id="methods-3" class="section"><h5><span class="secno">4.1.11.2 </span>Methods</h5><dl class="methods"><dt id="widl-PeerConnection-addIceCandidate-void-IceCandidate-candidate"><code>addIceCandidate</code></dt><dd>
              <p>The addIceCandidate method provides a remote candidate to the
              ICE Agent, which will be added to the remote description.
              Connectivity checks will be sent to the new candidates as long
              as the &quot;IceTransports&quot; constraint is not set to &quot;none&quot;. This
              call will result in a change to the state of the ICE Agent, and
              may result in a change to media state if it results in different
              connectivity being established. </p>

              <p> A TBD exception will be thrown if candidate parameter is
              malformed. </p>
            <table class="parameters"><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">candidate</td><td class="prmType"><code><a href="#idl-def-IceCandidate" class="idlType"><code>IceCandidate</code></a></code></td><td class="prmNullFalse">✘</td><td class="prmOptFalse">✘</td><td class="prmDesc"></td></tr></table><div><em>Return type: </em><code><a>void</a></code></div></dd><dt id="widl-PeerConnection-addStream-void-MediaStream-stream-MediaConstraints-constraints"><code>addStream</code></dt><dd>
              <p>Adds a new stream to the PeerConnection. </p>

              <p>When the <dfn id="dom-peerconnection-addstream">
                  <code title="">addStream()</code>
                </dfn> method is invoked, the user agent <em class="rfc2119" title="must">must</em> run the
              following steps:</p>

              <ol>
                <li>
                  <p>If the <code>
                      <a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a>
                    </code> object's <a href="#peerconnection-readiness-state"><code>PeerConnection</code>
                  readiness state</a> is <code>
                      <a href="#widl-PeerConnection-CLOSED">CLOSED</a>
                    </code> (3), throw an <code>INVALID_STATE_ERR</code>
                  exception.</p>
                </li>

                <li>
                  <p>If <var>stream</var> is already in the <code>
                      <a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a>
                    </code> object's <code title="dom-PeerConnection-localStreams">
                      <a href="#widl-PeerConnection-localStreams">localStreams</a>
                    </code> object, then abort these steps.</p>
                </li>

                <li>
                  <p>Add <var>stream</var> to the end of the <code>
                      <a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a>
                    </code> object's <code title="dom-PeerConnection-localStreams">
                      <a href="#widl-PeerConnection-localStreams">localStreams</a>
                    </code> object.</p>
                </li>

                <li>
                  <p>Parse the <var>constraints</var> provided by the
                  application and apply them to the MediaStream, if possible.
                  NOTE - need to deal with throwing an exception here. </p>
                </li>

                <li>
                  <p> Fire a renegotiationneeded event. [[OPEN ISSUE: Should this fire if 
		  the PeerConnection is in &quot;new&quot;?]]</p>
                </li>
              </ol>
            <table class="parameters"><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">stream</td><td class="prmType"><code><a>MediaStream</a></code></td><td class="prmNullFalse">✘</td><td class="prmOptFalse">✘</td><td class="prmDesc"></td></tr><tr><td class="prmName">constraints</td><td class="prmType"><code><a>MediaConstraints</a></code></td><td class="prmNullFalse">✘</td><td class="prmOptTrue">✔</td><td class="prmDesc"></td></tr></table><div><em>Return type: </em><code><a>void</a></code></div></dd><dt id="widl-PeerConnection-close-void"><code>close</code></dt><dd>
              <p>When the <dfn id="dom-peerconnection-close">
                  <code title="">close()</code>
                </dfn> method is invoked, the user agent <em class="rfc2119" title="must">must</em> run the
              following steps:</p>

              <ol>
                <li>
                  <p>If the <code>
                      <a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a>
                    </code> object's <a href="#peerconnection-readiness-state"><code>PeerConnection</code>
                  readiness state</a> is <code>
                      <a href="#widl-PeerConnection-CLOSED">CLOSED</a>
                    </code> (3), throw an <code>INVALID_STATE_ERR</code>
                  exception.</p>
                </li>

                <li>
                  <p>Destroy the <a href="#peerconnection-ice-agent"><code>PeerConnection</code>
                  ICE Agent</a>, abruptly ending any active ICE processing and
                  any active streaming, and releasing any relevant resources
                  (e.g. TURN permissions).</p>
                </li>

                <li>
                  <p>Set the object's <a href="#peerconnection-readiness-state"><code>PeerConnection</code>
                  readiness state</a> to <code>
                      <a href="#widl-PeerConnection-CLOSED">CLOSED</a>
                    </code> (3).</p>
                </li>
              </ol>
            <div><em>No parameters.</em></div><div><em>Return type: </em><code><a>void</a></code></div></dd><dt id="widl-PeerConnection-createAnswer-void-SessionDescription-offer-SessionDescriptionCallback-successCallback-PeerConnectionErrorCallback-failureCallback-MediaConstraints-constraints-Boolean-createProvisionalAnswer-false"><code>createAnswer</code></dt><dd>
              <p>The createAnswer method generates a [<cite><a class="bibref" rel="biblioentry" href="#bib-SDP">SDP</a></cite>] answer with the
              supported configuration for the session that is compatible with
              the parameters supplied in offer. Like createOffer, the returned
              blob contains descriptions of the local MediaStreams attached to
              this PeerConnection, the codec/RTP/RTCP options negotiated for
              this session, and any candidates that have been gathered by the
              ICE Agent. The constraints parameter may be supplied to provide
              additional control over the generated answer. </p>

              <p> As an answer, the generated SDP will contain a specific
              configuration that, along with the offer, specifies how the
              media plane should be established. The generation of the SDP
              must follow the appropriate process for generating an answer or
              provisional answer. </p>

              <p> Session descriptions generated by createAnswer must be
              immediately usable by setLocalDescription without generating an
              error if setLocalDescription is called from the successCallback
              function. Like createOffer, the returned description should
              reflect the current state of the system. The session
              descriptions <em class="rfc2119" title="must">must</em> remain usable by setLocalDescription without
              causing an error until at least the end of the successCallback
              function. Calling this method is is needed to get the ICE user
              name fragment and password. Provisional offers, as described in
              [<cite><a class="bibref" rel="biblioentry" href="#bib-RTCWEB-JSEP">RTCWEB-JSEP</a></cite>], are created if and only if the
              createProvisionalOffer flag is true. </p>

              <p> The failureCallback will be called if the system can not
              generate an appropriate answer given the offer. </p>

              <p> A TBD exception is thrown if the constraints parameter is
              malformed. </p>
            <table class="parameters"><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">offer</td><td class="prmType"><code><a href="#idl-def-SessionDescription" class="idlType"><code>SessionDescription</code></a></code></td><td class="prmNullFalse">✘</td><td class="prmOptFalse">✘</td><td class="prmDesc"></td></tr><tr><td class="prmName">successCallback</td><td class="prmType"><code><a>SessionDescriptionCallback</a></code></td><td class="prmNullFalse">✘</td><td class="prmOptFalse">✘</td><td class="prmDesc"></td></tr><tr><td class="prmName">failureCallback</td><td class="prmType"><code><a>PeerConnectionErrorCallback</a></code></td><td class="prmNullFalse">✘</td><td class="prmOptTrue">✔</td><td class="prmDesc"></td></tr><tr><td class="prmName">constraints</td><td class="prmType"><code><a>MediaConstraints</a></code></td><td class="prmNullFalse">✘</td><td class="prmOptTrue">✔</td><td class="prmDesc"></td></tr><tr><td class="prmName">createProvisionalAnswer=false</td><td class="prmType"><code><a>Boolean</a></code></td><td class="prmNullFalse">✘</td><td class="prmOptTrue">✔</td><td class="prmDesc"></td></tr></table><div><em>Return type: </em><code><a>void</a></code></div></dd><dt id="widl-PeerConnection-createDataChannel-DataChannel-DOMString-label-DataChannelInit-dataChannelDict"><code>createDataChannel</code></dt><dd>
              <p>Creates a new <code>
                  <a href="#idl-def-DataChannel" class="idlType"><code>DataChannel</code></a>
                </code> object with the given label. The <code>
                  <a href="#idl-def-DataChannelInit" class="idlType"><code>DataChannelInit</code></a>
                </code> dictionary can be used to configure properties of
              underlying channel such as 
<!-- priority and -->
 data reliability.
              A corresponding <code>
                  <a href="#idl-def-DataChannel" class="idlType"><code>DataChannel</code></a>
                </code> object is dispatched at the other peer if the channel
              setup was successful.</p>

              <p>When the <dfn id="dom-peerconnection-createdatachannel">
                  <code>createDataChannel()</code>
                </dfn> method is invoked, the user agent <em class="rfc2119" title="must">must</em> run the
              following steps.</p>

              <ol>
                <li>
                  <p>If the <code>
                      <a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a>
                    </code> object’s <a href="#peerconnection-readiness-state"><code>PeerConnection</code>
                  readiness state</a> is <code>
                      <a href="#widl-PeerConnection-CLOSED">CLOSED</a>
                    </code> (3), throw an <code>INVALID_STATE_ERR</code>
                  exception.</p>
                </li>

                <li>
                  <p>Let <var>channel</var> be a newly created <code>
                      <a href="#idl-def-DataChannel" class="idlType"><code>DataChannel</code></a>
                    </code> object.</p>
                </li>

                <li>
                  <p>Initialize <var>channel</var>’s <code>
                      <a href="#dom-datachannel-label">label</a>
                    </code> attribute to the value of the first argument.</p>
                </li>

                <li>
                  <p>Initialize <var>channel</var>’s <code>
                      <a href="#dom-datachannel-reliable">reliable</a>
                    </code> attribute to true.</p>
                </li>

                <li>
                  <p>If the second argument is present and it contains a <code>
                      <a href="#widl-DataChannelInit-reliable">reliable</a>
                    </code> dictionary member, then set <var>channel</var>’s
                  <code>
                      <a href="#dom-datachannel-reliable">reliable</a>
                    </code> attribute to the dictionary member value.</p>
                </li>

                <li>
                  <p>Return <var>channel</var> and continue these steps in the
                  background.</p>
                </li>

                <li>
                  <p>Create <var>channel</var>’s associated <a href="#dfn-underlying-data-transport" class="internalDFN">underlying data
                  transport</a>.</p>
                </li>
              </ol>
            <table class="parameters"><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">label</td><td class="prmType"><code><a>DOMString</a></code></td><td class="prmNullTrue">✔</td><td class="prmOptFalse">✘</td><td class="prmDesc"></td></tr><tr><td class="prmName">dataChannelDict</td><td class="prmType"><code><a href="#idl-def-DataChannelInit" class="idlType"><code>DataChannelInit</code></a></code></td><td class="prmNullTrue">✔</td><td class="prmOptTrue">✔</td><td class="prmDesc"></td></tr></table><div><em>Return type: </em><code><a href="#idl-def-DataChannel" class="idlType"><code>DataChannel</code></a></code></div></dd><dt id="widl-PeerConnection-createOffer-void-SessionDescriptionCallback-successCallback-PeerConnectionErrorCallback-failureCallback-MediaConstraints-constraints"><code>createOffer</code></dt><dd>
              <p> The createOffer method generates a blob of SDP that contains
              a RFC offer with the supported configurations for the session,
              including descriptions of the local MediaStreams attached to
              this PeerConnection, the codec/RTP/RTCP options supported by
              this implementation, and any candidates that have been gathered
              by the ICE Agent. The constraints parameter may be supplied to
              provide additional control over the offer generated. </p>

              <p> As an offer, the generated SDP will contain the full set of
              capabilities supported by the session (as opposed to an answer,
              which will include only a specific negotiated subset to use);
              for each SDP line, the generation of the SDP must follow the
              appropriate process for generating an offer. In the event
              createOffer is called after the session is established,
              createOffer will generate an offer that is compatible with the
              current session, incorporating any changes that have been made
              to the session since the last complete offer-answer exchange,
              such as addition or removal of streams. If no changes have been
              made, the offer will be include the capabilities of the current
              local description as well as any additional capabilities that
              could be negotiated in an updated offer. </p>

              <p> Session descriptions generated by createOffer <em class="rfc2119" title="must">must</em> be
              immediately usable by setLocalDescription without causing an
              error as long as setLocalDiscription is called within the
              successCallback function. If a system has limited resources
              (e.g. a finite number of decoders), createOffer needs to return
              an offer that reflects the current state of the system, so that
              setLocalDescription will succeed when it attempts to acquire
              those resources. The session descriptions <em class="rfc2119" title="must">must</em> remain usable by
              setLocalDescription without causing an error until at least end
              of the successCallback function. Calling this method is needed
              to get the ICE user name fragment and password. </p>

              <p> The failureCallback will be called if the system can not
              generate an appropriate offer given the state of the
              PeerConnection. </p>

              <p> A TBD exception is thrown if the constraints parameter is
              malformed. 
                [[ OPEN ISSUE: How are errors reported? ]]
                </p>
                

              <p> To Do: Discuss privacy aspects of this from a finger
              printing point of view - it's probably around as bad as access
              to a canvas :-) </p>
            <table class="parameters"><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">successCallback</td><td class="prmType"><code><a>SessionDescriptionCallback</a></code></td><td class="prmNullFalse">✘</td><td class="prmOptFalse">✘</td><td class="prmDesc"></td></tr><tr><td class="prmName">failureCallback</td><td class="prmType"><code><a>PeerConnectionErrorCallback</a></code></td><td class="prmNullFalse">✘</td><td class="prmOptTrue">✔</td><td class="prmDesc"></td></tr><tr><td class="prmName">constraints</td><td class="prmType"><code><a>MediaConstraints</a></code></td><td class="prmNullFalse">✘</td><td class="prmOptTrue">✔</td><td class="prmDesc"></td></tr></table><div><em>Return type: </em><code><a>void</a></code></div></dd><dt id="widl-PeerConnection-removeStream-void-MediaStream-stream"><code>removeStream</code></dt><dd>
              <p>Removes the given stream from the localStream array in the PeerConnection and fires 'renegotiationneeded.</p>

              <p>When the other peer stops sending a stream in this manner, a
              <code title="event-MediaStream-removestream">
                  <a href="#event-mediastream-removestream">removestream</a>
                </code> event is fired at the <code>
                  <a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a>
                </code> object.</p>

              <p>When the <dfn id="dom-peerconnection-removestream">
                  <code title="">removeStream()</code>
                </dfn> method is invoked, the user agent <em class="rfc2119" title="must">must</em> run the
              following steps:</p>

              <ol>
                <li>
                  <p>If the <code>
                      <a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a>
                    </code> object's <a href="#peerconnection-readiness-state"><code>PeerConnection</code>
                  readiness state</a> is <code>
                      <a href="#widl-PeerConnection-CLOSED">CLOSED</a>
                    </code> (3), throw an <code>INVALID_STATE_ERR</code>
                  exception.</p>
                </li>

                <li>
                  <p>If <var>stream</var> is not in the <code>
                      <a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a>
                    </code> object's <code title="dom-PeerConnection-localStreams">
                      <a href="#widl-PeerConnection-localStreams">localStreams</a>
                    </code> object, then abort these steps. TODO: Do we need
                  an exception here? </p>
                </li>

                <li>
                  <p>Remove <var>stream</var> from the <code>
                      <a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a>
                    </code> object's <code title="dom-PeerConnection-localStreams">
                      <a href="#widl-PeerConnection-localStreams">localStreams</a>
                    </code> object.</p>
                </li>

                <li>
                  <p> Fire a renegotiationneeded event.</p>
                </li>
              </ol>
            <table class="parameters"><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">stream</td><td class="prmType"><code><a>MediaStream</a></code></td><td class="prmNullFalse">✘</td><td class="prmOptFalse">✘</td><td class="prmDesc"></td></tr></table><div><em>Return type: </em><code><a>void</a></code></div></dd><dt id="widl-PeerConnection-setLocalDescription-void-SdpType-action-SessionDescription-description"><code>setLocalDescription</code></dt><dd>
              <p> The setLocalDescription method instructs the PeerConnection
              to apply the supplied [<cite><a class="bibref" rel="biblioentry" href="#bib-SDP">SDP</a></cite>] description as the local offer or
              answer. The type parameter indicates whether the description
              should be processed as an offer, provisional answer, or final
              answer. 
              [[OPEN ISSUE: The type appears as both the &quot;action&quot; argument
              and in the struct. That is redundant and just sort of crazy. We need
              to pick one.]]              
              </p>

              <p> This API changes the local media state. In order to
              successfully handle scenarios where the application wants to
              offer to change from one media format to a different,
              incompatible format, the PeerConnection must be able to
              simultaneously support use of both the old and new local
              descriptions (e.g. support codecs that exist in both
              descriptions) until a final answer is received, at which point
              the PeerConnection can fully adopt the new local description, or
              roll back to the old description if the remote side denied the
              change. </p>

              <p> Open issues: how to indicate to roll back? </p>

              <p> To Do: specify what parts of the SDP can be changed between
              the createOffer and setLocalDescription </p>

              <p>Changes to the state of media transmission will occur when a
              final answer is successfully applied. </p>

              <p> A TBD exception is thrown if sdp is invalid. A TBD exception
              is thrown if there are insufficient local resources to apply the
              sdp. </p>

              <p> Open Issues: for setLocal and setRemote, discuss how to
              return erro codes and if they need to be asynchronous. </p>
            <table class="parameters"><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">action</td><td class="prmType"><code><a>SdpType</a></code></td><td class="prmNullFalse">✘</td><td class="prmOptFalse">✘</td><td class="prmDesc"></td></tr><tr><td class="prmName">description</td><td class="prmType"><code><a href="#idl-def-SessionDescription" class="idlType"><code>SessionDescription</code></a></code></td><td class="prmNullFalse">✘</td><td class="prmOptFalse">✘</td><td class="prmDesc"></td></tr></table><div><em>Return type: </em><code><a>void</a></code></div></dd><dt id="widl-PeerConnection-setRemoteDescription-void-SdpType-action-SessionDescription-description"><code>setRemoteDescription</code></dt><dd>
              <p> The setRemoteDescription method instructs the PeerConnection
              to apply the supplied [<cite><a class="bibref" rel="biblioentry" href="#bib-SDP">SDP</a></cite>] in the description. As in
              setLocalDescription, the action parameter indicates how the blob
              should be processed. This API changes the local media state.
              </p>

              <p> Changes to the state of media transmission will occur when a
              final answer is successfully applied. </p>

              <p> A TBD exception is thrown if the sdp parameter is invalid. A
              TBD exception is thrown if there are insufficient local
              resources to apply the SDP. </p>
            <table class="parameters"><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">action</td><td class="prmType"><code><a>SdpType</a></code></td><td class="prmNullFalse">✘</td><td class="prmOptFalse">✘</td><td class="prmDesc"></td></tr><tr><td class="prmName">description</td><td class="prmType"><code><a href="#idl-def-SessionDescription" class="idlType"><code>SessionDescription</code></a></code></td><td class="prmNullFalse">✘</td><td class="prmOptFalse">✘</td><td class="prmDesc"></td></tr></table><div><em>Return type: </em><code><a>void</a></code></div></dd><dt id="widl-PeerConnection-updateIce-void-IceServers-configuration-MediaConstraints-constraints-Boolean-restart-false"><code>updateIce</code></dt><dd>
              <p> The updateIce method restarts or updates the ICE Agent
              process of gathering local candidates and pinging remote
              candidates. If there is a mandatory constraint called
              &quot;IceTransports&quot; it will control which how the ICE engine can
              act. This can be used to limit the use to TURN candidates by a
              callee to avoid leaking location information prior to the call
              being accepted. </p>

              <p> This call may result in a change to the state of the ICE
              Agent, and may result in a change to media state if it results
              in connectivity being established. </p>

              <p> If the restart parameter is set to true, the ICE state
              machine discards all candidates it has gathered, allocates new
              ports for the host candidates, and restarts ICE as if there had
              been no previos ICE session. Applications can use this to reset
              all ICE negotiation when something has gone terribly wrong. </p>

              <p> A TBD exception will be thrown if constraints parameter is
              malformed. </p>
            <table class="parameters"><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">configuration</td><td class="prmType"><code><a href="#idl-def-IceServers" class="idlType"><code>IceServers</code></a></code></td><td class="prmNullFalse">✘</td><td class="prmOptTrue">✔</td><td class="prmDesc"></td></tr><tr><td class="prmName">constraints</td><td class="prmType"><code><a>MediaConstraints</a></code></td><td class="prmNullFalse">✘</td><td class="prmOptTrue">✔</td><td class="prmDesc"></td></tr><tr><td class="prmName">restart=false</td><td class="prmType"><code><a>Boolean</a></code></td><td class="prmNullFalse">✘</td><td class="prmOptTrue">✔</td><td class="prmDesc"></td></tr></table><div><em>Return type: </em><code><a>void</a></code></div></dd></dl></div>

          <pre class="idl"><span class="idlImplements"><a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a> implements <a>EventTarget</a>;</span></pre><div class="idlImplementsDesc">
            </div>
            
        </div>
      </div>
    </div>

    <div id="iana-registrations" class="section">
      
<!-- OddPage -->
<h2 id="sec-iana"><span class="secno">5. </span>IANA Registrations</h2>

      <p> IANA is requested to register the constraints defined in <a href="#sec-constraints"> Constraints Section </a> as specified in
      [<cite><a class="bibref" rel="biblioentry" href="#bib-RTCWEB-CONSTRAINTS">RTCWEB-CONSTRAINTS</a></cite>]. </p>

      <div id="constraints" class="section">
        <h3 id="sec-constraints"><span class="secno">5.1 </span>Constraints</h3>

        <p> TOOD: Need to change the naming and declaration of these
        constraints to match the constraints draft once that is a bit further
        along. The names here now are likely not quite right but they serve as
        a place holder. 
	  [[OPEN ISSUE: there are multiple ways to add constraints. How are
	  multiple values reconciled?]]
	</p>

        <p> The following new constraints are defined that can be used with a
        PeerConnection object: </p>

        <dl>
          <dt> OfferToReceiveVideo </dt>

          <dd>
            <p> This is a enum type constraint that can take the values &quot;true&quot;
            and &quot;false&quot;. The default is a non mandatory &quot;true&quot; for a
            PeerConnection object that has a video stream at the point in time
            when the constraints are being evaluated and is non mandatory
            &quot;false&quot; otherwise. </p>

            <p> In some cases, a PeerConnection may wish to receive video but
            it is not going to send any video. The PeerConnection needs to
            know if it should signal to the remote side if it wishes to
            receive video or not. This constraints allows an application to
            indicate its preferences for receiving video when creating an
            offer. </p>
          </dd>

          <dt>OfferToReceiveAudio </dt>

          <dd>
            <p> This is a enum type constraint that can take the values &quot;true&quot;
            and &quot;false&quot;. The default is a non mandatory &quot;true&quot;. </p>

            <p> In some cases, a PeerConnection may wish to receive audio but
            it is not going to send any audio. The PeerConnection needs to
            know if it should signal to the remote side if it wishes to
            receive audio. This constraints allows an application to indicate
            its preferences for receiving audio when creating an offer. </p>
          </dd>

          <dt> VoiceActivityDetection </dt>

          <dd>
            <p> This is a enum type constraint that can take the values &quot;true&quot;
            and &quot;false&quot;. The default is a non mandatory &quot;true&quot;. </p>

            <p> Many codecs and system are capable of detecting &quot;silence&quot; and
            changing there behavior in this case by doing things such as not
            transmitting any media. In many cases, such as when dealing with
            sounds other than spoken voice or emergency calling, it is
            desirable to be able to turn off this behavior. This constraints
            allows the application to provide information about if it wishes
            this type of processing enable or disabled. </p>
          </dd>

          <dt> IceTransports </dt>

          <dd>
            <p> This is a enum type constraint that can take the values
            &quot;none&quot;, &quot;relay&quot;, and &quot;all&quot;. The default is a non mandatory &quot;all&quot;.
            </p>

            <p> This constraints indicates which candidates the ICE engine is
            restricted use. The value &quot;none&quot; means the ICE engine <em class="rfc2119" title="must">must</em> not
            send or receive any packets at this point. The value &quot;relay&quot;
            indicates the ICE engine <em class="rfc2119" title="must">must</em> only using media relay candidates
            such as candidates passing through a TURN server. This can be used
            to reduce leakage of IP addresses in certain use cases. The value
            of &quot;all&quot; indicates all values can be used. </p>
          </dd>
        </dl>

        <p> TODO items - need to register with IANA. </p>
      </div>
    </div>

    
<!-- 
      <section>
        <h3>SignalingCallback</h3>

        <dl class="idl"
            title="[Callback, NoInterfaceObject] interface SignalingCallback">
          <dt>void handleEvent (DOMString message, PeerConnection source)</dt>

          <dd>Def TBD</dd>
        </dl>
      </section>
     -->


       <div id="simple-example" class="section">
        
<!-- OddPage -->
<h2><span class="secno">6. </span>Simple Example</h2>

        <div>
          <p>When two peers decide they are going to set up a connection to
          each other, they both go through these steps. The STUN/TURN server
          configuration describes a server they can use to get things like
          their public IP address or to set up NAT traversal. They also have
          to send data for the signaling channel to each other using the same
          out-of-band mechanism they used to establish that they were going to
          communicate in the first place.</p>

          <p> NOTE: TODO - This code does not match the API yet and might have a few
          other problems. </p>

          <pre class="example sh_javascript sh_sourceCode"><span class="sh_keyword">var</span> signalingChannel <span class="sh_symbol">=</span> <span class="sh_function">createSignalingChannel</span><span class="sh_symbol">();</span>
<span class="sh_keyword">var</span> pc<span class="sh_symbol">;</span>

<span class="sh_comment">// set up the call, get access to local media, and establish connectivity</span>
<span class="sh_keyword">function</span> <span class="sh_function">start</span><span class="sh_symbol">(</span>isCaller<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span>
    <span class="sh_comment">// Create a PeerConnection and hook up the IceCallback</span>
    pc <span class="sh_symbol">=</span> <span class="sh_keyword">new</span> <span class="sh_function">PeerConnection</span><span class="sh_symbol">(</span><span class="sh_string">&quot;&quot;</span><span class="sh_symbol">,</span> <span class="sh_keyword">function</span> <span class="sh_symbol">(</span>candidate<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span>
        signalingChannel<span class="sh_symbol">.</span><span class="sh_function">send</span><span class="sh_symbol">(</span>JSON<span class="sh_symbol">.</span><span class="sh_function">stringify</span><span class="sh_symbol">(</span><span class="sh_cbracket">{</span> <span class="sh_string">&quot;type&quot;</span><span class="sh_symbol">:</span> <span class="sh_string">&quot;candidate&quot;</span><span class="sh_symbol">,</span> <span class="sh_string">&quot;sdp&quot;</span><span class="sh_symbol">:</span> candidate <span class="sh_cbracket">}</span><span class="sh_symbol">));</span>
    <span class="sh_cbracket">}</span><span class="sh_symbol">);</span>

    <span class="sh_comment">// get the local stream and show it in the local video element</span>
    navigator<span class="sh_symbol">.</span><span class="sh_function">getUserMedia</span><span class="sh_symbol">(</span><span class="sh_cbracket">{</span><span class="sh_string">&quot;audio&quot;</span><span class="sh_symbol">:</span> <span class="sh_keyword">true</span><span class="sh_symbol">,</span> <span class="sh_string">&quot;video&quot;</span><span class="sh_symbol">:</span> <span class="sh_keyword">true</span><span class="sh_cbracket">}</span><span class="sh_symbol">,</span> <span class="sh_keyword">function</span> <span class="sh_symbol">(</span>stream<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span>
        selfView<span class="sh_symbol">.</span>src <span class="sh_symbol">=</span> URL<span class="sh_symbol">.</span><span class="sh_function">createObjectURL</span><span class="sh_symbol">(</span>stream<span class="sh_symbol">);</span>
        pc<span class="sh_symbol">.</span><span class="sh_function">addStream</span><span class="sh_symbol">(</span>stream<span class="sh_symbol">);</span>

        <span class="sh_keyword">var</span> type<span class="sh_symbol">;</span>
        <span class="sh_keyword">if</span> <span class="sh_symbol">(</span>isCaller<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span>
            pc<span class="sh_symbol">.</span><span class="sh_function">createOffer</span><span class="sh_symbol">(</span>gotDescription<span class="sh_symbol">);</span>
            type <span class="sh_symbol">=</span> <span class="sh_string">&quot;offer&quot;</span><span class="sh_symbol">;</span>
        <span class="sh_cbracket">}</span> <span class="sh_keyword">else</span> <span class="sh_cbracket">{</span>
            pc<span class="sh_symbol">.</span><span class="sh_function">createAnswer</span><span class="sh_symbol">(</span>pc<span class="sh_symbol">.</span>remoteDescription<span class="sh_symbol">,</span> gotDescription<span class="sh_symbol">);</span>
            type <span class="sh_symbol">=</span> <span class="sh_string">&quot;answer&quot;</span><span class="sh_symbol">;</span>
        <span class="sh_cbracket">}</span>

        <span class="sh_keyword">function</span> <span class="sh_function">gotDescription</span><span class="sh_symbol">(</span>desc<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span>
            pc<span class="sh_symbol">.</span><span class="sh_function">setLocalDescription</span><span class="sh_symbol">(</span>type<span class="sh_symbol">,</span> desc<span class="sh_symbol">);</span>
            signalingChannel<span class="sh_symbol">.</span><span class="sh_function">send</span><span class="sh_symbol">(</span>JSON<span class="sh_symbol">.</span><span class="sh_function">stringify</span><span class="sh_symbol">(</span><span class="sh_cbracket">{</span> <span class="sh_string">&quot;type&quot;</span><span class="sh_symbol">:</span> type<span class="sh_symbol">,</span> <span class="sh_string">&quot;sdp&quot;</span><span class="sh_symbol">:</span> desc <span class="sh_cbracket">}</span><span class="sh_symbol">));</span>
        <span class="sh_cbracket">}</span>
    <span class="sh_cbracket">}</span><span class="sh_symbol">);</span>

    <span class="sh_comment">// once remote stream arrives, show it in the remote video element</span>
    pc<span class="sh_symbol">.</span>onaddstream <span class="sh_symbol">=</span> <span class="sh_keyword">function</span> <span class="sh_symbol">(</span>evt<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span>
        remoteView<span class="sh_symbol">.</span>src <span class="sh_symbol">=</span> URL<span class="sh_symbol">.</span><span class="sh_function">createObjectURL</span><span class="sh_symbol">(</span>evt<span class="sh_symbol">.</span>stream<span class="sh_symbol">);</span>
    <span class="sh_cbracket">}</span><span class="sh_symbol">;</span>
<span class="sh_cbracket">}</span>

signalingChannel<span class="sh_symbol">.</span>onmessage <span class="sh_symbol">=</span> <span class="sh_keyword">function</span> <span class="sh_symbol">(</span>evt<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span>
    <span class="sh_keyword">var</span> msg <span class="sh_symbol">=</span> JSON<span class="sh_symbol">.</span><span class="sh_function">parse</span><span class="sh_symbol">(</span>evt<span class="sh_symbol">.</span>data<span class="sh_symbol">);</span>
    <span class="sh_keyword">var</span> sdp <span class="sh_symbol">=</span> <span class="sh_function">SessionDescription</span><span class="sh_symbol">(</span>msg<span class="sh_symbol">.</span>sdp<span class="sh_symbol">)</span>
    <span class="sh_keyword">switch</span> <span class="sh_symbol">(</span>msg<span class="sh_symbol">.</span>type<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span>
    <span class="sh_keyword">case</span> <span class="sh_string">&quot;offer&quot;</span><span class="sh_symbol">:</span>
        <span class="sh_comment">// create the PeerConnection</span>
        <span class="sh_function">start</span><span class="sh_symbol">(</span><span class="sh_keyword">false</span><span class="sh_symbol">);</span>
        <span class="sh_comment">// feed the received offer into the PeerConnection</span>
        pc<span class="sh_symbol">.</span><span class="sh_function">setRemoteDescription</span><span class="sh_symbol">(</span>msg<span class="sh_symbol">.</span>type<span class="sh_symbol">,</span><span class="sh_function">SessionDescription</span><span class="sh_symbol">(</span>msg<span class="sh_symbol">.</span>sdp<span class="sh_symbol">));</span>
        <span class="sh_keyword">break</span><span class="sh_symbol">;</span>
    <span class="sh_keyword">case</span> <span class="sh_string">&quot;answer&quot;</span><span class="sh_symbol">:</span>
        pc<span class="sh_symbol">.</span><span class="sh_function">setRemoteDescription</span><span class="sh_symbol">(</span>msg<span class="sh_symbol">.</span>type<span class="sh_symbol">,</span><span class="sh_function">SessionDescription</span><span class="sh_symbol">(</span>msg<span class="sh_symbol">.</span>sdp<span class="sh_symbol">));</span>
        <span class="sh_keyword">break</span><span class="sh_symbol">;</span>
    <span class="sh_keyword">case</span> <span class="sh_string">&quot;candidate&quot;</span><span class="sh_symbol">:</span>
        pc<span class="sh_symbol">.</span><span class="sh_function">addIceCandidate</span><span class="sh_symbol">(</span><span class="sh_function">IceCandidate</span><span class="sh_symbol">(</span>msg<span class="sh_symbol">.</span>sdp<span class="sh_symbol">));</span>
        <span class="sh_keyword">break</span><span class="sh_symbol">;</span>
    <span class="sh_cbracket">}</span>
<span class="sh_cbracket">}</span><span class="sh_symbol">;</span></pre> 
        </div>
      </div>
  
    <div id="advanced-example" class="section">
      
<!-- OddPage -->
<h2><span class="secno">7. </span>Advanced Example</h2>

      <div>
        <p>This example shows the more comples functionality.</p>

      <pre class="example sh_javascript sh_sourceCode">TODO </pre> 
      </div>
    </div>

    <div id="peer-to-peer-data-api" class="section">
      
<!-- OddPage -->
<h2><span class="secno">8. </span>Peer-to-peer Data API</h2>

      <p>The Peer-to-peer Data API lets a web application send and receive
      generic application data peer-to-peer.</p>

      <div title="hello" class="note">
        <p>Open issues (this should not be considered as a complete list of
        open issues)</p>

        <ul>
          <li>Data channel setup signaling (signaling via SDP and application
          specific signaling channel or first channel via SDP and consecutive
          channels via internal signalling).</li>

          <li>What can be shared with the WebSocket API specification
          regarding actual interfaces.</li>
        </ul>
      </div>

      <div id="datachannel" class="section">
        <h3><span class="secno">8.1 </span>DataChannel</h3>

        <p>The <code>
            <a href="#idl-def-DataChannel" class="idlType"><code>DataChannel</code></a>
          </code> interface represents a bi-directional data channel between
        two peers. A <code>
            <a href="#idl-def-DataChannel" class="idlType"><code>DataChannel</code></a>
          </code> is created via a factory method on a <code>
            <a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a>
          </code> object. The corresponding <code>
            <a href="#idl-def-DataChannel" class="idlType"><code>DataChannel</code></a>
          </code> object is then dispatched at the other peer if the channel
        setup was successful.</p>

        <p>Each <code>
            <a href="#idl-def-DataChannel" class="idlType"><code>DataChannel</code></a>
          </code> has an associated <dfn id="dfn-underlying-data-transport">underlying data transport</dfn> that
        is used to transport actual data to the other peer. The transport
        properties of the <a href="#dfn-underlying-data-transport" class="internalDFN">underlying data transport</a>, such as
        reliability mode, are configured by the peer taking the initiative to
        create the channel. The other peer cannot change any transport
        properties of a offered data channel. The actual wire protocol between
        the peers is out of the scope for this specification.
      Open Issues: this needs to explain how the configuration state
	  is passed between the peers.
       Open Issues: this type of design where one side can pick anything and the
            other side much support everything has proven to make future upgrades
            very difficult. </p>

        <p>A <code>
            <a href="#idl-def-DataChannel" class="idlType"><code>DataChannel</code></a>
          </code> created with <code>
            <a href="#dom-peerconnection-createdatachannel">createDataChannel()</a>
          </code> <em class="rfc2119" title="must">must</em> initially be in the <code>
            <a href="#widl-DataChannel-CONNECTING">CONNECTING</a>
          </code> (0) state. If the <code>
            <a href="#idl-def-DataChannel" class="idlType"><code>DataChannel</code></a>
          </code> object’s <a href="#dfn-underlying-data-transport" class="internalDFN">underlying data transport</a> is successfully
        set up, the user agent <em class="rfc2119" title="must">must</em> <a href="#announce-datachannel-open">announce the
        <code>DataChannel</code> as open</a>.</p>

        <p>When the user agent is to <dfn id="announce-datachannel-open">announce a <code>DataChannel</code> as
        open</dfn>, the user agent <em class="rfc2119" title="must">must</em> queue a task to run the following
        steps:</p>

        <ol>
          <li>
            <p>If the associated <code>
                <a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a>
              </code> object’s <a href="#peerconnection-readiness-state"><code>PeerConnection</code>
            readiness state</a> is <code>
                <a href="#widl-PeerConnection-CLOSED">CLOSED</a>
              </code> (3), abort these steps.</p>
          </li>

          <li>
            <p>Let <var>channel</var> be the <code>
                <a href="#idl-def-DataChannel" class="idlType"><code>DataChannel</code></a>
              </code> object to be announced.</p>
          </li>

          <li>
            <p>Set <var>channel</var>’s <code>
                <a href="#dom-datachannel-readystate">readyState</a>
              </code> attribute to <code>
                <a href="#widl-DataChannel-OPEN">OPEN</a>
              </code> (1).</p>
          </li>

          <li>
            <p><a>Fire a simple event</a> named <code>
                <a href="#event-datachannel-open">open</a>
              </code> at <var>channel</var>.</p>
          </li>
        </ol>

        <p>When an <a href="#dfn-underlying-data-transport" class="internalDFN">underlying data transport</a> has been established, the
        user agent, of the peer that did not initiate the creation process
        <em class="rfc2119" title="must">must</em> queue a task to run the following steps:</p>

        <ol>
          <li>
            <p>If the associated <code>
                <a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a>
              </code> object’s <a href="#peerconnection-readiness-state"><code>PeerConnection</code>
            readiness state</a> is <code>
                <a href="#widl-PeerConnection-CLOSED">CLOSED</a>
              </code> (3), abort these steps.</p>
          </li>

          <li>
            <p>Let <var>configuration</var> be an information bundle with
            key-value pairs, received from the other peer as a part of the
            process to establish the <a>underlying data channel</a>.</p>
          </li>

          <li>
            <p>Let <var>channel</var> be a newly created <code>
                <a href="#idl-def-DataChannel" class="idlType"><code>DataChannel</code></a>
              </code> object.</p>
          </li>

          <li>
            <p>Initialize <var>channel</var>’s <code>
                <a href="#dom-datachannel-label">label</a>
              </code> attribute to value that corresponds to the
            &quot;<code>label</code>&quot; key in <var>configuration</var>.</p>
          </li>

          <li>
            <p>Initialize <var>channel</var>’s <code>
                <a href="#dom-datachannel-reliable">reliable</a>
              </code> attribute to true.</p>
          </li>

          <li>
            <p>If <var>configuration</var> contains a key named
            &quot;<code>reliable</code>&quot;, set <var>channel</var>’s <code>
                <a href="#dom-datachannel-reliable">reliable</a>
              </code> attribute to the corresponding value.</p>
          </li>

          
<!-- 
          
          <li>
          <p>Have the user agent <a href="#announce-datachannel-open">announce
          <var>connection</var> as open</a>.</p>
          </li>

           -->


          <li>
            <p>Set <var>channel</var>’s <code>
                <a href="#dom-datachannel-readystate">readyState</a>
              </code> attribute to <code>
                <a href="#widl-DataChannel-OPEN">OPEN</a>
              </code> (1).</p>
          </li>

          <li>
            <p><a href="#fire-a-datachannel-event" class="internalDFN">Fire a datachannel event</a> named <code>
                <a href="#event-peerconnection-datachannel">datachannel</a>
              </code> with <var>channel</var> at the <code>
                <a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a>
              </code> object.</p>
          </li>
        </ol>

        <p>When the <dfn id="tear-down-data-transport">process of tearing down
        a <code>
            <a href="#idl-def-DataChannel" class="idlType"><code>DataChannel</code></a>
          </code> object’s <a href="#dfn-underlying-data-transport" class="internalDFN">underlying data transport</a></dfn> is
        initiated, the user agent <em class="rfc2119" title="must">must</em> run the following steps:</p>

        <ol>
          <li>
            <p>If the associated <code>
                <a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a>
              </code> object’s <a href="#peerconnection-readiness-state"><code>PeerConnection</code>
            readiness state</a> is <code>
                <a href="#widl-PeerConnection-CLOSED">CLOSED</a>
              </code> (3), abort these steps.</p>
          </li>

          <li>
            <p>Let <var>channel</var> be the <code>
                <a href="#idl-def-DataChannel" class="idlType"><code>DataChannel</code></a>
              </code> object which is about to be closed.</p>
          </li>

          <li>
            <p>If <var>channel</var>’s <code>
                <a href="#dom-datachannel-readystate">readyState</a>
              </code> is <code>
                <a href="#widl-DataChannel-CLOSED">CLOSING</a>
              </code> (2) or <code>
                <a href="#widl-DataChannel-CLOSED">CLOSED</a>
              </code> (3), then abort these steps.</p>
          </li>

          <li>
            <p>Set <var>channel</var>’s <code>
                <a href="#dom-datachannel-readystate">readyState</a>
              </code> attribute to <code>
                <a href="#widl-DataChannel-CLOSING">CLOSING</a>
              </code> (2).</p>
          </li>

          <li>
            <p>Queue a task to run the following steps:</p>
          </li>

          <li>
            <ol>
              <li>
                <p>Close <var>channel</var>’s <a href="#dfn-underlying-data-transport" class="internalDFN">underlying data
                transport</a>.</p>

                <div class="note"> The data transport protocol will specify
                what happens to, e.g. buffered data, when the data transport
                is closed. </div>
              </li>

              <li>
                <p>Set <var>channel</var>’s <code>
                    <a href="#dom-datachannel-readystate">readyState</a>
                  </code> attribute to <code>
                    <a href="#widl-DataChannel-CLOSED">CLOSED</a>
                  </code> (3).</p>
              </li>

              <li>
                <p>Fire a simple event named <code title="event-DataChannel-close">
                    <a href="#event-datachannel-close">close</a>
                  </code> at <var>channel</var>.</p>
              </li>
            </ol>
          </li>
        </ol>

        <pre class="idl"><span id="idl-def-DataChannel" class="idlInterface">interface <span class="idlInterfaceID">DataChannel</span> {
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a>DOMString</a></span>      <span class="idlAttrName"><a href="#widl-DataChannel-label">label</a></span>;</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a>boolean</a></span>        <span class="idlAttrName"><a href="#widl-DataChannel-reliable">reliable</a></span>;</span>
<span class="idlConst">    const <span class="idlConstType"><a>unsigned short</a></span> <span class="idlConstName"><a href="#widl-DataChannel-CONNECTING">CONNECTING</a></span> = <span class="idlConstValue">0</span>;</span>
<span class="idlConst">    const <span class="idlConstType"><a>unsigned short</a></span> <span class="idlConstName"><a href="#widl-DataChannel-OPEN">OPEN</a></span> = <span class="idlConstValue">1</span>;</span>
<span class="idlConst">    const <span class="idlConstType"><a>unsigned short</a></span> <span class="idlConstName"><a href="#widl-DataChannel-CLOSING">CLOSING</a></span> = <span class="idlConstValue">2</span>;</span>
<span class="idlConst">    const <span class="idlConstType"><a>unsigned short</a></span> <span class="idlConstName"><a href="#widl-DataChannel-CLOSED">CLOSED</a></span> = <span class="idlConstValue">3</span>;</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a>unsigned short</a></span> <span class="idlAttrName"><a href="#widl-DataChannel-readyState">readyState</a></span>;</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a>unsigned long</a></span>  <span class="idlAttrName"><a href="#widl-DataChannel-bufferedAmount">bufferedAmount</a></span>;</span>
<span class="idlAttribute">    [<span class="extAttr">TreatNonCallableAsNull</span>]
             attribute <span class="idlAttrType"><a>Function</a>?</span>      <span class="idlAttrName"><a href="#widl-DataChannel-onopen">onopen</a></span>;</span>
<span class="idlAttribute">    [<span class="extAttr">TreatNonCallableAsNull</span>]
             attribute <span class="idlAttrType"><a>Function</a>?</span>      <span class="idlAttrName"><a href="#widl-DataChannel-onerror">onerror</a></span>;</span>
<span class="idlAttribute">    [<span class="extAttr">TreatNonCallableAsNull</span>]
             attribute <span class="idlAttrType"><a>Function</a>?</span>      <span class="idlAttrName"><a href="#widl-DataChannel-onclose">onclose</a></span>;</span>
<span class="idlMethod">    <span class="idlMethType"><a>void</a></span> <span class="idlMethName"><a href="#widl-DataChannel-close-void">close</a></span> ();</span>
<span class="idlAttribute">    [<span class="extAttr">TreatNonCallableAsNull</span>]
             attribute <span class="idlAttrType"><a>Function</a>?</span>      <span class="idlAttrName"><a href="#widl-DataChannel-onmessage">onmessage</a></span>;</span>
<span class="idlAttribute">             attribute <span class="idlAttrType"><a>DOMString</a></span>      <span class="idlAttrName"><a href="#widl-DataChannel-binaryType">binaryType</a></span>;</span>
<span class="idlMethod">    <span class="idlMethType"><a>void</a></span> <span class="idlMethName"><a href="#widl-DataChannel-send-void-DOMString-data">send</a></span> (<span class="idlParam"><span class="idlParamType"><a>DOMString</a></span> <span class="idlParamName">data</span></span>);</span>
<span class="idlMethod">    <span class="idlMethType"><a>void</a></span> <span class="idlMethName"><a href="#widl-DataChannel-send-void-ArrayBuffer-data">send</a></span> (<span class="idlParam"><span class="idlParamType"><a>ArrayBuffer</a></span> <span class="idlParamName">data</span></span>);</span>
<span class="idlMethod">    <span class="idlMethType"><a>void</a></span> <span class="idlMethName"><a href="#widl-DataChannel-send-void-Blob-data">send</a></span> (<span class="idlParam"><span class="idlParamType"><a>Blob</a></span> <span class="idlParamName">data</span></span>);</span>
};</span>
</pre><div id="attributes-6" class="section"><h4><span class="secno">8.1.1 </span>Attributes</h4><dl class="attributes"><dt id="widl-DataChannel-binaryType"><code>binaryType</code> of type <span class="idlAttrType"><a>DOMString</a></span></dt><dd>
            <p class="note">FIXME: align behavior with WebSocket API</p>
          </dd><dt id="widl-DataChannel-bufferedAmount"><code>bufferedAmount</code> of type <span class="idlAttrType"><a>unsigned long</a></span>, readonly</dt><dd>
            <p class="note">FIXME: align behavior with WebSocket API</p>
          </dd><dt id="widl-DataChannel-label"><code>label</code> of type <span class="idlAttrType"><a>DOMString</a></span>, readonly</dt><dd>
            <p>The <dfn id="dom-datachannel-label">
                <code>DataChannel.label</code>
              </dfn> attribute represents a label that can be used to
            distinguish this <code>
                <a href="#idl-def-DataChannel" class="idlType"><code>DataChannel</code></a>
              </code> object from other <code>
                <a href="#idl-def-DataChannel" class="idlType"><code>DataChannel</code></a>
              </code> objects. The attribute <em class="rfc2119" title="must">must</em> return the value to which it
            was set when the <code>
                <a href="#idl-def-DataChannel" class="idlType"><code>DataChannel</code></a>
              </code> object was created.</p>
          </dd><dt id="widl-DataChannel-onclose"><code>onclose</code> of type <span class="idlAttrType"><a>Function</a></span>, nullable</dt><dd>This event handler, of type <code>
              <a href="#event-datachannel-close">close</a>
            </code>, <em class="rfc2119" title="must">must</em> be supported by all objects implementing the <code>
              <a href="#idl-def-DataChannel" class="idlType"><code>DataChannel</code></a>
            </code> interface.</dd><dt id="widl-DataChannel-onerror"><code>onerror</code> of type <span class="idlAttrType"><a>Function</a></span>, nullable</dt><dd>This event handler, of type <code>
              <a href="#event-datachannel-error">error</a>
            </code>, <em class="rfc2119" title="must">must</em> be supported by all objects implementing the <code>
              <a href="#idl-def-DataChannel" class="idlType"><code>DataChannel</code></a>
            </code> interface.</dd><dt id="widl-DataChannel-onmessage"><code>onmessage</code> of type <span class="idlAttrType"><a>Function</a></span>, nullable</dt><dd>This event handler, of type <code>
              <a href="#event-datachannel-message">message</a>
            </code>, <em class="rfc2119" title="must">must</em> be supported by all objects implementing the <code>
              <a href="#idl-def-DataChannel" class="idlType"><code>DataChannel</code></a>
            </code> interface.</dd><dt id="widl-DataChannel-onopen"><code>onopen</code> of type <span class="idlAttrType"><a>Function</a></span>, nullable</dt><dd>This event handler, of type <code>
              <a href="#event-datachannel-open">open</a>
            </code>, <em class="rfc2119" title="must">must</em> be supported by all objects implementing the <code>
              <a href="#idl-def-DataChannel" class="idlType"><code>DataChannel</code></a>
            </code> interface.</dd><dt id="widl-DataChannel-readyState"><code>readyState</code> of type <span class="idlAttrType"><a>unsigned short</a></span>, readonly</dt><dd>
            <p>The <dfn id="dom-datachannel-readystate">
                <code>DataChannel.readyState</code>
              </dfn> attribute represents the state of the
            <code>DataChannel</code> object. It <em class="rfc2119" title="must">must</em> return the value to which
            the user agent last set it (as defined by the processing model
            algorithms). The attribute can have the following values:
            <dfn id="dfn-connecting">CONNECTING</dfn>, <dfn id="dfn-open">OPEN</dfn>, <dfn id="dfn-closing">CLOSING</dfn> or
            <dfn id="dfn-closed">CLOSED</dfn>.</p>
          </dd><dt id="widl-DataChannel-reliable"><code>reliable</code> of type <span class="idlAttrType"><a>boolean</a></span>, readonly</dt><dd>
            <p>The <dfn id="dom-datachannel-reliable">
                <code>DataChannel.reliable</code>
              </dfn> attribute returns true if the <code>
                <a href="#idl-def-DataChannel" class="idlType"><code>DataChannel</code></a>
              </code> is reliable, and false otherwise. The attribute <em class="rfc2119" title="must">must</em>
            return the value to which it was set when the <code>
                <a href="#idl-def-DataChannel" class="idlType"><code>DataChannel</code></a>
              </code> was created.</p>
          </dd></dl></div><div id="methods-4" class="section"><h4><span class="secno">8.1.2 </span>Methods</h4><dl class="methods"><dt id="widl-DataChannel-close-void"><code>close</code></dt><dd>
            <p>Closes the <code>
                <a href="#idl-def-DataChannel" class="idlType"><code>DataChannel</code></a>
              </code>. It may be called regardless if the <code>
                <a href="#idl-def-DataChannel" class="idlType"><code>DataChannel</code></a>
              </code> object was created by this peer or the remote peer.</p>

            <p>When the <dfn id="dfn-close">
                <code>close()</code>
              </dfn> method is called, the user agent <em class="rfc2119" title="must">must</em> initiate <a href="#tear-down-data-transport">the process of tearing down</a>
            the <code>DataChannel</code> object’s <a href="#dfn-underlying-data-transport" class="internalDFN">underlying data
            transport</a>.</p>
          <div><em>No parameters.</em></div><div><em>Return type: </em><code><a>void</a></code></div></dd><dt id="widl-DataChannel-send-void-DOMString-data"><code>send</code></dt><dd>
            <p class="note">FIXME: align behavior with WebSocket API</p>
          <table class="parameters"><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">data</td><td class="prmType"><code><a>DOMString</a></code></td><td class="prmNullFalse">✘</td><td class="prmOptFalse">✘</td><td class="prmDesc"></td></tr></table><div><em>Return type: </em><code><a>void</a></code></div></dd><dt id="widl-DataChannel-send-void-ArrayBuffer-data"><code>send</code></dt><dd>
            <p class="note">FIXME: align behavior with WebSocket API</p>
          <table class="parameters"><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">data</td><td class="prmType"><code><a>ArrayBuffer</a></code></td><td class="prmNullFalse">✘</td><td class="prmOptFalse">✘</td><td class="prmDesc"></td></tr></table><div><em>Return type: </em><code><a>void</a></code></div></dd><dt id="widl-DataChannel-send-void-Blob-data"><code>send</code></dt><dd>
            <p class="note">FIXME: align behavior with WebSocket API</p>
          <table class="parameters"><tr><th>Parameter</th><th>Type</th><th>Nullable</th><th>Optional</th><th>Description</th></tr><tr><td class="prmName">data</td><td class="prmType"><code><a>Blob</a></code></td><td class="prmNullFalse">✘</td><td class="prmOptFalse">✘</td><td class="prmDesc"></td></tr></table><div><em>Return type: </em><code><a>void</a></code></div></dd></dl></div><div id="constants" class="section"><h4><span class="secno">8.1.3 </span>Constants</h4><dl class="constants"><dt id="widl-DataChannel-CLOSED"><code>CLOSED</code> of type <span class="idlConstType"><a>unsigned short</a></span></dt><dd>
            <p>The <a href="#dfn-underlying-data-transport" class="internalDFN">underlying data transport</a> has been closed or could
            not be established.</p>
          </dd><dt id="widl-DataChannel-CLOSING"><code>CLOSING</code> of type <span class="idlConstType"><a>unsigned short</a></span></dt><dd>
            <p>The process of closing down the <a href="#dfn-underlying-data-transport" class="internalDFN">underlying data
            transport</a> has started.</p>
          </dd><dt id="widl-DataChannel-CONNECTING"><code>CONNECTING</code> of type <span class="idlConstType"><a>unsigned short</a></span></dt><dd>
            <p>The user agent is attempting to establish the <a href="#dfn-underlying-data-transport" class="internalDFN">underlying
            data transport</a>. This is the initial state of a <code>
                <a href="#idl-def-DataChannel" class="idlType"><code>DataChannel</code></a>
              </code> object created with <code>
                <a href="#dom-peerconnection-createdatachannel">createDataChannel()</a>
              </code>.</p>
          </dd><dt id="widl-DataChannel-OPEN"><code>OPEN</code> of type <span class="idlConstType"><a>unsigned short</a></span></dt><dd>
            <p>
            TODO - theses constants need to be changed to an enum. 
            </p>
            
            <p>The <a href="#dfn-underlying-data-transport" class="internalDFN">underlying data transport</a> is established and
            communication is possible. This is the initial state of a <code>
                <a href="#idl-def-DataChannel" class="idlType"><code>DataChannel</code></a>
              </code> object dispatched as a part of a <code>
                <a href="#idl-def-DataChannelEvent" class="idlType"><code>DataChannelEvent</code></a>
              </code>.</p>
          </dd></dl></div>

        <pre class="idl"><span id="idl-def-DataChannelInit" class="idlDictionary">dictionary <span class="idlDictionaryID">DataChannelInit</span> {
<span class="idlMember">    <span class="idlMemberType"><a>boolean</a></span> <span class="idlMemberName"><a href="#widl-DataChannelInit-reliable">reliable</a></span>;</span>
};</span>
</pre><div id="dictionary-datachannelinit-members" class="section"><h4><span class="secno">8.1.4 </span>Dictionary <a class="idlType" href="#idl-def-DataChannelInit"><code>DataChannelInit</code></a> Members</h4><dl class="dictionary-members"><dt id="widl-DataChannelInit-reliable"><code>reliable</code> of type <span class="idlMemberType"><a>boolean</a></span></dt><dd>-</dd></dl></div>
      </div>

      <div id="examples" class="section">
        <h3><span class="secno">8.2 </span>Examples</h3>

        <div>
          <p>This simple example shows how to create a DataChannel, register
          an event listener to handle incoming data, and how to send a
          message.</p>

         <pre class="example sh_javascript sh_sourceCode"><span class="sh_keyword">var</span> chan <span class="sh_symbol">=</span> peerConn<span class="sh_symbol">.</span><span class="sh_function">createDataChannel</span><span class="sh_symbol">(</span><span class="sh_string">&quot;mylabel&quot;</span><span class="sh_symbol">);</span>
chan<span class="sh_symbol">.</span>onmessage <span class="sh_symbol">=</span> <span class="sh_keyword">function</span> <span class="sh_symbol">(</span>evt<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span>
    <span class="sh_comment">// use evt.data };</span>
    chan<span class="sh_symbol">.</span><span class="sh_function">send</span><span class="sh_symbol">(</span><span class="sh_string">&quot;hello&quot;</span><span class="sh_symbol">);</span></pre> 
        </div>

        <div>
          <p>This simple example shows how to register an event listener to
          handle the case when a remote peer creates a new DataChannel.</p>

        <pre class="example sh_javascript sh_sourceCode">peerConn<span class="sh_symbol">.</span>ondatachannel <span class="sh_symbol">=</span> <span class="sh_keyword">function</span> <span class="sh_symbol">(</span>evt<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span>
   <span class="sh_keyword">var</span> chan <span class="sh_symbol">=</span> evt<span class="sh_symbol">.</span>channel<span class="sh_symbol">;</span>
   chan<span class="sh_symbol">.</span>onmessage <span class="sh_symbol">=</span> <span class="sh_keyword">function</span> <span class="sh_symbol">(</span>evt<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span>
       <span class="sh_comment">// use evt.data</span>
   <span class="sh_cbracket">}</span><span class="sh_symbol">;</span>
   chan<span class="sh_symbol">.</span>onclose <span class="sh_symbol">=</span> <span class="sh_keyword">function</span> <span class="sh_symbol">()</span> <span class="sh_cbracket">{</span>
          <span class="sh_comment">// remote side closed the data channel</span>
   <span class="sh_cbracket">}</span><span class="sh_symbol">;</span>
<span class="sh_cbracket">}</span><span class="sh_symbol">;</span></pre>&gt;
        </div>

        
<!-- div>
    <p>This simple example shows how configure two DataChannel objects for different purposes.</p>
<pre  class='example sh_javascript'>
// the chat channel is reliable and not as prioritized as game data
var chatChan = peerConn.createDataChannel("chat", { "priority": 1 });

// the game data channel is prioritized and unreliable low latency channel for high performance
var gameDataChan = peerConn.createDataChannel("data", { "reliable": false, "priority": 10 });
    </pre> 
  </div -->

      </div>
    </div>

    <div id="garbage-collection" class="section">
      
<!-- OddPage -->
<h2><span class="secno">9. </span>Garbage collection</h2>

      <p>A <code>Window</code> object <dfn id="concept-peerconnection-owner">has a strong reference</dfn> to any
      <code>
          <a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a>
        </code> objects created from the constructor whose global object is
      that <code>Window</code> object.</p>

      
<!--  we could be less strict here, e.g. dropping the reference when
  there’s no way for an event to be fired because there’s no event handlers
  registered and there’s no way for the remote peer to notice anything because
  no media is streaming; or e.g. dropping the reference when the object reaches
  the CLOSED state. But as dropping the reference in those cases is black-box
  indistinguishable from keeping the reference, I haven't bothered to work out
  the exact rules. If you do change this, see the /unloading document cleanup
  steps/.  -->

    </div>

 
   <div id="event-definitions" class="section">
        
<!-- OddPage -->
<h2><span class="secno">10. </span>Event definitions</h2>

        <div id="peerconnectionevent" class="section">
        <h3><span class="secno">10.1 </span>PeerConnectionEvent</h3>

        <p>Several of the PeerConnection events use the <code>
            <a href="#idl-def-PeerConnectionEvent" class="idlType"><code>PeerConnectionEvent</code></a>
          </code> interface.</p>

        <p><dfn title="Fire a track event" id="dfn-fire-a-track-event">Firing a PeerConnectionEvent event named
        <var>e</var></dfn> with a <code>
            <a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a>
          </code> <var>peer</var> means that an event with the name
        <var>e</var>, which does not bubble (except where otherwise stated)
        and is not cancelable (except where otherwise stated), and which uses
        the <code>
            <a href="#idl-def-PeerConnectionEvent" class="idlType"><code>PeerConnectionEvent</code></a>
          </code> interface with the <code>peer
          </code> attribute set to the <var>PeerConnectio</var> object, <em class="rfc2119" title="must">must</em> be created and
        dispatched at the given target.</p>

        <pre class="idl"><span id="idl-def-PeerConnectionEvent" class="idlInterface">[<span class="extAttr">Constructor(DOMString type, PeerConnectionEventInit eventInitDict)</span>]
interface <span class="idlInterfaceID">PeerConnectionEvent</span> : <span class="idlSuperclass"><a>Event</a></span> {
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a></span> <span class="idlAttrName"><a href="#widl-PeerConnectionEvent-peer">peer</a></span>;</span>
};<br /><span id="idl-def-PeerConnectionEventInit" class="idlDictionary">dictionary <span class="idlDictionaryID">PeerConnectionEventInit</span> : <span class="idlSuperclass"><a>EventInit</a></span> {
<span class="idlMember">    <span class="idlMemberType"><a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a></span> <span class="idlMemberName"><a href="#widl-PeerConnectionEventInit-peer">peer</a></span>;</span>
};</span></span>
</pre><div id="attributes-7" class="section"><h4><span class="secno">10.1.1 </span>Attributes</h4><dl class="attributes"><dt id="widl-PeerConnectionEvent-peer"><code>peer</code> of type <span class="idlAttrType"><a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a></span>, readonly</dt><dd>
            <p>The <dfn id="dom-peerconnectionevent-track">
                <code>peer</code>
              </dfn> attribute represents the <code>
                <a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a>
              </code> object associated with the event.</p>
          </dd></dl></div>

        <div id="dictionary-peerconnectioneventinit-members" class="section"><h4><span class="secno">10.1.2 </span>Dictionary <a class="idlType" href="#idl-def-PeerConnectionEventInit"><code>PeerConnectionEventInit</code></a> Members</h4><dl class="dictionary-members"><dt id="widl-PeerConnectionEventInit-peer"><code>peer</code> of type <span class="idlMemberType"><a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a></span></dt><dd>
            <p> </p>
          </dd></dl></div>
   </div>

              <div id="peerconnectioniceevent" class="section">
        <h3><span class="secno">10.2 </span>PeerConnectionIceEvent</h3>

                <p>The <code>onicecandidate</code> event of the PeerConnection uses the <code>
            <a href="#idl-def-PeerConnectionIceEvent" class="idlType"><code>PeerConnectionIceEvent</code></a>
          </code> interface.</p>

        <p><dfn title="Fire a track event" id="dfn-fire-a-track-event-1">Firing a PeerConnectionIceEvent event named
        <var>e</var></dfn> with a <code>
            <a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a>
          </code> <var>peer</var> means that an event with the name
        <var>e</var>, which does not bubble (except where otherwise stated)
        and is not cancelable (except where otherwise stated), and which uses
        the <code>PeerConnectionIceEvent</code> interface with the <code>peer
          </code> attribute set to the <var>PeerConnection</var> object, and the
        <code>candidate</code> attribute set to the new ICE candiate 
          <em class="rfc2119" title="must">must</em> be created and
        dispatched at the given target.</p>

        <pre class="idl"><span id="idl-def-PeerConnectionIceEvent" class="idlInterface">[<span class="extAttr">Constructor(DOMString type, PeerConnectionIceEventInit eventInitDict)</span>]
interface <span class="idlInterfaceID">PeerConnectionIceEvent</span> : <span class="idlSuperclass"><a>Event</a></span> {
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a></span> <span class="idlAttrName"><a href="#widl-PeerConnectionIceEvent-peer">peer</a></span>;</span>
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a href="#idl-def-IceCandidate" class="idlType"><code>IceCandidate</code></a></span>   <span class="idlAttrName"><a href="#widl-PeerConnectionIceEvent-candidate">candidate</a></span>;</span>
};</span>
</pre><div id="attributes-8" class="section"><h4><span class="secno">10.2.1 </span>Attributes</h4><dl class="attributes"><dt id="widl-PeerConnectionIceEvent-candidate"><code>candidate</code> of type <span class="idlAttrType"><a href="#idl-def-IceCandidate" class="idlType"><code>IceCandidate</code></a></span>, readonly</dt><dd>
            <p>The 
                <code>candidate</code>
               attribute is the <code>
                <a href="#event-icecandidate" class="internalDFN">IceCandidate</a>
              </code> object with the new ICE candiate that caused the event.</p>
          </dd><dt id="widl-PeerConnectionIceEvent-peer"><code>peer</code> of type <span class="idlAttrType"><a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a></span>, readonly</dt><dd>
            <p>The 
                <code>peer</code>
               attribute represents the <code>
                <a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a>
              </code> object associated with the event.</p>
          </dd></dl></div>

        <pre class="idl"><span id="idl-def-PeerConnectionEventIceInit" class="idlDictionary">dictionary <span class="idlDictionaryID">PeerConnectionEventIceInit</span> : <span class="idlSuperclass"><a>EventInit</a></span> {
<span class="idlMember">    <span class="idlMemberType"><a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a></span> <span class="idlMemberName"><a href="#widl-PeerConnectionEventIceInit-peer">peer</a></span>;</span>
<span class="idlMember">    <span class="idlMemberType"><a href="#idl-def-IceCandidate" class="idlType"><code>IceCandidate</code></a></span>   <span class="idlMemberName"><a href="#widl-PeerConnectionEventIceInit-candidate">candidate</a></span>;</span>
};</span>
</pre><div id="dictionary-peerconnectioneventiceinit-members" class="section"><h4><span class="secno">10.2.2 </span>Dictionary <a class="idlType" href="#idl-def-PeerConnectionEventIceInit"><code>PeerConnectionEventIceInit</code></a> Members</h4><dl class="dictionary-members"><dt id="widl-PeerConnectionEventIceInit-candidate"><code>candidate</code> of type <span class="idlMemberType"><a href="#idl-def-IceCandidate" class="idlType"><code>IceCandidate</code></a></span></dt><dd>
            <p> </p>
          </dd><dt id="widl-PeerConnectionEventIceInit-peer"><code>peer</code> of type <span class="idlMemberType"><a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a></span></dt><dd>
            <p> </p>
          </dd></dl></div>
   </div>

      <div id="mediastreamtrackevent" class="section">
        <h3><span class="secno">10.3 </span>MediaStreamTrackEvent</h3>

        <p>The <code>
            <a href="#event-mediastreamtracklist-addtrack">addtrack</a>
          </code> and <code title="event-MediaStreamTracklist-removetrack">
            <a href="#event-mediastreamtracklist-removetrack">removetrack</a>
          </code> events use the <code>
            <a href="#idl-def-MediaStreamTrackEvent" class="idlType"><code>MediaStreamTrackEvent</code></a>
          </code> interface.</p>

        <p><dfn title="Fire a track event" id="dfn-fire-a-track-event-2">Firing a track event named
        <var>e</var></dfn> with a <code>
            <a>MediaStreamTrack</a>
          </code> <var>track</var> means that an event with the name
        <var>e</var>, which does not bubble (except where otherwise stated)
        and is not cancelable (except where otherwise stated), and which uses
        the <code>
            <a href="#idl-def-MediaStreamTrackEvent" class="idlType"><code>MediaStreamTrackEvent</code></a>
          </code> interface with the <code>
            <a href="#dom-mediastreamtrackevent-track">track</a>
          </code> attribute set to <var>track</var>, <em class="rfc2119" title="must">must</em> be created and
        dispatched at the given target.</p>

        <pre class="idl"><span id="idl-def-MediaStreamTrackEvent" class="idlInterface">[<span class="extAttr">Constructor(DOMString type, MediaStreamTrackEventInit eventInitDict)</span>]
interface <span class="idlInterfaceID">MediaStreamTrackEvent</span> : <span class="idlSuperclass"><a>Event</a></span> {
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a>MediaStreamTrack</a></span> <span class="idlAttrName"><a href="#widl-MediaStreamTrackEvent-track">track</a></span>;</span>
};<br /><span id="idl-def-MediaStreamTrackEventInit" class="idlDictionary">dictionary <span class="idlDictionaryID">MediaStreamTrackEventInit</span> : <span class="idlSuperclass"><a>EventInit</a></span> {
<span class="idlMember">    <span class="idlMemberType"><a>readonly MediaStreamTrack</a>?</span> <span class="idlMemberName"><a href="#widl-MediaStreamTrackEventInit-track">track</a></span>;</span>
};</span></span>
</pre><div id="attributes-9" class="section"><h4><span class="secno">10.3.1 </span>Attributes</h4><dl class="attributes"><dt id="widl-MediaStreamTrackEvent-track"><code>track</code> of type <span class="idlAttrType"><a>MediaStreamTrack</a></span>, readonly</dt><dd>
            <p>The <dfn id="dom-mediastreamtrackevent-track">
                <code>track</code>
              </dfn> attribute represents the <code>
                <a>MediaStreamTrack</a>
              </code> object associated with the event.</p>
          </dd></dl></div>

        <div id="dictionary-mediastreamtrackeventinit-members" class="section"><h4><span class="secno">10.3.2 </span>Dictionary <a class="idlType" href="#idl-def-MediaStreamTrackEventInit"><code>MediaStreamTrackEventInit</code></a> Members</h4><dl class="dictionary-members"><dt id="widl-MediaStreamTrackEventInit-track"><code>track</code> of type <span class="idlMemberType"><a>readonly MediaStreamTrack</a></span>, nullable</dt><dd>
            <p></p>
          </dd></dl></div>
      </div>

      <div id="mediastreamevent" class="section">
        <h3><span class="secno">10.4 </span>MediaStreamEvent</h3>

        <p>The <code>
            <a href="#event-mediastream-addstream">addstream</a>
          </code> and <code title="event-MediaStream-removestream">
            <a href="#event-mediastream-removestream">removestream</a>
          </code> events use the <code>
            <a href="#idl-def-MediaStreamEvent" class="idlType"><code>MediaStreamEvent</code></a>
          </code> interface.</p>

        <p><dfn title="fire a stream event" id="fire-a-stream-event">Firing a
        stream event named <var>e</var></dfn> with a <code>
            <a>MediaStream</a>
          </code> <var>stream</var> means that an event with the name
        <var>e</var>, which does not bubble (except where otherwise stated)
        and is not cancelable (except where otherwise stated), and which uses
        the <code>
            <a href="#idl-def-MediaStreamEvent" class="idlType"><code>MediaStreamEvent</code></a>
          </code> interface with the <code>
            <a href="#dom-mediastreamevent-stream">stream</a>
          </code> attribute set to <var title="">stream</var>, <em class="rfc2119" title="must">must</em> be created
        and dispatched at the given target.</p>

        <pre class="idl"><span id="idl-def-MediaStreamEvent" class="idlInterface">[<span class="extAttr">Constructor(DOMString type, MediaStreamEventInit eventInitDict)</span>]
interface <span class="idlInterfaceID">MediaStreamEvent</span> : <span class="idlSuperclass"><a>Event</a></span> {
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a>MediaStream</a>?</span> <span class="idlAttrName"><a href="#widl-MediaStreamEvent-stream">stream</a></span>;</span>
};<br /><span id="idl-def-MediaStreamEventInit" class="idlDictionary">dictionary <span class="idlDictionaryID">MediaStreamEventInit</span> : <span class="idlSuperclass"><a>EventInit</a></span> {
<span class="idlMember">    <span class="idlMemberType"><a>MediaStream</a></span> <span class="idlMemberName"><a href="#widl-MediaStreamEventInit-stream">stream</a></span>;</span>
};</span></span>
</pre><div id="attributes-10" class="section"><h4><span class="secno">10.4.1 </span>Attributes</h4><dl class="attributes"><dt id="widl-MediaStreamEvent-stream"><code>stream</code> of type <span class="idlAttrType"><a>MediaStream</a></span>, readonly, nullable</dt><dd>
            <p>The <dfn id="dom-mediastreamevent-stream">
                <code>stream</code>
              </dfn> attribute represents the <code>
                <a>MediaStream</a>
              </code> object associated with the event.</p>
          </dd></dl></div>

        <div id="dictionary-mediastreameventinit-members" class="section"><h4><span class="secno">10.4.2 </span>Dictionary <a class="idlType" href="#idl-def-MediaStreamEventInit"><code>MediaStreamEventInit</code></a> Members</h4><dl class="dictionary-members"><dt id="widl-MediaStreamEventInit-stream"><code>stream</code> of type <span class="idlMemberType"><a>MediaStream</a></span></dt><dd>
            <p></p>
          </dd></dl></div>
      </div>

      <div id="datachannelevent" class="section">
        <h3><span class="secno">10.5 </span>DataChannelEvent</h3>

        <p>The <code>
            <a href="#event-peerconnection-datachannel">datachannel</a>
          </code> event use the <code>
            <a href="#idl-def-DataChannelEvent" class="idlType"><code>DataChannelEvent</code></a>
          </code> interface.</p>

        <p><dfn title="fire a datachannel event" id="fire-a-datachannel-event">Firing a datachannel event named
        <var>e</var></dfn> with a <code>
            <a href="#idl-def-DataChannel" class="idlType"><code>DataChannel</code></a>
          </code> <var>channel</var> means that an event with the name
        <var>e</var>, which does not bubble (except where otherwise stated)
        and is not cancelable (except where otherwise stated), and which uses
        the <code>
            <a href="#idl-def-DataChannelEvent" class="idlType"><code>DataChannelEvent</code></a>
          </code> interface with the <code>
            <a href="#dom-datachannelevent-channel">channel</a>
          </code> attribute set to <var>channel</var>, <em class="rfc2119" title="must">must</em> be created and
        dispatched at the given target.</p>

        <pre class="idl"><span id="idl-def-DataChannelEvent" class="idlInterface">[<span class="extAttr">Constructor(DOMString type, DataChannelEventInit eventInitDict)</span>]
interface <span class="idlInterfaceID">DataChannelEvent</span> : <span class="idlSuperclass"><a>Event</a></span> {
<span class="idlAttribute">    readonly attribute <span class="idlAttrType"><a href="#idl-def-DataChannel" class="idlType"><code>DataChannel</code></a></span> <span class="idlAttrName"><a href="#widl-DataChannelEvent-channel">channel</a></span>;</span>
};<br /><span id="idl-def-DataChannelEventInit" class="idlDictionary">dictionary <span class="idlDictionaryID">DataChannelEventInit</span> : <span class="idlSuperclass"><a>EventInit</a></span> {
<span class="idlMember">    <span class="idlMemberType"><a href="#idl-def-DataChannel" class="idlType"><code>DataChannel</code></a></span> <span class="idlMemberName"><a href="#widl-DataChannelEventInit-channel">channel</a></span>;</span>
};</span></span>
</pre><div id="attributes-11" class="section"><h4><span class="secno">10.5.1 </span>Attributes</h4><dl class="attributes"><dt id="widl-DataChannelEvent-channel"><code>channel</code> of type <span class="idlAttrType"><a href="#idl-def-DataChannel" class="idlType"><code>DataChannel</code></a></span>, readonly</dt><dd>
            <p>The <dfn id="dom-datachannelevent-channel">
                <code>channel</code>
              </dfn> attribute represents the <code>
                <a href="#idl-def-DataChannel" class="idlType"><code>DataChannel</code></a>
              </code> object associated with the event.</p>
          </dd></dl></div>

        <div id="dictionary-datachanneleventinit-members" class="section"><h4><span class="secno">10.5.2 </span>Dictionary <a class="idlType" href="#idl-def-DataChannelEventInit"><code>DataChannelEventInit</code></a> Members</h4><dl class="dictionary-members"><dt id="widl-DataChannelEventInit-channel"><code>channel</code> of type <span class="idlMemberType"><a href="#idl-def-DataChannel" class="idlType"><code>DataChannel</code></a></span></dt><dd></dd></dl></div>
      </div>
    </div>

    <div class="informative section" id="event-summary">
      
<!-- OddPage -->
<h2><span class="secno">11. </span>Event summary</h2><p><em>This section is non-normative.</em></p>

      <p>The following event fires on <code>
          <a>MediaStream</a>
        </code> objects:</p>

      <table>
        <tbody><tr>
          <th>Event name</th>

          <th>Interface</th>

          <th>Fired when...</th>
        </tr>

        </tbody><tbody>
          <tr>
            <td>
              <dfn id="event-mediastream-ended">
                <code>ended</code>
              </dfn>
            </td>

            <td>
              <code>Event</code>
            </td>

            <td>The <code>
                <a>MediaStream</a>
              </code> <a>finished</a> as a result of all tracks in the <code>
                <a>MediaStream</a>
              </code> <a title="ended" href="#event-mediastreamtrack-ended" class="internalDFN">ending</a>.</td>
          </tr>
        </tbody>
      </table>

      <p>The following event fires on <code>
          <a>MediaStreamTrack</a>
        </code> objects:</p>

      <table>
        <tbody><tr>
          <th>Event name</th>

          <th>Interface</th>

          <th>Fired when...</th>
        </tr>

        </tbody><tbody>
          <tr>
            <td>
              <dfn id="event-mediastreamtrack-muted">
                <code>muted</code>
              </dfn>
            </td>

            <td>
              <code>Event</code>
            </td>

            <td>The <code>
                <a>MediaStreamTrack</a>
              </code> object's source is temporarily unable to provide
            data.</td>
          </tr>

          <tr>
            <td>
              <dfn id="event-mediastreamtrack-unmuted">
                <code>unmuted</code>
              </dfn>
            </td>

            <td>
              <code>Event</code>
            </td>

            <td>The <code>
                <a>MediaStreamTrack</a>
              </code> object's source is live again after having been
            temporarily unable to provide data.</td>
          </tr>

          <tr>
            <td>
              <dfn id="event-mediastreamtrack-ended">
                <code>ended</code>
              </dfn>
            </td>

            <td>
              <code>Event</code>
            </td>

            <td>The <code>
                <a>MediaStreamTrack</a>
              </code> object's source will no longer provide any data, either
            because the user revoked the permissions, or because the source
            device has been ejected, or because the remote peer stopped
            sending data, or because the <code>
                <a href="#dom-mediastream-stop">stop()</a>
              </code> method was invoked.</td>
          </tr>
        </tbody>
      </table>

      <p>The following event fires on <code>
          <a>MediaStreamTrackList</a>
        </code> objects:</p>

      <table>
        <tbody><tr>
          <th>Event name</th>

          <th>Interface</th>

          <th>Fired when...</th>
        </tr>

        </tbody><tbody>
          <tr>
            <td>
              <dfn id="event-mediastreamtracklist-addtrack">
                <code>addtrack</code>
              </dfn>
            </td>

            <td>
              <code>
                <a href="#idl-def-MediaStreamTrackEvent" class="idlType"><code>MediaStreamTrackEvent</code></a>
              </code>
            </td>

            <td>A new <code>
                <a>MediaStreamTrack</a>
              </code> has been added to this list.</td>
          </tr>

          <tr>
            <td>
              <dfn id="event-mediastreamtracklist-removetrack">
                <code>removetrack</code>
              </dfn>
            </td>

            <td>
              <code>
                <a href="#idl-def-MediaStreamTrackEvent" class="idlType"><code>MediaStreamTrackEvent</code></a>
              </code>
            </td>

            <td>A <code>
                <a>MediaStreamTrack</a>
              </code> has been removed from this list.</td>
          </tr>
        </tbody>
      </table>

        <p>The following event fires on <code>
          <a href="#idl-def-DataChannel" class="idlType"><code>DataChannel</code></a>
        </code> objects:</p>

      <table>
        <tbody><tr>
          <th>Event name</th>

          <th>Interface</th>

          <th>Fired when...</th>
        </tr>

        </tbody><tbody>

          
          <tr>
            <td>
              <dfn id="event-datachannel-open">
              <code>open</code>
              </dfn>
            </td>
            
            <td>
              <code>
              <a>Event</a>
              </code>
            </td>
            
            <td>  The <code><a href="#idl-def-DataChannel" class="idlType"><code>DataChannel</code></a></code> object’s <a href="#dfn-underlying-data-transport" class="internalDFN">underlying data
            transport</a> has been established (or re-established).</td>
          </tr>

          <tr>
            <td>
              <dfn id="event-datachannel-message">
              <code>MessageEvent</code>
              </dfn>
            </td>
            
            <td>
              <code>
              <a>Event</a>
              </code>
            </td>
            
            <td>A message was successfully received. TODO: Ref where MessageEvent
          is defined? </td>
          </tr>

          <tr>
            <td>
              <dfn id="event-datachannel-error">
              <code>error</code>
              </dfn>
            </td>
            
            <td>
              <code>
              <a>Event</a>
              </code>
            </td>
            
            <td>TODO.</td>
          </tr>

          <tr>
            <td>
              <dfn id="event-datachannel-close">
              <code>close</code>
              </dfn>
            </td>
            
            <td>
              <code>
              <a>Event</a>
              </code>
            </td>
            
            <td> The <code><a href="#idl-def-DataChannel" class="idlType"><code>DataChannel</code></a></code> object’s <a href="#dfn-underlying-data-transport" class="internalDFN">underlying data
            transport</a> has was closed.</td>
          </tr>


          
        
        </tbody>
      </table>

      
      <p>The following events fire on <code>
          <a href="#idl-def-PeerConnection" class="idlType"><code>PeerConnection</code></a>
        </code> objects:</p>

      <table>
        <tbody><tr>
          <th>Event name</th>

          <th>Interface</th>

          <th>Fired when...</th>
        </tr>

        </tbody><tbody>
          <tr>
            <td>
              <dfn id="event-mediastream-connecting">
                <code>connecting</code>
              </dfn>
            </td>

            <td>
              <code>Event</code>
            </td>

            <td>TODO</td>
          </tr>

          <tr>
            <td>
              <dfn id="event-mediastream-open">
                <code>open</code>
              </dfn>
            </td>

            <td>
              <code>Event</code>
            </td>

            <td>TODO</td>
          </tr>

          
<!-- 
        <tr>
          <td><dfn title="event-MediaStream-error"><code>error</code></dfn></td>
          <td><code>Event</code></td>
          <td></td>
        </tr>
        <tr>
          <td><dfn title="event-MediaStream-close"><code>close</code></dfn></td>
          <td><code>Event</code></td>
          <td>The <code title="dom-PeerConnection-close">close()</code> method was
            called. </td>
          </tr>
           -->


          
<!-- 
          <tr>
            <td>
              <dfn id="event-mediastream-message">
                <code>message</code>
              </dfn>
            </td>

            <td>
              <code>MessageEvent</code>
            </td>

            <td>A <a href="#data-udp-media-stream">data UDP media
            stream</a> message was received.</td>
          </tr>
           -->

          
          <tr>
            <td>
              <dfn id="event-mediastream-addstream">
                <code>addstream</code>
              </dfn>
            </td>

            <td>
              <code>
                <a href="#idl-def-MediaStreamEvent" class="idlType"><code>MediaStreamEvent</code></a>
              </code>
            </td>

            <td>A new stream has been added to the <code title="dom-PeerConnection-remoteStreams">
                <a href="#widl-PeerConnection-remoteStreams">remoteStreams</a>
              </code> array.</td>
          </tr>

          <tr>
            <td>
              <dfn id="event-mediastream-removestream">
                <code>removestream</code>
              </dfn>
            </td>

            <td>
              <code>
                <a href="#idl-def-MediaStreamEvent" class="idlType"><code>MediaStreamEvent</code></a>
              </code>
            </td>

            <td>A stream has been removed from the <code title="dom-PeerConnection-remoteStreams">
                <a href="#widl-PeerConnection-remoteStreams">remoteStreams</a>
              </code> array.</td>
          </tr>

          <tr>
            <td>
              <dfn id="event-renegotiation">
                <code>renegotiationneeded</code>
              </dfn>
            </td>

            <td>
              <code>
                <a href="#idl-def-PeerConnectionEvent" class="idlType"><code>PeerConnectionEvent</code></a>
              </code>
            </td>

            <td>The browser wishes to inform the application that session
            negotiation needs to be redone at some point in the near future.
            Open Issue: should this be moved to &quot;Negotiation Needed&quot; instead
            of &quot;Re-Negotiation Needed&quot;? </td>
          </tr>


            <tr>
            <td>
              <dfn id="event-statechange">
                <code>statechange</code>
              </dfn>
            </td>

            <td>
              <code>
                <a href="#idl-def-PeerConnectionEvent" class="idlType"><code>PeerConnectionEvent</code></a>
              </code>
            </td>

            <td> TODO </td>
          </tr>


               <tr>
            <td>
              <dfn id="event-icechange">
                <code>icechange</code>
              </dfn>
            </td>

            <td>
              <code>
                <a href="#idl-def-PeerConnectionEvent" class="idlType"><code>PeerConnectionEvent</code></a>
              </code>
            </td>

            <td> TODO </td>
          </tr>

          <tr>
            <td>
              <dfn id="event-icecandidate">
              <code>icecandidate</code>
              </dfn>
            </td>

            <td>
              <code>
              <a href="#idl-def-PeerConnectionIceEvent" class="idlType"><code>PeerConnectionIceEvent</code></a>
              </code>
            </td>
            
            <td> TODO </td>
          </tr>


        </tbody>
      </table>
    </div>

    <div id="change-log" class="section">
      
<!-- OddPage -->
<h2><span class="secno">12. </span>Change Log</h2>

      <p> This section will be removed before publication. </p>

      <h3 id="changes-since-may-28--2012"> Changes since May 28, 2012 </h3>

      <ol>
        <li> TODO </li>
      </ol>

      
      <h3 id="changes-since-april-27--2012"> Changes since April 27, 2012 </h3>

      <ol>
        <li> Major rewrite of PeerConnection section to line up with IETF JSEP
        draft.  </li>

        <li>Added simple PeerConnection example. Initial update of
        SessionDescription and IceCandidate to support serialization and
        construction.</li>
      </ol>

      <h3 id="changes-since-21-april-2012">Changes since 21 April 2012</h3>

      <ol>
        <li>Moved MediaStream and related definitions to getUserMedia.</li>

        <li>Removed some left-overs from the old Data Stream API.</li>

        <li>Initial import of new Data API.</li>

        <li>Renamed &quot;underlying data channel&quot; to &quot;underlying data transport&quot;.
        Fixed closing procedures. Fixed some typos.</li>
      </ol>

      <h3 id="changes-since-12-january-2012"> Changes since 12 January 2012</h3>

      <ol>
        <li> Clarified the relation of Stream, Track, and Channel. </li>
      </ol>

      <h3 id="changes-since-17-october-2011"> Changes since 17 October 2011</h3>

      <ol>
        <li>Tweak the introduction text and add a reference to the IETF RTCWEB
        group.</li>

        <li>Changed the first argument to getUserMedia to be an object.</li>

        <li>Added a MediaStreamHints object as a second argument to
        PeerConnection.addStream.</li>

        <li>Added AudioMediaStreamTrack class and DTMF interface.</li>
      </ol>

      <h3 id="changes-since-23-august-2011"> Changes since 23 August 2011</h3>

      <ol>
        <li> Separated the SDP and ICE Agent into separate agents and added
        explicit state attributes for each. </li>

        <li> Removed the send method from PeerConenction and associated
        callback function. </li>

        <li>Modified MediaStream() constructor to take a list of
        MediaStreamTrack objects instead of a MediaStream. Removed text about
        MediaStream parent and child relationship.</li>

        <li>Added abstract.</li>

        <li>Moved a few paragraphs from the MediaStreamTrack.label section to
        the MediaStream.label section (where they belong).</li>

        <li>Split MediaStream.tracks into MediaStream.audioTracks and
        MediaStream.videoTracks.</li>

        <li>Removed a sentence that implied that track access is limited to
        LocalMediaStream.</li>

        <li>Updated a few getUserMedia()-examples to use
        MediaStreamOptions.</li>

        <li>Replaced calls to URL.getObjectURL() with URL.createObjectURL() in
        example code.</li>

        <li>Fixed some broken getUserMedia() links.</li>

        <li>Introduced state handling on MediaStreamTrack (removed state
        handling from MediaStream).</li>

        <li>Reintroduced onended on MediaStream to simplify checking if all
        tracks are ended.</li>

        <li>Aligned the MediaStreamTrack ended event dispatching behavior with
        that of MediaStream.</li>

        <li>Updated the LocalMediaStream.stop() algorithm to implicitly use
        the end track algorithm.</li>

        <li>Replaced an occurrence the term finished track with ended track
        (to align with rest of spec).</li>

        <li>Moved (and extended) the explanation about track references and
        media sources from LocalMediaStream to MediaStreamTrack.</li>

        <li>Removed section &quot;Obtaining local multimedia content&quot;.</li>

        <li>Updated getUserMedia() calls in examples (changes in Media Capture
        TF spec).</li>

        <li>Introduced MediaStreamTrackList interface with support for adding
        and removing tracks.</li>

        <li>Updated the algorithm that is run when PeerConnection receives a
        stream (create new stream when negotiated instead of when data
        arrives).</li>
      </ol>
    </div>

    <div class="appendix section" id="acknowledgements">
      
<!-- OddPage -->
<h2><span class="secno">A. </span>Acknowledgements</h2>

      <p>The editors wish to thank the Working Group chairs, Harald Alvestrand
      and Stefan Håkansson, for their support.</p>
    </div>
  

<div id="references" class="appendix section">
<!-- OddPage -->
<h2><span class="secno">B. </span>References</h2><div id="normative-references" class="section"><h3><span class="secno">B.1 </span>Normative references</h3><dl class="bibliography"><dt id="bib-GETUSERMEDIA">[GETUSERMEDIA]</dt><dd>D. Burnett, A. Narayanan. <a href="http://dev.w3.org/2011/webrtc/editor/getusermedia.html"><cite>getusermedia: Getting access to local devices that can generate multimedia streams</cite></a> 22 December 2011. W3C Editors draft (Work in progress.) URL: <a href="http://dev.w3.org/2011/webrtc/editor/getusermedia.html">http://dev.w3.org/2011/webrtc/editor/getusermedia.html</a> 
</dd><dt id="bib-ICE">[ICE]</dt><dd>J. Rosenberg. <a href="http://tools.ietf.org/html/rfc5245"><cite>Interactive Connectivity Establishment (ICE): A Protocol for Network Address Translator (NAT) Traversal for Offer/Answer Protocols.</cite></a> April 2010. Internet RFC 5245. URL: <a href="http://tools.ietf.org/html/rfc5245">http://tools.ietf.org/html/rfc5245</a>
</dd><dt id="bib-RFC2119">[RFC2119]</dt><dd>S. Bradner. <a href="http://www.ietf.org/rfc/rfc2119.txt"><cite>Key words for use in RFCs to Indicate Requirement Levels.</cite></a> March 1997. Internet RFC 2119.  URL: <a href="http://www.ietf.org/rfc/rfc2119.txt">http://www.ietf.org/rfc/rfc2119.txt</a> 
</dd><dt id="bib-RTCWEB-CONSTRAINTS">[RTCWEB-CONSTRAINTS]</dt><dd>D. Burnett. <a href="http://datatracker.ietf.org/doc/draft-burnett-rtcweb-constraints-registry/"><cite>IANA Registry for RTCWeb Media Constraints.</cite></a> URL: <a href="http://datatracker.ietf.org/doc/draft-burnett-rtcweb-constraints-registry/">http://datatracker.ietf.org/doc/draft-burnett-rtcweb-constraints-registry/</a> 
</dd><dt id="bib-SDP">[SDP]</dt><dd>J. Rosenberg, H. Schulzrinne. <a href="http://tools.ietf.org/html/rfc3264"><cite>An Offer/Answer Model with the Session Description Protocol (SDP).</cite></a> June 2002. Internet RFC 3264. URL: <a href="http://tools.ietf.org/html/rfc3264">http://tools.ietf.org/html/rfc3264</a>
</dd><dt id="bib-STUN">[STUN]</dt><dd>J. Rosenberg, R. Mahy, P. Matthews, D. Wing. <a href="http://tools.ietf.org/html/rfc5389"><cite>Session Traversal Utilities for NAT (STUN).</cite></a> October 2008. Internet RFC 5389. URL: <a href="http://tools.ietf.org/html/rfc5389">http://tools.ietf.org/html/rfc5389</a>
</dd><dt id="bib-STUN-URI">[STUN-URI]</dt><dd>S. Nandakumar,  G. Salgueiro, P. Jones, and M. Petit-Huguenin. <a href="http://tools.ietf.org/html/draft-nandakumar-rtcweb-stun-uri"><cite>URI Scheme for Session Traversal Utilities for NAT (STUN) Protocol.</cite></a> 12 March 2012. Internet Draft (work in progress). URL: <a href="http://tools.ietf.org/html/draft-nandakumar-rtcweb-stun-uri">http://tools.ietf.org/html/draft-nandakumar-rtcweb-stun-uri</a> 
</dd><dt id="bib-TURN">[TURN]</dt><dd>P. Mahy, P. Matthews, J. Rosenberg. <a href="http://tools.ietf.org/html/rfc5766"><cite>Traversal Using Relays around NAT (TURN): Relay Extensions to Session Traversal Utilities for NAT (STUN).</cite></a> April 2010. Internet RFC 5766. URL: <a href="http://tools.ietf.org/html/rfc5766">http://tools.ietf.org/html/rfc5766</a>
</dd><dt id="bib-TURN-URI">[TURN-URI]</dt><dd>M. Petit-Huguenin, S. Nandakumar,  G. Salgueiro, and  P. Jones. <a href="http://tools.ietf.org/html/draft-petithuguenin-behave-turn-uris"><cite>Traversal Using Relays around NAT (TURN) Uniform Resource Identifiers.</cite></a> 12 March 2012. Internet Draft (work in progress). URL: <a href="http://tools.ietf.org/html/draft-petithuguenin-behave-turn-uris">http://tools.ietf.org/html/draft-petithuguenin-behave-turn-uris</a> 
</dd><dt id="bib-WEBIDL">[WEBIDL]</dt><dd>Cameron McCormack. <a href="http://www.w3.org/TR/2011/WD-WebIDL-20110927/"><cite>Web IDL.</cite></a> 27 September 2011. W3C Working Draft. (Work in progress.) URL: <a href="http://www.w3.org/TR/2011/WD-WebIDL-20110927/">http://www.w3.org/TR/2011/WD-WebIDL-20110927/</a> 
</dd></dl></div><div id="informative-references" class="section"><h3><span class="secno">B.2 </span>Informative references</h3><dl class="bibliography"><dt id="bib-RTCWEB-JSEP">[RTCWEB-JSEP]</dt><dd>J. Uberti, C. Jennings. <a href="http://datatracker.ietf.org/doc/draft-ietf-rtcweb-jsep/"><cite>Javascript Session Establishment Protocol.</cite></a> URL: <a href="http://datatracker.ietf.org/doc/draft-ietf-rtcweb-jsep/">http://datatracker.ietf.org/doc/draft-ietf-rtcweb-jsep/</a> 
</dd></dl></div></div></body></html>
