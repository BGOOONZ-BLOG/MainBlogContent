(function(){var h={"extends":function(a,c){c.prototype=new a},stackCounterLimit:1E3,stackCounter:0};h.recur=function(a){h.stackCounter===h.stackCounterLimit?(h.stackCounter=0,setTimeout(a,0)):(h.stackCounter++,a())};h.clone=function(a){return JSON.parse(JSON.stringify(a))};h.shuffle=function(a){for(var c,b,g=a.length;g;c=parseInt(Math.random()*g),b=a[--g],a[g]=a[c],a[c]=b);return a};h.include=function(a,b,d){for(var g=a.length-1;g>=0;g--){var j=!1,j=d==null?a[g]===b:d(a[g],b)===0;if(j===!0)return!0}return!1};
h.remove=function(a,b){for(var d=[],g=0;g<a.length;g++)a[g]!==b&&d.push(a[g]);return d};h.repeat=function(a,b,d,g,j){arguments.length===4&&(j={});a<b?(j._i=a,d(function(d,e){h.recur(function(){h.repeat(a+1,b,d,g,e)})},j)):g(j)};h.meanwhile=function(a,b,d,g){arguments.length===3&&(g={});g._stack_counter==null&&(g._stack_counter=0);a===!0?b(function(a,b,c){c._stack_counter%40==39?(c._stack_counter+=1,setTimeout(function(){h.neanwhile(a,b,d,c)},0)):(c._stack_counter+=1,h.meanwhile(a,b,d,c))},g):d(g)};
h.seq=function(){var a=arguments;return function(b){h.repeat(0,a.length,function(b,c){var j=arguments.callee;a[c._i](function(){b(j,c)})},function(){b()})}};h.partition=function(a,b){for(var d=a.length%b,g=[],j=0;j<d;j++)g.push(null);d=[];for(j=0;j<a.length;j++)g.push(a[j]),g.length%b==0&&(d.push(g),g=[]);return d};h.keys=function(a){var b=[],d;for(d in a)b.push(d);return b};h.iso8601=function(a){function b(a){return a<10?"0"+a:a}return a.getUTCFullYear()+"-"+b(a.getUTCMonth()+1)+"-"+b(a.getUTCDate())+
"T"+b(a.getUTCHours())+":"+b(a.getUTCMinutes())+":"+b(a.getUTCSeconds())+"Z"};h.parseStrictISO8601=function(a){var b=a.match(RegExp("([0-9]{4})(-([0-9]{2})(-([0-9]{2})(T([0-9]{2}):([0-9]{2})(:([0-9]{2})(.([0-9]+))?)?(Z|(([-+])([0-9]{2}):([0-9]{2})))?)?)?)?")),a=0,d=new Date(b[1],0,1);if(b[3])d.setMonth(b[3]-1);else throw"missing ISO8061 component";if(b[5])d.setDate(b[5]);else throw"missing ISO8061 component";if(b[7])d.setHours(b[7]);else throw"missing ISO8061 component";if(b[8])d.setMinutes(b[8]);
else throw"missing ISO8061 component";if(b[10])d.setSeconds(b[10]);else throw"missing ISO8061 component";b[12]&&d.setMilliseconds(Number("0."+b[12])*1E3);b[14]&&(a=Number(b[16])*60+Number(b[17]),a*=b[15]=="-"?1:-1);a-=d.getTimezoneOffset();b=new Date;b.setTime(Number(Number(d)+a*6E4));return b};h.parseISO8601=function(a){var b=a.match(RegExp("([0-9]{4})(-([0-9]{2})(-([0-9]{2})(T([0-9]{2}):([0-9]{2})(:([0-9]{2})(.([0-9]+))?)?(Z|(([-+])([0-9]{2}):([0-9]{2})))?)?)?)?")),a=0,d=new Date(b[1],0,1);b[3]&&
d.setMonth(b[3]-1);b[5]&&d.setDate(b[5]);b[7]&&d.setHours(b[7]);b[8]&&d.setMinutes(b[8]);b[10]&&d.setSeconds(b[10]);b[12]&&d.setMilliseconds(Number("0."+b[12])*1E3);b[14]&&(a=Number(b[16])*60+Number(b[17]),a*=b[15]=="-"?1:-1);a-=d.getTimezoneOffset();b=new Date;b.setTime(Number(Number(d)+a*6E4));return b};h.parseISO8601Components=function(a){var a=a.match(RegExp("([0-9]{4})(-([0-9]{2}))(-([0-9]{2}))(T([0-9]{2}):([0-9]{2})(:([0-9]{2}))?(.([0-9]+))?)?(Z|([-+])([0-9]{2})(:([0-9]{2}))?)?")),b,d,g,j,i,
e,f,h;b=Number(a[1]);d=a[3]-1;g=Number(a[5]);j=Number(a[7]);i=Number(a[8]);e=Number(a[10]);a[12]&&(f=Number("0."+a[12])*1E3);a[13]==="Z"?h=0:a[14]?(h=0,a[17]&&(h=Number(a[17])),h+=Number(a[15])*60,h*=a[14]=="-"?-1:1):a[14]==null&&a[11]&&(h=Number(a[12])*60);return{year:isNaN(b)?null:b,month:isNaN(d)?null:d,date:isNaN(g)?null:g,hours:isNaN(j)?null:j,minutes:isNaN(i)?null:i,seconds:isNaN(e)?null:e,millisecs:isNaN(f)?null:f,timezone:isNaN(h)?null:h}};h.compareDateComponents=function(a,b){var d=h.parseISO8601Components(a),
g=h.parseISO8601Components(b);if(d.timezone==null&&g.timezone==null||d.timezone!=null&&g.timezone!=null)return d=h.parseISO8601(a),g=h.parseISO8601(b),d.getTime()==g.getTime()?0:d.getTime()<g.getTime()?-1:1;else if(d.timezone!=null&&g.timezone==null){var d=h.parseISO8601(a),g=h.parseISO8601(b),d=d.getTime(),g=g.getTime(),j=50400;return d<g&&d<g+j?-1:d>g&&d>g-j?1:null}else return d=h.parseISO8601(a),g=h.parseISO8601(b),d=d.getTime(),g=g.getTime(),j=50400,d<g&&d+j<g?-1:d>g&&d+j>g?1:null};h.lexicalFormLiteral=
function(a,b){var d=a.value,g=a.lang,j=a.type,i=null;if(d!=null&&j!=null&&typeof j!="string"){d=j.value;if(d==null)d=j.suffix,j=b.namespaces[j.prefix],a.type=j+d,d=j+d;i=d.indexOf("hexBinary")!=-1?'"'+a.value.toLowerCase()+'"^^<'+d+">":'"'+a.value+'"^^<'+d+">"}else i=g==null&&j==null?'"'+d+'"':j==null?'"'+d+'"@'+g:j.indexOf("hexBinary")!=-1?'"'+a.value.toLowerCase()+'"^^<'+j+">":'"'+a.value+'"^^<'+j+">";return i};h.lexicalFormBaseUri=function(a,b){var d=null,b=b||{};if(a.value==null)var d=a.prefix,
g=a.suffix,j=b.namespaces[d],d=j!=null?j+g:d+":"+g;else d=a.value;if(d===null)return null;else d.indexOf(":")==-1&&(d=(b.base||"")+d);return d};h.lexicalFormTerm=function(a,b){if(a.token==="uri")return{uri:h.lexicalFormBaseUri(a,b)};else if(a.token==="literal")return{literal:h.lexicalFormLiteral(a,b)};else if(a.token==="blank")return{blank:"_:"+a.value};else throw"Error, cannot get lexical form of unknown token: "+a.token;};h.normalizeUnicodeLiterals=function(a){for(var b=a.match(/\\u[0-9abcdefABCDEF]{4,4}/g)||
[],d={},g=0;g<b.length;g++)d[b[g]]==null&&(d[b[g]]=!0,a=a.replace(RegExp("\\"+b[g],"g"),eval("'"+b[g]+"'")));return a};h.hashTerm=function(a){try{if(a==null)return"";if(a.token==="uri")return"u"+a.value;else if(a.token==="blank")return"b"+a.value;else if(a.token==="literal"){var b="l"+a.value;b+=a.type||"";b+=a.lang||"";return b}}catch(d){if(typeof a==="object"){b="";for(p in a)b=b+p+a[p];return b}return a}};var f={defaultContext:{rdf:"http://www.w3.org/1999/02/22-rdf-syntax-ns#",rdfs:"http://www.w3.org/2000/01/rdf-schema#",
owl:"http://www.w3.org/2002/07/owl#",xsd:"http://www.w3.org/2001/XMLSchema#",dcterms:"http://purl.org/dc/terms/",foaf:"http://xmlns.com/foaf/0.1/",cal:"http://www.w3.org/2002/12/cal/ical#",vcard:"http://www.w3.org/2006/vcard/ns# ",geo:"http://www.w3.org/2003/01/geo/wgs84_pos#",cc:"http://creativecommons.org/ns#",sioc:"http://rdfs.org/sioc/ns#",doap:"http://usefulinc.com/ns/doap#",com:"http://purl.org/commerce#",ps:"http://purl.org/payswarm#",gr:"http://purl.org/goodrelations/v1#",sig:"http://purl.org/signature#",
ccard:"http://purl.org/commerce/creditcard#"},UrisMap:function(){this.defaultNs="";this.interfaceProperties=["get","remove","set","setDefault","addAll","resolve","shrink"]}};f.UrisMap.prototype.values=function(){var a={},b;for(b in this)!h.include(this.interfaceProperties,b)&&typeof this[b]!=="function"&&b!=="defaultNs"&&b!=="interfaceProperties"&&(a[b]=this[b]);return a};f.UrisMap.prototype.get=function(a){if(a.indexOf(" ")!=-1)throw"Prefix must not contain any whitespaces";return this[a]};f.UrisMap.prototype.remove=
function(a){if(a.indexOf(" ")!=-1)throw"Prefix must not contain any whitespaces";delete this[a];return null};f.UrisMap.prototype.set=function(a,b){if(a.indexOf(" ")!=-1)throw"Prefix must not contain any whitespaces";this[a]=b};f.UrisMap.prototype.setDefault=function(a){this.defaultNs=a};f.UrisMap.prototype.addAll=function(a,b){for(var d in a)h.include(this.interfaceProperties,d)||(this[d]!=null?b===!0&&(this[d]=a[d]):this[d]=a[d]);return this};f.UrisMap.prototype.resolve=function(a){var b=a.split(":"),
a=b[0],b=b[1];return a===""?this.defaultNs==null?null:this.defaultNs+b:this.hasOwnProperty(a)?this[a]+b:null};f.UrisMap.prototype.shrink=function(a){for(var b in this){var d=this[b];if(a.indexOf(d)===0&&d!==""&&b!="defaultNs")return a=a.split(d)[1],b+":"+a}return a};f.Profile=function(){this.prefixes=new f.UrisMap;this.terms=new f.UrisMap};f.Profile.prototype.importProfile=function(a,b){this.prefixes.addAll(a.prefixes,b);this.terms.addAll(a.terms,b)};f.Profile.prototype.resolve=function(a){return a.indexOf(":")!=
-1?this.prefixes.resolve(a):this.terms[a]!=null?this.terms.resolve(a):null};f.Profile.prototype.setDefaultPrefix=function(a){this.prefixes.setDefault(a)};f.Profile.prototype.setDefaultVocabulary=function(a){this.terms.setDefault(a)};f.Profile.prototype.setPrefix=function(a,b){this.prefixes.set(a,b)};f.Profile.prototype.setTerm=function(a,b){this.terms.set(a,b)};f.RDFEnvironment=function(){this.blankNodeCounter=0;var a=this;this.filters={s:function(a){return function(b){return b.subject.equals(a)}},
p:function(a){return function(b){return b.predicate.equals(a)}},o:function(a){return function(b){return b.object.equals(a)}},sp:function(a,b){return function(c){return c.subject.equals(a)&&c.predicate.equals(b)}},so:function(a,b){return function(c){return c.subject.equals(a)&&c.object.equals(b)}},po:function(a,b){return function(c){return c.predicate.equals(a)&&c.object.equals(b)}},spo:function(a,b,c){return function(i){return i.subject.equals(a)&&i.predicate.equals(b)&&i.object.equals(c)}},describes:function(a){return function(b){return b.subject.equals(a)||
b.object.equals(a)}},type:function(b){var c=a.resolve("rdf:type");return function(a){return a.predicate.equals(c)&&a.object.equals(b)}}};for(var b in f.defaultContext)this.prefixes.set(b,f.defaultContext[b])};h["extends"](f.Profile,f.RDFEnvironment);f.RDFEnvironment.prototype.createBlankNode=function(){var a=new f.BlankNode(this.blankNodeCounter);this.blankNodeCounter++;return a};f.RDFEnvironment.prototype.createNamedNode=function(a){var b=this.resolve(a);return b!=null?new f.NamedNode(b):new f.NamedNode(a)};
f.RDFEnvironment.prototype.createLiteral=function(a,b,d){return d!=null?new f.Literal(a,b,d.toString()):new f.Literal(a,b,d)};f.RDFEnvironment.prototype.createTriple=function(a,b,d){return new f.Triple(a,b,d)};f.RDFEnvironment.prototype.createGraph=function(a){var b=new f.Graph;if(a!=null)for(var d=0;d<a.length;d++)b.add(a[d]);return b};f.RDFEnvironment.prototype.createAction=function(a,b){return function(d){return a(d)?b(d):d}};f.RDFEnvironment.prototype.createProfile=function(a){return a===!0?new f.RDFEnvironment.Profile:
(a=new f.RDFEnvironment.Profile,a.importProfile(this),a)};f.RDFEnvironment.prototype.createTermMap=function(a){if(a===!0)return new f.UrisMap;else{var a=this.terms.values(),b=new f.UrisMap,d;for(d in a)b[d]=a[d];return b}};f.RDFEnvironment.prototype.createPrefixMap=function(a){if(a===!0)return new f.UrisMap;else{var a=this.prefixes.values(),b=new f.UrisMap,d;for(d in a)b[d]=a[d];return b}};f.RDFNode=function(a){this.interfaceName=a;this.attributes=["interfaceName","nominalValue"]};f.RDFNode.prototype.equals=
function(a){if(a.interfaceName==null)return this.valueOf()==a;else{for(var b in this.attributes){var d=this.attributes[b];if(this[d]!=a[d])return!1}return!0}};f.BlankNode=function(a){f.RDFNode.call(this,"BlankNode");this.nominalValue="_:"+a;this.bnodeId=a};h["extends"](f.RDFNode,f.BlankNode);f.BlankNode.prototype.toString=function(){return this.nominalValue};f.BlankNode.prototype.toNT=function(){return this.nominalValue};f.BlankNode.prototype.valueOf=function(){return this.nominalValue};f.Literal=
function(a,b,d){f.RDFNode.call(this,"Literal");this.nominalValue=a;if(b!=null)this.language=b;else if(d!=null)this.datatype=d};h["extends"](f.RDFNode,f.Literal);f.Literal.prototype.toString=function(){var a='"'+this.nominalValue+'"';if(this.language!=null)a=a+"@"+this.language;else if(this.datatype!=null||this.type)a=a+"^^<"+(this.datatype||this.type)+">";return a};f.Literal.prototype.toNT=function(){return this.toString()};f.Literal.prototype.valueOf=function(){return b.effectiveTypeValue({token:"literal",
type:this.type||this.datatype,value:this.nominalValue,language:this.language})};f.NamedNode=function(a){f.RDFNode.call(this,"NamedNode");this.nominalValue=a.value!=null?a.value:a};h["extends"](f.RDFNode,f.NamedNode);f.NamedNode.prototype.toString=function(){return this.nominalValue};f.NamedNode.prototype.toNT=function(){return"<"+this.toString()+">"};f.NamedNode.prototype.valueOf=function(){return this.nominalValue};f.Triple=function(a,b,d){this.subject=a;this.predicate=b;this.object=d};f.Triple.prototype.equals=
function(a){return this.subject.equals(a.subject)&&this.predicate.equals(a.predicate)&&this.object.equals(a.object)};f.Triple.prototype.toString=function(){return this.subject.toNT()+" "+this.predicate.toNT()+" "+this.object.toNT()+" . \r\n"};f.Graph=function(){this.triples=[];this.duplicates={};this.actions=[];this.length=0};f.Graph.prototype.add=function(a){for(var b=0;b<this.actions.length;b++)a=this.actions[b](a);b=a.subject.toString()+a.predicate.toString()+a.object.toString();this.duplicates[b]||
(this.duplicates[b]=!0,this.triples.push(a));this.length=this.triples.length;return this};f.Graph.prototype.addAction=function(a,b){this.actions.push(a);if(b==!0)for(var d=0;d<this.triples.length;d++)this.triples[d]=a(this.triples[d]);return this};f.Graph.prototype.addAll=function(a){for(var a=a.toArray(),b=0;b<a.length;b++)this.add(a[b]);this.length=this.triples.length;return this};f.Graph.prototype.remove=function(a){for(var b=null,d=0;d<this.triples.length;d++)if(this.triples[d].equals(a)){delete this.duplicates[a.subject.toString()+
a.predicate.toString()+a.object.toString()];b=d;break}b!=null&&this.triples.splice(b,1);this.length=this.triples.length;return this};f.Graph.prototype.toArray=function(){return this.triples};f.Graph.prototype.some=function(a){for(var b=0;b<this.triples.length;b++)if(a(this.triples[b],this)===!0)return!0;return!1};f.Graph.prototype.every=function(a){for(var b=0;b<this.triples.length;b++)if(a(this.triples[b],this)===!1)return!1;return!0};f.Graph.prototype.filter=function(a){for(var b=new f.Graph,d=
0;d<this.triples.length;d++)a(this.triples[d],this)===!0&&b.add(this.triples[d]);return b};f.Graph.prototype.forEach=function(a){for(var b=0;b<this.triples.length;b++)a(this.triples[b],this)};f.Graph.prototype.merge=function(){for(var a=new f.Graph,b=0;b<this.triples.length;b++)a.add(this.triples[b]);return a};f.Graph.prototype.match=function(a,b,d,g){for(var j=new f.Graph,i=0,e=0;e<this.triples.length;e++){var k=this.triples[e];if(a==null||k.subject.equals(a))if(b==null||k.predicate.equals(b))if(d==
null||k.object.equals(d))if(g==null||i<g)i++,j.add(k);else break}return j};f.Graph.prototype.removeMatches=function(a,b,d){for(var g=[],j=0;j<this.triples.length;j++){var i=this.triples[j];if(a==null||i.subject.equals(a))if(b==null||i.predicate.equals(b))(d==null||i.object.equals(d))&&g.push(i)}for(j=0;j<g.length;j++)this.remove(g[j]);return this};f.Graph.prototype.toNT=function(){var a="";this.forEach(function(b){a+=b.toString()});return a};f.buildRDFResource=function(a,b,d,g){return a.token==="blank"?
f.buildBlankNode(a,b,d,g):a.token==="literal"?f.buildLiteral(a,b,d,g):a.token==="uri"?f.buildNamedNode(a,b,d,g):a.token==="var"?(a=b[a.value],a!=null?f.buildRDFResource(a,b,d,g):null):null};f.buildBlankNode=function(a){if(a.valuetmp!=null)a.value=a.valuetmp;if(a.value.indexOf("_:")===0)a.value=a.value.split("_:")[1];return new f.BlankNode(a.value)};f.buildLiteral=function(a){return new f.Literal(a.value,a.lang,a.type)};f.buildNamedNode=function(a,b,d,g){if(a.value==null&&a.prefix!=null)b=d.resolveNsInEnvironment(a.prefix,
g),a.value=b+a.suffix;return new f.NamedNode(a)};f.rdf=new f.RDFEnvironment;var b={checkFilters:function(a,c,d,g,j,i){var e=a.filter,f=[];if(e==null||a.length!=null)return c;for(a=0;a<e.length;a++){for(var c=b.run(e[a].value,c,d,g,j,i),h=[],l=0;l<c.length;l++)c[l].__nullify__!=null?f.push(c[l]):h.push(c[l]);c=h}return c.concat(f)}};b.boundVars=function(a){if(a.expressionType!=null){var c=a.expressionType;if(c=="relationalexpression")return c=a.op2,b.boundVars(a.op1)+b.boundVars(c);else if(c=="conditionalor"||
c=="conditionaland"){for(var d=[],c=0;c<a.operands;c++)d=d.concat(b.boundVars(a.operands[c]));return d}else if(c=="builtincall")if(a.args==null)return[];else{d=[];for(c=0;c<a.args.length;c++)d=d.concat(b.boundVars(a.args[c]));return d}else if(c=="multiplicativeexpression"){d=b.boundVars(a.factor);for(c=0;c<a.factors.length;c++)d=d.concat(b.boundVars(a.factors[c].expression));return d}else if(c=="additiveexpression"){d=b.boundVars(a.summand);for(c=0;c<a.summands.length;c++)d=d.concat(b.boundVars(a.summands[c].expression));
return d}else if(c=="regex")return d=b.boundVars(a.expression1),d.concat(b.boundVars(a.expression2));else if(c=="unaryexpression")return b.boundVars(a.expression);else if(c=="atomic")return a.primaryexpression=="var"?[a.value]:[]}else throw console.log("ERROR"),console.log(a),"Cannot find bound expressions in a no expression token";};b.run=function(a,c,d,g,j,i){for(var e=i.copyDenormalizedBindings(c,j.outCache),f=[],h=0;h<c.length;h++){var l=b.runFilter(a,e[h],i,g,j),l=b.ebv(l);b.isEbvError(l)?d&&
(l={__nullify__:!0,bindings:c[h]},f.push(l)):l===!0?f.push(c[h]):d&&(l={__nullify__:!0,bindings:c[h]},f.push(l))}return f};b.collect=function(a,c,d,g,f){for(var i=f.copyDenormalizedBindings(c,g.outCache),e=[],h=0;h<i.length;h++){var m=b.runFilter(a,i[h],f,d,g);e.push({binding:c[h],value:m})}return e};b.runDistinct=function(){};b.runAggregator=function(a,c,d,g,f){if(c==null||c.length===0)return b.ebvError();else if(a.token==="variable"&&a.kind=="var")return c[0][a.value.value];else if(a.token==="variable"&&
a.kind==="aliased")if(a.expression.expressionType==="atomic"&&a.expression.primaryexpression==="var")return c[0][a.expression.value.value];else if(a.expression.expressionType==="aggregate")if(a.expression.aggregateType==="max"){for(var i=null,e=0;e<c.length;e++){var k=c[e],k=b.runFilter(a.expression.expression,k,d,g,f);b.isEbvError(k)||(i===null?i=k:b.runLtFunction(i,k).value===!0&&(i=k))}return i===null?b.ebvError():i}else if(a.expression.aggregateType==="min"){i=null;for(e=0;e<c.length;e++)k=c[e],
k=b.runFilter(a.expression.expression,k,d,g,f),b.isEbvError(k)||(i===null?i=k:b.runGtFunction(i,k).value===!0&&(i=k));return i===null?b.ebvError():i}else if(a.expression.aggregateType==="count"){var i={},m=0;if(a.expression.expression==="*")if(a.expression.distinct!=null&&a.expression.distinct!="")for(e=0;e<c.length;e++){var k=c[e],l=h.hashTerm(k);i[l]==null&&(i[l]=!0,m++)}else m=c.length;else for(e=0;e<c.length;e++)k=c[e],k=b.runFilter(a.expression.expression,k,d,g,f),b.isEbvError(k)||(a.expression.distinct!=
null&&a.expression.distinct!=""?(l=h.hashTerm(k),i[l]==null&&(i[l]=!0,m++)):m++);return{token:"literal",type:"http://www.w3.org/2001/XMLSchema#integer",value:""+m}}else if(a.expression.aggregateType==="avg"){for(var i={},n={token:"literal",type:"http://www.w3.org/2001/XMLSchema#integer",value:"0"},e=m=0;e<c.length;e++)k=c[e],k=b.runFilter(a.expression.expression,k,d,g,f),b.isEbvError(k)||(a.expression.distinct!=null&&a.expression.distinct!=""?(l=h.hashTerm(k),i[l]==null&&(i[l]=!0,b.isNumeric(k)&&
(n=b.runSumFunction(n,k),m++))):b.isNumeric(k)&&(n=b.runSumFunction(n,k),m++));a=b.runDivFunction(n,{token:"literal",type:"http://www.w3.org/2001/XMLSchema#integer",value:""+m});a.value=""+a.value;return a}else if(a.expression.aggregateType==="sum"){i={};n={token:"literal",type:"http://www.w3.org/2001/XMLSchema#integer",value:"0"};for(e=0;e<c.length;e++)k=c[e],k=b.runFilter(a.expression.expression,k,d,g,f),b.isEbvError(k)||(a.expression.distinct!=null&&a.expression.distinct!=""?(l=h.hashTerm(k),i[l]==
null&&(i[l]=!0,b.isNumeric(k)&&(n=b.runSumFunction(n,k)))):b.isNumeric(k)&&(n=b.runSumFunction(n,k)));n.value=""+n.value;return n}else return k=b.runFilter(aggregate.expression,c[0],g,{blanks:{},outCache:{}})};b.runFilter=function(a,c,d,g,f){if(a.expressionType!=null){var i=a.expressionType;if(i=="relationalexpression"){var i=b.runFilter(a.op1,c,d,g,f),e=b.runFilter(a.op2,c,d,g,f);return b.runRelationalFilter(a,i,e,c,d,g,f)}else if(i=="conditionalor")return b.runOrFunction(a,c,d,g,f);else if(i=="conditionaland")return b.runAndFunction(a,
c,d,g,f);else if(i=="additiveexpression")return b.runAddition(a.summand,a.summands,c,d,g,f);else if(i=="builtincall")return b.runBuiltInCall(a.builtincall,a.args,c,d,g,f);else if(i=="multiplicativeexpression")return b.runMultiplication(a.factor,a.factors,c,d,g,f);else if(i=="unaryexpression")return b.runUnaryExpression(a.unaryexpression,a.expression,c,d,g,f);else if(i=="irireforfunction")return b.runIriRefOrFunction(a.iriref,a.args,c,d,g,f);else if(i=="regex")return b.runRegex(a.text,a.pattern,a.flags,
c,d,g,f);else if(i=="custom")return b.runBuiltInCall(a.name,a.args,c,d,g,f);else if(i=="atomic")if(a.primaryexpression=="var")return c[a.value.value];else{if(typeof a.value=="object"&&!(a.value.type==null||typeof a.value.type!="object"))a.value.type=h.lexicalFormBaseUri(a.value.type,f);return a.value}else throw"Unknown filter expression type";}else throw"Cannot find bound expressions in a no expression token";};b.isRDFTerm=function(a){return a==null?!1:a.token&&a.token=="literal"||a.token&&a.token==
"uri"||a.token&&a.token=="blank"?!0:!1};b.RDFTermEquality=function(a,c,d,g){return a.token==="literal"&&c.token==="literal"?a.lang==c.lang&&a.type==c.type&&a.value==c.value?!0:a.type!=null&&c.type!=null?b.ebvError():b.isSimpleLiteral(a)&&c.type!=null?b.ebvError():b.isSimpleLiteral(c)&&a.type!=null?b.ebvError():!1:a.token==="uri"&&c.token==="uri"?h.lexicalFormBaseUri(a,g)==h.lexicalFormBaseUri(c,g):a.token==="blank"&&c.token==="blank"?a.value==c.value:!1};b.isInteger=function(a){return a==null?!1:
a.token==="literal"?a.type=="http://www.w3.org/2001/XMLSchema#integer"||a.type=="http://www.w3.org/2001/XMLSchema#decimal"||a.type=="http://www.w3.org/2001/XMLSchema#double"||a.type=="http://www.w3.org/2001/XMLSchema#nonPositiveInteger"||a.type=="http://www.w3.org/2001/XMLSchema#negativeInteger"||a.type=="http://www.w3.org/2001/XMLSchema#long"||a.type=="http://www.w3.org/2001/XMLSchema#int"||a.type=="http://www.w3.org/2001/XMLSchema#short"||a.type=="http://www.w3.org/2001/XMLSchema#byte"||a.type==
"http://www.w3.org/2001/XMLSchema#nonNegativeInteger"||a.type=="http://www.w3.org/2001/XMLSchema#unsignedLong"||a.type=="http://www.w3.org/2001/XMLSchema#unsignedInt"||a.type=="http://www.w3.org/2001/XMLSchema#unsignedShort"||a.type=="http://www.w3.org/2001/XMLSchema#unsignedByte"||a.type=="http://www.w3.org/2001/XMLSchema#positiveInteger"?!0:!1:!1};b.isFloat=function(a){return a==null?!1:a.token==="literal"?a.type=="http://www.w3.org/2001/XMLSchema#float"?!0:!1:!1};b.isDecimal=function(a){return a==
null?!1:a.token==="literal"?a.type=="http://www.w3.org/2001/XMLSchema#decimal"?!0:!1:!1};b.isDouble=function(a){return a==null?!1:a.token==="literal"?a.type=="http://www.w3.org/2001/XMLSchema#double"?!0:!1:!1};b.isNumeric=function(a){return a==null?!1:a.token==="literal"?a.type=="http://www.w3.org/2001/XMLSchema#integer"||a.type=="http://www.w3.org/2001/XMLSchema#decimal"||a.type=="http://www.w3.org/2001/XMLSchema#float"||a.type=="http://www.w3.org/2001/XMLSchema#double"||a.type=="http://www.w3.org/2001/XMLSchema#nonPositiveInteger"||
a.type=="http://www.w3.org/2001/XMLSchema#negativeInteger"||a.type=="http://www.w3.org/2001/XMLSchema#long"||a.type=="http://www.w3.org/2001/XMLSchema#int"||a.type=="http://www.w3.org/2001/XMLSchema#short"||a.type=="http://www.w3.org/2001/XMLSchema#byte"||a.type=="http://www.w3.org/2001/XMLSchema#nonNegativeInteger"||a.type=="http://www.w3.org/2001/XMLSchema#unsignedLong"||a.type=="http://www.w3.org/2001/XMLSchema#unsignedInt"||a.type=="http://www.w3.org/2001/XMLSchema#unsignedShort"||a.type=="http://www.w3.org/2001/XMLSchema#unsignedByte"||
a.type=="http://www.w3.org/2001/XMLSchema#positiveInteger"?!0:!1:!1};b.isSimpleLiteral=function(a){return a&&a.token=="literal"?a.type==null&&a.lang==null?!0:!1:!1};b.isXsdType=function(a,b){return b&&b.token=="literal"?b.type=="http://www.w3.org/2001/XMLSchema#"+a:!1};b.ebv=function(a){if(a==null||b.isEbvError(a))return b.ebvError();else if(a.token&&a.token==="literal")if(a.type=="http://www.w3.org/2001/XMLSchema#integer"||a.type=="http://www.w3.org/2001/XMLSchema#decimal"||a.type=="http://www.w3.org/2001/XMLSchema#double"||
a.type=="http://www.w3.org/2001/XMLSchema#nonPositiveInteger"||a.type=="http://www.w3.org/2001/XMLSchema#negativeInteger"||a.type=="http://www.w3.org/2001/XMLSchema#long"||a.type=="http://www.w3.org/2001/XMLSchema#int"||a.type=="http://www.w3.org/2001/XMLSchema#short"||a.type=="http://www.w3.org/2001/XMLSchema#byte"||a.type=="http://www.w3.org/2001/XMLSchema#nonNegativeInteger"||a.type=="http://www.w3.org/2001/XMLSchema#unsignedLong"||a.type=="http://www.w3.org/2001/XMLSchema#unsignedInt"||a.type==
"http://www.w3.org/2001/XMLSchema#unsignedShort"||a.type=="http://www.w3.org/2001/XMLSchema#unsignedByte"||a.type=="http://www.w3.org/2001/XMLSchema#positiveInteger"){var c=parseFloat(a.value);return isNaN(c)?!1:parseFloat(a.value)!=0}else return a.type==="http://www.w3.org/2001/XMLSchema#boolean"?a.value==="true"||a.value===!0||a.value==="True":a.type==="http://www.w3.org/2001/XMLSchema#string"?a.value!="":a.type==="http://www.w3.org/2001/XMLSchema#dateTime"?new Date(a.value)!=null:b.isEbvError(a)?
a:a.type==null?a.value!=""?!0:!1:b.ebvError();else return a.value===!0};b.effectiveBooleanValue=b.ebv;b.ebvTrue=function(){return{token:"literal",type:"http://www.w3.org/2001/XMLSchema#boolean",value:!0}};b.ebvFalse=function(){return{token:"literal",type:"http://www.w3.org/2001/XMLSchema#boolean",value:!1}};b.ebvError=function(){return{token:"literal",type:"https://github.com/antoniogarrote/js-tools/types#error",value:null}};b.isEbvError=function(a){return typeof a=="object"&&a!=null?a.type==="https://github.com/antoniogarrote/js-tools/types#error":
!1};b.ebvBoolean=function(a){return b.isEbvError(a)?a:a===!0?b.ebvTrue():b.ebvFalse()};b.runRelationalFilter=function(a,c,d,g,f,i,e){a=a.operator;if(a==="=")return b.runEqualityFunction(c,d,g,f,i,e);else if(a==="!="){c=b.runEqualityFunction(c,d,g,f,i,e);if(!b.isEbvError(c))c.value=!c.value;return c}else if(a==="<")return b.runLtFunction(c,d,g);else if(a===">")return b.runGtFunction(c,d,g);else if(a==="<=")return b.runLtEqFunction(c,d,g);else if(a===">=")return b.runGtEqFunction(c,d,g);else throw"Error applying relational filter, unknown operator";
};b.effectiveTypeValue=function(a){if(a.token=="literal")if(a.type=="http://www.w3.org/2001/XMLSchema#integer")return a=parseInt(a.value);else if(a.type=="http://www.w3.org/2001/XMLSchema#decimal")return a=parseFloat(a.value);else if(a.type=="http://www.w3.org/2001/XMLSchema#float")return a=parseFloat(a.value);else if(a.type=="http://www.w3.org/2001/XMLSchema#double")return a=parseFloat(a.value);else if(a.type=="http://www.w3.org/2001/XMLSchema#nonPositiveInteger")return a=parseFloat(a.value);else if(a.type==
"http://www.w3.org/2001/XMLSchema#negativeInteger")return a=parseInt(a.value);else if(a.type=="http://www.w3.org/2001/XMLSchema#long")return a=parseInt(a.value);else if(a.type=="http://www.w3.org/2001/XMLSchema#int")return a=parseInt(a.value);else if(a.type=="http://www.w3.org/2001/XMLSchema#short")return a=parseInt(a.value);else if(a.type=="http://www.w3.org/2001/XMLSchema#byte")return a=parseInt(a.value);else if(a.type=="http://www.w3.org/2001/XMLSchema#nonNegativeInteger")return a=parseInt(a.value);
else if(a.type=="http://www.w3.org/2001/XMLSchema#unsignedLong")return a=parseInt(a.value);else if(a.type=="http://www.w3.org/2001/XMLSchema#unsignedInt")return a=parseInt(a.value);else if(a.type=="http://www.w3.org/2001/XMLSchema#unsignedShort")return a=parseInt(a.value);else if(a.type=="http://www.w3.org/2001/XMLSchema#unsignedByte")return a=parseInt(a.value);else if(a.type=="http://www.w3.org/2001/XMLSchema#positiveInteger")return a=parseInt(a.value);else if(a.type=="http://www.w3.org/2001/XMLSchema#date"||
a.type=="http://www.w3.org/2001/XMLSchema#dateTime")try{return h.parseISO8601(a.value)}catch(b){return null}else return a.type=="http://www.w3.org/2001/XMLSchema#boolean"?a.value===!0||a.value==="true"||a.value==="1"||a.value===1||a.value===!0?!0:a.value===!1||a.value==="false"||a.value==="0"||a.value===0||a.value===!1?!1:void 0:a.type=="http://www.w3.org/2001/XMLSchema#string"?a.value===null||a.value===void 0?void 0:""+a.value:a.value;else throw console.log("not implemented yet"),console.log(a),
"value not supported in operations yet";};b.runOrFunction=function(a,c,d,g,f){for(var i=null,e=0;e<a.operands.length;e++){var h=b.runFilter(a.operands[e],c,d,g,f);b.isEbvError(h)==!1&&(h=b.ebv(h));i==null?i=h:b.isEbvError(h)?i=b.isEbvError(i)?b.ebvError():i===!0?!0:b.ebvError():h===!0?i=!0:b.isEbvError(i)&&(i=b.ebvError())}return b.ebvBoolean(i)};b.runAndFunction=function(a,c,d,g,f){for(var i=null,e=0;e<a.operands.length;e++){var h=b.runFilter(a.operands[e],c,d,g,f);b.isEbvError(h)==!1&&(h=b.ebv(h));
i==null?i=h:b.isEbvError(h)?i=b.isEbvError(i)?b.ebvError():i===!0?b.ebvError():!1:h===!0?b.isEbvError(i)&&(i=b.ebvError()):i=!1}return b.ebvBoolean(i)};b.runEqualityFunction=function(a,c,d,g,f,i){if(b.isEbvError(a)||b.isEbvError(c))return b.ebvError();if(b.isNumeric(a)&&b.isNumeric(c))return d=b.effectiveTypeValue(a),f=b.effectiveTypeValue(c),isNaN(d)||isNaN(f)?b.ebvBoolean(b.RDFTermEquality(a,c,g,i)):b.ebvBoolean(d==f);else if((b.isSimpleLiteral(a)||b.isXsdType("string",a))&&(b.isSimpleLiteral(c)||
b.isXsdType("string",c)))return b.ebvBoolean(b.effectiveTypeValue(a)==b.effectiveTypeValue(c));else if(b.isXsdType("boolean",a)&&b.isXsdType("boolean",c))return b.ebvBoolean(b.effectiveTypeValue(a)==b.effectiveTypeValue(c));else if((b.isXsdType("dateTime",a)||b.isXsdType("date",a))&&(b.isXsdType("dateTime",c)||b.isXsdType("date",c))){if(b.isXsdType("dateTime",a)&&b.isXsdType("date",c))return b.ebvFalse();if(b.isXsdType("date",a)&&b.isXsdType("dateTime",c))return b.ebvFalse();a=h.compareDateComponents(a.value,
c.value);return a!=null?a==0?b.ebvTrue():b.ebvFalse():b.ebvError()}else return b.isRDFTerm(a)&&b.isRDFTerm(c)?b.ebvBoolean(b.RDFTermEquality(a,c,g,i)):b.ebvFalse()};b.runGtFunction=function(a,c){if(b.isEbvError(a)||b.isEbvError(c))return b.ebvError();if(b.isNumeric(a)&&b.isNumeric(c))return b.ebvBoolean(b.effectiveTypeValue(a)>b.effectiveTypeValue(c));else if(b.isSimpleLiteral(a)&&b.isSimpleLiteral(c))return b.ebvBoolean(b.effectiveTypeValue(a)>b.effectiveTypeValue(c));else if(b.isXsdType("string",
a)&&b.isXsdType("string",c))return b.ebvBoolean(b.effectiveTypeValue(a)>b.effectiveTypeValue(c));else if(b.isXsdType("boolean",a)&&b.isXsdType("boolean",c))return b.ebvBoolean(b.effectiveTypeValue(a)>b.effectiveTypeValue(c));else if((b.isXsdType("dateTime",a)||b.isXsdType("date",a))&&(b.isXsdType("dateTime",c)||b.isXsdType("date",c))){if(b.isXsdType("dateTime",a)&&b.isXsdType("date",c))return b.ebvFalse();if(b.isXsdType("date",a)&&b.isXsdType("dateTime",c))return b.ebvFalse();var d=h.compareDateComponents(a.value,
c.value);return d!=null?d==1?b.ebvTrue():b.ebvFalse():b.ebvError()}else return b.ebvFalse()};b.runTotalGtFunction=function(a,c){return b.isEbvError(a)||b.isEbvError(c)?b.ebvError():b.isNumeric(a)&&b.isNumeric(c)||b.isSimpleLiteral(a)&&b.isSimpleLiteral(c)||b.isXsdType("string",a)&&b.isSimpleLiteral("string",c)||b.isXsdType("boolean",a)&&b.isSimpleLiteral("boolean",c)||b.isXsdType("dateTime",a)&&b.isSimpleLiteral("dateTime",c)?b.runGtFunction(a,c,[]):a.token&&a.token==="uri"&&c.token&&c.token==="uri"?
b.ebvBoolean(a.value>c.value):a.token&&a.token==="literal"&&c.token&&c.token==="literal"?b.ebvBoolean(""+a.value+a.type+a.lang>""+c.value+c.type+c.lang):a.token&&a.token==="blank"&&c.token&&c.token==="blank"?b.ebvBoolean(a.value>c.value):a.value&&c.value?b.ebvBoolean(a.value>c.value):b.ebvTrue()};b.runLtFunction=function(a,c){if(b.isEbvError(a)||b.isEbvError(c))return b.ebvError();if(b.isNumeric(a)&&b.isNumeric(c))return b.ebvBoolean(b.effectiveTypeValue(a)<b.effectiveTypeValue(c));else if(b.isSimpleLiteral(a)&&
b.isSimpleLiteral(c))return b.ebvBoolean(b.effectiveTypeValue(a)<b.effectiveTypeValue(c));else if(b.isXsdType("string",a)&&b.isXsdType("string",c))return b.ebvBoolean(b.effectiveTypeValue(a)<b.effectiveTypeValue(c));else if(b.isXsdType("boolean",a)&&b.isXsdType("boolean",c))return b.ebvBoolean(b.effectiveTypeValue(a)<b.effectiveTypeValue(c));else if((b.isXsdType("dateTime",a)||b.isXsdType("date",a))&&(b.isXsdType("dateTime",c)||b.isXsdType("date",c))){if(b.isXsdType("dateTime",a)&&b.isXsdType("date",
c))return b.ebvFalse();if(b.isXsdType("date",a)&&b.isXsdType("dateTime",c))return b.ebvFalse();var d=h.compareDateComponents(a.value,c.value);return d!=null?d==-1?b.ebvTrue():b.ebvFalse():b.ebvError()}else return b.ebvFalse()};b.runGtEqFunction=function(a,c){if(b.isEbvError(a)||b.isEbvError(c))return b.ebvError();if(b.isNumeric(a)&&b.isNumeric(c))return b.ebvBoolean(b.effectiveTypeValue(a)>=b.effectiveTypeValue(c));else if(b.isSimpleLiteral(a)&&b.isSimpleLiteral(c))return b.ebvBoolean(b.effectiveTypeValue(a)>=
b.effectiveTypeValue(c));else if(b.isXsdType("string",a)&&b.isXsdType("string",c))return b.ebvBoolean(b.effectiveTypeValue(a)>=b.effectiveTypeValue(c));else if(b.isXsdType("boolean",a)&&b.isXsdType("boolean",c))return b.ebvBoolean(b.effectiveTypeValue(a)>=b.effectiveTypeValue(c));else if((b.isXsdType("dateTime",a)||b.isXsdType("date",a))&&(b.isXsdType("dateTime",c)||b.isXsdType("date",c))){if(b.isXsdType("dateTime",a)&&b.isXsdType("date",c))return b.ebvFalse();if(b.isXsdType("date",a)&&b.isXsdType("dateTime",
c))return b.ebvFalse();var d=h.compareDateComponents(a.value,c.value);return d!=null?d!=-1?b.ebvTrue():b.ebvFalse():b.ebvError()}else return b.ebvFalse()};b.runLtEqFunction=function(a,c){if(b.isEbvError(a)||b.isEbvError(c))return b.ebvError();if(b.isNumeric(a)&&b.isNumeric(c))return b.ebvBoolean(b.effectiveTypeValue(a)<=b.effectiveTypeValue(c));else if(b.isSimpleLiteral(a)&&b.isSimpleLiteral(c))return b.ebvBoolean(b.effectiveTypeValue(a)<=b.effectiveTypeValue(c));else if(b.isXsdType("string",a)&&
b.isXsdType("string",c))return b.ebvBoolean(b.effectiveTypeValue(a)<=b.effectiveTypeValue(c));else if(b.isXsdType("boolean",a)&&b.isXsdType("boolean",c))return b.ebvBoolean(b.effectiveTypeValue(a)<=b.effectiveTypeValue(c));else if((b.isXsdType("dateTime",a)||b.isXsdType("date",a))&&(b.isXsdType("dateTime",c)||b.isXsdType("date",c))){if(b.isXsdType("dateTime",a)&&b.isXsdType("date",c))return b.ebvFalse();if(b.isXsdType("date",a)&&b.isXsdType("dateTime",c))return b.ebvFalse();var d=h.compareDateComponents(a.value,
c.value);return d!=null?d!=1?b.ebvTrue():b.ebvFalse():b.ebvError()}else return b.ebvFalse()};b.runAddition=function(a,c,d,g,f,i){var e=b.runFilter(a,d,g,f,i);if(b.isEbvError(e))return b.ebvError();a=e;if(b.isNumeric(e)){for(e=0;e<c.length;e++){var h=b.runFilter(c[e].expression,d,g,f,i);if(b.isNumeric(h))c[e].operator==="+"?a=b.runSumFunction(a,h):c[e].operator==="-"&&(a=b.runSubFunction(a,h));else return b.ebvFalse()}return a}else return b.ebvFalse()};b.runSumFunction=function(a,c){if(b.isEbvError(a)||
b.isEbvError(c))return b.ebvError();var d=b.effectiveTypeValue(a)+b.effectiveTypeValue(c);return b.isDouble(a)||b.isDouble(c)?{token:"literal",type:"http://www.w3.org/2001/XMLSchema#double",value:d}:b.isFloat(a)||b.isFloat(c)?{token:"literal",type:"http://www.w3.org/2001/XMLSchema#float",value:d}:b.isDecimal(a)||b.isDecimal(c)?{token:"literal",type:"http://www.w3.org/2001/XMLSchema#decimal",value:d}:{token:"literal",type:"http://www.w3.org/2001/XMLSchema#integer",value:d}};b.runSubFunction=function(a,
c){if(b.isEbvError(a)||b.isEbvError(c))return b.ebvError();var d=b.effectiveTypeValue(a)-b.effectiveTypeValue(c);return b.isDouble(a)||b.isDouble(c)?{token:"literal",type:"http://www.w3.org/2001/XMLSchema#double",value:d}:b.isFloat(a)||b.isFloat(c)?{token:"literal",type:"http://www.w3.org/2001/XMLSchema#float",value:d}:b.isDecimal(a)||b.isDecimal(c)?{token:"literal",type:"http://www.w3.org/2001/XMLSchema#decimal",value:d}:{token:"literal",type:"http://www.w3.org/2001/XMLSchema#integer",value:d}};
b.runMultiplication=function(a,c,d,g,f,i){a=b.runFilter(a,d,g,f,i);if(b.isEbvError(a))return a;var e=a;if(b.isNumeric(a)){for(var h=0;h<c.length;h++){var m=b.runFilter(c[h].expression,d,g,f,i);if(b.isEbvError(m))return a;if(b.isNumeric(m))c[h].operator==="*"?e=b.runMulFunction(e,m):c[h].operator==="/"&&(e=b.runDivFunction(e,m));else return b.ebvFalse()}return e}else return b.ebvFalse()};b.runMulFunction=function(a,c){if(b.isEbvError(a)||b.isEbvError(c))return b.ebvError();var d=b.effectiveTypeValue(a)*
b.effectiveTypeValue(c);return b.isDouble(a)||b.isDouble(c)?{token:"literal",type:"http://www.w3.org/2001/XMLSchema#double",value:d}:b.isFloat(a)||b.isFloat(c)?{token:"literal",type:"http://www.w3.org/2001/XMLSchema#float",value:d}:b.isDecimal(a)||b.isDecimal(c)?{token:"literal",type:"http://www.w3.org/2001/XMLSchema#decimal",value:d}:{token:"literal",type:"http://www.w3.org/2001/XMLSchema#integer",value:d}};b.runDivFunction=function(a,c){if(b.isEbvError(a)||b.isEbvError(c))return b.ebvError();var d=
b.effectiveTypeValue(a)/b.effectiveTypeValue(c);return b.isDouble(a)||b.isDouble(c)?{token:"literal",type:"http://www.w3.org/2001/XMLSchema#double",value:d}:b.isFloat(a)||b.isFloat(c)?{token:"literal",type:"http://www.w3.org/2001/XMLSchema#float",value:d}:b.isDecimal(a)||b.isDecimal(c)?{token:"literal",type:"http://www.w3.org/2001/XMLSchema#decimal",value:d}:{token:"literal",type:"http://www.w3.org/2001/XMLSchema#integer",value:d}};b.runBuiltInCall=function(a,c,d,f,h,i){if(a==="notexists"||a==="exists"){var e=
JSON.parse(JSON.stringify(c[0])),e=f.abstractQueryTree.parseSelect({pattern:e},d),e=f.abstractQueryTree.bind(e.pattern,d),d=f.executeSelectUnit([{kind:"*"}],h,e,i);return a==="exists"?b.ebvBoolean(d.length!==0):b.ebvBoolean(d.length===0)}else{for(var e=[],k=0;k<c.length;k++)if(c[k].token==="var")e.push(c[k]);else{var m=b.runFilter(c[k],d,f,h,i);if(b.isEbvError(m))return m;e.push(m)}if(a==="str")return e[0].token==="literal"?{token:"literal",type:null,value:""+e[0].value}:e[0].token==="uri"?{token:"literal",
type:null,value:e[0].value}:b.ebvFalse();else if(a==="lang")return e[0].token==="literal"?e[0].lang!=null?{token:"literal",value:""+e[0].lang}:{token:"literal",value:""}:b.ebvError();else if(a==="datatype")return e[0].token==="literal"?(a=e[0],a.type!=null?typeof a.type==="string"?{token:"uri",value:a.type,prefix:null,suffix:null}:a.type:a.lang==null?{token:"uri",value:"http://www.w3.org/2001/XMLSchema#string",prefix:null,suffix:null}:b.ebvError()):b.ebvError();else if(a==="isliteral")return e[0].token===
"literal"?b.ebvTrue():b.ebvFalse();else if(a==="isblank")return e[0].token==="blank"?b.ebvTrue():b.ebvFalse();else if(a==="isuri"||a==="isiri")return e[0].token==="uri"?b.ebvTrue():b.ebvFalse();else if(a==="sameterm")return a=b.RDFTermEquality(e[0],e[1],f,i),b.isEbvError(a)&&(a=!1),b.ebvBoolean(a);else if(a==="langmatches")return a=e[0],d=e[1],a.token==="literal"&&d.token==="literal"?d.value==="*"&&a.value!=""?b.ebvTrue():b.ebvBoolean(a.value.toLowerCase().indexOf(d.value.toLowerCase())===0):b.ebvError();
else if(a==="bound")return a=e[0].value,a==null?b.ebvError():d[a]!=null?b.ebvTrue():b.ebvFalse();else if(f.customFns[a]!=null)return f.customFns[a](b,e);else throw"Builtin call "+a+" not implemented yet";}};b.runUnaryExpression=function(a,c,d,f,h,i){c=b.runFilter(c,d,f,h,i);if(b.isEbvError(c))return c;if(a==="!"){var e=b.ebv(c);return b.isEbvError(e)?b.ebvFalse():b.ebvBoolean(!e)}else if(a==="+")return b.isNumeric(c)?c:b.ebvError();else if(a==="-")if(b.isNumeric(c)){a={};for(e in c)a[e]=c[e];a.value=
-a.value;return a}else return b.ebvError()};b.runRegex=function(a,c,d,f,h,i,e){if(a!=null)a=b.runFilter(a,f,h,i,e);else return b.ebvError();if(c!=null)c=b.runFilter(c,f,h,i,e);else return b.ebvError();d!=null&&(d=b.runFilter(d,f,h,i,e));if(c!=null&&c.token==="literal"&&(d==null||d.token==="literal"))c=c.value,d=d==null?null:d.value;else return b.ebvError();if(a!=null&&a.token=="var")if(f[a.value]!=null)a=f[a.value];else return b.ebvError();else if(a!=null&&a.token==="literal")if(a.type==null||b.isXsdType("string",
a))a=a.value;else return b.ebvError();else return b.ebvError();return(d==null?RegExp(c):RegExp(c,d.toLowerCase())).exec(a)?b.ebvTrue():b.ebvFalse()};b.normalizeLiteralDatatype=function(a,b,d){if(!(a.value.type==null||typeof a.value.type!="object"))a.value.type=h.lexicalFormBaseUri(a.value.type,d);return a};b.runIriRefOrFunction=function(a,c,d,f,j,i){if(c==null)return a;else{for(var e=[],k=0;k<c.length;k++)e.push(b.runFilter(c[k],d,f,j,i));a=h.lexicalFormBaseUri(a,i);if(a=="http://www.w3.org/2001/XMLSchema#integer"||
a=="http://www.w3.org/2001/XMLSchema#decimal"||a=="http://www.w3.org/2001/XMLSchema#double"||a=="http://www.w3.org/2001/XMLSchema#nonPositiveInteger"||a=="http://www.w3.org/2001/XMLSchema#negativeInteger"||a=="http://www.w3.org/2001/XMLSchema#long"||a=="http://www.w3.org/2001/XMLSchema#int"||a=="http://www.w3.org/2001/XMLSchema#short"||a=="http://www.w3.org/2001/XMLSchema#byte"||a=="http://www.w3.org/2001/XMLSchema#nonNegativeInteger"||a=="http://www.w3.org/2001/XMLSchema#unsignedLong"||a=="http://www.w3.org/2001/XMLSchema#unsignedInt"||
a=="http://www.w3.org/2001/XMLSchema#unsignedShort"||a=="http://www.w3.org/2001/XMLSchema#unsignedByte"||a=="http://www.w3.org/2001/XMLSchema#positiveInteger")if(e=e[0],e.token==="literal")if(e=b.normalizeLiteralDatatype(e,f,i),e.type=="http://www.w3.org/2001/XMLSchema#integer"||e.type=="http://www.w3.org/2001/XMLSchema#decimal"||e.type=="http://www.w3.org/2001/XMLSchema#double"||e.type=="http://www.w3.org/2001/XMLSchema#nonPositiveInteger"||e.type=="http://www.w3.org/2001/XMLSchema#negativeInteger"||
e.type=="http://www.w3.org/2001/XMLSchema#long"||e.type=="http://www.w3.org/2001/XMLSchema#int"||e.type=="http://www.w3.org/2001/XMLSchema#short"||e.type=="http://www.w3.org/2001/XMLSchema#byte"||e.type=="http://www.w3.org/2001/XMLSchema#nonNegativeInteger"||e.type=="http://www.w3.org/2001/XMLSchema#unsignedLong"||e.type=="http://www.w3.org/2001/XMLSchema#unsignedInt"||e.type=="http://www.w3.org/2001/XMLSchema#unsignedShort"||e.type=="http://www.w3.org/2001/XMLSchema#unsignedByte"||e.type=="http://www.w3.org/2001/XMLSchema#positiveInteger")return e.type=
a,e;else if(e.type=="http://www.w3.org/2001/XMLSchema#boolean")return b.ebv(e)==!0?(e.type=a,e.value=1):(e.type=a,e.value=0),e;else if(e.type=="http://www.w3.org/2001/XMLSchema#float"||e.type=="http://www.w3.org/2001/XMLSchema#double")return e.type=a,e.value=parseInt(e.value),e;else if(e.type=="http://www.w3.org/2001/XMLSchema#string"||e.type==null){if(e.value.split(".").length>2)return b.ebvError();else if(e.value.split("-").length>2)return b.ebvError();else if(e.value.split("/").length>2)return b.ebvError();
else if(e.value.split("+").length>2)return b.ebvError();if(a=="http://www.w3.org/2001/XMLSchema#decimal"&&(e.value.indexOf("e")!=-1||e.value.indexOf("E")!=-1))return b.ebvError();if(a=="http://www.w3.org/2001/XMLSchema#int"||a=="http://www.w3.org/2001/XMLSchema#integer")if(e.value.indexOf("e")!=-1||e.value.indexOf("E")!=-1||e.value.indexOf(".")!=-1)return b.ebvError();try{return e.value=parseInt(parseFloat(e.value)),isNaN(e.value)?b.ebvError():(e.type=a,e)}catch(m){return b.ebvError()}}else return b.ebvError();
else return b.ebvError();else if(a=="http://www.w3.org/2001/XMLSchema#boolean")return e=e[0],e.token==="literal"&&e.type==null?e.value==="true"||e.value==="1"?b.ebvTrue():e.value==="false"||e.value==="0"?b.ebvFalse():b.ebvError():e.token==="literal"?b.isEbvError(e)?e:b.ebvBoolean(e):b.ebvError();else if(a=="http://www.w3.org/2001/XMLSchema#string")if(e=e[0],e.token==="literal")if(e=b.normalizeLiteralDatatype(e,f,i),e.type=="http://www.w3.org/2001/XMLSchema#integer"||e.type=="http://www.w3.org/2001/XMLSchema#decimal"||
e.type=="http://www.w3.org/2001/XMLSchema#double"||e.type=="http://www.w3.org/2001/XMLSchema#nonPositiveInteger"||e.type=="http://www.w3.org/2001/XMLSchema#negativeInteger"||e.type=="http://www.w3.org/2001/XMLSchema#long"||e.type=="http://www.w3.org/2001/XMLSchema#int"||e.type=="http://www.w3.org/2001/XMLSchema#short"||e.type=="http://www.w3.org/2001/XMLSchema#byte"||e.type=="http://www.w3.org/2001/XMLSchema#nonNegativeInteger"||e.type=="http://www.w3.org/2001/XMLSchema#unsignedLong"||e.type=="http://www.w3.org/2001/XMLSchema#unsignedInt"||
e.type=="http://www.w3.org/2001/XMLSchema#unsignedShort"||e.type=="http://www.w3.org/2001/XMLSchema#unsignedByte"||e.type=="http://www.w3.org/2001/XMLSchema#positiveInteger"||e.type=="http://www.w3.org/2001/XMLSchema#float")return e.type=a,e.value=""+e.value,e;else if(e.type=="http://www.w3.org/2001/XMLSchema#string")return e;else if(e.type=="http://www.w3.org/2001/XMLSchema#boolean")return b.ebv(e)?(e.type=a,e.value="true"):(e.type=a,e.value="false"),e;else if(e.type=="http://www.w3.org/2001/XMLSchema#dateTime"||
e.type=="http://www.w3.org/2001/XMLSchema#date"){e.type=a;if(typeof e.value!="string")e.value=h.iso8601(e.value);return e}else return e.type==null?(e.value=""+e.value,e.type=a,e):b.ebvError();else return e.token==="uri"?{token:"literal",value:h.lexicalFormBaseUri(e,i),type:a,lang:null}:b.ebvError();else if(a=="http://www.w3.org/2001/XMLSchema#dateTime"||a=="http://www.w3.org/2001/XMLSchema#date")if(e=e[0],e.type=="http://www.w3.org/2001/XMLSchema#dateTime"||e.type=="http://www.w3.org/2001/XMLSchema#date")return e;
else if(e.type=="http://www.w3.org/2001/XMLSchema#string"||e.type==null)try{return e.value=h.iso8601(h.parseStrictISO8601(e.value)),e.type=a,e}catch(l){return b.ebvError()}else return b.ebvError();else if(a=="http://www.w3.org/2001/XMLSchema#float")if(e=e[0],e.token==="literal")if(e=b.normalizeLiteralDatatype(e,f,i),e.type=="http://www.w3.org/2001/XMLSchema#decimal"||e.type=="http://www.w3.org/2001/XMLSchema#int")return e.type=a,e.value=parseFloat(e.value),e;else if(e.type=="http://www.w3.org/2001/XMLSchema#boolean")return b.ebv(e)==
!0?(e.type=a,e.value=1):(e.type=a,e.value=0),e;else if(e.type=="http://www.w3.org/2001/XMLSchema#float"||e.type=="http://www.w3.org/2001/XMLSchema#double")return e.type=a,e.value=parseFloat(e.value),e;else if(e.type=="http://www.w3.org/2001/XMLSchema#string")try{return e.value=parseFloat(e.value),isNaN(e.value)?b.ebvError():(e.type=a,e)}catch(n){return b.ebvError()}else if(e.type==null){if(e.value.split(".").length>2)return b.ebvError();else if(e.value.split("-").length>2)return b.ebvError();else if(e.value.split("/").length>
2)return b.ebvError();else if(e.value.split("+").length>2)return b.ebvError();try{return e.value=parseFloat(e.value),isNaN(e.value)?b.ebvError():(e.type=a,e)}catch(o){return b.ebvError()}}else return b.ebvError();else return b.ebvError();else return b.ebvError()}};try{typeof module==="undefined"?window.RDFJSInterface=f:module.exports=f}catch(o){}})();
