!function(e){"use strict";if("function"==typeof define&&define.amd)define(["jquery"],function(t){return e(window,document,t)});else{if("undefined"==typeof exports)return e(window,document,jQuery);module.exports=e(window,document,require("jquery"))}}(function(e,t,n){"use strict";var r=function(e,t,n){var r,a,o,i,s,l,c,u;switch(i=Math.floor(6*e),s=6*e-i,l=n*(1-t),c=n*(1-s*t),u=n*(1-(1-s)*t),i%6){case 0:r=n,a=u,o=l;break;case 1:r=c,a=n,o=l;break;case 2:r=l,a=n,o=u;break;case 3:r=l,a=c,o=n;break;case 4:r=u,a=l,o=n;break;case 5:r=n,a=l,o=c}var p=Math.floor(255*r).toString(16),f=Math.floor(255*a).toString(16),d=Math.floor(255*o).toString(16);return"#"+(p.length<2?"0":"")+p+(f.length<2?"0":"")+f+(d.length<2?"0":"")+d},a=function(e){return e.replace(/[&<>"]/g,function(e){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"};return t[e]||e})},o=function(o,i,s,l,c,u,p,f,d,w,h,g,y,v,m,b,C){var P=function(e,t){t&&(e.getSelectedHTML()?e.insertLink(t):e.insertHTML('<a href="'+a(t)+'">'+a(t)+"</a>")),e.closePopup().collapseSelection()},k=function(e,t){var r=E(u),a=n('<input type="text" value="'+(t?t.attr("href"):"")+'" />').addClass("wysiwyg-input").keypress(function(n){(10==n.which||13==n.which)&&(t?(t.attr("href",a.val()),e.closePopup().collapseSelection()):P(e,a.val()))});f&&a.attr("placeholder",f);var o=r.click(function(n){return t?(t.attr("href",a.val()),e.closePopup().collapseSelection()):P(e,a.val()),n.stopPropagation(),n.preventDefault(),!1}),i=n("<div/>").addClass("wysiwyg-toolbar-form").attr("unselectable","on");return i.append(a).append(o),i},x=function(t){var r=function(e,r){var o='<img id="wysiwyg-insert-image" src="" alt=""'+(r?' title="'+a(r)+'"':"")+" />";t.insertHTML(o).closePopup().collapseSelection();var i=n("#wysiwyg-insert-image").removeAttr("id");w&&i.css({maxWidth:w[0]+"px",maxHeight:w[1]+"px"}).load(function(){i.css({maxWidth:"",maxHeight:""});var e=i.width(),t=i.height();(e>w[0]||t>w[1])&&(e/t>w[0]/w[1]?(t=parseInt(t/e*w[0]),e=w[0]):(e=parseInt(e/t*w[1]),t=w[1]),i.attr("width",e).attr("height",t))}),i.attr("src",e)},o=n("<div/>").addClass("wysiwyg-toolbar-form").attr("unselectable","on"),i=null,s=n('<input type="file" />').css({position:"absolute",left:0,top:0,width:"100%",height:"100%",opacity:0,cursor:"pointer"});if(!g&&e.File&&e.FileReader&&e.FileList){var l=function(e){if(e.type.match("image.*")){var t=new FileReader;t.onload=function(t){var n=t.target.result;r(n,e.name)},t.readAsDataURL(e)}};i=s.attr("draggable","true").change(function(e){for(var t=e.target.files,n=0;n<t.length;++n)l(t[n])}).on("dragover",function(e){return e.originalEvent.dataTransfer.dropEffect="copy",e.stopPropagation(),e.preventDefault(),!1}).on("drop",function(e){for(var t=e.originalEvent.dataTransfer.files,n=0;n<t.length;++n)l(t[n]);return e.stopPropagation(),e.preventDefault(),!1})}else if(h){var c=s.change(function(e){h.call(this,r)});i=n("<form/>").append(c)}i&&n("<div/>").addClass("wysiwyg-browse").html(p).append(i).appendTo(o);var d=E(u),y=n('<input type="text" value="" />').addClass("wysiwyg-input").keypress(function(e){(10==e.which||13==e.which)&&r(y.val())});f&&y.attr("placeholder",f);var v=d.click(function(e){return r(y.val()),e.stopPropagation(),e.preventDefault(),!1});return o.append(n("<div/>").append(y).append(v)),o},L=function(e){var t=function(t,r){t=n.trim(t||""),r=n.trim(r||"");var o=!1;t.length&&!r.length?o=t:-1==r.indexOf("<")&&-1==r.indexOf(">")&&r.match(/^(?:https?:\/)?\/?(?:[^:\/\s]+)(?:(?:\/\w+)*\/)(?:[\w\-\.]+[^#?\s]+)(?:.*)?(?:#[\w\-]+)?$/)&&(o=r),o&&y&&(r=y(o)||""),!r.length&&o&&(r='<video src="'+a(o)+'" />'),e.insertHTML(r).closePopup().collapseSelection()},r=n("<div/>").addClass("wysiwyg-toolbar-form").attr("unselectable","on"),o=n("<textarea>").addClass("wysiwyg-input wysiwyg-inputtextarea");d&&o.attr("placeholder",d),n("<div/>").addClass("wysiwyg-embedcode").append(o).appendTo(r);var i=E(u),s=n('<input type="text" value="" />').addClass("wysiwyg-input").keypress(function(e){(10==e.which||13==e.which)&&t(s.val())});f&&s.attr("placeholder",f);var l=i.click(function(e){return t(s.val(),o.val()),e.stopPropagation(),e.preventDefault(),!1});return r.append(n("<div/>").append(s).append(l)),r},S=function(e,t){for(var a=n("<table/>").attr("cellpadding","0").attr("cellspacing","0").attr("unselectable","on"),o=1;15>o;++o){for(var i=n("<tr/>"),s=0;25>s;++s){var l;if(24==s){var c=Math.floor(255/13*(14-o)).toString(16),u=(c.length<2?"0":"")+c;l="#"+u+u+u}else{var p=s/24,f=8>=o?o/8:1,d=o>8?(16-o)/8:1;l=r(p,f,d)}n("<td/>").addClass("wysiwyg-toolbar-color").attr("title",l).attr("unselectable","on").css({backgroundColor:l}).click(function(){var n=this.title;return t?e.forecolor(n).closePopup().collapseSelection():e.highlight(n).closePopup().collapseSelection(),!1}).appendTo(i)}a.append(i)}return a},T=function(e,t){switch(e){case"insertimage":return t?function(e){t(x(F),e)}:null;case"insertvideo":return t?function(e){t(L(F),e)}:null;case"insertlink":return t?function(e){t(k(F),e)}:null;case"bold":return function(){F.bold()};case"italic":return function(){F.italic()};case"underline":return function(){F.underline()};case"strikethrough":return function(){F.strikethrough()};case"forecolor":return t?function(e){t(S(F,!0),e)}:null;case"highlight":return t?function(e){t(S(F,!1),e)}:null;case"alignleft":return function(){F.align("left")};case"aligncenter":return function(){F.align("center")};case"alignright":return function(){F.align("right")};case"alignjustify":return function(){F.align("justify")};case"subscript":return function(){F.subscript()};case"superscript":return function(){F.superscript()};case"indent":return function(){F.indent()};case"outdent":return function(){F.indent(!0)};case"orderedList":return function(){F.insertList(!0)};case"unorderedList":return function(){F.insertList()};case"removeformat":return function(){F.removeFormat().closePopup().collapseSelection()}}return null},E=function(e){return n("<a/>").addClass("wysiwyg-toolbar-icon").attr("href","#").attr("title",e.title).attr("unselectable","on").append(e.image)},I=function(e,t,r,a){n.each(c,function(o,i){if(i&&!(t===!1&&"showstatic"in i&&!i.showstatic||t===!0&&"showselection"in i&&!i.showselection)){var s;s="click"in i?function(e){i.click(n(e))}:"popup"in i?function(e){var t=r(),o=i.popup(t,n(e));a(t,e,o)}:T(o,function(e,t){var n=r();n.append(e),a(n,t),n.find("input[type=text]:first").focus()});var l;s?l=E(i).click(function(e){return s(e.currentTarget),T(o)&&F.getElement().focus(),e.stopPropagation(),e.preventDefault(),!1}):i.html&&(l=n(i.html)),l&&e.append(l)}})},M=function(r,a,o,i){for(var s=a.get(0),l=s.offsetParent,c={left:0,top:0},u=!1,p=!1,f=r.width(),d=l;d;){c.left+=d.offsetLeft,c.top+=d.offsetTop;var w=n(d);"fixed"==w.css("position")&&(u=!0),"visible"!=w.css("overflow")&&(p=!0),d=d.offsetParent}var h=n(l||t.body);h.append(r),o+=s.offsetLeft,i+=s.offsetTop,(u||p)&&(o+f>h.width()-1&&(o=h.width()-f-1),1>o&&(o=1));var g=n(e).width();c.left+o+f>g-1&&(o=g-c.left-f-1);var y=u?0:n(e).scrollLeft();c.left+o<y+1&&(o=y-c.left+1),r.css({left:parseInt(o)+"px",top:parseInt(i)+"px"})},D={},j=null,H=function(e,t,r,a){var o=function(e,t,r,a,o,i,s){if(C){var l=j||"";switch(t){case 8:l=l.substring(0,l.length-1);case 13:case 27:case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:if(e)return;r=!1;break;default:if(!e)return;l+=r}var u=C(l,t,r,a,o,i,s);if("object"!=typeof u||!u.length)return c.closePopup(),j=null,u;var p=n(c.openPopup());p.hide().addClass("wysiwyg-popup wysiwyg-popuphover").empty().append(u),j=l}},i={element:e.get(0),onKeyDown:function(e,t,n,r,a,i){if(v&&v(e,t,n,r,a,i)===!1)return!1;if(t&&!n&&!r&&a&&!i){var s=t.toLowerCase();if(!D[s])return;return D[s](),!1}return o(!1,e,t,n,r,a,i)},onKeyPress:function(e,t,n,r,a,i){return m&&m(e,t,n,r,a,i)===!1?!1:o(!0,e,t,n,r,a,i)},onKeyUp:function(e,t,n,r,a,o){return b&&b(e,t,n,r,a,o)===!1?!1:void 0},onSelection:function(e,t,a,o){var i=!0,s=null;if(e&&n.each(a,function(e,t){return 0!=n(t).parents("a").length?(s=k(c,n(t).parents("a:first")),!1):void 0}),c.readOnly()?i=!1:t?s||o||j||(-1==n.inArray("selection",l.split("-"))?i=!1:e?i=!1:1==a.length&&"IMG"==a[0].nodeName&&(i=!1)):i=!1,!i)return void c.closePopup();var u,p=function(){var e=u.outerWidth(),a=r.offset(),o=n(c.getElement()).offset(),i=t.left+parseInt(t.width/2)-parseInt(e/2)+o.left-a.left,s=t.top+t.height+o.top-a.top;M(u,r,i,s)};u=n(c.openPopup()),u.hasClass("wysiwyg-popuphover")&&!u.data("special")==!s||(u=n(c.closePopup().openPopup())),j?u.show():u.hasClass("wysiwyg-popup")||(u.addClass("wysiwyg-popup wysiwyg-popuphover"),s?u.empty().append(s).data("special",!0):I(u,!0,function(){return u.empty()},p)),p()},onOpenpopup:function(){O()},onClosepopup:function(){j=null,W()},hijackContextmenu:"selection"==l,readOnly:!!e.attr("readonly")};if(a){var s=n("<div/>").addClass("wysiwyg-placeholder").html(a).hide();r.prepend(s),i.onPlaceholder=function(e){e?s.show():s.hide()}}var c=wysiwyg(i);return c},U=n("<div/>").addClass("wysiwyg-container");i&&U.addClass(i),o.wrap(U),U=o.parent(".wysiwyg-container");var A=!1;s&&(A=n("<div/>").addClass("wysiwyg-wrapper").click(function(){F.getElement().focus()}),o.wrap(A),A=o.parent(".wysiwyg-wrapper"));var F=H(o,U,s?A:U,s);if(F.legacy){var o=n(F.getElement());o.addClass("wysiwyg-textarea"),o.is(":visible")&&o.width(U.width()-(o.outerWidth()-o.width()))}else n(F.getElement()).addClass("wysiwyg-editor");var K=null,O=function(){K&&clearTimeout(K),K=null,U.addClass("wysiwyg-active"),U.find(".wysiwyg-toolbar-focus").slideDown()},W=function(){K||t.activeElement==F.getElement()||(K=setTimeout(function(){U.removeClass("wysiwyg-active"),0==n.trim(F.getHTML().replace(/<br\s*[\/]?>/gi,"")).length&&U.find(".wysiwyg-toolbar-focus").slideUp()},100))};n(F.getElement()).focus(O).blur(W);var q={};if(n.each(c,function(e,t){if(t&&t.hotkey){var n=T(e);n&&(D[t.hotkey.toLowerCase()]=n,q[e]=n)}}),!n.isEmptyObject(c)&&"selection"!=l){var R=-1!=n.inArray("top",l.split("-")),$=-1!=n.inArray("focus",l.split("-")),z=n("<div/>").addClass("wysiwyg-toolbar").addClass(R?"wysiwyg-toolbar-top":"wysiwyg-toolbar-bottom");$&&z.hide().addClass("wysiwyg-toolbar-focus"),I(z,!1,function(){var e=n(F.openPopup());return e.hasClass("wysiwyg-popup")&&e.hasClass("wysiwyg-popuphover")&&(e=n(F.closePopup().openPopup())),e.hasClass("wysiwyg-popup")||e.addClass("wysiwyg-popup"),e},function(e,t,r){var a=n(t),o=e.outerWidth(),i=a.offset().left-U.offset().left+parseInt(a.width()/2)-parseInt(o/2),s=a.offset().top-U.offset().top;R?s+=a.outerHeight():s-=e.outerHeight(),r&&(i=r.left,s=r.top),M(e,U,i,s)}),R?U.prepend(z):U.append(z)}return{wysiwygeditor:F,$container:U}};n.fn.wysiwyg=function(e,t){if(!e||"object"==typeof e)return e=n.extend({},e),this.each(function(){var t=n(this);if(!t.data("wysiwyg")){var r=e.classes,a=e.placeholder||t.attr("placeholder"),i=e.toolbar||"top",s=e.buttons||{},l=e.submit,c=e.selectImage,u=e.placeholderUrl||null,p=e.placeholderEmbed||null,f=e.maxImageSize||null,d=e.onImageUpload||null,w=e.forceImageUpload&&d,h=e.videoFromUrl||null,g=e.onKeyDown||null,y=e.onKeyPress||null,v=e.onKeyUp||null,m=e.onAutocomplete||null,b=o(t,r,a,i,s,l,c,u,p,f,d,w,h,g,y,v,m);t.data("wysiwyg",b)}});if(1==this.length){var r=this.data("wysiwyg");if(!r)return this;if("container"==e)return r.$container;if("shell"==e)return r.wysiwygeditor}return this}});